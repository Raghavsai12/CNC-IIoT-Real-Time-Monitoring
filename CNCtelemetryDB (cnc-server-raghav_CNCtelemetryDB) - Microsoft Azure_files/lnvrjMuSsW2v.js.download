define("MsPortalImpl/Services/Services.UtilHandlers",["require","exports","FxInternal/AsyncLoader","Fx/Ajax","Fx/Cryptography","MsPortalImpl/Extension/ExtensionManagerOptions","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/Commands/UI.Commands.Lists"],(function(e,t,r,i,n,a,o,s){"use strict";t.getClientIpHandler=function(e,t,r,n){if(MsPortalFx.isFeatureEnabled("getclientipfromportalservicerp"))return i.ajax({type:"GET",uri:`${fx.internalEnv.fxPortalServiceRPEndpoint}api/getClientIP?api-version=2024-03-01`,setAuthorizationHeader:{resourceName:"portalservicerp"},setTelemetryHeader:"GetClientIPFromPortalServiceRP",performRetry:!0}).then((e=>e.address));const a=fx.internalEnv.atmEndPoint,o="api/Utilities/getClientIp";return i.postJSON({isBackgroundTask:!1,uri:a?`https://${a}/${o}`:l(o),performRetry:!0,setAuthorizationHeader:{resourceName:"self"},setTelemetryHeader:"GetClientIP"},{}).then((e=>e.address))},t.getClientIpv6Handler=function(e){const t=e?.fallbackToIPv4;return i.postJSON({isBackgroundTask:!1,uri:l("api/Utilities/getClientIp"),performRetry:!0,setAuthorizationHeader:{resourceName:"self"},setTelemetryHeader:"GetClientIPv6"},{}).then((e=>{let r=e.address;return!t&&r?.includes(".")&&(r=null),r}))},t.x509CertificateRpcHandler=t.pinPartsRpcHandler=t.hmacShaRpcHandler=t.getPublishingProfileRpcHandler=void 0;var l=MsPortalFx.Base.Resources.getAppRelativeUri;t.getPublishingProfileRpcHandler=e=>i.postJSON({isBackgroundTask:!1,uri:l("api/PublishingProfile/getPublishingProfile"),performRetry:!0},e);t.pinPartsRpcHandler=(e,{srcWindowId:t},i,n)=>{const l=[],p=e.parts.filter((e=>{if(!e.resourceId)return!0;l.push(e)}));let c=[];if(l.length){const e=o.Locator.fromJSON(n.get(a.ExtensionManagerOptions),{name:"ResourceMenuBlade",type:1,parent:{name:"HubsExtension",type:0}});c=l.map((t=>(0,s.executePin)(i,n,{model:{id:t.resourceId},locator:e},"Rpc")))}if(p.length){const i=!e.options||e.options.notify;c.push(r.get("MsPortalImpl/UI/Dashboard/Common/DashboardPinHelper","pinTilesWithDashboardSelection").then((e=>e(n,"Rpc",null,{partReferences:p,originExtension:t,notify:i}))))}return Promise.all(c).then(MsPortalFx.noop)};t.x509CertificateRpcHandler=e=>i.postJSON({isBackgroundTask:!1,uri:l("api/X509Certificate/getX509Certificates"),performRetry:!0},e);t.hmacShaRpcHandler=e=>window.crypto||window.msCrypto?(0,n.getHmacSha256UsingCryptoApi)(e.key,e.stringToHash):i.postJSON({isBackgroundTask:!1,uri:l("api/Utilities/gethmacsha256"),performRetry:!e.skipRetry},e).then((e=>e.data))}));