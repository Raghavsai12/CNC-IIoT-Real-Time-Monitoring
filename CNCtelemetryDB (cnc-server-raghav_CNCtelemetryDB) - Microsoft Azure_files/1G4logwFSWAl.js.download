define("MsPortalImpl/AzFramework/AzHost.Notifications",["require","exports","Fx/Composition/Selectable","MsPortalImpl/Base/Base.ImplUtils","FxInternal/Notifications"],(function(e,t,i,n,o){"use strict";t.mapAndExecuteAzureAsyncOperation=function(t,i){const n=t.response,a=t.notificationOptions,{title:u,description:m,id:p,pollingDetails:d,linkTo:N,actions:y}=a,g=s(N,i,"",p,d?.defaultTelemetryName),T=l(Array.isArray(y)?[...y]:y,i,"",p,d?.defaultTelemetryName);if(!1===g||null===T)return null;const $={title:u,description:m,id:p,pollingDetails:r(d,i,p),..."linkTo"in a&&{linkTo:g},..."actions"in a&&{actions:T}};if(!$.pollingDetails||!(0,o.validatePollingDetails)($.pollingDetails,c(e,i)))return null;if(f($.title,$.description,i,$.id,$.pollingDetails?.defaultTelemetryName)&&$.pollingDetails)return(0,o.executeAzureAsyncOperation)(new Promise((e=>{e(n)})),$,!0,!0,"ReactView"),{id:p};return null},t.mapAndPublishInternalNotification=function(e,t){const{title:i,description:n,id:r,status:u,linkTo:c,actions:p}=e,d=s(c,t,"",r),N=l(Array.isArray(p)?[...p]:p,t,"",r);if(!1===d||null===N)return null;const y={title:i,description:n,status:a[u],id:r,..."linkTo"in e&&{linkTo:d},..."actions"in e&&{actions:N}};if(f(y.title,y.description,t,y.id)&&m(y.status,t,"",y.id)){return{id:(0,o.publishNotification)(y,!0,"ReactView").id}}return null},t.mapAndPublishInternalPendingNotification=function(e,t){const{title:i,description:n,id:a,percentComplete:r,linkTo:u,actions:c}=e,m=s(u,t,"",a),p=l(Array.isArray(c)?[...c]:c,t,"",a);if(!1===m||null===p)return null;if(!isNaN(r)&&(0>r||r>100))return null;const d={title:i,description:n,id:a,..."linkTo"in e&&{linkTo:m},..."actions"in e&&{actions:p},..."percentComplete"in e&&{percentComplete:r}};if(f(d.title,d.description,t,d.id)){return{id:(0,o.publishPendingNotification)(d,!0,"ReactView").id}}return null},t.mapAndPublishInternalPollingNotification=function(t,i){const{title:n,description:a,id:u,pollingDetails:m,linkTo:p,actions:d}=t,N=s(p,i,"",u,m?.defaultTelemetryName),y=l(Array.isArray(d)?[...d]:d,i,"",u,m?.defaultTelemetryName);if(!1===N||null===y)return null;const g={title:n,description:a,id:u,pollingDetails:r(m,i,u),..."linkTo"in t&&{linkTo:N},..."actions"in t&&{actions:y}};if(!g.pollingDetails||!(0,o.validatePollingDetails)(g.pollingDetails,c(e,i)))return null;if(f(g.title,g.description,i,g.id,g.pollingDetails?.defaultTelemetryName)&&g.pollingDetails){return{id:(0,o.publishPollingNotification)(g,!0,"ReactView").id}}return null};MsPortalFx.Base.Diagnostics.LogEntryLevel;const a={0:0,1:1,2:2,4:4};function l(t,o,a,l,s){if(!t)return;if(!Array.isArray(t)&&"object"==typeof t){const r=function(t,o,a,l,s){const r=t,u=t;if(t){if("string"==typeof t)return t;if(r.bladeName){const{extensionName:t,bladeName:u,openInContextPane:c,tryOpenInDockedContextPane:f}=r,m=r?.parameters??Object.create(null);if(!t){let t=`When Notification${a}.actions.action is not a string with a bladeName property, it must contain a non-empty 'extensionName'. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",void(0,n.logToExtension)(e,o,2,t)}return new i.BladeReference({blade:u,extension:t,parameters:m,openInContextPane:c,tryOpenInDockedContextPane:f})}if(u.assetId||u.assetType){const{assetId:t,assetType:i,extensionName:r}=u;if(!r||!i||!t){let t=`When Notification${a}.actions.action is not a string with either an assetId or an assetType, it must contain a non-empty 'assetId', 'assetType' and 'extensionName'. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",void(0,n.logToExtension)(e,o,2,t)}return`#asset/${r}/${i}/${t}`}let c=`When Notification${a}.actions.action is not a string it must contain an 'extensionName' property, and either ('bladeName' and 'parameters' properties) or ('assetId' and 'assetType' properties). NotificationId: ${l}.`;return c+=s?` Telemetry Name: ${s}`:"",void(0,n.logToExtension)(e,o,2,c)}return t}(t?.action,o,a,l,s);return r?{...t,action:r}:null}if(!Array.isArray(t))return null;if(t.length>3){let t=`When Notification${a}.actions are included as an array, it must be no more than 3 buttons. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,t),null}const r=t.map((t=>function(t,o,a,l,s){let r;if(!t.action)return null;if("string"==typeof t.action)r=t.action;else if(t.action.partName){const i=t.action,{extension:u,partName:c}=i,f=i?.parameters??Object.create(null);if(!u){let t=`When Notification${a}.actions aka buttons have a non-string with partName, they must contain a non-empty 'extension'. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,t),null}r={partName:c,extension:u,parameters:f}}else{const l=t.action,{extensionName:u,bladeName:c,openInContextPane:f,tryOpenInDockedContextPane:m}=l,p=l?.parameters??Object.create(null);if(!u||!c){let t=`When Notification${a}.actions aka buttons have a non-string, they must contain a non-empty 'bladeName' and 'extensionName'.`;return t+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,t),null}r=new i.BladeReference({blade:c,extension:u,parameters:p,openInContextPane:f,tryOpenInDockedContextPane:m})}return{...t,action:r}}(t,o,a,l,s))).filter((e=>!!e));return t.length!==r.length?null:r}function s(t,o,a,l,s){const r=t,u=t;if(t){if("string"==typeof t)return t;if(r.bladeName){const{extensionName:t,bladeName:u,openInContextPane:c,tryOpenInDockedContextPane:f}=r,m=r?.parameters??Object.create(null);if(!t){let t=`When Notification${a}.linkTo is not a string with a bladeName property, it must contain a non-empty 'extensionName'. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,t),!1}return new i.BladeReference({blade:u,extension:t,parameters:m,openInContextPane:c,tryOpenInDockedContextPane:f})}if(u.assetId||u.assetType){const{assetId:t,assetType:i,extensionName:r}=u;if(!r||!i||!t){let t=`When Notification${a}.linkTo is not a string with either an assetId or an assetType, it must contain a non-empty 'assetId', 'assetType' and 'extensionName'. NotificationId: ${l}.`;return t+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,t),!1}return`#asset/${r}/${i}/${t}`}let c=`When Notification${a}.linkTo is not a string it must contain an 'extensionName' property, and either ('bladeName' and 'parameters' properties) or ('assetId' and 'assetType' properties). NotificationId: ${l}.`;return c+=s?` Telemetry Name: ${s}`:"",(0,n.logToExtension)(e,o,2,c),!1}return t}function r(t,i,o){if(!t)return(0,n.logToExtension)(e,i,2,`Polling Notifications must contain pollingDetails. NotificationId: ${o}.`),null;const l=t.defaultTelemetryName;if(t.responseNotificationByStatusCode&&!t.uri?.trim()){let t=`Polling Notifications must contain an ARM/ARG uri to poll against. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}if(!t.defaultFailureNotification){let t=`Notification PollingDetails must contain a defaultFailureNotification. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}const s=u(t.defaultFailureNotification,i,".pollingDetails.defaultFailureNotification",o,l);if(!s)return null;let r,c;if(t.pollingTimeout){const a=t.pollingTimeout?.failureNotification,l=t.pollingTimeout?.telemetryName;if(!a){let t=`When including a PollingDetails.pollingTimeout, a PollingDetails.pollingTimeout.failureNotification is required. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}if(r=u(a,i,".pollingDetails.pollingTimeout.failureNotification",o,t.pollingTimeout?.telemetryName),!r)return null}const f=t,p=t;if(f.responseNotificationByStatus||f.keepPollingStatuses){if(!Array.isArray(f.keepPollingStatuses)||!f.keepPollingStatuses.length){let t=`Notification PollingDetails.keepPollingStatuses must be an array with 1 or more 3 digit HTTP response codes. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}if(!f.responseNotificationByStatus||"object"!=typeof f.responseNotificationByStatus||!Object.keys(f.responseNotificationByStatus).length){let t=`Notifications PollingDetails.responseNotificationByStatus must be a record containing at least one key/value pair. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}c="responseNotificationByStatus"}else{if(!Array.isArray(p.keepPollingCodes)||!p.keepPollingCodes.length){let t=`Notification PollingDetails.keepPollingCodes must be an array with 1 or more 3 digit HTTP response codes. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}if(!p.responseNotificationByStatusCode||"object"!=typeof p.responseNotificationByStatusCode||!Object.keys(p.responseNotificationByStatusCode).length){let t=`Notifications PollingDetails.responseNotificationByStatusCode must be a record containing at least one key/value pair. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}c="responseNotificationByStatusCode"}if(f.responseNotificationByStatus&&p.responseNotificationByStatusCode){let t=`Polling Notifications can only have PollingDetails.responseNotificationByStatusCode or PollingDetails.responseNotificationByStatus, but not both. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}if(f.keepPollingStatuses&&p.keepPollingCodes){let t=`Polling Notifications can only have PollingDetails.keepPollingStatuses or PollingDetails.keepPollingCodes, but not both. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),null}let d=!0;const N={};if(Object.entries(p.responseNotificationByStatusCode||f.responseNotificationByStatus).forEach((t=>{const s=t[0]+"",r=t[1];if(!r){d=!1;let t=`Notifications PollingDetails.${c} must not contain empty records. NotificationId: ${o}.`;return t+=l?` Telemetry Name: ${l}`:"",void(0,n.logToExtension)(e,i,2,t)}if("object"!=typeof r)return void(N[s]=r+"");const f=r.notification;if(!f){d=!1;let t=`Notifications PollingDetails.${c}[${s}].notification must be present.`;const o=r.telemetryName||l;return t+=o?` Telemetry Name: ${o}`:"",void(0,n.logToExtension)(e,i,2,t)}if(!m(a[f.status],i,`.pollingDetails.${c}[${s}].notification`,o,r.telemetryName))return void(d=!1);let p=u(f,i,`.pollingDetails.${c}[${s}].notification`,o,r.telemetryName);if(!p)return void(d=!1);p={...p,status:a[f.status]};const y=r.requiredResponseValue,g=y?.failureNotification;let T;if(y){if(!y.location||!Array.isArray(y.location)||!y.location.length){d=!1;let t=`Notifications PollingDetails.${c}[${s}].requiredResponseValue.location must be an array with at least 1 value. NotificationId: ${o}.`;return t+=y.telemetryName?` Telemetry Name: ${y.telemetryName}`:"",void(0,n.logToExtension)(e,i,2,t)}if(void 0===y.value){d=!1;let t=`Notifications PollingDetails.${c}[${s}].requiredResponseValue.value can't be 'undefined'. NotificationId: ${o}.`;return t+=y.telemetryName?` Telemetry Name: ${y.telemetryName}`:"",void(0,n.logToExtension)(e,i,2,t)}const t=y.pollingValues;if(t&&(!Array.isArray(t)||t.some((e=>"object"==typeof e&&null!==e||"function"==typeof e)))){d=!1;let t=`Notifications PollingDetails.${c}[${s}].requiredResponseValue.pollingValues when defined must be an array and values contained must be of string, number, or boolean type. NotificationId: ${o}.`;return t+=y.telemetryName?` Telemetry Name: ${y.telemetryName}`:"",void(0,n.logToExtension)(e,i,2,t)}if("failureNotification"in y){const e=u(g,i,`.pollingDetails.${c}[${s}].requiredResponseValue.failureNotification`,o,y.telemetryName);if(!e)return void(d=!1);T={location:y?.location,value:y?.value,failureNotification:e,...y&&"pollingValues"in y&&{pollingValues:y.pollingValues}}}}T||(T={location:y?.location,value:y?.value,...y&&"pollingValues"in y&&{pollingValues:y.pollingValues}});const $={notification:{...p},...T.location&&{requiredResponseValue:T}};N[s]=$})),!d)return null;return{defaultFailureNotification:s,..."keepPollingCodes"in t&&{keepPollingCodes:t.keepPollingCodes},..."keepPollingStatuses"in t&&{keepPollingStatuses:t.keepPollingStatuses},..."responseNotificationByStatusCode"in t&&{responseNotificationByStatusCode:N},..."responseNotificationByStatus"in t&&{responseNotificationByStatus:N},uri:t.uri,..."customDelayInMs"in t&&{customDelayInMs:t.customDelayInMs},..."pollingTimeout"in t&&t.pollingTimeout&&{pollingTimeout:{timeoutInMs:t.pollingTimeout.timeoutInMs,failureNotification:r}},..."authDetails"in t&&{authDetails:t.authDetails}}}function u(t,i,o,a,r){const u=t.title,c=t.description,f=s(t.linkTo,i,o,a,r),m=l(Array.isArray(t.actions)?[...t.actions]:t.actions,i,o,a,r);if(!1===f||null===m)return null;if("title"in t&&!u?.trim()){let t=`When Notification${o}.title is defined, it can't be undefined, null, empty, or only containing whitespace. NotificationId: ${a}`;return t+=r?` Telemetry Name: ${r}`:"",(0,n.logToExtension)(e,i,2,t),null}if("description"in t&&!("string"==typeof c&&c?.trim()||"string"!=typeof c&&c?.htmlTemplate?.trim())){let t=`When Notification${o}.description or Notification${o}.description.htmlTemplate is defined, it can't be undefined, null, empty, or only containing whitespace. NotificationId: ${a}`;return t+=r?` Telemetry Name: ${r}`:"",(0,n.logToExtension)(e,i,2,t),null}return{..."title"in t&&{title:u},..."description"in t&&{description:c},..."linkTo"in t&&{linkTo:f},..."actions"in t&&{actions:m}}}function c(e,t){return{verbose:(i,...o)=>{(0,n.logToExtension)(e,t,0,i,null)},warning:(i,o,...a)=>{(0,n.logToExtension)(e,t,1,i)},error:(i,o,...a)=>{(0,n.logToExtension)(e,t,2,i)},debug:(i,...o)=>{(0,n.logToExtension)(e,t,-1,i,null)},writeEntry:(i,o,a,l)=>{(0,n.logToExtension)(e,t,i,o)}}}function f(t,i,o,a,l){if(!t?.trim()){let t=`Notification.title can't be empty. NotificationId: ${a}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,o,2,t),!1}if(!i||"string"==typeof i&&!i?.trim()||"string"!=typeof i&&!i.htmlTemplate?.trim()){let t=`Notification.description can't be empty if string, nor can htmlTemplate if HtmlContent. NotificationId: ${a}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,o,2,t),!1}return!0}function m(t,i,o,a,l){switch(t){case 0:case 1:case 2:case 4:return!0;default:{let t=`Notification${o}.status must be of type CompletedStatus. NotificationId: ${a}.`;return t+=l?` Telemetry Name: ${l}`:"",(0,n.logToExtension)(e,i,2,t),!1}}}}));