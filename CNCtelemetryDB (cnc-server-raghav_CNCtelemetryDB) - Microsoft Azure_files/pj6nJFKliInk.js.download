define("MsPortalImpl/Widgets/Widgets.Cutout",["require","exports","MsPortalImpl/Widgets/Widgets.WidgetBase"],(function(e,t,s){"use strict";t.Widget=void 0;class i extends s.Widget{constructor(e,t,s){super(e,t),this._anchor=s,this._ctx=e[0].getContext("2d"),this._isRendered=!1}remove(){if(this._isRendered){const{x:e,y:t,width:s,height:i}=this._dimensions(),n=this._ctx;n.clearRect(e,t,s,i),n.fillStyle="rgba(0, 0, 0, 0.3)",n.fillRect(e,t,s,i),this._isRendered=!1}}render(){const{x:e,y:t,width:s,height:i}=this._dimensions();if(!this._isRendered){const n=this._ctx;n.clearRect(e,t,s,i),n.fillStyle="rgba(0, 0, 0, 1)",n.strokeStyle="white",n.lineWidth=2,n.strokeRect(e+1,t+1,s-2,i-2),this._isRendered=!0}}_dimensions(){const e=this._anchor,t=e.offset();return{x:t.left,y:t.top,width:e.outerWidth(),height:e.outerHeight()}}dispose(){this.remove(),super.dispose()}}t.Widget=i})),
define("MsPortalImpl/Widgets/Widgets.Modal",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Interactions/Interactions.KeyboardNavigation","MsPortalImpl/Widgets/Widgets.Cutout","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Base/JQueryHelper","Fx/Controls/Button","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Modal.css"],(function(e,t,s,i,n,o,a,r,l,d){"use strict";t.Widget=t.ViewModel=void 0,t._setUseSynchronousRendering=function(e){f=e},(0,l.injectCss)(d);const c=MsPortalFx.Base.Diagnostics.Telemetry,h=s.Modal,u=window,m=$(document),p=$(u);function g(e,t,s){return Math.max(e,Math.min(t,s))}function x(){return Date.now()}let f=!1;function _(e){for(;e.length>0;)e.pop().dispose()}class b extends o.ViewModel{constructor(e){super(),this.closeIcon=MsPortalFx.Base.Images.Close(),this.title=ko.observable(""),this.description=ko.observable(""),this.uri=ko.observable(null),this.hasNext=ko.observable(!1),this.hasPrev=ko.observable(!1),this.sequenceState=ko.observable(0);const t=e.defaultLabels||{};this.prevLabel=t.prev||h.prevLabel,this.nextLabel=t.next||h.nextLabel,this.finishLabel=t.finish||h.finishLabel,this.closeLabel=t.close||h.closeLabel,this.linkLabel=t.link||h.linkLabel,this.modalSequenceSettings=e,this._updateIndex(0),this._telemetryLastStageStartTime=x(),this._telemetryStagesVisited=[],this._telemetrySequenceOfStages=[];const s=e.modalId,i=e.modalCategoryName;s&&i&&(this._telemetryTraceKey=c.startTrace({source:s,action:i}))}_updateIndex(e){const t=this.modalSequenceSettings.items,s=t.length-1,i=this.lastIndex=this.index;this.index=e;const n=i>=0&&i<=s?t[i]:null;n&&n.onAfter&&n.onAfter();const o=e>=0&&e<=s?t[e]:null;return o&&o.onBefore&&o.onBefore(),this.hasNext(e>=0&&e<s),this.hasPrev(e>0&&e<=s),this.title(o?o.title:""),this.description(o?o.description:""),this.uri(o?o.uri:""),this._telemetryLastStageStartTime&&this._trackStageCompletion(i),!!o}itemCount(){return this.modalSequenceSettings.items.length}currentItem(){return this.modalSequenceSettings.items[this.index]}next(){return!!this.hasNext()&&this._updateIndex(this.index+1)}prev(){return!!this.hasPrev()&&this._updateIndex(this.index-1)}jump(e){return e>=0&&e<this.itemCount()&&this._updateIndex(e)}finish(){this.sequenceState(1),this._logExitTelemetry("finish"),this._updateIndex(-1)}close(){this.sequenceState(2),this._logExitTelemetry("close"),this._updateIndex(-1)}dismiss(){this.sequenceState(3),this._logExitTelemetry("dismiss"),this._updateIndex(-1)}_trackStageCompletion(e){const t=x(),s=t-this._telemetryLastStageStartTime;this._telemetryStagesVisited.push(e),this._telemetrySequenceOfStages.push({stageIndex:e,timeToComplete:s}),this._telemetryLastStageStartTime=t}_logExitTelemetry(e){this.modalSequenceSettings.modalId&&this.modalSequenceSettings.modalCategoryName&&(this._trackStageCompletion(this.index),c.endTrace(this._telemetryTraceKey,e,{stagesVisited:this._telemetryStagesVisited,sequenceOfStages:this._telemetrySequenceOfStages}))}}t.ViewModel=b;class y extends o.Widget{constructor(e,t,s,n){super(e,t),this._currentStep=ko.observable(1),this._portal=s;const o=this.ltm;t.nextLabelComputed=ko.computed(o,(()=>t.hasNext()?t.nextLabel:t.finishLabel));const a=t.modalSequenceSettings,l=this._activeClasses=a.activeClasses,d=`fxs-modal ${a.templateClass} msportalfx-shadow-level2`,c="fxs-button",g=this._triangle=$(FxImpl.createElement("div")).addClass("fxs-modal-triangle fxs-modal-can-transition"),x="widgets-modal-sequence-title",f="widgets-modal-sequence-description";e.html(a.template).addClass(d).attr({role:"alertdialog","aria-labelledby":x,"aria-describedby":f}).append(g),e.find(`.${l.title}`)[0].id=x,e.find(`.${l.description}`)[0].id=f,n&&(this._overlay=n.addClass("fxs-modal-overlay"),s.append(n),a.overlayClickToDismiss&&n.addClass("fxs-modal-overlay-dismiss").on("click",this._dismissOnOverlayClickHandler=()=>t.dismiss()),this._cutouts=[]),t.closeButton=r.create(o,{text:"",style:1,onClick:()=>t.close(),icon:{image:t.closeIcon,position:1},ariaLabel:h.ariaCloseLabel}),t.closeTour=()=>t.close(),t.maybeLaterButton=r.create(o,{text:t.closeLabel,style:1,onClick:()=>t.close()});const _=()=>{const e=this.options;if(!this._activeClasses.progress||e.itemCount()<=1)return;const t=this._progressCircles,s="fxs-modal-progress-current";e.lastIndex>=0&&t[e.lastIndex].removeClass(s),e.index>=0&&t[e.index].addClass(s)},b=t.modalSequenceSettings.buttonWithArrow,y=MsPortalFx.Base.Images.CaretUp();t.nextButton=r.create(o,{style:a.nextPrimaryButton?0:1,text:t.nextLabelComputed,icon:b?{image:y,position:1}:null,ariaLabel:h.ariaNextLabel,onClick:()=>{if(t.hasNext()){if(t.next()){const e=this._currentStep();this._currentStep(e+1),this.render(),_()}}else t.finish()}}),t.startTourButton=r.create(o,{text:t.nextLabel,style:0,onClick:()=>{t.finish()}});const S=e.find(`.${l.next}`);t.prevButton=r.create(o,{text:t.prevLabel,visible:t.hasPrev,icon:b?{image:y,position:0}:null,ariaLabel:h.ariaPrevLabel,style:1,onClick:()=>{if(t.prev()){const e=this._currentStep();this._currentStep(e-1),this.render(),_(),0===t.index&&1===t.lastIndex&&S.find(`.${c}`).focus()}}}),t.modalSequenceSettings.escapeToDismiss&&m.on("keydown",this._exitKeyHandler=e=>{27===e.keyCode&&t.close()});l.stepText&&t.itemCount()>1&&(t.stepText=ko.computed(o,(()=>h.stepText.format(this._currentStep(),t.itemCount()))));const C=l.progress;if(C&&t.itemCount()>1){const s=e.find(`.${C}`).addClass("fxs-modal-progress"),i=this._progressCircles=[];for(let e=0;e<t.itemCount();e++){const n=$(FxImpl.createElement("button")).addClass("fxs-modal-progress-circle").attr("aria-label",h.ariaJumpLabel.format(e)).on("click",(()=>{t.jump(e)&&(this.render(),_())}));i.push(n),s.append(n)}_()}this._lastFocus=$(document.activeElement),new i.KeyboardNavigation(this.ltm,{element:e}),ko.applyBindings(t,e[0]),this.render(!0),p.on("resize",this._renderOnResizeHandler=e=>{u.requestAnimationFrame((()=>{this.options.jump(this.options.index),this.render()}))}),setTimeout((()=>{S.find(`.${c}`).focus()}),100)}render(e){f?this._render(e):u.requestAnimationFrame((()=>this._render(e)))}_render(e){const t=this.element,s=this._triangle,i=this.options.currentItem(),r=this._overlay,l=this._portal,d=document.body,c=d.clientWidth,h=d.clientHeight,m=t.outerWidth(),p=t.outerHeight();if(r){const e=r[0];e.width=c,e.height=h;const t=e.getContext("2d");t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,c,h);const s=this._cutouts;_(s);const d=i.cutouts;d&&d.map((e=>{let t=l.find(`.${e}`);t.length>1&&(t=a.filterVisible(l[0],"."+e));const i=new n.Widget(r,new o.ViewModel,t);s.push(i),i.render()}))}const x=i.anchorSide,f=i.anchorClass,b=1===x,y=2===x,S=3===x,C=4===x,v="fxs-modal-top-triangle",I="fxs-modal-right-triangle",k="fxs-modal-bottom-triangle",L="fxs-modal-left-triangle";let W,M,q="",T=0,$=0;if(f&&x){q=b?v:y?I:S?k:L;let e=l.find(`.${f}`);e.length>1&&(e=a.filterVisible(l[0],"."+f));const t=e.outerHeight(),n=e.outerWidth(),o=e.offset(),r=s.outerHeight(),d=s.outerWidth();let u=o.left,x=o.top;const _=parseInt(i.left||"0",10),w=10;let P=-w,B=-w;y&&(P=-P,u+=n),S&&(B=-B,x+=t);const R=x+parseInt(i.top||"0",10),F=u+_;W=g(0,R+B,h-p),M=g(0,F+P,c-m),b||S?(T=b?p:-r,$=g(w,F-M,m-d-w)):(T=g(w,R-W,p-r-w),$=C?m:-d)}else W=h/2-p/2,M=c/2-m/2;t.css("transform",`translate(${Math.floor(M)}px, ${Math.floor(W)}px) translateZ(0)`),s.css("transform",`translate(${Math.floor($)}px, ${Math.floor(T)}px) translateZ(0)`).removeClass(`${v} ${I} ${k} ${L}`).addClass(q),e&&u.requestAnimationFrame((()=>{const e="fxs-modal-can-transition";t.addClass(e),s.addClass(e)}))}dispose(){p.off("resize",this._renderOnResizeHandler),m.off("keydown",this._exitKeyHandler),this._lastFocus.focus();const e=this._overlay;e&&(e.off("click",this._dismissOnOverlayClickHandler),_(this._cutouts)),this._cleanElement(),super.dispose()}_getOverlay(){return this._overlay}}t.Widget=y}));