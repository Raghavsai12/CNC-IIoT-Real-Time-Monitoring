define("FxInternal/Controls/BaseResourceDropDown",["require","exports","Fx/Controls/CustomHtml","FxInternal/Controls/DropDown","FxInternal/Utils/ValidationHelper","FxInternal/ResourceManagement/Policies"],(function(e,t,n,r,o,i){"use strict";var a;return function(e){var t=MsPortalFx.Resources.Strings.ViewModels.Controls.CreatorAndComboBox,a=function(){function e(e,o,i,a,s){var u,l=this;this.controlType=124,this.vmKind="Fx",this.labelPosition=ko.observable(),this._msPortalFxRequired=ko.observable(),this._msPortalFxLeftLabelWidth=ko.observable(),this._fetching=ko.observable(!0),this._fetchingId=0,this.fetchedValues=ko.observableArray(),this.outerCssClass=s,this._valueKeyMap=a,this._value=ko.isObservable(o.value)?o.value:ko.observable(o.value);var c,d,p,v=ko.observable(),m=ko.pureComputed((function(){var e=ko.unwrap(o.topItemValue);return(e?[e]:[]).concat(l.fetchedValues()).filter((function(e){return!!e}))}));!function(e,t,n){var r,o,i=e&&e.createChildLifetime(),a=t.observable(),s=n.observable(),u=function(){r&&!r.isDisposed||(r=t.observable.subscribe(i,(function(e){t.map(e)!==n.observable()&&(r.dispose(),n.observable(t.map(e)),u())}),n)),o&&!o.isDisposed||(o=n.observable.subscribe(i,(function(e){n.map(e)!==t.observable()&&(o.dispose(),t.observable(n.map(e)),u())}),n))},l=function(e){return!MsPortalFx.isUndefined(e)};l(a)?n.observable(t.map(a)):l(s)&&t.observable(n.map(s));u()}(e,{observable:this._value,map:function(e){return l._valueKeyMap(e)}},{observable:v,map:function(e){return MsPortalFx.find(m().concat([l.value()]),(function(t){return t&&l._valueKeyMap(t)===e}))}}),this._validations=ko.isObservable(o.validations)?o.validations:ko.observableArray(o.validations||[]),ko.computed(e,(function(){var e=ko.unwrap(o.noWrapValidations)||[];return ko.unwrap(l._validations).map((function(t){if(21===t.type&&!e.includes(t)){var n=t;return n.wrappedValidate||(n.wrappedValidate=n.validate,n.validate=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return n.wrappedValidate.apply(n,__spreadArray([l._value.peek()],t,!1))}),n}return t}))})).subscribeAndRun(e,o.validations=ko.observableArray()),o.grouping&&(d=o.grouping.map,p=o.grouping.sort,c=o.grouping.mapToHtml),o.onFetchedValues&&this.fetchedValues.subscribe(e,(function(e){return o.onFetchedValues([].concat(e))})),p=p||function(e,t){return 0};var f=ko.observableArray(),b=(null===(u=o.hiding)||void 0===u?void 0:u.hide)||MsPortalFx.wrap(!1),g=ko.observable(),h=o.sort?null:function(e,t){return MsPortalFx.compare(e.text,t.text)},x=o.sort||MsPortalFx.wrap(0),y=o.cssClass||ko.observable(""),_=function(e){return!b(e)||(g(o.hiding.reason),!1)},I=d,w=p;o.disable&&(d=d||function(e){return""},I=function(e){var t;return(t=o.disable(e))&&f.push(t),t||d(e)},w=function(e,t){var n=f.indexOf(e),r=f.indexOf(t);return~n&&!~r?1:!~n&&~r?-1:p&&p(e,t)||0});var P=ko.pureComputed((function(){var e=ko.unwrap(o.topItemValue),n=ko.unwrap(c)||{};g(null);var r=m().filter(_).sort((function(t,n){return t===e?-1:n===e?1:x(t,n)})).map((function(n){var r=i(n);return n===e&&(r.text=t.newItemText.format(r.text)),r}));if(r=h?r.sort(h):r,I){var a=r.reduce((function(e,t){var r,o=I(t.value),i=null===(r=null==n?void 0:n[o])||void 0===r?void 0:r.itemAriaLabel;return i&&(t.ariaLabel="".concat(i," ").concat(t.text)),(e[o]=e[o]||[]).push(t),t.value=l._valueKeyMap(t.value),e}),{}),s=Object.keys(a).sort(w).reduce((function(e,t){return t?(e.push({children:a[t],text:n[t]||t,disabled:!!~f.indexOf(t)}),e):e.concat(a[t])}),[]);return f([]),s}var u=ko.unwrap(o.header);return(u?[u]:[]).concat(I?r:r.map((function(e){return e.value=l._valueKeyMap(e.value),e})))})).extend({deferred:!0}),F=ko.observableArray();P.subscribeAndRun(e,(function(e){F(e)})),this.subLabel=MsPortalFx.initObservable(o.subLabel);var C=o.subLabel,k={htmlTemplate:'\n                        \x3c!--ko if: fxSubLabel--\x3e\n                           <div data-bind="pcCustomHtmlField: fxSubLabel"></div>\n                        \x3c!-- /ko --\x3e\n                        \x3c!--ko if: reason--\x3e\n                            <div data-bind="text: reason"></div>\n                        \x3c!-- /ko --\x3e\n                        \x3c!--ko if: subLabel--\x3e\n                           <div data-bind="pcCustomHtmlField: subLabel"></div>\n                        \x3c!-- /ko --\x3e\n                ',viewModel:{reason:g,fxSubLabel:o.fxSublabel,subLabel:ko.pureComputed((function(){var t=ko.unwrap(C);if("string"==typeof t)return n.create(e,{htmlTemplate:t});var r=t||{},o=r.viewModel,i=r.htmlTemplate;return i?n.create(e,{htmlTemplate:i,innerViewModel:o,isolated:!0}):null}))}};delete o.subLabel,this._fxDropDown=new r.ViewModel(e,MsPortalFx.extend(o,{cssClass:y,items:F,loading:this._fetching,value:v,subLabel:k})),this.control=ko.observable(this._fxDropDown),this.valid=ko.computed(e,{read:function(){return l.control().valid()},write:function(e){return l.control().valid(e)}}),this.labelPosition=ko.computed(e,{read:function(){return l.control().labelPosition()},write:function(e){return l.control().labelPosition(e)}}),this._msPortalFxRequired=ko.computed(e,{read:function(){return l.control()._msPortalFxRequired()},write:function(e){return l.control()._msPortalFxRequired(e)}}),this._msPortalFxLeftLabelWidth=ko.computed(e,{read:function(){return l.control()._msPortalFxLeftLabelWidth()},write:function(e){return l.control()._msPortalFxLeftLabelWidth(e)}}),o.onIsPopUpOpen&&this._fxDropDown.isPopUpOpen.subscribe(e,o.onIsPopUpOpen)}return Object.defineProperty(e.prototype,"dirty",{get:function(){return this._fxDropDown.dirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableValidation",{get:function(){return this._fxDropDown.enableValidation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ensureValidation",{get:function(){return this._fxDropDown.ensureValidation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"label",{get:function(){return this._fxDropDown.label},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"validations",{get:function(){return this._validations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"validationResults",{get:function(){return this._fxDropDown.validationResults},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._fxDropDown.disabled},enumerable:!1,configurable:!0}),e.prototype.triggerValidation=function(e){return(0,o.tryOnTriggerValidation)(this),this._fxDropDown.triggerValidation(e)},Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){return this._fxDropDown.loading},enumerable:!1,configurable:!0}),e.prototype.selectInitialOrCurrent=function(e,t){return __awaiter(this,arguments,void 0,(function(e,t,n,r,o){var i,a,s,u,l,c,d,p=this;return void 0===n&&(n=!0),void 0===r&&(r=!0),void 0===o&&(o=!1),__generator(this,(function(v){switch(v.label){case 0:return[4,Promise.allSettled([this._initialPromise])];case 1:return i=v.sent()[0],a="fulfilled"===i.status?i.value:void 0,s=this.value(),u=s&&[this._valueKeyMap(s)]||[],l=u.concat(a||[]).filter((function(e){return!!e})),o&&(c=l.map((function(e){return e.toLowerCase()})),l=c),this.fetchedValues(e.slice(0)),(l.length||n)&&(d=e.filter((function(e){var t=p._valueKeyMap(e);return o&&(t=(null!=t?t:"").toLowerCase()),!!~l.indexOf(t)})).sort((function(e,t){return MsPortalFx.compare(MsPortalFx.findIndex(l,(function(t){var n=p._valueKeyMap(e);return o&&(t=(null!=t?t:"").toLowerCase(),n=n.toLowerCase()),t===n})),MsPortalFx.findIndex(l,(function(e){var n=p._valueKeyMap(t);return o&&(e=(null!=e?e:"").toLowerCase(),n=n.toLowerCase()),e===n})))})).concat(e)[0],r&&this.value(d)),~[null,void 0].indexOf(this.value())&&this.value(t),[2]}}))}))},e.createControlPlaneValidator=i.PolicyValidationFactoryImpl.createControlPlaneValidator,e}();e.ViewModel=a}(a||(a={})),a})),
define("FxInternal/ResourceManagement/ArmCreateTelemetry",["require","exports","Fx/DependencyInjection","Fx/Telemetry"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ArmCreateTelemetry=void 0;var o=function(){function t(){this._resourceType={},this._telemetryIds=[]}return Object.defineProperty(t.prototype,"telemetryId",{set:function(e){this._telemetryIds.push(e),this._telemetryIds.includes(e)||(this._resourceType[e]={})},enumerable:!1,configurable:!0}),t.prototype.traceSubscriptionSelected=function(e){var t=this._telemetryIds[0];t&&this._resourceType[t]&&(0,r.trace)({source:"ArmCreate",action:"SubscriptionSelected",data:{subscriptionId:e,telemetryId:t}})},t.prototype.traceComparisonToProvisionedResourceTypes=function(e){var t=this,n=this._telemetryIds[0];if(n&&this._resourceType[n]){var o=Object.keys(e.reduce((function(e,r){return r in t._resourceType[n]||(e[r]=!0),e}),{}));(0,r.trace)({source:"ArmCreate",action:"ProvisionedResourceTypesMissingFromLocationDropdown",data:{missingKeys:o,telemetryId:n}})}},t.prototype.setResourceTypes=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this._telemetryIds[0];r&&this._resourceType[r]&&t.forEach((function(t){e._resourceType[r][t]=!0}))},t.prototype.popTelemetryId=function(){var e=this._telemetryIds.pop();if(!this._telemetryIds.includes(e)){var t=this._resourceType,n=e,r=(t[n],__rest(t,["symbol"==typeof n?n:n+""]));this._resourceType=r}return e},t=__decorate([__metadata("fx:diagnostics",[e,"ArmCreateTelemetry"]),n.Class()],t)}();t.ArmCreateTelemetry=o})),
define("FxInternal/ResourceManagement/Locations",["require","exports","Fx/DependencyInjection","FxHubs/ArmHelpers/ArmApis","FxHubs/ArmHelpers/ArmApisStartup","Fx/Ajax","FxInternal/ResourceManagement/ArmCreateTelemetry"],(function(e,t,n,r,o,i,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.telemetrySource=void 0,t.getLocationsAndResourceTypesForCreate=function(e){return __awaiter(this,arguments,void 0,(function(e,i,s){var v,m,f,b,g,h,x,y,_,I,w,P;return void 0===i&&(i=[]),void 0===s&&(s=""),__generator(this,(function(F){switch(F.label){case 0:return(P=n.container.get(a.ArmCreateTelemetry)).setResourceTypes.apply(P,i),v=[],m=[],f=i.map((function(n){var o=(n=n.toLowerCase()).indexOf("/"),i=n.slice(0,o);return v.push(n.slice(o+1)),{uri:e?(0,r.getResourceProviderWithSubscriptionApi)(e,i):(0,r.getResourceProviderAtScope)(s,i),arrayResponse:!1,telemetry:t.telemetrySource+".getLocForResTypes"}})),b=(0,o.callBatchWithContinuation)(f,(function(e){m.push(e)}),(function(e){var t=i[m.length],n=e.reason&&e.reason.content,r=e.reason&&e.reason.httpStatusCode;r>=400?l.warning("Could not get locations for resource type '".concat(t,"': (").concat(r,") ")+JSON.stringify(n)):m.push(null)}),!1),g={},[4,Promise.all([e?p(e):d(s),b])];case 1:return h=F.sent()[0],i.length?[3,3]:[4,Promise.resolve(h.filter((function(e){return!e.metadata||"physical"===e.metadata.regionType.toLowerCase()})))];case 2:return[2,{locations:x=(x=F.sent()).length?x:h,resourceTypeApis:g}];case 3:try{m.forEach((function(e,t){if(!e)return null;var n=i[t],r=e&&MsPortalFx.find(e.resourceTypes,(function(e){return e.resourceType.toLowerCase()===v[t]}));if(!r)return l.warning("Resource type '".concat(n,"' not found in list of returned resource types.")),void(y=[]);g["".concat(e.namespace,"/").concat(r.resourceType)]=r.apiVersions;var o=r.locations;y=y?y.filter((function(e){return!!~o.indexOf(e)})):o})),y=(y||[]).sort()}catch(e){e=e||{},l.warning("Falling back to subscription locations. Error: "+(e.message||JSON.stringify(e)))}return _=[],I=y.map((function(e){return e.replace(/ /g,"").toLowerCase()})),(w=(h||[]).filter((function(e){var t=c(e.name).toLowerCase();if(I.includes(t))return _.push(t),!0})).concat(I.filter((function(e){return!_.includes(e)})).map((function(n){var r=y[I.indexOf(n)],o="The following resource types returned '".concat(r,"' as a valid location which was not in list of all locations returned from ARM: [").concat(i.join(", "),"]");return u.trace({source:t.telemetrySource,action:"RPLocsMissingForUser",data:{message:o,subscriptionId:e,resourceTypes:i}}),{name:n,displayName:r,regionalDisplayName:r,metadata:{regionCategory:"ServiceProvided",regionType:"Manifest"}}})))).length?[2,{locations:w,resourceTypeApis:g}]:(l.warning("No locations returned for resource types: '".concat(i.join(", "),"'. Falling back to subscription locations.")),[2,{locations:h,resourceTypeApis:g}])}}))}))};var s=MsPortalFx.Base.Diagnostics,u=s.Telemetry,l=s.createLog(e);t.telemetrySource="Services.ArmLocations";var c=ko.unwrap;function d(e){var n=(0,o.listLocationsAtScopeApi)(e);return(0,i.batch)({uri:n,type:"GET",setTelemetryHeader:t.telemetrySource+".getLocForSub"}).then((function(t){if(t.content&&t.content.value)return t.content.value;throw new Error("Error getting locations at scope "+e)}))}function p(e){var n=(0,o.listSubscriptionLocationsApi)(e);return(0,i.batch)({uri:n,type:"GET",setTelemetryHeader:t.telemetrySource+".getLocForSub"}).then((function(t){if(t.content&&t.content.value)return t.content.value;throw new Error("Error getting locations for subscription "+e)}))}})),
define("FxInternal/Controls/LocationDropDown",["require","exports","FxInternal/Controls/BaseResourceDropDown","Fx/Controls/InfoBalloon","Fx","Fx/ResourceManagement","FxInternal/ResourceManagement/Locations","Fx/Composition","FxInternal/ResourceManagement/Policies"],(function(e,t,n,r,o,i,a,s,u){"use strict";var l;return function(e){var t=MsPortalFx.Resources.Strings.Azure.Locations.DropDown,l={Recommended:t.groupRecommended,Other:t.groupOther,ServiceProvided:t.groupServiceProvided,Restricted:t.groupRestricted},c={Recommended:t.groupRecommendedBubble,Other:t.groupOtherBubble,ServiceProvided:t.groupServiceProvidedBubble,Restricted:t.groupRestrictedBubble},d=(0,o.isFeatureEnabled)("regionSegments");function p(e,t){var n=l[e],o=c[e];return{htmlTemplate:'<span data-bind="text: text"></span><span tabindex="0" data-bind="pcControl: infoBalloon"></span>',viewModel:{text:n,infoBalloon:r.create(t,{content:o})},itemAriaLabel:n}}var v=function(e){function r(r,a){var l,c,v=this,m={Recommended:p("Recommended",r),Other:p("Other",r),ServiceProvided:p("ServiceProvided",r),Restricted:p("Restricted",r)},f=ko.observable(),b=[],g=MsPortalFx.initObservable(a.value),h=__assign(__assign(__assign(__assign({label:ko.observable(t.defaultLabel),filter:!0,initialLocationName:null,subscriptionId:null},d?{grouping:{mapToHtml:m,map:function(e){if(v._disabledLocations().includes(e.name))return"Restricted";var t=e.metadata;return t?(b.includes(t.regionCategory)||b.push(t.regionCategory),t.regionCategory):"ServiceProvided"},sort:function(e,t){return MsPortalFx.compare(b.concat("Restricted").indexOf(e),b.concat("Restricted").indexOf(t))}},sort:MsPortalFx.wrap(0)}:{}),a.enableEdgeLocations&&a.subscriptionId&&"openBlade"in r?{subLabel:{htmlTemplate:'<a role="link" data-bind="fxclick: edgeLocationBladeReference">'.concat(t.edgeLocationSubLabel,"</a>"),viewModel:{edgeLocationBladeReference:function(){var e,t=ko.unwrap(a.subscriptionId);r.openContextPane(s.BladeReferences.forExtension("Microsoft_Azure_Compute").forBlade("EdgeZonesPicker.ReactView").createReference({parameters:{homeLocation:(null===(e=g())||void 0===e?void 0:e.id)||"",subscriptionId:"string"==typeof t?t:null==t?void 0:t.subscriptionId},onClosed:function(e,t){2===e&&(null==t?void 0:t.id)&&(f(t),g(t))}}))}}}}:{}),a),{value:g});g.subscribe(r,(function(e){var t;e&&e.id!==(null===(t=f())||void 0===t?void 0:t.id)&&f(null)}));var x=ko.observable();ko.computed(r,(function(){var e;return(e=ko.unwrap(a.validations)||[]).concat.apply(e,x()||[])})).subscribeAndRun(r,h.validations=ko.observableArray());var y=function(e){return(null==e?void 0:e.name)||""};v=e.call(this,r,h,(function(e){return{text:d&&e.regionalDisplayName||e.displayName||e.name,value:e}}),y)||this;var _=null===(l=(0,u.getProvisioningBladeDiContainer)(r))||void 0===l?void 0:l.get(u.ProvisioningBladeDefaultPolicyAPI),I=a.resourceTypes||ko.observableArray();null===(c=n.ViewModel.createControlPlaneValidator({control:v,container:r,resourceTypeProperty:"location",convertValue:y}))||void 0===c||c.subscribe(r,x);var w=a.initialLocationName;return v._disabledLocations=ko.observableArray(),v._locationsFromArm=ko.observableArray(),v._resourceTypeApis=ko.observable(),v._resourceTypeApis.fxAwait(r).then((function(){var e;"subscribe"in I?I.subscribeAndRun(r,(function(e){var t;null===(t=null==_?void 0:_.policyScope)||void 0===t||t.resourceTypesWithApiVersion(e.map((function(e){var t,n;return[e,null===(n=null===(t=v._resourceTypeApis())||void 0===t?void 0:t[e])||void 0===n?void 0:n[0]]})))})):null===(e=null==_?void 0:_.policyScope)||void 0===e||e.resourceTypesWithApiVersion(I.map((function(e){var t,n;return[e,null===(n=null===(t=v._resourceTypeApis())||void 0===t?void 0:t[e])||void 0===n?void 0:n[0]]})))})),v._initialPromise=ko.isObservable(w)?w.fxAwaitAndRun(r):Promise.resolve(w),v._scope=ko.computed(r,(function(){var e=ko.unwrap(a.subscriptionId);return e?"string"==typeof e?i.ArmId.stringify({subscription:e,kind:1},1):i.ArmId.stringify({subscription:e.subscriptionId,kind:1},1):ko.unwrap(a.scope)})),v._scope.fxAwaitAndRun(r,(function(e){return!!e||""===e})).then((function(){return ko.computed(r,(function(){return[v._scope(),ko.unwrap(a.resourceTypes)]})).extend({deferred:!0}).subscribe(r,(function(){v.triggerValidation()}))})),(0,o.nextTick)((function(){return ko.computed(r,(function(){return[v._scope(),ko.unwrap(a.resourceTypes)]})).subscribeAndRun(r,(function(e){(e[0]||""===e[0])&&v._fetchItems(a)}))})),ko.computed(r,(function(){var e=f(),t=__spreadArray(__spreadArray([],e?[e]:[],!0),v._locationsFromArm(),!0);return a.customizeItems?a.customizeItems(t):t})).subscribe(r,(function(e){return v.selectInitialOrCurrent(e)})),ko.computed(r,(function(){return __awaiter(v,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,u.PolicyValidationFactoryImpl.getDisabledValues({container:r,values:this._locationsFromArm(),convertValue:function(e){return e.name},resourceTypeProperty:"location"})];case 1:return e=t.sent(),this._disabledLocations(e),[2]}}))}))})),v}return __extends(r,e),r.prototype._fetchItems=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r;return __generator(this,(function(o){switch(o.label){case 0:t=++this._fetchingId,o.label=1;case 1:return o.trys.push([1,,3,4]),n=!d&&e.customFetch,this._fetching(!0),[4,n?n():(0,a.getLocationsAndResourceTypesForCreate)(null,ko.unwrap(e.resourceTypes)||[],this._scope())];case 2:return r=o.sent(),t===this._fetchingId&&("locations"in r?(this._locationsFromArm([].concat(r.locations)),this._resourceTypeApis(r.resourceTypeApis)):this._locationsFromArm(r)),[3,4];case 3:return t===this._fetchingId&&(this._fetchingId=0,this._fetching(!1)),[7];case 4:return[2]}}))}))},r}(n.ViewModel);e.ViewModel=v}(l||(l={})),l})),
define("Fx/Controls/LocationDropDown",["require","exports","FxInternal/Controls/LocationDropDown"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=o,t.createCustom=function(e,t){return o(e,t)};var r=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(n.ViewModel);function o(e,t){var n;return ko.ignoreDependencies((function(){n=new r(e,t)})),n}})),
define("FxHubs/ArmHelpers/ArmLocks",["require","exports","FxHubs/ArmHelpers/ArmApis","Fx/Ajax","FxHubs/ArmHelpers/ArmIds","Fx/ResourceManagement"],(function(e,t,n,r,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isParentResource=s,t.getResourceIdFromLockScope=u,t.getAllLocksForResource=l,t.getScopeRelationshipEnum=c,t.getIsLocked=function(e){return l(e.resourceId).then((function(t){return!!(t=t.filter((function(t){return a[t.properties.level]>=a[e.lockLevel]&&0!==c(t.id,e.resourceId,!0)}))).length}))};var a={CanNotDelete:1,ReadOnly:2};function s(e,t){var n=(e||"").toLowerCase()+"/";return(t||"").toLowerCase().startsWith(n)}function u(e){return e.slice(0,e.lastIndexOf("/providers"))}function l(e){return(0,r.batch)({uri:(0,n.locksOnResourceApi)(e),type:"GET"}).then((function(e){return e.content.value.map((function(e){return MsPortalFx.extend(e.properties,{notes:e.properties.notes||""}),e})).sort(d)}))}function c(e,t,n){if(void 0===n&&(n=!0),s(t,e=n?u(e):e))return 0;var r=i.ArmId.parse(e,!0);if(o.ResourceArmIdKindMap[r.kind]){if(t.toLowerCase()===e.toLowerCase())return 1;if(s(e,t))return 2}return 4===r.kind?3:1===r.kind?4:void 0}function d(e,t){return e.name.localeCompare(t.name)}})),
define("FxInternal/ResourceManagement/ResourceGroups",["require","exports","FxHubs/ArmHelpers/ArmApisStartup"],(function(e,t,n){"use strict";function r(e){return __awaiter(this,void 0,void 0,(function(){var t,r;return __generator(this,(function(o){switch(o.label){case 0:return(t=(e||[]).filter((function(e){return!!e})).map((function(e){return{uri:n.resourceGroupsInSubscriptionApi(e),arrayResponse:!0,telemetry:"GetSubRGs"}}))).length?(r=[],[4,n.callBatchWithContinuation(t,(function(e){r.push.apply(r,e.filter(MsPortalFx.identity))}),(function(e){throw e}),!1)]):[2,[]];case 1:return o.sent(),[2,r]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getResourceGroups=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,r(e).then((function(e){return e.map((function(e){var t;return{name:e.name,location:e.location,provisioningState:null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.provisioningState}}))}))]}))}))},t.getArmResourceGroups=r})),
define("FxInternal/Controls/ResourceGroupDropDown",["require","exports","Fx/DependencyInjection","Fx/Controls/TextBox","Fx/Controls/CustomHtml","Fx/Controls/Validations","FxInternal/Controls/BaseResourceDropDown","Fx/ResourceManagement","FxHubs/ArmHelpers/ArmLocks","FxInternal/Utils/ValidationHelper","FxInternal/ResourceManagement/Permissions","FxInternal/ResourceManagement/ResourceGroups","FxInternal/ResourceManagement/Policies","FxHubs/ArmHelpers/ArmResourceGroups"],(function(e,t,n,r,o,i,a,s,u,l,c,d,p,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewModel=void 0;var m=MsPortalFx.Base,f=m.Constants,b=MsPortalFx.ViewModels,g=m.Diagnostics,h=MsPortalFx.Resources.Strings,x=FxImpl.Rpc,y=MsPortalFx.Azure,_=y.ResourceGroups.Internal,I=b.getValidationResult,w=h.Azure.ResourceGroups.DropDown,P=h.ViewModels.Controls.CreatorAndComboBox,F=h.ResourceGroup.Validation,C=Promise.resolve(I());function k(e,t){return e===t}function M(e,t){return(e=!~[void 0,null].indexOf(e)?e:"")===(t=!~[void 0,null].indexOf(t)?t:"")}function R(e){var t=ko.unwrap(e);if(t)return t.subscriptionId||t}function A(e,t){return e?"/subscriptions/".concat(e).concat(t?"/resourceGroups/".concat(t):""):""}function D(e,t){return t?(Object.defineProperty(t,"resourceId",{get:function(){return A(R(e),t.name)}}),t):null}function V(e){return 1===e?1:0}function T(e,t){var n=ko.unwrap(t)||w.defaultLabel;switch(e){case 1:return w.createNewAriaLabel.format(n);case 0:return w.useExistingAriaLabel.format(n);default:return w.defaultAriaLabel.format(n)}}var S=function(e){function t(t,a){var l,d,m=this,h=MsPortalFx.extend({label:w.defaultLabel,sort:function(e,t){return MsPortalFx.compare(e.value.name,t.value.name)},filter:!0,filterPlaceholder:a.filterPlaceholder||P.selectExisting},a);h.cssClass=a.nested?"msportalfx-nested-control":a.cssClass;var S=ko.isObservable(a.allowedMode)?a.allowedMode:ko.observable(void 0!==a.allowedMode?a.allowedMode:2);h.allowedMode=S,h.subscriptionId=a.subscriptionId||null;var L={name:"",location:"",provisioningState:""},O={mode:1,value:L},B={mode:0,value:{name:"",location:""}},E=ko.isWritableObservable(a.value)?a.value:ko.observable(a.value),G=E(),N=G||O,j={mode:0,value:{name:""}};if(G){var H=S();(2===H||0===H&&0===G.mode)&&(j=G)}var q=ko.observable(j);h.value=q,q.equalityComparer=k;var U=ko.observable(V(S()));U.equalityComparer=k;var K,W=a.validations,z=[new b.CustomValidationV(F.invalidMessage,(function(e){return(ce.isFulfilled()?de:m._fetchItems(a,!!a.initialResourceGroupName)).then((function(){return m._fetching.fxAwaitAndRun(t,(function(e){return!1===e}))})).then((function(){return _.validateResourceGroupName(e,R(a.subscriptionId),m.fetchedValues().map((function(e){return e.value.name})))}))})),new b.CustomValidationV(F.invalidMessage,(function(e){return K||(K=new y.ReservedResourceNameValidator(f.ResourceTypes.ResourceGroups)),K.validate(e)}))],J=ko.observableArray(),Z=ko.observable(q()||MsPortalFx.clone(O,!0));Z.equalityComparer=k,ko.computed(t,[q],(function(e){e&&(U(e.mode),Z&&Z(e))})),ko.computed(t,(function(){return(ko.unwrap(W)||[]).map((function(e){if(21===e.type){var t=e,n=t.validate;if("triggerSubscribable"in t){var r=t.validate;return t.validate=function(){return r(Z())},t}return new i.CustomV({message:t.message,validate:function(){return n(Z())}})}return e})).concat(z)})).subscribeAndRun(t,J);var $=ko.observable(2===S()&&G&&1===G.mode?G:null);h.topItemValue=$;var X=ko.observable(null);h.fxSublabel=X;var Y=ko.pureComputed((function(){return T(1,a.ariaLabel)}));h.ariaLabel=ko.pureComputed((function(){return T(S(),a.ariaLabel)}));var ee,te=FxImpl.lowerCaseStringMap();h.onFetchedValues=function(e){e.forEach((function(e){var t=e.value.name;t&&te.set(t.toLowerCase(),e)}))};var ne=MsPortalFx.memoize((function(){return(0,o.create)(t,{cssClass:"fxt-resourcegroup-create-container",htmlTemplate:'<a class="fxt-resourcegroup-create" role="button" data-bind="attr: { aria-label: createNewAria }, text: createNew, fxclick: openSubCreate"></a>',innerViewModel:{createNew:P.createNew,createNewAria:ko.pureComputed((function(){return"".concat(m.label(),": ").concat(P.createNew)})),openSubCreate:function(){ee&&ee.dispose(),ee=t.createChildLifetime();var e=[new b.RequiredValidation,new b.CustomValidationV(F.invalidMessage,(function(e){return _.validateResourceGroupName(e,R(a.subscriptionId),m.fetchedValues().map((function(e){return e.value.name})))})),new b.CustomValidationV(F.invalidMessage,(function(e){return K||(K=new y.ReservedResourceNameValidator(f.ResourceTypes.ResourceGroups)),K.validate(e)}))],n=r.create(ee,{ariaLabel:Y,label:w.name,placeHolderText:h.createNewPlaceholder,validations:e,value:$()&&$().value.name}),o=ko.observable(!1);ko.computed(ee,[n.valid,n.value],(function(){o(!(n.valid()&&n.value()&&n.value().length))})),t.openDialog({telemetryName:"ResourceGroupCreateNewDialog",content:{htmlTemplate:'<div style="max-width: 320px"><div data-bind="text: description" style="margin-bottom: 25px"></div><div data-bind="pcControl: textbox"></div></div>',viewModel:{description:w.description,textbox:n}},buttons:[{button:4,disabled:o},{button:1}],target:".fxt-resourcegroup-create",title:null,onClosed:function(e){4===e.button&&function(e){if(!e)return $(null);var t=MsPortalFx.clone(O,!0);t.value.name=e,t.value=D(a.subscriptionId,t.value),$(t),q(t)}(n.value())}})}}})}));S.subscribeAndRun(t,(function(e){var t=U();if(U(V(e)),!e)return $(null),X(null);if(1===t&&oe&&oe()&&ie.valid()){var n=MsPortalFx.clone(O,!0);n.value.name=oe(),$(n)}return 1===e&&!$()&&oe&&oe(""),!e&&q&&q(B),X(ne())}));var re=U()&&N.value&&N.value.name,oe=ko.observable(re||"");oe.equalityComparer=M,ko.computed(t,oe,(function(e){if(1===U()){var t=MsPortalFx.clone(O,!0);t.value.name=e,"resourceId"in t.value||(t.value=D(a.subscriptionId,t.value)),Z&&Z(t)}})),Object.defineProperty(L,"name",{get:oe,set:oe}),D(a.subscriptionId,L);var ie=r.create(t,{ariaLabel:Y,cssClass:h.cssClass,infoBalloonContent:h.infoBalloonContent,label:a.label||w.defaultLabel,placeHolderText:h.createNewPlaceholder,value:oe,validations:J}),ae=a.requiredPermissions,se=new b.CustomValidation("",(function(e){var t;if(!(null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.name))return C;var n=A(R(h.subscriptionId),e.value.name);return(0,u.getIsLocked)({lockLevel:"ReadOnly",resourceId:n}).then((function(e){return I(e&&w.lockedValidationMessage)})).catch((function(e){return g.Log.writeEntry(1,"ResourceGroupValidation","Error checking read permissions. Defaulting to false."),I()}))})),ue=new b.CustomValidation("",(function(e){return 0===e.mode?C:Promise.all([n.container.get(c.PermissionChecker).hasPermission("/subscriptions/".concat(R(a.subscriptionId)),["Microsoft.Resources/subscriptions/resourcegroups/write"]),y.getSubscriptionInfo(R(a.subscriptionId)).then((function(e){return e.displayName}))]).then((function(e){var t=e[0],n=e[1];return t?I():I(F.subscriptionHasNoPermissionsMessage.format(n))})).catch((function(e){return g.Log.writeEntry(1,"ResourceGroupValidation","Error checking resource group create permissions. Defaulting to true."),I()}))}));ko.computed(t,(function(){return __spreadArray(__spreadArray([],ko.unwrap(W)||[],!0),[se,ue],!1).map((function(e){return 21!==e.type&&(e.map=e.map||function(e){return Z().value.name}),e}))})).subscribeAndRun(t,h.validations=ko.observableArray()),m=e.call(this,t,h,(function(e){return{text:e.value.name,value:e}}),(function(e){var t;return null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.name}),"fxt-resourcegroup-dropdown")||this;var le=null===(d=null===(l=(0,p.getProvisioningBladeDiContainer)(t))||void 0===l?void 0:l.get(p.ProvisioningBladeDefaultPolicyAPI))||void 0===d?void 0:d.policyScope;le&&E.subscribe(t,le.resourceGroup),S.subscribeAndRun(t,(function(e){return m.control(1===e?ie:m._fxDropDown)}));var ce=Q(m._fetching.fxAwait(t)),de=m._fetching.fxAwait(t,(function(e){return!e}));m._textBox=ie,m._emptyControlValue=O,m._emptyDropdownValue=B,m._exposedValue=E,m._baseOptions=h,m._selectedMode=U,m._newResourceGroup=$;var pe=h.initialResourceGroupName,ve=ko.isObservable(pe)?pe.fxAwaitAndRun(t):Promise.resolve(pe),me=FxImpl.Extension.getLastResourceIdInJourneyEndPoint.invoke(x.client,f.Shell,null).then((function(e){var t=s.ArmId.parse(e,!0).resourceGroup;return t?[t]:[]}));m._initialPromise=Promise.all([ve.then((function(e){return[].concat(e||[])})),me]).then((function(e){var t=e[0],n=e[1];return t.concat(n)})),ko.computed(t,[a.subscriptionId,S],(function(){return 1!==S()||ie.value()?[ko.unwrap(a.subscriptionId)]:[]})).subscribeAndRun(t,(function(e){return e[0]&&m._fetchItems(a,1!==S())})),a.subscriptionId.fxAwaitAndRun(t).then((function(){return ko.computed(t,(function(){return[ko.unwrap(ae),ko.unwrap(a.subscriptionId),!1===ko.unwrap(m._fetching)&&U()&&$()]})).extend({deferred:!0}).subscribe(t,(function(){var e=Z();e&&e.value.name&&m.triggerValidation()}))}));var fe=E.subscribe(t,(function(e){e=e||{mode:U(),value:{name:oe(),location:"",provisioningState:""}},U()!==e.mode&&m.switchMode(e.mode);var t=ko.unwrap(m._baseOptions.allowedMode);if(1===t)oe(e.value.name);else{if(!e)return q(B);if(!m._fetching()){var n=te.get("".concat(e.value.name));n||2!==t?e=n:$(e)}q(null!=e?e:B)}})),be=(0,p.getProvisioningBladeDiContainer)(t),ge=null==be?void 0:be.get(v.ProvisioningResourceGroupTags);return(null==ge?void 0:ge.tagsExp)&&ko.computed(t,(function(){var e,t,n;return 1===(null===(e=E())||void 0===e?void 0:e.mode)?null===(n=null===(t=E())||void 0===t?void 0:t.value)||void 0===n?void 0:n.name:""})).subscribeAndRun(t,ge.newResourceGroupName),ko.computed(t,Z,(function(e){if(e=e||{mode:U(),value:{name:oe(),location:"",provisioningState:""}},U(e.mode),1===e.mode)O.value=L,oe(e.value.name);else{if(!e)return q(B);if(!m._fetching.peek()){var n=te.get(e?"".concat(e.value.name):null);n&&(e=n)}q(null!=e?e:B)}fe.dispose();var r=MsPortalFx.clone(e,!0);"resourceId"in r.value||D(a.subscriptionId,r.value),E(r),fe=E.subscribe(t,fe.callback)})),m._fxDropDown.visibleItemLimit=50,m}return __extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this._exposedValue},enumerable:!1,configurable:!0}),t.prototype.triggerValidation=function(e){return(0,l.tryOnTriggerValidation)(this),1===ko.unwrap(this._baseOptions.allowedMode)?this._textBox.triggerValidation():this._fxDropDown.triggerValidation()},t.prototype.switchMode=function(e){var t=this._selectedMode,n=ko.unwrap(this._baseOptions.allowedMode);2!==n&&void 0!==n&&(0===n?this._exposedValue(this._emptyDropdownValue):this._exposedValue(this._newResourceGroup()||this._emptyControlValue),t(n));var r=void 0===e?!t():!!e;t(e=r?1:0)},t.prototype._fetchItems=function(e){return __awaiter(this,arguments,void 0,(function(e,t){var n,r,o,i;return void 0===t&&(t=!0),__generator(this,(function(a){switch(a.label){case 0:this._fetching(!0),n=++this._fetchingId,r=e.customFetch||function(){return(0,d.getResourceGroups)([R(e.subscriptionId)])},a.label=1;case 1:return a.trys.push([1,,4,5]),[4,r()];case 2:return o=a.sent(),n!==this._fetchingId?[2]:(i=o.filter((function(e){return!!e})).map((function(t){return t.resourceId=A(R(e.subscriptionId),t.name),{mode:0,value:t}})),[4,this.selectInitialOrCurrent(i,MsPortalFx.clone(this._emptyControlValue,!0),!1,t,!0)]);case 3:return a.sent(),[3,5];case 4:return 2===ko.unwrap(this._baseOptions.allowedMode)&&this._newResourceGroup()&&this._fxDropDown.value(this._newResourceGroup().value.name),n===this._fetchingId&&(this._fetchingId=0,this._fetching(!1)),[7];case 5:return[2]}}))}))},t}(a.ViewModel);t.ViewModel=S})),
define("Fx/Controls/ResourceGroupDropDown",["require","exports","FxInternal/Controls/ResourceGroupDropDown"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e,t){var n;return ko.ignoreDependencies((function(){n=new r(e,t)})),n};var r=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(n.ViewModel)})),
define("FxInternal/Composition/ExtensionTelemetry",["require","exports","Fx","Fx/DependencyInjection"],(function(e,t,n,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionTelemetry=void 0;var o=MsPortalFx.Base.Diagnostics.Telemetry,i="fx"===(0,n.getEnvironmentValue)("extensionName")?"composition":"viewModel",a=function(){function t(e){this._telemetryContextState=FxImpl.TelemetryContext.getState(),this.extensionName=this._asyncGetCompositionProvenance(e).then((function(e){return e?e.locator.getExtensionLocator().name:(0,n.getEnvironmentValue)("extensionName")})),this.context=this._asyncGetPartContext(e).then((function(e){return e&&{Blade:{id:e.bladeId,instanceId:e.bladeInstanceId}}}))}return t.prototype._asyncGetPartContext=function(e){return"viewModel"===e.scope?e.getAsync(MsPortalFx.require("FxInternal/Composition/ViewModel").then((function(e){return e.PartContext}))):Promise.resolve(void 0)},t.prototype._asyncGetCompositionProvenance=function(e){return"viewModel"!==e.scope?e.getAsync(MsPortalFx.require("MsPortalImpl/Base/Base.ImplUtils").then((function(e){return e.CompositionProvenance}))):Promise.resolve(void 0)},t.prototype.trace=function(e){var t=this,n=Date.now();Promise.all([this.extensionName,this.context]).then((function(r){var a=r[0],s=r[1],u=__assign({timestamp:n,context:s},e);"viewModel"!==i?FxImpl.Extension.traceToExtensionEndPoint.invoke(FxImpl.Rpc.client,a,[u,t._telemetryContextState]):o.trace(u)}))},t.prototype.startTrace=function(e){var t=this,n=fx.getTimestamp();return function(r,a){var s=fx.getTimestamp();return Promise.all([t.extensionName,t.context]).then((function(u){var l=u[0],c=u[1],d=__assign({timestamp:n,context:c},e);if("viewModel"===i){var p=o.start(d);return o.endTrace(p,r,a)}FxImpl.Extension.endTraceToExtensionEndPoint.invoke(FxImpl.Rpc.client,l,[d,s,r,a,t._telemetryContextState])})),s-n}},t.prototype.getBladeId=function(){return __awaiter(this,void 0,void 0,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this.context];case 1:return[2,null===(t=null===(e=n.sent())||void 0===e?void 0:e.Blade)||void 0===t?void 0:t.id]}}))}))},t=__decorate([__metadata("fx:diagnostics",[e,"ExtensionTelemetry"]),r.Class(i),__metadata("design:paramtypes",[r.Container])],t)}();t.ExtensionTelemetry=a})),
define("FxInternal/Composition/ViewModelAdapters.DoesProvisioning",["require","exports","Fx/DependencyInjection","Fx/Composition/Selectable","FxInternal/Composition/ViewModel","FxHubs/ProvisioningRpc","Fx","FxInternal/ResourceManagement/Policies","FxHubs/MarketplaceRpc","FxInternal/ResourceManagement/ArmCreateTelemetry","FxInternal/Composition/ExtensionTelemetry"],(function(e,t,n,r,o,i,a,s,u,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DoesProvisioningContext=t.InjectedDoesProvisioning=void 0,t.setProvisioning=y;var d=MsPortalFx.ViewModels,p=FxImpl.Azure.ResourceManager,v=function(){function t(){}return t=__decorate([__metadata("fx:diagnostics",[e,"InjectedDoesProvisioning"]),n.Class("")],t)}();function m(e){return e&&{galleryItem:e,launchingContext:null==e?void 0:e.launchingContext,subscriptionId:null,subscriptionDisplayName:null,resourceGroupName:null,resourceGroupLocation:null,resourceGroupLocationDisplayName:null,deploymentName:null==e?void 0:e.deploymentName,deploymentTemplateFileUris:null==e?void 0:e.deploymentTemplateFileUris,deploymentFragmentFileUris:null==e?void 0:e.deploymentFragmentFileUris}}function f(e){return{managementGroupId:e.managementGroupId,resourceGroupLocation:e.resourceGroupLocation,location:e.location,resourceProviders:e.resourceProviders,parameters:e.parameters,referenceParameters:e.referenceParameters,marketplaceItemId:e.marketplaceItemId,parametersLinkUri:e.parametersLinkUri,provisioningHash:e.provisioningHash,templateLinkUri:e.templateLinkUri,templateJson:e.templateJson,templateLink:e.templateLink,deploymentMode:e.deploymentMode,validateTemplate:e.validateTemplate,validationResult:e.validationResult,subscriptionId:e.subscriptionId,deploymentName:e.deploymentName,resourceGroupName:e.resourceGroupName,resourceId:e.resourceId,assetType:e.assetType,launchingContext:e.launchingContext,debug:e.debug,validateRetry:e.validateRetry}}function b(e,t,n,r,o,i,a){var s,u,l=this,c=n.marketplaceItem,d=new p.Provisioner(e,t,null,{supplyTemplateDeploymentOptions:function(e,t){return Q(s)},supplyGalleryCreateOptions:function(){return m(c)}}),v=n.provisioningConfig,b=m(n.marketplaceItem),g={dontDiscardJourney:v&&v.dontDiscardJourney,galleryCreateOptions:b,supplyDashboardPartReference:function(e){return u&&u(e)||r(e)},provisioningEnabled:!0,launchPostCreate:!0};return d.provisioningConfig(g),function(e){return Q(__awaiter(l,void 0,void 0,(function(){var n,r,l;return __generator(this,(function(p){switch(p.label){case 0:return[4,a()];case 1:return n=p.sent(),c=(null==n?void 0:n.marketplaceItem)||c,u=e.supplyPartReference,s=f(__assign({launchingContext:null===(l=null==n?void 0:n.marketplaceItem)||void 0===l?void 0:l.launchingContext},e)),o()||s.validateTemplate||d.traceValidation("DeployWithoutValidate"),r=d.startProvisioning(e.parameters),d.deploymentStartedPromise.fxAwait(t).then((function(e){i(e),t.closeCurrentBlade()})),[2,r]}}))})))}}function g(e,t,n,r,o){var i=this,a=n.provisioningConfig;return function(s){return __awaiter(i,void 0,void 0,(function(){var i,u,l,c,d,p,v,m,f,b,g;return __generator(this,(function(h){switch(h.label){case 0:return[4,o()];case 1:return i=h.sent(),u=(null==a?void 0:a.dashboardPartReference)&&__assign({name:a.dashboardPartReference.partName,extension:a.dashboardPartReference.options.extensionName,parameters:(v={},v[a.dashboardPartReference.dashboardPartKeyId]=s.primaryResourceId,v)},i?{name:i.uiDefinition.createDefinition.startboardPart.name,extension:i.uiDefinition.createDefinition.startboardPart.extension,parameters:(m={},m[i.uiDefinition.createDefinition.startboardPartKeyId]=s.primaryResourceId,m)}:{}),l=__assign(__assign({notifications:{pinToDashboard:u},telemetryId:n.telemetryId,marketplaceItemId:null===(f=n.marketplaceItem)||void 0===f?void 0:f.id,galleryItemIconUri:n.marketplaceItem.mediumIconUri,launchingContext:null===(b=n.marketplaceItem)||void 0===b?void 0:b.launchingContext},i?{marketplaceItemId:i.marketplaceItem.id,galleryItemIconUri:i.marketplaceItem.mediumIconUri,launchingContext:null===(g=i.marketplaceItem)||void 0===g?void 0:g.launchingContext}:{}),s),c=4&s.deploymentMode,[4,MsPortalFx.require("FxInternal/ResourceManagement/ArmTemplate")];case 2:d=h.sent(),h.label=3;case 3:return h.trys.push([3,,5,6]),[4,d.deployStack(e,l)];case 4:return p=h.sent(),[3,6];case 5:return[7];case 6:return c?[2,p]:(r({correlationId:p.correlationId,primaryResourceId:p.primaryResourceId,deploymentId:p.deploymentId,provisioningState:p.provisioningState}),t.closeCurrentBlade(),[2,p])}}))}))}}function h(e,t,n){var r,o=new FxImpl.ViewModels.Provisioning.Provisioner(e,{supplyProvisioningPromise:function(e){return r},supplyStartboardInfo:function(){return null}}),i=t.provisioningConfig,a={dontDiscardJourney:i&&i.dontDiscardJourney,provisioningEnabled:!0};return o.provisioningConfig(a),function(e){r=e.provisioningPromise;var t=Q(o.startProvisioning(null));return t.then((function(){return n(!0)})),t}}function x(e,t,n,r,o){var i,a=this,s=n.marketplaceItem,u=new p.Provisioner(e,t,null,{supplyTemplateDeploymentOptions:function(e,t){return Q(i)},supplyGalleryCreateOptions:function(){return m(s)}}),l=n.provisioningConfig,c={dontDiscardJourney:l&&l.dontDiscardJourney,galleryCreateOptions:m(n.marketplaceItem),provisioningEnabled:!0};return u.provisioningConfig(c),function(l){return __awaiter(a,void 0,void 0,(function(){var a,c,d,p,v,m,b;return __generator(this,(function(g){switch(g.label){case 0:return[4,o()];case 1:return a=g.sent(),s=(null==a?void 0:a.marketplaceItem)||s,r(!1),i=__assign(__assign({},f(__assign({launchingContext:null===(b=null==a?void 0:a.marketplaceItem)||void 0===b?void 0:b.launchingContext},l))),{telemetryId:n.telemetryId}),c=l.formValidationOptions||{},MsPortalFx.initValue(c.validateForm,"viewModel"===e.scope)?(d=MsPortalFx.initValue(c.focusOnFirstInvalid,!1),p=!!c.validateHidden,[4,t.form.triggerValidation(d,p)]):[3,6];case 2:if(!g.sent())return u.traceValidation("FailedFormValidation"),[2,i];g.label=3;case 3:return g.trys.push([3,5,,6]),[4,u.validateTemplate(i)];case 4:return v=g.sent(),r(!0),u.traceValidation("PassedValidation"),[2,v];case 5:throw m=g.sent(),u.traceValidation("FailedArmValidation"),m;case 6:return[2,u.validateTemplate(i)]}}))}))}}function y(e,t,o,i,d,p,m){var f=this;if(!o)throw new Error("This provisioning blade has been launched with invalid inputs from marketplace. Please ensure the $schema property in your gallery package UIDefinition.json is updated to 'https://gallery.azure.com/schemas/2018-02-12/UIDefinition.json#'");var y,_,I=o.provisioningConfig;n.container.get(l.ArmCreateTelemetry).telemetryId=o.telemetryId,"viewModel"===e.scope&&(_=e.get(s.ProvisioningBladeDefaultPolicyAPI),m&&ko.computed(i,(function(){var e,t,n,r,o=_.policyScope.resourceGroup(),i=null===(e=_.policyScope.subscription())||void 0===e?void 0:e.subscriptionId,a=0===(null==o?void 0:o.mode)&&!(null===(n=null===(t=null==o?void 0:o.value)||void 0===t?void 0:t.resourceId)||void 0===n?void 0:n.includes(i));return{subscriptionId:i,resourceGroup:(null===(r=null==o?void 0:o.value)||void 0===r?void 0:r.name)&&!a&&{type:!MsPortalFx.isNullOrUndefined(null==o?void 0:o.mode)&&(1===o.mode?"New":"Existing"),name:o.value.name},resourceTypesWithApiVersion:_.policyScope.resourceTypesWithApiVersion()}})).subscribeAndRun(i,(function(e){null==m||m(e)})),_.policyApiFlag="cuid",(0,s.setProvisioningBladeDiContainer)(i,e));var w,P=ko.observable(!1),F=function(e,t,r){var o=e.get(c.ExtensionTelemetry);o.trace({name:null==t?void 0:t.id,source:"ProvisioningBladeAdapter",action:"ProvisioningBladeOpen",data:{telemetryId:null==r?void 0:r.telemetryId},context:t&&{Blade:t}});var i=o.startTrace({name:null==t?void 0:t.id,source:"ProvisioningBladeAdapter",action:"ProvisioningBladeClose",context:t&&{Blade:t}}),a=!1;return function(e){if(n.container.get(l.ArmCreateTelemetry).popTelemetryId(),!a){a=!0;var o=r.marketplaceItem||{};return i(e?"Success":"Abandon",{action:"ProvisioningBladeClose",data:MsPortalFx.extend({bladeContext:null==t?void 0:t.id,bladeInstanceId:null==t?void 0:t.instanceId,telemetryId:r.telemetryId,marketplaceItemId:o.id,launchingContext:o.launchingContext},e)})}}}(e,d,o),C=function(e){var t,n=this,r=(0,a.memoizePromise)((function(t){return Q((0,u.getMarketplaceContext)(t,e.marketplaceItem.launchingContext))}));return{write:function(e){return r(t=e)},read:function(){return __awaiter(n,void 0,void 0,(function(){var e;return __generator(this,(function(n){switch(n.label){case 0:return(e=t)?[4,r(t)]:[3,2];case 1:e=n.sent(),n.label=2;case 2:return[2,e]}}))}))}}}(o),k=C.read,M=C.write;MsPortalFx.extend(t,{initialValues:o.initialValues,marketplaceItem:o.marketplaceItem,telemetryId:o.telemetryId,referenceType:o.referenceType,validateTemplate:x(e,i,o,P,k),deployTemplate:b(e,i,o,(function(e){var t,n,r,o,i,a,s,u,l=y?{partName:null===(r=null===(n=null==y?void 0:y.createDefinition)||void 0===n?void 0:n.startboardPart)||void 0===r?void 0:r.name,partKey:null===(o=null==y?void 0:y.createDefinition)||void 0===o?void 0:o.startboardPartKeyId,partExtension:null===(i=null==y?void 0:y.createDefinition)||void 0===i?void 0:i.startboardPart.extension}:(null==I?void 0:I.dashboardPartReference)?{partName:null===(a=null==I?void 0:I.dashboardPartReference)||void 0===a?void 0:a.partName,partKey:null===(s=null==I?void 0:I.dashboardPartReference)||void 0===s?void 0:s.dashboardPartKeyId,partExtension:null===(u=null==I?void 0:I.dashboardPartReference)||void 0===u?void 0:u.options.extensionName}:{partName:"",partKey:"",partExtension:""},c=l.partExtension,d=l.partKey,p=l.partName;return p&&d&&c&&new MsPortalFx.Composition.PartReference(p,((t={})[d]=e,t),{extensionName:c})}),P,F,k),deployStack:g(e,i,o,F,k),deployCustom:h(i,o,F),getAutomationBladeReference:(w=o,function(e){var t;return new r.PdlBladeReference("TemplateViewerBlade","HubsExtension",{parameters:{options:{templateLink:e.templateLinkUri||(null===(t=e.templateLink)||void 0===t?void 0:t.uri),templateJson:e.templateJson,parameters:e.parameters,telemetryId:w.telemetryId}}})}),getArmErrorsBladeReference:function(e){return new r.PdlBladeReference("ArmErrorsBlade","HubsExtension",{parameters:e})},setMarketplaceId:function(e){return __awaiter(f,void 0,void 0,(function(){var n,r,o;return __generator(this,(function(i){switch(i.label){case 0:return[4,M(e)];case 1:return n=i.sent(),r=n.marketplaceItem,o=n.uiDefinition,y=o,MsPortalFx.extend(t,{marketplaceItem:r}),[2,r]}}))}))}}),Object.defineProperties(t,{policyValidationFactory:{get:function(){if(_)return _.policyValidationFactoryUsed=!0,_.policyFactory}}}),e.get(v).context=t,(p||i).registerForDispose((function(){F(!1)}))}t.InjectedDoesProvisioning=v;var _=function(){function t(e,t,n,r){this.value=Promise.all([i.provisioningContextEndpoint.invoke(t,"fx",{})]).then((function(t){var o=t[0],i={};return y(e,i,o.provisioningInputs._provisioningContext,r,{id:n.bladeId,instanceId:n.bladeInstanceId}),i}))}return t.DoesProvisioningContext=!0,t=__decorate([__metadata("fx:diagnostics",[e,"DoesProvisioningContext"]),n.Class("viewModel"),__metadata("design:paramtypes",[n.Container,FxImpl.Rpc.Client,o.PartContext,d.ContainerContract])],t)}();t.DoesProvisioningContext=_})),
define("FxInternal/Controls/SubscriptionDropDown",["require","exports","Fx/DependencyInjection","FxInternal/Controls/BaseResourceDropDown","FxHubs/RpcEndPoints","Fx/ResourceManagement","FxInternal/ResourceManagement/ArmCreateTelemetry","FxHubs/MarketplaceRpc","Fx","FxInternal/ResourceManagement/Policies","Fx","FxInternal/Composition/ViewModelAdapters.DoesProvisioning","Fx/Experimentation"],(function(e,t,n,r,o,i,a,s,u,l,c,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewModel=void 0,t.getDisplayedSubscriptions=C;var v=MsPortalFx.Base.Constants,m=MsPortalFx.ViewModels,f=FxImpl.Azure,b=FxImpl.Rpc,g=m.getValidationResultPromise,h=["enabled","active","pastdue"],x=MsPortalFx.Resources.Strings.Azure.Subscriptions.DropDown;function y(e,t,n){void 0===n&&(n=1e3);var r=new Map;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=t.apply(void 0,o);if(r.has(a))return r.get(a);var s=e.apply(void 0,o);if(s instanceof Promise)s.then((function(e){if(r.set(a,e),r.size>n){var t=r.keys().next().value;r.delete(t)}})).catch((function(){return r.delete(a)}));else if(r.set(a,s),r.size>n){var u=r.keys().next().value;r.delete(u)}return s}}var _=y((function(e){return function(e,t){return(0,s.validateSubscriptions)(t,e)}(e.subscriptions,e.galleryItem)}),(function(e){var t=e.subscriptions,n=e.galleryItem;return"".concat(t.map((function(e){return e.subscriptionId})).sort().join(",")," + ").concat(n.id)})),I=y((function(e){return function(e,t){return(0,s.validateSubscriptions)(t,[e])}(e.subscription,e.galleryItem)}),(function(e){var t=e.subscription,n=e.galleryItem;return"".concat(t.subscriptionId," + ").concat(n.id)}));function w(e){return!h.includes(e.state.toLowerCase())}function P(e,t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return(0,c.isFeatureEnabled)("marketplaceSingleSub")&&t?[4,I({subscription:e,galleryItem:t})]:[3,2];case 1:return[2,r.sent().invalidSubscriptions[0]];case 2:return n&&n.invalidSubscriptions.length?[2,MsPortalFx.find(n.invalidSubscriptions,(function(t){return t.subscriptionId===e.subscriptionId}))]:[2]}}))}))}function F(e){var t=e.split("{0}"),n=t[0],r=t[1];return{htmlTemplate:'<span data-bind="attr: { title: messageTitle }"><span data-bind="text: messagePrefix"></span><a style="white-space: nowrap" href="#settings/subscriptions" data-bind="text: clickHereText"></a><span data-bind="text: messageSuffix"></span></span',viewModel:{messageTitle:e.format(x.clickHere),messagePrefix:n,messageSuffix:r||"",clickHereText:x.clickHere}}}function C(e,t){return __awaiter(this,void 0,void 0,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return[4,o.Impl.getInSessionDisplayedSubscriptions(b.client)];case 1:return n=i.sent(),t||!e?[2,n]:[4,o.Impl.getSubscriptionsForSelectedDirectories(b.client,n.subscriptions)];case 2:return r=i.sent(),[2,__assign(__assign({},n),{subscriptions:r})]}}))}))}var k=[x.recent,x.selected,x.available],M=function(e){function t(t,r){var o,s,u,c,h,y,_=this,I=ko.observable(null),C=ko.observable(!1),M=ko.observable(!1),R=ko.observableArray([]);MsPortalFx.Azure.getSelectedSubscriptions().then((function(e){R(e.map((function(e){return e.subscriptionId}))||[])}));var A=MsPortalFx.isFeatureEnabled("mspfilter"),D=(0,l.getProvisioningBladeDiContainer)(t),V=null==D?void 0:D.get(p.Experimentation),T=null===(c=null===(u=null===(s=null==D?void 0:D.get(d.InjectedDoesProvisioning))||void 0===s?void 0:s.context)||void 0===u?void 0:u.initialValues)||void 0===c?void 0:c.subscriptionIds,S=MsPortalFx.extend({label:ko.observable(x.defaultLabel),filter:!0,header:I,onIsPopUpOpen:function(e){C()&&e&&_._fetchItems(r,!1)},grouping:A?{map:function(e){var t=e.tenantId;e.subscriptionId;if(!M())return"";var n=(t||"").toLowerCase(),r=_._directoryNameMap,o=M()&&r&&r[n];return o&&o.displayName||t||x.unknownTenant}}:(null==V?void 0:V.shellAssignments.getBooleanValue("subscriptionDropdownHeader"))?{map:function(e){var t,n=e.subscriptionId;return(null==T?void 0:T.includes(n))?x.recent:(null===(t=R())||void 0===t?void 0:t.includes(n))?x.selected:x.available},sort:function(e,t){return k.indexOf(e)-k.indexOf(t)},mapToHtml:(o={},o[x.recent]={htmlTemplate:"<span>".concat(x.recent,"</span>"),viewModel:{}},o[x.selected]=F(x.selected),o[x.available]={htmlTemplate:"<span>".concat(x.available,"</span>"),viewModel:{}},o)}:void 0},r),L=r.requiredPermissions,O=new m.CustomValidation(x.disabledSubscriptionValidationMessage,(function(e){return __awaiter(_,void 0,void 0,(function(){var t,o=this;return __generator(this,(function(i){switch(i.label){case 0:return[4,__awaiter(o,void 0,void 0,(function(){var t,o,i,a;return __generator(this,(function(s){switch(s.label){case 0:return e?w(e)?[2,g(x.disabledSubscriptionValidationMessage)]:[4,P(e,ko.unwrap(r.filterByGalleryItem),this._marketplaceValidation())]:[2,g()];case 1:if(t=s.sent())return[2,g(t.displayText||x.subscriptionNotAllowedForGalleryItemValidationMessage)];s.label=2;case 2:return s.trys.push([2,5,,6]),[4,f.canRegisterSubscriptionWithRPs(e.subscriptionId,ko.unwrap(r.resourceProviders))];case 3:return(o=s.sent()).success?[4,MsPortalFx.require("FxInternal/ResourceManagement/ArmTemplate")]:(i=e.uniqueDisplayName||e.subscriptionId,(a=o.disallowedRPs||[]).length?[2,g(x.subDisallowedRP.format(i,a.join(", ")))]:[2,g(x.subCantRegisterWithRP.format(i,o.failedRPs.join(", ")))]);case 4:return[2,s.sent().hasPermission(n.container,"/subscriptions/".concat(e.subscriptionId),L,x.requiredPermissionsValidationMessage)];case 5:return s.sent(),[2,g()];case 6:return[2]}}))}))];case 1:return(t=i.sent()).valid&&e&&n.container.get(a.ArmCreateTelemetry).traceSubscriptionSelected(e.subscriptionId),[2,t]}}))}))}));ko.computed(t,(function(){return __spreadArray(__spreadArray([],ko.unwrap(r.validations)||[],!0),[O],!1)})).subscribeAndRun(t,S.validations=ko.observableArray()),_=e.call(this,t,S,(function(e){return{text:e.uniqueDisplayName||e.displayName||e.subscriptionId,value:e,disabled:w(e)}}),(function(e){return e&&e.subscriptionId}))||this;var B=null===(y=null===(h=(0,l.getProvisioningBladeDiContainer)(t))||void 0===h?void 0:h.get(l.ProvisioningBladeDefaultPolicyAPI))||void 0===y?void 0:y.policyScope;B&&_.value.subscribe(t,B.subscription),_._marketplaceValidation=ko.observable(null),_._headerGroup=I,_._directoryNameMap=null,_._enableMspFilter=A;var E,G=S.initialSubscriptionId,N=Promise.resolve(ko.isObservable(G)?G.fxAwaitAndRun(t):G),j=FxImpl.Extension.getLastResourceIdInJourneyEndPoint.invoke(b.client,v.Shell,null).then((function(e){var t=i.ArmId.parse(e,!0).subscription;return t?[t]:[]}));return _._initialPromise=Promise.all([N.then((function(e){return[].concat(e||[])})),j]).then((function(e){var t=e[0],n=e[1];return t.concat(n).filter(Boolean).map((function(e){return e.toLowerCase()}))})),_._updateOnOpen=C,_._groupByDirectories=M,_._usingGlobalResourceFiltersPromise=new Promise((function(e){E=e})),r.customFetch||!MsPortalFx.isFeatureEnabled("globalresourcefilter")||FxImpl.internalEnv.isShell?E(!1):(0,i.onGlobalResourceFilterChange)(t,(function(){E(!0),C(!0)})),ko.computed(t,(function(){return[ko.unwrap(L),ko.unwrap(r.resourceProviders),ko.unwrap(r.filterByGalleryItem)]})).extend({deferred:!0}).subscribe(t,(function(){return _.triggerValidation()})),ko.computed(t,(function(){return[ko.unwrap(r.filterByGalleryItem)]})).extend({deferred:!0}).subscribeAndRun(t,(function(){return _._fetchItems(r)})),_}return __extends(t,e),t.prototype._getSubscriptions=function(){return __awaiter(this,void 0,void 0,(function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._usingGlobalResourceFiltersPromise];case 1:return e=r.sent(),[4,C(this._enableMspFilter,e)];case 2:return t=r.sent(),this._updateOnOpen(t.isPartialSet),t.isPartialSet||e?(o=t.isPartialSet,i=x.showingFiltered,o&&(i=x.showingPartial),n=F(i),this._headerGroup({text:n})):this._headerGroup(null),[2,t.subscriptions]}var o,i}))}))},t.prototype._fetchItems=function(e,t){var n=this,r=void 0===t||t;this._fetching(r);var i=[],a=this._enableMspFilter?o.Impl.getDirectoriesMap(FxImpl.Rpc.client).then((function(e){n._directoryNameMap=e})):Promise.resolve();Promise.all([((null==e?void 0:e.customFetch)||this._getSubscriptions).call(this),a]).then((function(t){return __awaiter(n,[t],void 0,(function(t){var n,r,o,a,s=t[0];t[1];return __generator(this,(function(t){switch(t.label){case 0:return n=this._directoryNameMap,this._enableMspFilter&&n&&(r=s.some((function(e){var t=e.tenantId,r=n[(t||"").toLowerCase()];return!r||!(r.tenantCategory||"").toLowerCase().includes("home")})),this._groupByDirectories(r)),i=s,o=ko.unwrap(e.filterByGalleryItem),(0,c.isFeatureEnabled)("marketplaceSingleSub")?(this._marketplaceValidation({invalidSubscriptions:[]}),[4,this.selectInitialOrCurrent(i)]):[3,2];case 1:return t.sent(),this._fetching(!1),[2];case 2:return o?[4,_({subscriptions:s,galleryItem:o})]:[3,5];case 3:return a=t.sent(),this._marketplaceValidation(a||{invalidSubscriptions:[]}),[4,this.selectInitialOrCurrent(i)];case 4:t.sent(),this._fetching(!1),this.triggerValidation(),t.label=5;case 5:return[2]}}))}))})).finally((function(){u.nextTick((function(){return __awaiter(n,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.selectInitialOrCurrent(i)];case 1:return e.sent(),this._fetching(!1),[2]}}))}))}))}))},t}(r.ViewModel);t.ViewModel=M})),
define("Fx/Controls/SubscriptionDropDown",["require","exports","FxInternal/Controls/SubscriptionDropDown"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e,t){var n;return ko.ignoreDependencies((function(){n=new r(e,t)})),n};var r=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t}(n.ViewModel)})),
define("FxInternal/Controls/Summary",["require","exports","FxInternal/Controls/Base/Base"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ViewModel=void 0;var r=function(e){function t(t,n){var r=e.call(this,t)||this;return n=n||{},r.controlType=134,r.visible=MsPortalFx.initObservable(n.visible,!0),r.cssClass=MsPortalFx.initObservable(n.cssClass,""),r.name=MsPortalFx.initObservable(n.name,""),r.children=MsPortalFx.initObservableArray(n.children,[]),r}return __extends(t,e),t}(n.ViewModel);t.ViewModel=r})),
define("Fx/Controls/Summary",["require","exports","FxInternal/Controls/Summary"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(e,t){var r;return ko.ignoreDependencies((function(){r=new n.ViewModel(e,t)})),r}})),
define("FxInternal/WeaveControls/Tab.Component",["require","exports","FxInternal/Weave/Components/Tab"],(function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),__exportStar(n,t)}));