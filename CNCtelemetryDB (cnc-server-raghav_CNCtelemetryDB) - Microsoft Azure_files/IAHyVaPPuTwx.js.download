define("MsPortalImpl/Controls/Forms/DropDown",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Controls/DropDown","MsPortalImpl/Interactions/Interactions.DismissHandler","MsPortalImpl.Controls/Fields/TextField","MsPortalImpl.Controls/Controls/Base/ViewModelBase","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl.Controls/Fields/Base/LabelAndBalloonWidget","MsPortalImpl/Controls/Helpers/Validators","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Widgets/Widgets.Common","Viva.Controls/Util/Viva.Resize","Viva.Controls/Controls/Viva.Balloon","MsPortalImpl/Base/Base.FeatureDetection","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Weave/Util","FxInternal/Css","MsPortalImpl/Interactions/Interactions.PortalReader","_generated/Less/MsPortalImpl/Controls/Forms/DropDown.css","FxInternal/Controls/TextBox","Fx"],(function(t,e,s,i,l,o,n,a,r,h,d,c,p,m,u,_,f,b,g,x,v,I,w){"use strict";e.Widget=e.DropDown=void 0;var M=s;(0,g.injectCss)(v);var S=MsPortalFx.Base,P=S.Images,D=S.Diagnostics.Telemetry;const k=MsPortalFx.deepEquals,C=MsPortalFx.isNullOrUndefined,A=32,O=MsPortalFx.isFeatureEnabled("ci"),y=[27,9,16,40,38,18,112,13,35,36],F="azc-disabled",U="fxc-dropdown-filter",B="fxs-br-primary",T="fxc-dropdown-option",H="fxc-dropdown-option-disabled",W="fxc-dropdown-keynav",R="msportalfx-tooltip-overflow",L="fxs-portal-selected",z="fxs-portal-hover",V="fxc-dropdown-check",E="fxc-dropdown-multifilter",K="fxc-dropdown-selectall",G="fxc-dropdown-selectall-all",N="fxc-dropdown-selectall-partial",q="fxc-dropdown-popup",j="fxc-dropdown-hidden",X="fxc-dropdown-open",Y="fxc-group-dropdown",J="azc-formElementContainer",Q="azc-input",Z="fxc-dd-text-wrapper",tt="fxc-dropdown-virtual-height",et="fxc-dropdown-popup-dock",st="fxc-inner-popup",it="fxc-dropdown-option-wrapper",lt="fxc-dd-noresults",ot="fxs-portal-bg-txt-br",nt="fxc-group-dropdown-arrow",at=`[role='treeitem']:not(.${lt}):not(.${K})`,rt=" ",ht="width",dt="max-width",ct="max-height",pt=i.DropDown.filterTextbox,mt=M.tsx("div",{class:J},M.tsx("label",{"aria-busy":"true","aria-live":"assertive","aria-atomic":"true",class:"fxs-hide-accessible-label","data-bind":{text:"$ctl._ariaLive"}}),M.tsx("div",{class:[Z],"data-bind":{attr:{id:'$ctl._comboBox() ? $ctl._comboboxContainerId() : ""',"aria-label":`$ctl._comboBox() ? "${i.Controls.combobox}" : ""`,"aria-labelledby":'$ctl._comboBox() ? ($ko.unwrap($data.data.label) ? $ctl._labelId() : $ctl._comboboxContainerId()) : ""'}}},M.tsx(s.KoIfNot,{condition:"$ctl._comboBox"},M.tsx("div",{class:["azc-formControl",Q,X,R,"azc-validation-border","fxc-dropdown-input"],role:"combobox","aria-haspopup":"dialog","aria-autocomplete":"none","data-canfocus":"true","data-bind":{untrustedContent:"$ctl._stringOrHtmlToDisplay",css:{[F]:"$disabled()","fxs-br-dirty":"data.dirty()"},attr:{id:"$ctl._comboBoxFilterId",tabindex:"$tabIndex","aria-disabled":"$disabled()","aria-labelledby":"$ctl._labelAndComboboxIds()","aria-controls":"$ctl._dialogContainerId","aria-expanded":"$data.data.isPopUpOpen().toString()"}}}))),M.tsx(s.KoIfNot,{condition:"$ctl._comboBox"},M.tsx("span",{class:[nt,X,ot],role:"button",tabindex:"-1","aria-label":i.toggle},M.tsx("span",{class:["fxc-dd-caret","fxs-portal-svg"],"data-bind":{image:"$ctl._icon"}}))),M.tsx("div",{class:[j,q,"fxc-control-border","azc-bg-default","msportalfx-shadow-level2"],"data-bind":{attr:{id:"$ctl._dialogContainerId",role:'$ctl._comboBox() ? null : "dialog"'}}},M.tsx(s.KoIfNot,{condition:"$ctl._comboBox"},M.tsx("div",{class:`${et} ${ot}`},M.tsx("div",{class:[E]}))),M.tsx("div",{role:"tree",tabindex:"-1","aria-label":i.DropDown.optionContainer,"data-canfocus":"true","data-bind":{attr:{id:"$ctl._optionContainerId","aria-multiselectable":"$ctl._multiselectActivated()"}}},M.tsx(s.KoIf,{condition:"$ctl._showMultiselectSelectAll()"},M.tsx("div",{role:"treeitem","aria-posinset":"1",class:[T,R,K,z,"fxs-portal-background"],"data-bind":{attr:{id:"$ctl._multiSelectSelectAllId","aria-label":`"${i.dropDownSelectAll}"`,"aria-selected":"$ctl._allSelected().toString()","aria-setsize":"$ctl._descendantItemOnlyIndex + 1"},css:{[L]:"$ctl._allSelected"}}},M.tsx("span",{class:"azc-bg-muted-80-10"}),M.tsx("div",{class:[V]},M.tsx("span",{class:["fxc-dd-svg","fxs-portal-svg"],"data-bind":{image:"$ctl._checkMarkIcon"}})),M.tsx("span",{"data-bind":{text:`"${i.dropDownSelectAll}"`}}))),M.tsx("div",{class:st},M.tsx(s.KoIf,{condition:"$ctl._popupOnce"},M.tsx("div",{class:it},M.tsx(s.KoForEach,{items:"$ctl._paneItemsMap"},M.tsx(s.KoIf,{condition:"$ctl._isGroup($data)"},M.tsx(s.KoIf,{condition:"$data.text"},M.tsx("div",{class:["fxc-dropdown-option-label",R],"data-bind":{untrustedContent:"text",css:"$ctl._setClasses($data)",attr:{"aria-label":"$ko.unwrap($data.ariaLabel) || null"}}}))),M.tsx(s.KoIf,{condition:"$ctl._isItem($data)"},M.tsx("div",{role:"treeitem",class:[T,R],"data-bind":{attr:{"aria-selected":"$ctl._isSelected($data) === undefined ? null : $ctl._isSelected($data).toString()",id:"$ctl._getInternalItem($data).id()","aria-disabled":"($ko.unwrap($data.disabled) || $ko.unwrap($ctl._getInternalItem($data).headerDisabled)) || null","aria-label":"$ko.unwrap($data.ariaLabel) || null","aria-posinset":"(($ctl._filtering() || $ctl._comboBox()) && $ctl.vm.filterString()) ? null : ($ctl._showMultiselectSelectAll() ? $ctl._getInternalItem($data).itemIndex + 1 : $ctl._getInternalItem($data).itemIndex)","aria-setsize":"(($ctl._filtering() || $ctl._comboBox()) && $ctl.vm.filterString()) ? null : ($ctl._showMultiselectSelectAll() ? $ctl._descendantItemOnlyIndex + 1 : $ctl._descendantItemOnlyIndex)"},css:"$ctl._setClasses($data)"}},M.tsx(s.KoIf,{condition:"$ctl._multiselectActivated"},M.tsx("div",{class:[V]},M.tsx("span",{class:["fxc-dd-svg","fxs-portal-svg"],"data-bind":{image:"$ctl._checkMarkIcon"}}))),M.tsx("span",{class:"fxs-portal-svg","data-bind":{untrustedContent:"text"}})))),M.tsx(s.KoIf,{condition:"$ctl._showStatusMessage()"},M.tsx("div",{role:"treeitem",class:[lt]},M.tsx("span",{"data-bind":{untrustedContent:"$ctl._statusMessage"}})))),M.tsx("div",{class:tt}))))));class ut extends a.Widget{constructor(t,e,s){super(t,e,s),this._selectedValues=ko.observableArray([]),this._checkMarkIcon=P.Check({palette:99}),this._canFilter=!0,this._filterActivated=ko.observable(!1),this._filterInPopUp=ko.observable(!1),this._filterReadOnly=ko.observable(!1),this._filterStringChangedByVM=!1,this._filtering=ko.observable(!1),this._customFilterResults=ko.observableArray(null),this._customItemReplacement=!1,this._oldItems=[],this._multiselectActivated=ko.observable(!1),this._multiselectSelectAll=ko.observable(!1),this._showMultiselectSelectAll=ko.observable(!1),this._allSelected=ko.observable(!1),this._multiSelectSelectAllId=ko.observable(""),this._labelId=ko.observable(""),this._comboboxContainerId=ko.observable(""),this._labelAndComboboxIds=ko.observable(""),this._optionContainerId=ko.observable(""),this._dialogContainerId=ko.observable(""),this._comboBoxFilterId=ko.observable(""),this._ariaLive=ko.observable(""),this._noUserScroll=!1,this._popupOnce=ko.observable(!1),this._virtualize=ko.observable(!1),this._flattenItemsMap=ko.observableArray([]),this._filteredItems=ko.observableArray([]),this._paneItemsMap=ko.observableArray([]),this._itemsMap=new Map,this._topItemIndex=ko.observable(0),this._maxItemsInPopup=50,this._stringOrHtmlToDisplay=ko.observable(""),this._icon=ko.observable(P.CaretDown()),this._showStatusMessage=ko.observable(!1),this._statusMessage=ko.observable({htmlTemplate:i.Search.noResults}),this._pendingTimer=null,this._comboBox=ko.observable(!1),this._hasItemHeaders=!1,this._popupGuard=!1,this._openPopupUp=void 0,this._keyDownOnScrollBar=!1,this._widthOfInput=0,this._defaultItemHeight=A,this._descendantIndex=0,this._descendantItemOnlyIndex=0,this._isTouch=c.isTouch,this._subscribedToPopupMaxWidth=!1,this._setTemplate(),this._attachEvents(),this._initializeSubscriptions()}_countItems(t,e=!1){let s=0;return t&&(e&&(t=ft(t.map((t=>this._unwrapGroupChildren(t))))),t.forEach((t=>{this._isItem(t)&&s++}))),s}_unwrapGroupChildren(t){if(!C(t)){if(this._getInternalItem(t),this._isGroup(t)&&t.children){const e=ft(ko.unwrap(t.children).map((t=>this._unwrapGroupChildren(t))));return e.unshift(t),e}return t}}_setClasses(t){const e=ko.unwrap(t.disabled)||ko.unwrap(this._getInternalItem(t).headerDisabled),s={[H]:e};return this._isItem(t)?$.extend(s,{[z]:!ko.unwrap(e),[L]:this._isSelected(t)}):$.extend(s,{"fxc-dropdown-group":!0}),s}_setItems(t=0,e=!1){const s=[],i=this._maxItemsInPopup+(this._multiselectSelectAll()&&!this._showMultiselectSelectAll()?1:0);let l=!1;const o=this.vm.filterString();if(this._comboBox()&&this._filtering()&&o){if(!this._flattenItemsMap().some((t=>{const e=ko.unwrap(t.value);return"string"==typeof e&&e===o}))&&!this.vm.hidePreviewItem()){const t={text:{htmlTemplate:"<div class=\"fxt-dd-prewrap\" data-bind='text: text'></div>",viewModel:{text:o}},value:o};s.push(t)}}const n=s.length;for(let o=t;o<t+i-n;o++){let t;!e&&this._useFilteringArray()?(t=this._filteredItems()[o],l=!0):t=this._flattenItemsMap()[o],t&&s.push(t)}if(this._topItemIndex(t),this._paneItemsMap(s),this._virtualize()){const t=l?this._filteredItems():this._flattenItemsMap(),e=this.element.find(`.${lt}`).outerHeight()||0,i=Math.max(t.length+n,s.length)*this._defaultItemHeight+e;this.element.find(`.${tt}`).height(i)}this.element.toggleClass("fxc-dropdown-noitems",!s.length)}_useFilteringArray(){return this._filtering()&&this._filteredItems&&!this._customItemReplacement}_findMatches(t=""){const e=this._customFilterResults(),s=this._filtering()&&(""!==t||!!e),l=i=>{let o=[];return i&&i.forEach((i=>{if(this._isItem(i)){if(s)if(e?.includes(ko.unwrap(i.value)))o.push(i);else if(!e){const e=(0,p.getStringFromHtmlContent)(this._diContainer,ko.unwrap(i.text),this.element[0]);e&&t&&e.toLocaleLowerCase().includes(t.toLocaleLowerCase())&&o.push(i)}}else if(this._isGroup(i)){const t=l(ko.unwrap(i.children));t.length&&(o.push(i),o=[...o,...t])}})),o},o=l(this.vm.items());s?(this.element.find(`.${st}`).scrollTop(0),this._filteredItems(o),this._setItems(),this._ariaLive(i.DropDown.filterResult.format(this._countItems(o),this.vm.filterString())),this._setDropDownWidth(),A!==this._defaultItemHeight&&this._openDropdown(!0)):(this._filtering(!1),this._setItems())}_setTemplate(){this.element.addClass(`${Y} msportalfx-form-formelement azc-fabric`);const t=this._labelHelper=new h.LabelAndBalloonWidgetHelper(this._diContainer,this.ltm,this.vm,ko.computed(this.ltm,(()=>this.vm.disabled()?0:-1)));this._required=ko.computed(this.ltm,(()=>0!==this.vm.validations.filter(this.ltm,(t=>1===t.type))().length||t.required()));const e=$(mt);t.appendWidgetToDom(this.element,e),t.attachSubLabelClass(this.element),t.attachKeyboardEvents(this.element),t.insertLabelBefore(e),this._labelId(t.labelId),this._comboBoxFilterId(`${t.labelId}textbox`),this._filterInPopupId=`${t.labelId}filter`,this._comboboxContainerId(`${t.labelId}combobox`),this._optionContainerId(`${t.labelId}aria`),this._dialogContainerId(`${t.labelId}dialog`),this._multiSelectSelectAllId(`${t.labelId}selectall`),this._labelAndComboboxIds(this._labelId());const s=MsPortalFx.initObservable(this.vm.ariaLabel,""),i=MsPortalFx.initObservable(this.vm.label);ko.reactor(this.ltm,[i,s],((t,e)=>{const s=String(e||"").trim();this._labelAndComboboxIds(s?this._comboBoxFilterId():t&&this._labelId())})),this._bindDescendants({},this.element.find(`.${J}`)),this._validator=new d.Validators(this._diContainer,this.ltm,this,this.element.find(`.${J}`)),this.vm.showValidationMessagesBelowControl?(this.element.addClass(h.validationMessageBelowControlClass),t.insertValidationMessageBelowControlAfter(e,this._validator.validationResults)):t.insertValidationMessageHidden(e,this._validator.validationResults),t.insertSubLabelAfter(e),e.find(`.${Q}`).attr("aria-describedby",t.errMsgId),this._validator.validationResults.subscribeAndRun(this.ltm,(s=>{const i=s.filter((t=>0!==t.state&&!t.valid)).map((t=>t.message)).join(rt).trim();(0,h.toggleAriaErrorMessage)(e.find(`.${Q}`),t.errMsgId,!!i)})),this._widthOfInput=$(this.element.find(`.${J}`)[0]).width()}_initializeSubscriptions(){const t=this.vm,e=this.ltm,s=this.element.find(`.${Z}`),l=MsPortalFx.initObservable(t.multiselect,!1),o=MsPortalFx.initObservable(t.filter,!1);this._comboBox(!!t.isComboBoxCtrl&&o()),ko.reactor(e,[o,this._comboBox],((t,e)=>{this._filterInPopUp(t&&!e)}));const n=e=>{this._multiselectActivated(e),this.element.toggleClass("fxc-dropdown-multiselect",e),this._filterActivated()?(this._removeFiltering(),this._setupFiltering()):this._updateSelected(t.value())};l.subscribeAndRun(e,(t=>{(t||this._multiselectActivated())&&n(t)})),o.subscribeAndRun(e,(t=>{t?this._setupFiltering():this._filterActivated()&&this._removeFiltering()})),this._ariaLive.subscribe(e,(t=>{this.element.find("[aria-live='assertive']").attr("aria-busy","false")})),t.items.subscribeAndRun(e,(s=>{this._descendantIndex=this._descendantItemOnlyIndex=0,this._hasItemHeaders=!1,this._itemsMap=new Map;const l=MsPortalFx.deepEquals(this._oldItems,s);if(this.vm.isPopUpOpen()&&this._filtering()&&!l&&(this._customItemReplacement=!0,this._ariaLive(i.DropDown.filterResult.format(this._countItems(s,!0),this._textBoxViewModel.value()))),this._currentItemsLifeTime&&(this._currentItemsLifeTime.dispose(),this._currentItemsLifeTime=null),C(s))this._paneItemsMap([]);else{const i=ft(s.map((t=>this._unwrapGroupChildren(t))));this._flattenItemsMap(i);const l=!O&&i.length>50;if(l){const e=this._virtualize();this._virtualize(!0),this._popupOnce()||this._setItems(),!e&&t.isPopUpOpen()&&(this._closeDropdown(),this._openDropdown())}else this._virtualize(!1),this._maxItemsInPopup=50;this.element.toggleClass("fxc-dropdown-virtual",l),O&&(this._maxItemsInPopup=1e4),this._comboBox()&&this.vm.suppressSelectedUpdate()||this._setItems(0,this._filtering()),this.vm.isPopUpOpen()&&this._setMaxItemsShow(),i.forEach((s=>{if(this._isGroup(s)){this._hasItemHeaders=!0,ko.isObservable(s.children)&&(this._currentItemsLifeTime||(this._currentItemsLifeTime=e.createChildLifetime()),s.children.subscribe(this._currentItemsLifeTime,(()=>{t.items.notifySubscribers(this.vm.items())})));const i=ko.unwrap(s.disabled);s.children&&i&&(ko.isObservable(s.disabled)?(this._currentItemsLifeTime||(this._currentItemsLifeTime=e.createChildLifetime()),s.disabled.subscribeAndRun(this._currentItemsLifeTime,(t=>{ko.unwrap(s.children).forEach((e=>{this._getInternalItem(e).headerDisabled(t)}))}))):ko.unwrap(s.children).forEach((t=>{this._getInternalItem(t).headerDisabled(i)})))}}))}this._customFilterResults(void 0),this._updateSelected(t.value()),this.vm.isPopUpOpen()&&w.nextTick((()=>{this.vm.isPopUpOpen()&&!this.ltm.isDisposed()&&this._setDropDownWidth()})),l||this._setDropDownPosition(),this._oldItems=s}));const a=t.selectAllState;a&&a.subscribeAndRun(e,(t=>{this._setSelectAllClass(t)}));const r=MsPortalFx.initObservable(t.selectAll);ko.reactor(e,[r,l],((t,e)=>{this._multiselectSelectAll(t&&e),this._setSelectAllClass()})),ko.reactor(e,[this.vm.items,this._filtering,this.vm.filterString,l,r],((t,e,s,i,l)=>{const o=this._showMultiselectSelectAll();i&&l?this._showMultiselectSelectAll(t&&!!t.length&&(!e||""===s)):this._showMultiselectSelectAll(!1),o!==this._showMultiselectSelectAll()&&this._setDropDownPosition()})),t.value.subscribeAndRun(e,(t=>{this._updateSelected(t)})),ko.isObservable(t.multiItemDisplayText)&&t.multiItemDisplayText.subscribe(e,(t=>{this._setDisplayString()})),this.$disabled.subscribeAndRun(e,(t=>{t&&this._closeDropdown(),this.element.toggleClass("msportalfx-form-formelement-disabled",t)}));let h=!0;(0,p.waitForBindings)(this.element[0]).then((()=>{this.vm.isPopUpOpen.subscribeAndRun(e,(t=>{this._popupGuard||(t?(this._openDropdown(!0),this._setFocus()):h||this._closeDropdown(!0,!0))})),h=!1})),t.ariaLabel?.subscribeAndRun(e,(e=>{const i=s.find(`#${this._comboBoxFilterId()}`),l=(e||"").trim();l.length?i.attr({"aria-labelledby":null,"aria-label":l}):ko.unwrap(t.label)?i.attr("aria-labelledby",this._labelId()):i.attr("aria-labelledby",null)})),this._required.subscribeAndRun(e,(t=>{this._setAttribute("aria-required",t)})),t.valid.subscribeAndRun(e,(t=>{this._setAttribute("aria-invalid",!t)})),t.loading.subscribeAndRun(e,(t=>{this.disabled(t),t?(this._closeDropdown(),this._icon(P.Loading.Spinner())):this._icon(P.CaretDown()),this._setDisplayString()})),this._validator.validationState.subscribe(this.ltm,(t=>{3===t?this._pendingTimer=setTimeout((()=>{this._icon(P.Loading.Spinner())}),50):(this._pendingTimer&&clearTimeout(this._pendingTimer),this._pendingTimer=null,this._icon(P.CaretDown()))})),ko.reactor(this.ltm,[MsPortalFx.initObservable(t.placeholder)],(()=>{this._setDisplayString()}));const d=MsPortalFx.initObservable(this.vm.statusMessage,void 0),c=MsPortalFx.initObservable(this.vm.showStatusMessage,void 0);ko.reactor(e,[this._paneItemsMap,this.vm.isPopUpOpen,d,c],((t,e,s,l)=>{if(C(l)&&!this._comboBox()){const l=e&&0===t.length;l&&C(s)&&(this._filtering()?this._statusMessage({htmlTemplate:i.Search.noResults}):this._statusMessage({htmlTemplate:i.DropDown.noItems})),this._showStatusMessage(l)}else this._showStatusMessage(l);C(s)||(this._statusMessage(s),e&&this._showStatusMessage()&&this._setDropDownWidth())})),this._showStatusMessage.subscribeAndRun(e,(t=>{t&&this.vm.isPopUpOpen()&&this._announceMessage()})),this._customFilterResults.subscribe(e,(t=>{t&&this._findMatches()}))}_setFocus(){this.vm?.isPopUpOpen()&&(ko.unwrap(this.vm.filter)?$(this.element.find("input")[0]).focus():this.element.find(`div.${Q}[role='combobox']`).focus())}_attachEvents(){const t=()=>{this.vm.isPopUpOpen()?this._closeDropdown():this._openDropdown()},e=t=>{const e=this.vm;if(t.hasClass(K))if(e.selectAllOverride)e.selectAllOverride();else{const t=e._msPortalFxWidgetValue;let s=[];C(t())||(s=_t(t()));const i=this._getItemValues(e.items());s&&s.length===i.length?t([]):t(i)}else{let s=t.hasClass(H);if(t.parentsUntil(`.${q}`).each((function(t,e){$(e).hasClass(H)&&(s=!0)})),!s){const s=ko.dataFor(t[0]),i=s&&ko.unwrap(s.value);if(this._multiselectActivated()){const t=e._msPortalFxWidgetValue();let s,l=[];C(t)||(l=_t(t)),l.length?MsPortalFx.isUndefined(s=MsPortalFx.find(l,(t=>k(t,i))))?l.push(i):MsPortalFx.remove(l,s):l=[i],e._msPortalFxWidgetValue(l)}else e._msPortalFxWidgetValue(i),this._setFocus(),this._closeDropdown(!this._filtering())}}this.element.trigger("fxvaluechanged")},s=t=>{const s=this.element.find(`.${q}`).find(`.${T}:not(.${K}):not(.${H})`);(1===s.length||t&&s.length)&&e($(s[0]))},i=this.element.find(`.${q}`);let l=!1;this.ltm.registerForDispose([this.element.setEvents(["touchstart",()=>{this._isTouch||this._filterReadOnly(!0),this._isTouch=!0}],["click",t=>{t.stopPropagation()}],["mousedown",t=>{t.stopPropagation(),$(t.target).closest(`.${nt}`).length>0&&t.preventDefault()}],["mouseup",e=>{e.stopPropagation(),$(e.target).closest(`.${X}`).length>0&&(e.preventDefault(),t(),this._setFocus())}],["keydown",t=>{9===t.which&&this._filtering()&&s();const e=this.element.find(`.${st}`),i=function(t){t.preventDefault(),t.stopPropagation()};switch(t.which){case 38:case 40:{let e=this.element.find(`.${W}`);e.length||(e=$(this.element.find(`.${L}`)[0])),i(t),this._handleArrowKey(t,40===t.which,e);break}case 36:this.vm.isPopUpOpen()&&!y.includes(t.which)&&(e.scrollTop(0),i(t));break;case 35:this.vm.isPopUpOpen()&&!y.includes(t.which)&&(e.scrollTop(e[0].scrollHeight),i(t));break;case 34:this.vm.isPopUpOpen()&&(e.scrollTop(e.scrollTop()+e.height()),i(t));break;case 33:this.vm.isPopUpOpen()&&(e.scrollTop(e.scrollTop()-e.height()),i(t));break;case 13:l=!0}this._checkOnShowStatusMessage()}],["keyup",i=>{const o=this.element.find(`.${W}`);if(13!==i.which&&32!==i.which||(this._comboBox()||$(i.target).is("a")||!this.element.find(`.${W}`).length||i.preventDefault(),i.stopPropagation()),13===i.which)l&&(l=!1,o?.length?e(o):13===i.which&&this.vm.isPopUpOpen()&&(this._filtering()||this._comboBox())?s(!0):($(i.target).hasClass(X)||this._comboBox()&&!this.vm.isPopUpOpen())&&t())}]),i.setEvents(["mouseup",t=>{t.stopPropagation(),this.element.find(`.${W}`).removeClass(W);const s=$(t.target).closest(`.${T}`);s?.length&&e(s)}],["wheel",t=>{const e=$(t.target);if(this._virtualize()&&(e.hasClass(T)||e.parentsUntil(`.${T}`))){const e=t.originalEvent.deltaY>0?100:-100,s=i.find(`.${st}`),l=s.scrollTop()+e;s.scrollTop(l),this._checkOnShowStatusMessage()}}]),!(c.isIPadOS||c.isAndroidOrMobile)&&$(window).setEvents([`resize.${q}`,()=>{this._closeDropdown()}])]);const o=this.element.closest(".fxs-blade-content-container")[0],n=o&&ko.dataFor(o),a=n?.data?.bladeName;this._extensionName=a?.extensionName,this._extensionName&&(this._telemetrySource=["Extension",this._extensionName,"Blade",a?.name].join("/")),(0,m.track)(this.ltm,this.element,(()=>{this._widthOfInput=$(this.element.find(`.${J}`)[0]).width(),this.vm.isPopUpOpen()&&this._setDropDownPosition()}))}_setAttribute(t,e){let s=this.element.find(!this._filterInPopUp()&&this._filterActivated()?".fxc-TextField input":`.${Q}.${X}`);MsPortalFx.isNull(e)?s.removeAttr(t):s.attr(t,e),this._filterInPopUp()&&(s=this.element.find(".fxc-TextField input"),MsPortalFx.isNull(e)?s.removeAttr(t):s.attr(t,e))}_isSelected(t){if((!(ko.unwrap(t.disabled)||ko.unwrap(this._getInternalItem(t).headerDisabled))||this._multiselectActivated())&&this._isItem(t)){const e=ko.unwrap(t.value);return"object"==typeof e?this._selectedValues().some((t=>k(t,e))):this._selectedValues().includes(e)}}_updateSelected(t){const e=_t(t);this._selectedValues(e);let s=!1;e?.length&&(s=this._flattenItemsMap().some((t=>{if(this._isItem(t)){const s=e.some((e=>k(e,ko.unwrap(t.value))));return s&&(this._currentItem=t),s}}))),s||(this._currentItem=null),this.vm.suppressSelectedUpdate()||this._setDisplayString(),this._multiselectSelectAll()&&this._setSelectAllClass()}_setSelectAllClass(t=null){if(this._multiselectSelectAll()&&!this.vm.selectAllState){const t=(0,this.vm.value)(),e=this._getItemValues(this.vm.items()),s=t?.length,i=s===e.length;this._allSelected(i),this.element.find(`.${K}`).toggleClass(L,i),this.element.toggleClass(G,i),this.element.toggleClass(N,!i&&!!s)}else if(null!==t){let e=!1,s=!1;switch(t){case 1:s=!0;break;case 2:e=!0}this.element.toggleClass(G,e),this.element.toggleClass(N,s)}}_setupFiltering(){this._filterLifeTime&&this._filterLifeTime.dispose(),this.element.addClass(U),this._filterActivated(!0);const t=this.vm,e=this._filterLifeTime=this.ltm.createChildLifetime(),s=this._textBoxViewModel=new I.ViewModel(e,{placeHolderText:this.vm.filterPlaceholder,valueUpdateTrigger:4,readOnly:this._filterReadOnly,dirty:this.vm.dirty,valid:this._filterInPopUp()?void 0:t.valid}),l=$(document.createElement("div"));this.element.find(this._filterInPopUp()?`.${E}`:`#${this._comboboxContainerId()}`).prepend(l);const o=new n.WidgetUIState({diContainer:this._diContainer,vm:s});this._textBoxWidget=new n.Widget(l,s,{},o),t.showSearchIcon?.subscribeAndRun(this._textBoxWidget.ltm,(t=>{this._textBoxWidget&&o.vivaTextBoxViewModel.showSearchIcon(t)})),l.find(".azc-text-label").removeAttr("aria-hidden"),l.find(`.${Q}`).attr("aria-describedby",this._labelHelper.errMsgId),this._filterComputed=ko.computed(e,[s.value],(e=>{if(!C(e)){if(this._filterStringChangedByVM)this._openDropdown(),this._filterStringChangedByVM=!1;else if(!(t.filterString()!==e||""===e&&t.customFilter&&this._filterByUser))return;if(this._canFilter&&(t.isPopUpOpen()||this._openDropdown(),t.filterString(e),t.isPopUpOpen())){if(this._comboBox()){const s=t.customFilter;this.vm.suppressSelectedUpdate(!0),this.vm.value(e),this._filtering(!0),s?s(e).then((()=>{this.vm.suppressSelectedUpdate(!1),this._setItems(0,!0),this._filtering(!1)})):(this.vm.suppressSelectedUpdate(!1),this._setItems(0,!0),this._filtering(!1)),this.vm._msPortalFxViewModelValueChangesAreClean&&this.vm.dirty(!0)}else if(""!==e||t.customFilter)if(this._customItemReplacement)this._customItemReplacement&&t.customFilter&&t.customFilter(e).then((()=>{t.isPopUpOpen()&&this._canFilter&&(this._filtering(!0),this._ariaLive(i.DropDown.filterResult.format(this._countItems(t.items(),!0),this.vm.filterString())))}));else if(t.customFilter){const s=t.items();t.customFilter(e).then((e=>{if(t.isPopUpOpen()&&this._canFilter&&(this._filtering(!0),!this._customItemReplacement)){const l=t.items();let o=e?.length||0;MsPortalFx.deepEquals(s,l)?this._customFilterResults(e||null):(this._customItemReplacement=!0,o=this._countItems(l,!0)),this._ariaLive(i.DropDown.filterResult.format(o,this.vm.filterString()))}}))}else e&&!t.customFilter&&(this._filtering(!0),this._findMatches(e));else this._filtering(!1),this._setItems(0,!0),this._setDropDownWidth();this._checkOnShowStatusMessage()}this._filterByUser&&(this._filterByUser=!1)}})),O&&!this.element.parents(".fxc-pill").length||this._filterComputed.extend({throttle:50}),t.filterString.subscribe(e,(t=>{s.value()!==t&&(this._filterStringChangedByVM=!0,s.value(t))})),this.$disabled.subscribeAndRun(e,s.disabled);const a=l.find("input");a.on("mouseup",(()=>{this.vm.isPopUpOpen()||this._openDropdown()})).on("keydown",(()=>{this._filterByUser=!0})).on("keyup",(t=>{if(this.vm.isPopUpOpen()||y.includes(t.which)||0!==(0,r.getModifierKeys)(t))switch(t.which){case 112:case 27:{const e=$.Event("keydown");e.which=t.which,this.element.trigger(e)}}else this._openDropdown(),this._filtering(!0)})),a.attr({id:this._filterInPopUp()?this._filterInPopupId:this._comboBoxFilterId(),role:"combobox","aria-readonly":null,"aria-multiline":null,autocomplete:"off","aria-required":this._required(),"aria-invalid":!t.valid(),"aria-label":pt,"aria-labelledby":null,"aria-autocomplete":"list","aria-haspopup":"tree","aria-expanded":"true","aria-controls":this._optionContainerId()}),this._comboBox()&&t.isPopUpOpen.subscribeAndRun(e,(t=>{a.attr({"aria-expanded":t})})),this._updateSelected(t.value())}_removeFiltering(){this.element.removeClass(U),this._filterActivated(!1),this._filterLifeTime&&this._filterLifeTime.dispose(),this._textBoxViewModel=null,this._textBoxWidget.dispose(),this._textBoxWidget.element.remove(),this._textBoxWidget=null,this.element.find(`.${Q}.${X}`).attr({"aria-required":this._required(),"aria-invalid":!this.vm.valid()})}dispose(){this._checkExistsOrRegisterDestroyId(super.dispose)||(super.dispose(),this._filterActivated()&&this._removeFiltering(),this.vm.isPopUpOpen(!1),this._cleanElement(Y,"msportalfx-form-formelement"))}_handleArrowKey(t,e,s){if(this.vm.isPopUpOpen())if(e&&t.altKey)this._closeDropdown();else{const t=this.element.find(`.${q}`).find(`.${T}`),i=this.element.find(`.${st}`);if(t?.length&&s){const l=t.toArray().indexOf(s[0]),o=this.element.find(`.${W}`);let n;if(o[0]||!s[0]){const s=$(o[0]||t[0]).outerHeight(!0);e?t.length>l+1?n=$(t[l+1]):this._virtualize()&&this._topItemIndex()+this._maxItemsInPopup+ +(this._multiselectSelectAll()&&!this._showMultiselectSelectAll())<(this._useFilteringArray()?this._filteredItems:this._flattenItemsMap)().length&&(i[0].scrollTop+=s,this._setItems(this._topItemIndex()+1),n=this.element.find(`.${T}`).last()):l>0?1===l&&this._virtualize()&&this._showMultiselectSelectAll()&&this._topItemIndex()>0?(this._setItems(this._topItemIndex()-1),n=i.find(`.${T}`).first(),i[0].scrollTop-=s):n=$(t[l-1]):this._virtualize()&&this._topItemIndex()>0&&(this._setItems(this._topItemIndex()-1),n=i.find(`.${T}`).first(),i[0].scrollTop-=s)}else n=s;if(n?.length){if(o.removeClass(W),n.addClass(W),this._virtualize())this._noUserScroll=!0;else{const t=n.outerHeight(),e=this.element.find(`.${q}`).height(),s=i.height(),l=n.position().top-(this._showMultiselectSelectAll()?A:0),o=this.element.find(`.${et}`).outerHeight()||0,a=this._openPopupUp?s:e-(this._showMultiselectSelectAll()?A:0),r=a<l+t;(r||l<(this._openPopupUp?0:o))&&(i[0].scrollTop+=l-(r?a-t:!this._openPopupUp&&o))}this._setAttribute("aria-activedescendant",n.attr("id")||rt)}}}else this._openDropdown()}_setDisplayString(){const t=ko.unwrap(this.vm.loading);let e=!1;if(this._multiselectActivated()){const e=ko.unwrap(this.vm.multiItemDisplayText),s=_t(this.vm.value()),l=this.vm.items?.()||[],o=this._getItemValues(l),n=s.filter((t=>o.includes(t)))||[];let a=i.dropDownXSelected.format(n.length);t?a=i.dropDownLoading:C(e)?1===n.length&&(a=this._currentItem&&ko.unwrap(this._currentItem.selectedItemOverride||this._currentItem.text)):a=e.format(n.length),this._stringOrHtmlToDisplay(a),this._ariaLive((0,p.getStringFromHtmlContent)(this._diContainer,a,this.element[0]))}else{let s=this._currentItem;t&&(s={text:i.dropDownLoading,value:null});const l=ko.unwrap(this.vm.placeholder)||"";let o=l;if(s&&(o=s.selectedItemOverride?ko.unwrap(s.selectedItemOverride):ko.unwrap(s.text)),this._stringOrHtmlToDisplay(o),this._comboBox()&&!this._filtering()){this._canFilter=!1;const t=this._textBoxWidget.element.find("input");if(s){const e=(0,p.getStringFromHtmlContent)(this._diContainer,o,this.element[0]);t.val(e)}else{this._textBoxViewModel.value(void 0);const e=this.vm.value();"string"==typeof e&&t.val(e)}this._canFilter=!0}e=l.length&&!s}this.element.find(`.${X}.azc-formControl`).toggleClass("fxc-dropdown-placeholder",!!e)}_setMaxItemsShow(){if(this._popupOnce()&&this._virtualize()){let t=bt(this.element.find(`.${q}`));this._filterInPopUp()&&(t-=this.element.find(`.${et}`).outerHeight()||0),this._showMultiselectSelectAll()&&(t-=A);const e=Math.floor(t/this._defaultItemHeight);this._maxItemsInPopup!==e&&(this._maxItemsInPopup=e,this._setItems(this._topItemIndex()))}}_openDropdown(t){if(!this.$disabled()&&(!this.vm.isPopUpOpen()||t)){const t=performance.now(),e=!this._popupOnce();this._popupOnce(!0),this._popupGuard=!0,this.vm.isPopUpOpen(!0),this._popupGuard=!1,this.element.find(`.${J}`).addClass(B),(0,u.hideAllBalloons)(null,this.element);const s=this.element.find(`.${q}`);this._checkHeightOfItems(s.find(at)),this._setDropDownPosition(),this._filterActivated()&&(this._isTouch?(s.focus(),this._filterReadOnly(!1)):this.element.find("input").focus(),this._announceMessage(pt));const i=t=>{const e=this.element.find(".azc-formElementContainer")[0],s=$(t).closest(".azc-dockedballoon-balloon").attr("id");return!(e===t||$.contains(e,t)||s&&(this.element.find(`.azc-dockedballoon-anchor[aria-owns='${s}']`).length||this.element.find(`.azc-dockedballoon-anchor[aria-controls='${s}']`).length))?2:0},l={dismissFn:()=>{this._closeDropdown()},shouldDismissOnFocusOutFn:i,shouldDismissOnMouseDownFn:i,shouldDismissOnMouseWheelFn:i,shouldDismissOnScroll:!this._isTouch,logName:"dropdown"};if(!this._dismissHandleLifetime||this._dismissHandleLifetime.isDisposed()){(0,o.dismissByLogName)("dropdown"),(0,o.register)(l);(this._dismissHandleLifetime=this.ltm.createChildLifetime()).registerForDispose((()=>{(0,o.unregister)(l)}))}const n=(0,f.throttle)(this.ltm,(()=>{this._setDropDownWidth()}),200);if(this._setMaxItemsShow(),this._selectedValues().length&&this._flattenItemsMap().some(((t,e)=>{if(this._isSelected(t))return this._setAttribute("aria-activedescendant",this._getInternalItem(t).id()||rt),this._virtualize()&&e>this._maxItemsInPopup&&(this.element.find(`.${st}`)[0].scrollTop=e*this._defaultItemHeight,this._checkOnShowStatusMessage()),!0})),this._virtualize())this._checkOnShowStatusMessage();else{const t=this.element.find(`.${L}`);t?.length&&t.position().top>s.height()&&(this.element.find(`.${st}`)[0].scrollTop=t.position().top)}const a=this.element.find(`.${st}`);let r=a.scrollTop()||0;if(this._dismissHandleLifetime.registerForDispose([a.setEvents(["scroll",()=>{if(this._virtualize()){const t=a.scrollTop(),e=this._showStatusMessage()&&r<t,s=Math.floor(t/this._defaultItemHeight)+(e?1:0);r=t,this._noUserScroll?this._noUserScroll=!1:this._setAttribute("aria-activedescendant",rt),this._topItemIndex(s),this._setItems(s),this._checkOnShowStatusMessage(),n()}}],["mousedown",()=>{this._keyDownOnScrollBar=!0}],["mouseup",()=>{this._keyDownOnScrollBar=!1,this._setDropDownWidth()}])]),!this._multiselectActivated()){const t=s.find(".fxs-portal-selected");t?.addClass("fxc-dropdown-keynav")}setTimeout((()=>{const t=this.element.find(`.${st}`),e=t[0]&&(t[0].clientHeight<t[0].scrollHeight?(0,_.getScrollbarWidth)():0)||0,s=this.vm.popupWidthHint,i=!!s&&s()||0;if(this.element.find(`.${it}`).css(dt,this._calculatePopupMaxWidth(i)-e),this._virtualize()){const s=t.width(),i={[ht]:s-e};this.element.find(`.${tt}`).css(i),this.element.find(`.${it}`).css(i)}}),A),D.trace({action:"DropDownOpened",extension:this._extensionName,source:this._telemetrySource,name:this.vm.telemetryName||"",duration:performance.now()-t,data:{itemsCount:this.vm.items?.()?.length||0,firstOpen:e,duration:performance.now()-t}}),this._showStatusMessage()&&this._announceMessage()}}_setDropDownPosition(){if(this.vm.isPopUpOpen()){let t="top";const e=this._widthOfInput,s=this.element.find(`.${q}`),i=this.vm.popupWidthHint,l=!!i&&i()||0,o=this.element.find(`.${Z}`),n=o[0].getBoundingClientRect(),a={},r={},h=$(window).height();let d=n.top+o.height()-$(window).scrollTop();const c=$(document).find(".fxs-journey-breadcrumb"),p=$(document).find(".fxs-breadcrumb-container"),m=c[0]||p[0],u=window.innerHeight<500?3-(this._virtualize()?8:0):35,f=n.top-u-$(document).find(".fxs-topbar").height()-((m&&function(t){const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}(m)&&m)?.offsetHeight||0);let b=0;const g=$(document).find(".fxs-portal-console");g.length&&!g.hasClass("fxs-display-none")&&(b=g.height());const x=h-n.top-n.height-u-b;let v=x;MsPortalFx.isUndefined(this._openPopupUp)?(this._virtualize()||s.height()>x)&&f>x?(t="bottom",this._openPopupUp=!0):this._openPopupUp=!1:this._openPopupUp&&(t="bottom"),this._openPopupUp&&(v=f,d=h-n.top),a[t]=d,r[t]=d,this._openPopupUp&&(v=f),v>704&&(v=704);const I=this.element.find(`.${it}`);let w=v-(this.element.find(`.${et}`).outerHeight()||0);this._virtualize()&&(this._hasItemHeaders&&this._filtering()&&this.vm.filterString()||(v-=w%this._defaultItemHeight),$.extend(a,{maxHeight:v})),this._showMultiselectSelectAll()&&(w-=A),r[ct]=w,I.css(ct,w);const M=t=>{const e=this.element.find(`.${st}`),i=e[0]&&(e[0].clientHeight<e[0].scrollHeight?(0,_.getScrollbarWidth)():0)||0,l=t-(0<i?i:0);s.find(`.${tt}`).css(dt,`${l}px`),s.find(`.${it}`).css(dt,`${l}px`),s.find(`.${et}`).css(dt,`${t}px`),e.css(dt,`${t}px`)},S=this._calculatePopupMaxWidth(l);if(s.removeClass(j).css({maxWidth:`${S}px`,width:e}).removeAttr("aria-hidden"),M(S),this._subscribedToPopupMaxWidth||(this._subscribedToPopupMaxWidth=!0,i?.subscribe(this.ltm,(t=>{const e=this._calculatePopupMaxWidth(t);t=t||0,s.css({maxWidth:`${e}px`}),M(e)}))),s.css("top","").css("bottom","").css(a),this.element.find(`.${st}`).css("top","").css("bottom","").css(r),this._virtualize()&&I.css("top",r.top+(this._openPopupUp?"":this._showMultiselectSelectAll()?A:0)).css("bottom",r.bottom),this.element.toggleClass("fxc-popup-opened-up",this._openPopupUp),this._filterInPopUp()||this._multiselectSelectAll()){const t={};this._openPopupUp&&$.extend(t,{bottom:d}),this.element.find(`.${et}`).css(t)}this._setDropDownWidth()}}_calculatePopupMaxWidth(t){let e;const s=this.element.find(`.${q}`);if(-1===t)e=s.parent().find(`.${Z}`).width();else e=0<t&&t;return e||l.defaultPopupMaxWidth}_checkHeightOfItems(t){if(this._virtualize()){let e,s=!1;t.each((function(t,i){if(e){if(e!==i.offsetHeight)return void(s=!0)}else e=i.offsetHeight})),this._defaultItemHeight=e&&!s?e:A}}_setDropDownWidth(){if(this.vm.isPopUpOpen()&&!this._keyDownOnScrollBar){const t=this.element.find(`.${q}`),e=t.width();let s=this._widthOfInput;const i=this.element.find(`.${Z}`).offset(),l=i.left,o=$(window).width()-i.left-this._widthOfInput;let n="right",a=o;const r=$(document).find(".fxs-sidebar-bar"),h=$(document).find(".fxs-sidebar-leftnav-container")[0];let d=l-(h?.checkVisibility?.()&&h.offsetWidth||r.width()||0);o>d&&(n="left",a=l,d=o);let c=0;const p=t.find("[role='treeitem'] > span"),m=t.find(".fxc-dropdown-option-label.fxc-dropdown-group");if(p.each(((t,e)=>{const s=e.offsetWidth+(this._multiselectActivated()?8:0);c<s&&(c=s)})),m.each(((t,e)=>{const s=e.offsetWidth;c<s&&(c=s)})),this._checkHeightOfItems(t.find(at)),this._showStatusMessage()){const e=t.find(`.${lt}`)[0]?.offsetWidth-8;s<e&&(s=e)}const u=c+(0,_.getScrollbarWidth)()+(this._virtualize()?0:16);if(c>s){s=u;const t=d+this._widthOfInput-20;s>t&&(s=t)}s<e&&(s=e);const f={};if(f[n]=a,f[ht]=s,t.css(f),this._filterInPopUp()||this._multiselectSelectAll()){const t=this.element.find(`.${et}`),e=this.vm.popupWidthHint,i=!!e&&e()||0;t.css({width:s,maxWidth:this._calculatePopupMaxWidth(i)})}let b=bt(t);if(b-=this.element.find(`.${et}`).outerHeight()||0,this._virtualize()){b-=b%this._defaultItemHeight;const t=this.element.find(`.${st}`),e=this.element.find(`.${it}`),i=b-(this._showMultiselectSelectAll()?A:0);t.css({width:s,maxHeight:i}),e.css({maxHeight:i});const l=t[0]&&(t[0].clientHeight<t[0].scrollHeight?(0,_.getScrollbarWidth)():0)||0;this.element.find(`.${tt}`).css(ht,s-l),this.element.find(`.${it}`).css(ht,s-l)}else this.element.find(`.${st}`).css({width:"auto",maxHeight:b});const g=this.element.find(`.${et}`).outerHeight()||0,x=this._openPopupUp?`0 0 ${g}px`:`${g}px 0 0`;this.element.find(`.${K}`).css({margin:this._openPopupUp?"":x}),this.element.find(`.${st}`).css({margin:this._openPopupUp||!this._showMultiselectSelectAll()?x:""}),this.element.find(`.${it}`).css({margin:this._virtualize()?x:""})}}_closeDropdown(t,e=!1){if(!this.vm.isPopUpOpen()&&!e)return;this._canFilter=!1,this._filtering()&&(this._filtering(!1),this._customFilterResults()&&this._customFilterResults(void 0));ko.unwrap(this.vm.showStatusMessage)||this._showStatusMessage(!1),[B,W].forEach((t=>{this.element.find(`.${t}`).removeClass(t)}));this.element.find(`.${st}`)[0].scrollTop=0,this._setItems(),this._resetDropDownPosition(),this._setAttribute("aria-activedescendant",rt),this._popupGuard=!0,this.vm.isPopUpOpen(!1),this._popupGuard=!1,this._openPopupUp=void 0,this._filterActivated()&&(this._isTouch&&this._filterReadOnly(!0),this._filterInPopUp()?(this._resetTextBox(),this.element.find(`div.${Q}[role='combobox']`).focus()):t||this._setDisplayString()),this._dismissHandleLifetime&&this._dismissHandleLifetime.dispose(),this._canFilter=!0}_resetTextBox(){this._textBoxWidget.element.find("input").val(""),this._textBoxViewModel.value(void 0),this.vm.filterString(void 0)}_resetDropDownPosition(){const t={top:"",bottom:"",left:"",right:"",width:""};this.element.find(`.${q}`).css(t).attr("aria-hidden","true").addClass(j),this.element.find(`.${it}`).css(t),this.element.find(`.${st}`).css(t),this.element.find(`.${et}`).css(t)}_getItemValues(t,e=[]){return(ko.unwrap(t)||[]).forEach((t=>{if(this._multiselectActivated()||!(ko.unwrap(t.disabled)||this._getInternalItem(t).headerDisabled()))if(this._isItem(t)){const s=ko.unwrap(t.value);!e.includes(s)&&e.push(ko.unwrap(t.value))}else this._isGroup(t)&&this._getItemValues(t.children,e)})),e}_getInternalItem(t){if(this._itemsMap.has(t))return this._itemsMap.get(t);{const e=this._isItem(t);e&&this._descendantItemOnlyIndex++;const s={index:this._descendantIndex,itemIndex:e?this._descendantItemOnlyIndex:null,id:ko.observable(this._optionContainerId()+this._descendantIndex),headerDisabled:ko.observable(!1)};return this._descendantIndex++,this._itemsMap.set(t,s),s}}_isItem(t){return t&&t.hasOwnProperty("value")&&!t.hasOwnProperty("children")}_isGroup(t){return t&&(t.hasOwnProperty("children")||!t.hasOwnProperty("value"))}_checkOnShowStatusMessage(){const t=this.element.find(`.${it}`),e=this.element.find(`.${st}`),s=this._virtualize();let i=0;if(this._openPopupUp&&(i=parseInt(e.css("bottom"))||null),s&&this._showStatusMessage()){const s=e[0],l=s?.scrollHeight,o=l&&(s.clientHeight>=l||Math.abs(l-s.scrollTop-e.height())<3);e.find(`.${lt}`).css({display:o?"block":"none"}),t.css({overflow:o?"visible":""}),this._openPopupUp&&t.css({bottom:i+(o?this.element.find(`.${lt}`).height():0)})}else t.css({overflow:"",bottom:s&&this._openPopupUp?i:null})}_announceMessage(t){this._announce||(this._announce=new x.PortalReader(this.ltm,{removalDelayMs:1})),this._announce.read(t||this.element.find(`.${lt}`).text())}}e.Widget=ut;e.DropDown=(0,b.createControlComponentForKO)({widgetCtor:ut});function _t(t){return Array.isArray(t)?t:[t]}function ft(t){return MsPortalFx.merge.apply([],t)}function bt(t){return parseInt(t.css(ct).replace("px",""))||null}}));