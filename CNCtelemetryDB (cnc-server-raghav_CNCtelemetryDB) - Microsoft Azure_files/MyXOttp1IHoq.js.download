define("MsPortalImpl/Services/Services.ArmLocations",["require","exports","Fx/DependencyInjection","MsPortalImpl/Services/LazyUserData/LazyUserDataHelpers","FxInternal/AsyncLoader","FxInternal/ResourceManagement/Locations"],(function(e,t,a,n,s,r){"use strict";t.getLocationsHandler=t.getLocationsAndResourceTypesForCreateHandler=t.LocationsUserContext=void 0;var o=MsPortalFx.Base.Diagnostics.Telemetry,i=FxImpl.Azure;const l=MsPortalFx.extendArrayIntoMap(Object.create(null),MsPortalFx.getEnvironmentValue("servicesHealthAllowedRegions")||[],(e=>e.toLowerCase()));let c=class{constructor(e){o.trace({source:"Services.ArmLocations",action:"ServicesLocations"}),this.locations=(0,n.lazyUserDataMemo)(e).then((e=>e.locations.value))}};c=__decorate([__metadata("fx:diagnostics",[e,"ServicesLocations"]),a.Class(),__metadata("design:paramtypes",[a.Container])],c);let p=t.LocationsUserContext=class{constructor(e){this.getLocationDisplayNames=e=>this.locations.then((t=>{const a=e?t.filter((e=>l[e.name.toLowerCase()])):t;return MsPortalFx.extendArrayIntoMap(Object.create(null),a,(e=>e.name),(e=>e.displayName))})),this.locations=e.get(c).locations}getLocations(){return this.locations}getLocationsAndResourceTypesForCreate(e,t,a){return(0,r.getLocationsAndResourceTypesForCreate)(e,t,a)}};t.LocationsUserContext=p=__decorate([__metadata("fx:diagnostics",[e,"LocationsUserContext"]),a.Class(),__metadata("design:paramtypes",[a.Container])],p);t.getLocationsAndResourceTypesForCreateHandler=(0,s.defineHandler)(i.getLocationsAndResourceTypesForCreate,(e=>e.diContainer.get(p).getLocationsAndResourceTypesForCreate(e.messageArg.subscriptionId,e.messageArg.resourceTypes,e.messageArg.scope))),t.getLocationsHandler=(0,s.defineHandler)(i.getLocationsEndPoint,(e=>e.diContainer.get(p).getLocations().then((e=>e?.slice()))))})),
define("MsPortalImpl/Services/Services.DeploymentSession",["require","exports","Fx/DependencyInjection","MsPortalImpl/UI/UI.AuthStateManager","Fx/Ajax"],(function(e,t,a,n,s){"use strict";t.DeploymentSession=void 0;var r=MsPortalFx.Base.Diagnostics.Telemetry;const o={deploymentName:null,getAllOperations:null,location:null,launchingContext:null,managementGroupId:null,resourceId:null,resourceGroupName:null,subscriptionId:null,tenant:null,suppressDefaultNotifications:null},i={stackName:null,tenant:null,scope:null,primaryResourceId:null,parameters:null,location:null,launchingContext:null,deploymentMode:null},l={_endPreflightTs:null,_pollingStats:null,_retryAfter:null,_startPreflightTs:null,_startDeploymentTs:null,_stopPolling:null,deploymentUri:null,deploymentStatusCode:null};function c(e){return(e.objectId||e.email)+e.directoryId}function p({template:e,stack:t}){return(e||t).tenant.objectId+(e||t).tenant.id}let m=t.DeploymentSession=class{restoreDeployments(e){e.get(n.AuthStateManager).getUserInfo().then((t=>{let a;try{a=JSON.parse(MsPortalImpl.sessionStorage.getItem("_msPortalFx-Session-Deployments-{0}".format(c(t))))||{}}catch(e){return void MsPortalImpl.sessionStorage.setItem("_msPortalFx-Session-Deployments-{0}".format(c(t)),JSON.stringify({}))}const n=Object.keys(a);n.length&&(r.trace({action:"Deployments reloaded from session",source:"Services.DeploymentSession",data:{restoredNotificationCount:n.length}}),n.forEach((n=>{Promise.all([(0,s.batch)({uri:n,type:"GET",setTelemetryHeader:"Services.DeploymentSession.getDeployment"}).catch((e=>(delete a[n],MsPortalImpl.sessionStorage.setItem("_msPortalFx-Session-Deployments-{0}".format(c(t)),JSON.stringify(a)),console.warn(e),null))),MsPortalFx.require("MsPortalImpl/Services/Services.DeploymentManager")]).then((([t,s])=>{a[n].track.deployment=t?.content,e.get(s.DeploymentManager).pollDeployment(e,a[n],new Date,MsPortalFx.Base.Constants.Shell)}))})))}))}saveDeployment({template:e,track:t,stack:a}){if(!(e||a).tenant.objectId)return;const n=JSON.parse(MsPortalImpl.sessionStorage.getItem("_msPortalFx-Session-Deployments-{0}".format(p({template:e,track:t,stack:a}))))||{};n[t.deploymentUri]={template:e&&Object.keys(o).reduce(((t,a)=>(t[a]=e[a],t)),{}),track:t&&Object.keys(l).reduce(((e,a)=>(e[a]=t[a],e)),{}),stack:a&&Object.keys(i).reduce(((e,t)=>(e[t]=a[t],e)),{})},MsPortalImpl.sessionStorage.setItem("_msPortalFx-Session-Deployments-{0}".format(p({template:e,track:t,stack:a})),JSON.stringify(n))}removeDeployment({template:e,track:t,stack:a}){if(!(e||a).tenant.objectId)return;const n=JSON.parse(MsPortalImpl.sessionStorage.getItem("_msPortalFx-Session-Deployments-{0}".format(p({template:e,track:t,stack:a}))))||{};delete n[t.deploymentUri],MsPortalImpl.sessionStorage.setItem("_msPortalFx-Session-Deployments-{0}".format(p({template:e,track:t,stack:a})),JSON.stringify(n))}};t.DeploymentSession=m=__decorate([__metadata("fx:diagnostics",[e,"DeploymentSession"]),a.Class()],m)})),
define("MsPortalImpl/Services/Services.DeploymentManager",["require","exports","Fx/Ajax","MsPortalImpl/UI/Hubs/Services/DeploymentClientStrings","Fx/DependencyInjection","Fx/ResourceManagement","FxInternal/ResourceManagement/ArmTemplate","FxHubs/ArmHelpers/ArmApisStartup","FxHubs/ArmHelpers/ArmResourceGroups","FxHubs/HubsSettingsSchema","MsPortalImpl/Services/Services.ArmEvents","FxHubs/ArmHelpers/ArmIds","MsPortalImpl/Services/Services.Settings","FxHubs/ArmHelpers/ArmApis","FxHubs/ArmHelpers/ArmResources","FxHubs/RpcEndPoints","MsPortalImpl/Services/Services.ArmLocations","luxon","Fx","Fx/Experimentation","FxHubs/ArmClient","FxInternal/AsyncLoader","MsPortalImpl/UI/UI.AuthStateManager","MsPortalImpl/Services/Services.DeploymentSession","MsPortalImpl.Controls/Controls/Visualization/MonitorChartV2/AI/ME/Utilities/DateUtils","MsPortalImpl/UI/UI.BladeOpener","Fx/Composition/Selectable","MsPortalImpl/UI/UI.JourneyManager"],(function(e,t,a,n,s,r,o,i,l,c,p,m,d,u,g,y,f,I,k,b,D,S,h,x,v,P,C,M){"use strict";t.writeLastUsedUserSettingsHandler=t.pollDeploymentHandler=t.notifyDeploymentHandler=t.internalDeploymentHelperHandler=t.getMarketplaceUserSettingsHandler=t.DeploymentSettings=t.DeploymentManager=void 0;var F,w,A=a,N=c,L=k,T=MsPortalFx.Base,_=MsPortalFx.Azure.ResourceManager,U=_.DeploymentStages,E=FxImpl.Hubs.Notifications,R=MsPortalFx.Hubs.Notifications.NotificationStatus;const O=n.Notifications.DeployTemplate,H=_.DeploymentStates,{createLauncherLastUsedSubscriptionId:B,createLastDeployedItems:G,deploymentsLastUsedLocations:J,createLauncherLastUsedResourceGroupLocation:$}=c.Keys,j=T.Diagnostics.createLog(e),q='<a href="{0}">{1}</a>',V="Microsoft.Resources/deployments/write",z="pollForUpdates",K="Deploy.",W=[H.Succeeded,H.Failed,H.Deleted,H.Canceled],Y={source:"Microsoft.Resources",operationNameRegex:V};function X(e){const t=e[B];if("string"==typeof t){const a={[t]:Date.now()};e={...e,[B]:a}}return void 0===t&&(e={...e,[B]:{}}),e}let Q=t.DeploymentManager=F=class{constructor(){this.notificationMap={}}static getPollingInterval(e,t){return t?1e3*t:e<=80?5e3:(e-=80)<=60?6e4:3e5}getOrSetNotification(e,t){e=e||new Date;let a=this.notificationMap[e.toJSON()];return a||(this.notificationMap[e.toJSON()]=a=t(e)),a}updateNotification(e){const{options:t,status:a,title:n,description:s,deepLink:i}=e,{template:c,track:p,stack:d}=t;this.prepareNotification({template:c,track:p,stack:d});const u=p._notification;return u?(u.status=a,u.title=n,u.description=s,u.descriptionAsHtml=!0,Promise.resolve().then((()=>{const e=p.deployment;if(e){const a=(0,g.getProvisioningState)(e),n=e.properties.correlationId;if(~u.correlationIds.indexOf(n)||u.correlationIds.push(n),a===H.Succeeded){u.uri=i;const e=r.ArmId.parse(d?.primaryResourceId||c?.resourceId,!0),a=r.ArmId.parse((0,o.getDeploymentScope)({template:c,track:p,stack:d}),!0);let n=m.ResourceArmIdKindMap[e.kind]?1:0;n|=4===a.kind?2:0,n|=1===a.kind?4:0;const s=(d?.notifications||c?.notifications||{}).pinToDashboard||!(1&n)&&2&n&&{name:"ResourceGroupMapPinnedPart",extension:"HubsExtension",parameters:{id:4===a.kind&&r.ArmId.stringify(a)}},g=[],y=1&n&&{label:O.Actions.goToResource,deepLink:{uri:(t=d?.primaryResourceId||c?.resourceId,`#resource${t}`)}},f=2&n?{label:O.Actions.goToResourceGroup,deepLink:{uri:(0,l.getDeepLinkToResourceGroup)(r.ArmId.stringify({resourceGroup:a.resourceGroup,subscription:a.subscription,kind:4},4))}}:4&n&&{label:O.Actions.goToSubscription,deepLink:{uri:(0,l.getDeepLinkToSubscription)(r.ArmId.stringify({subscription:a.subscription,kind:1},1))}};g.push(y),s&&g.push({label:O.Actions.pinToDashboard,pinToDashboard:{name:s.name,extension:s.extension,parameters:s.parameters}}),g.push(f),u.inlineForm={buttons:g.filter((e=>!!e)).slice(0,2)},u.uri||(u.uri=`#resource/subscriptions/${c?.subscriptionId}`)}else u.uri=se(e.id)}else i&&(u.uri=i);var t})).then((()=>u.publish()))):Promise.resolve(void 0)}prepareNotification({template:e,track:t,stack:a},n){return(8&a?.deploymentMode||e&&!e.suppressDefaultNotifications)&&!t._notification&&(t._notification=this.getOrSetNotification(n,(e=>new E.InternalClientNotification({status:R.InProgress,title:"",description:"",descriptionAsHtml:!0,timestamp:e})))),{template:e,track:t,stack:a}}async checkDeploymentStatus(e,{template:t,track:a,stack:n},s,r){if(a._stopPolling)return Promise.resolve({template:t,track:a,stack:n});r||(r={count:0,retryAfter:void 0}),a._retryAfter=a._retryAfter||[];try{const l=await re({template:t,track:a,stack:n},`${K}${z}.attempt${r.count}`),c=l.content;if(!n&&c.properties.correlationId&&!te(c.properties.correlationId,a.deployment.properties.correlationId))return await this.handleOverriddenDeployment(e,{template:t,track:a,stack:n},s);const p=await async function({stack:e,template:t,track:a}){if(e||t?.getAllOperations){let e=[];const t=(0,u.deploymentOperationsApi)(a.deployment.id);await(0,i.callWithContinuation)([t],(t=>{e=e.concat(t||[])}),(e=>{throw e}),K+"getOperations").then((()=>e)).catch((e=>{j.warning("Failed to get deployment operations: "+JSON.stringify(e.jqXHR.responseJSON))}))}return}({template:t,track:{...a,deployment:c},stack:n});return a.operations=p,await Promise.resolve(this.handleDeployment(e,{template:t,track:a,stack:n},c,(0,g.getProvisioningState)(c),(async t=>{(function(e){return!!e.notify})(t)&&(0,o.notifyProgress)(t,p);const n=parseInt(l.headers["Retry-After"]);return a._retryAfter.push(n),await L.delay(F.getPollingInterval(r.count,n)),r={count:r.count+1,retryAfter:n},this.checkDeploymentStatus(e,t,s,r)})))}catch(e){(0,o.buildTemplateFailureFromBatchItemError)(t,U.GetDeploymentStatus,e)}finally{r.count<=1&&(a._pollingStats={startPreflightTs:a._startPreflightTs,endPreflightTs:a._endPreflightTs,startDeploymentTs:a._startDeploymentTs,endDeploymentTs:Date.now(),startArm:a.requestTimestamp,endArm:a.deployment.properties.timestamp,retryAfter:a._retryAfter})}}async handleOverriddenDeployment(e,{template:t,track:a,stack:n},s){const r=a.requestTimestamp;let l,c;r?(l=I.DateTime.fromISO(r).toJSDate(),c=I.DateTime.fromISO(r).plus({days:7}).toJSDate()):(c=I.DateTime.local().toJSDate(),l=I.DateTime.fromJSDate(c).minus({days:7}).toJSDate());const p=new T.UriBuilder(a.deploymentUri).getRelativePath(),m=a.deployment.properties.correlationId,d="eventChannels eq 'Admin, Operation' and correlationId eq '{0}'".format(m),u=(0,i.getEventsApi)(t?.subscriptionId,l,c,d),g=` for deployment ${t?.deploymentName}, correlationId ${m}.`,y=e=>{const s="Deployment status unavailable. correlationId didn't match. "+e;j.warning(s),this.deploymentStatusUnknown({template:t,track:a,stack:n},s),(0,o.buildTemplateFailure)(t,(0,o.buildError)(new Error(s)),U.GetDeploymentStatus,!0)};let f=[];try{await(0,i.callWithContinuation)([u],(e=>{f=f.concat(e||[])}),(e=>{throw e}),`${K}getEvents-${s}`),f&&f.length||y("Failed to get status"+g);const r=f.filter((e=>te(p,e.resourceUri)&&te(V,(e.operationName||{}).value)));r.length<1&&y("Failed to get events"+g),r.sort(((e,t)=>I.DateTime.fromISO(t.eventTimestamp).diff(I.DateTime.fromISO(e.eventTimestamp)).as("milliseconds")));const o=r[0];return await Promise.resolve(this.handleDeployment(e,{template:t,track:a,stack:n},{id:p,name:V,properties:{correlationId:m,provisioningState:o.status.value,timestamp:o.eventTimestamp}},ae(o.status.value),(()=>y("Unexpected provisioning state"+g))))}catch(e){throw"stage"in e?e:(0,o.buildTemplateFailure)(t,(0,o.buildError)(e.reason),U.GetDeploymentStatus)}}notifyDeployment(e,t,a,n,s){switch(this.prepareNotification(t,n),a){case 0:return this.notifyInitializingDeployment(t);case 1:return this.notifySubmittingDeployment(t);case 2:return this.notifyDeploymentInProgress(t);case 3:return n&&delete this.notificationMap[n.toString()],this.notifySuccessfulDeployment(e,t);case 4:return n&&delete this.notificationMap[n.toString()],this.notifyDeploymentFailed(t,s);default:return Promise.resolve(n)}}async pollDeployment(e,{template:t,track:a,stack:n},s,r){this.prepareNotification({template:t,track:a,stack:n},s),delete this.notificationMap[s.toString()],a.deploymentUri||(a.deploymentUri=n?(0,u.getDeploymentStacksApi)((0,o.getDeploymentScope)({template:t,track:a,stack:n}),n.stackName):(0,u.getDeploymentApi)((0,o.getDeploymentScope)({template:t,track:a,stack:n}),t.deploymentName)),a.deployment&&this.notifyDeploymentInProgress({template:t,track:a,stack:n}),!a.requestTimestamp&&(a.requestTimestamp=a.deployment.properties.timestamp);const i=e.get(p.ArmEvents);let l;try{return({stack:n,track:a,template:t}=await Promise.any([this.checkDeploymentStatus(e,{template:t,track:a,stack:n},r),new Promise(((s,r)=>{let o=!0;l=i.subscribeToArmEvent(Y,(i=>{(0,k.forEachKey)(i,(async(i,l={})=>{let c=a.deploymentUri;const p=c.indexOf("?");c=ne(p>-1?c.substring(0,p):c);const m=ae(l.status||"");if(l.correlationId===a.deployment.properties.correlationId&&c===ne(l.assetId)&&""===l.subStatus&&W.includes(m)&&o){a._stopPolling=!0,j.verbose(`Deployment ${m} based on eventService: ${JSON.stringify(l)}.`);try{const{content:r}=await re({template:t,track:a,stack:n},`${K}${z}.eventMatch`),i=(0,g.getProvisioningState)(r);({template:t,track:a,stack:n}=this.handleDeployment(e,{template:t,track:a,stack:n},r,i,(()=>{throw new Error(`Deployment completed at a non-terminal state: ${i}: ${JSON.stringify(l)}.`)}))),o=!1,s({template:t,track:a,stack:n})}catch(e){o=!1,r(e)}}}))}))}))])),{stack:n,track:a,template:t}}finally{l&&i.removeArmEventSubscription(l)}}notifyDeploymentFailed({template:e,track:t,stack:a},n={}){const s=t.deployment,i=(0,o.getDeploymentLevel)({template:e,track:t,stack:a}),c=ee({template:e,track:t,stack:a},i);let p,m,d,u=O.DeploymentRequestFailed.label,g=O.DeploymentRequestFailed.message.format(c,Z({template:e,track:t,stack:a})),y=R.Error;const f=(n.error||(0,o.getInnerError)(s)||{}).message;switch(n.stage){case U.InitialSetup:case U.SanityCheck:case U.FulfillPrerequisites:case U.GetDeploymentName:switch(u=O.ErrorStartingDeployment.label,i){case 0:g=O.TenLevelErrorStartingDeployment.message.format(c,Z({template:e,track:t,stack:a}));break;case 1:g=O.SubLevelErrorStartingDeployment.message.format(c,Z({template:e,track:t,stack:a}));break;case 3:g=O.MGLevelErrorStartingDeployment.message.format(c,Z({template:e,track:t,stack:a}));break;case 2:g=O.ErrorStartingDeployment.message.format(c,Z({template:e,track:t,stack:a}))}break;case U.ProvisionResourceGroup:u=O.ErrorStartingDeployment.label,g=O.ErrorProvisioningResourceGroup.message.format(c,Z({template:e,track:t,stack:a}));break;case U.RegisterResourceProviders:u=O.ErrorStartingDeployment.label,g=O.ErrorRegisteringResourceProviders.message.format(c,Z({template:e,track:t,stack:a}));break;case U.ValidateTemplate:u=O.DeploymentValidationFailed.label,g=O.DeploymentValidationFailed.message,d=!(p=!!f);break;case U.SubmitDeploymentRequest:u=O.ErrorSubmittingDeploymentRequest.label,g=O.ErrorSubmittingDeploymentRequest.message,d=!(p=!!f);break;case U.GetDeploymentStatus:u=O.ErrorGettingDeploymentStatus.label,g=O.ErrorGettingDeploymentStatus.message,y=R.Warning,m=!(p=!!f);break;default:switch(u=O.DeploymentFailed.label,i){case 0:g=O.TenLevelDeploymentFailed.message.format(c,Z({template:e,track:t,stack:a}));break;case 1:g=O.SubLevelDeploymentFailed.message.format(c,Z({template:e,track:t,stack:a}));break;case 3:g=O.MGLevelDeploymentFailed.message.format(c,Z({template:e,track:t,stack:a}));break;case 2:g=O.DeploymentFailed.message.format(c,Z({template:e,track:t,stack:a}))}m=!(p=!!f)}let I;f&&(g+="<br/>"+O.additionalDetailsPrefix+" "+f),m&&(s?I=se(s.id):d=!0);let k="";if(a){const{resourceGroup:e,subscription:t}=r.ArmId.parse(a.primaryResourceId);k=r.ArmId.stringify({resourceGroup:e,subscription:t,kind:4})}return e&&(k=r.ArmId.stringify({resourceGroup:e.resourceGroupName,subscription:e.subscriptionId,kind:4},4)),d&&(I=(0,l.getDeepLinkToResourceGroup)(k)),p&&(I="#resource"+(0,o.getDeploymentScope)({template:e,stack:a,track:t})+"/eventlogs"),this.updateNotification({options:{template:e,track:t,stack:a},status:y,title:u,description:g,deepLink:I})}deploymentSucceeded(e,{template:t,track:a,stack:n}){this.notifySuccessfulDeployment(e,{template:t,track:a,stack:n}),a.deploymentStatusCode=0;const s=r.ArmId.parse((0,o.getDeploymentScope)({template:t,track:a,stack:n})),i=(t||n).location;return s.subscription&&e.get(me).updateUserSettings(e,s.subscription,i,(t.launchingContext||{}).galleryItemId),{template:t,track:a,stack:n}}deploymentFailed({template:e,track:t,stack:a}){return this.notifyDeploymentFailed({template:e,track:t,stack:a}),t.deploymentStatusCode=-1,{template:e,track:t,stack:a}}handleDeployment(e,{template:t,track:a,stack:n},s,r,o){switch(a.deployment=s,r){case H.Succeeded:return e.get(x.DeploymentSession).removeDeployment({template:t,track:a,stack:n}),this.deploymentSucceeded(e,{template:t,track:a,stack:n});case H.Failed:return e.get(x.DeploymentSession).removeDeployment({template:t,track:a,stack:n}),this.deploymentFailed({template:t,track:a,stack:n});case H.Canceled:return e.get(x.DeploymentSession).removeDeployment({template:t,track:a,stack:n}),this.deploymentCanceled({template:t,track:a,stack:n});case H.Deleted:return e.get(x.DeploymentSession).removeDeployment({template:t,track:a,stack:n}),this.deploymentDeleted({template:t,track:a,stack:n});default:return o({template:t,track:a,stack:n})}}deploymentCanceled(e){return this.notifyDeploymentCanceled(e),e.track.deploymentStatusCode=-1,e}deploymentDeleted(e){return this.notifyDeploymentDeleted(e),e.track.deploymentStatusCode=-1,e}deploymentStatusUnknown(e,t){return this.notifyDeploymentUnknown(e,t),e}notifyDeploymentCanceled(e){let t;const a=e.track.deployment,n=(0,o.getDeploymentLevel)(e),s=ee(e,n);switch(n){case 0:t=O.TenLevelDeploymentCanceled.message.format(s,Z(e));break;case 1:t=O.SubLevelDeploymentCanceled.message.format(s,Z(e));break;case 3:t=O.MGLevelDeploymentCanceled.message.format(s,Z(e));break;case 2:t=O.DeploymentCanceled.message.format(s,Z(e))}return this.updateNotification({options:e,status:R.Information,title:O.DeploymentCanceled.label,description:t,deepLink:a&&se(a.id)})}notifyDeploymentDeleted(e){let t;const a=e.track.deployment,n=(0,o.getDeploymentLevel)(e),s=ee(e,n);switch(n){case 0:t=O.TenLevelDeploymentDeleted.message.format(s,Z(e));break;case 1:t=O.SubLevelDeploymentDeleted.message.format(s,Z(e));break;case 3:t=O.MGLevelDeploymentDeleted.message.format(s,Z(e));break;case 2:t=O.DeploymentDeleted.message.format(s,Z(e))}return this.updateNotification({options:e,status:R.Information,title:O.DeploymentDeleted.label,description:t,deepLink:a&&se(a.id)})}notifyDeploymentUnknown(e,t){let a;const n=(0,o.getDeploymentLevel)(e),s=ee(e,n);switch(n){case 0:a=O.TenLevelDeploymentStatusUnknown.message.format(s,Z(e));break;case 1:a=O.SubLevelDeploymentStatusUnknown.message.format(s,Z(e));break;case 3:a=O.MGLevelDeploymentStatusUnknown.message.format(s,Z(e));break;case 2:a=O.DeploymentStatusUnknown.message.format(s,Z(e))}return t&&(a+=" "+O.additionalDetailsPrefix+" "+t),this.updateNotification({options:e,status:R.Warning,title:O.ErrorGettingDeploymentStatus.label,description:a,deepLink:(0,l.getDeepLinkToResourceGroup)(e.stack?.scope||r.ArmId.stringify({resourceGroup:e.template?.resourceGroupName,subscription:e.template?.subscriptionId,kind:4},4))})}notifyInitializingDeployment(e){let t;const a=(0,o.getDeploymentLevel)(e),n=ee(e,a);switch(a){case 0:t=O.TenLevelInitializingDeployment.message.format(n,Z(e));break;case 1:t=O.SubLevelInitializingDeployment.message.format(n,Z(e));break;case 3:t=O.MGLevelInitializingDeployment.message.format(n,Z(e));break;case 2:t=O.InitializingDeployment.message.format(n,Z(e))}return this.updateNotification({options:e,status:R.InProgress,title:O.InitializingDeployment.label,description:t})}notifySubmittingDeployment(e){let t;const a=(0,o.getDeploymentLevel)(e),n=ee(e,a);switch(a){case 0:t=O.TenLevelSubmittingDeployment.message.format(n,Z(e));break;case 1:t=O.SubLevelSubmittingDeployment.message.format(n,Z(e));break;case 3:t=O.MGLevelSubmittingDeployment.message.format(n,Z(e));break;case 2:t=O.SubmittingDeployment.message.format(n,Z(e))}return this.updateNotification({options:e,status:R.InProgress,title:O.SubmittingDeployment.label,description:t,deepLink:(0,l.getDeepLinkToResourceGroup)(e.stack?.scope||r.ArmId.stringify({resourceGroup:e.template?.resourceGroupName,subscription:e.template?.subscriptionId,kind:4},4))})}notifySuccessfulDeployment(e,t){let n;const s=t.track.deployment,i=s&&se(s.id),c=(0,o.getDeploymentLevel)(t),p=ee(t,c),m=t.stack?.stackName||t.template?.deploymentName;switch(c){case 0:n=O.TenLevelDeploymentSucceeded.message.format(q.format(i,m),p,Z(t));break;case 1:n=O.SubLevelDeploymentSucceeded.message.format(q.format(i,m),p,Z(t));break;case 3:n=O.MGLevelDeploymentSucceeded.message.format(q.format(i,m),p,Z(t));break;case 2:n=O.DeploymentSucceeded.message.format(q.format(i,m),q.format((0,l.getDeepLinkToResourceGroup)(t.stack?.scope||r.ArmId.stringify({resourceGroup:t.template?.resourceGroupName,subscription:t.template?.subscriptionId,kind:4},4)),p)),s?.id&&((0,k.isFeatureEnabled)("cachecreatedresources")||e.get(b.Experimentation).shellAssignments.getBooleanValue("addcreatedtorecents"))&&(d=s.id,(0,a.batch)({uri:le(d),type:"GET",setTelemetryHeader:"ShellProvisioner.fetchDeployment"})).then((t=>{const a=t?.content?.properties?.outputResources?.map((e=>e.id))||[];if((0,k.isFeatureEnabled)("cachecreatedresources")&&y.AssetTypes.cacheNewlyCreatedResourcesEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceIds:a}),e.get(b.Experimentation).shellAssignments.getBooleanValue("addcreatedtorecents"))for(const e of a)(0,D.getResource)(e,"deploymentmanager",{background:!0,skipCacheMissRetry:!0}).then((t=>{const a=t.id||e,n=r.ArmId.parse(e,!0).resourceType.toLowerCase();(0,r.addRecentResource)({id:a,name:r.ResourceName.getDisplayName(t),location:t.location,type:n,kind:t.kind})}))}))}var d;return this.updateNotification({options:t,status:R.Success,title:O.DeploymentSucceeded.label,description:n,deepLink:i})}notifyDeploymentInProgress(e){let t;const a=e.track.deployment,n=(0,o.getDeploymentLevel)(e),s=ee(e,n);switch(n){case 0:t=O.TenLevelDeploymentInProgress.message.format(s,Z(e));break;case 1:t=O.SubLevelDeploymentInProgress.message.format(s,Z(e));break;case 3:t=O.MGLevelDeploymentInProgress.message.format(s,Z(e));break;case 2:t=O.DeploymentInProgress.message.format(s,Z(e))}return this.updateNotification({options:e,status:R.InProgress,title:O.DeploymentInProgress.label,description:t,deepLink:a&&se(a.id)})}};function Z(e){return e.template?O.template:O.stack}function ee({stack:e,template:t,track:a},n){const s=r.ArmId.parse((0,o.getDeploymentScope)({stack:e,template:t,track:a}));switch(n){case 2:return s.resourceGroup;case 1:return s.subscription;case 3:return s.resourceName;default:return(e||t)?.tenant?.name}}function te(e,t){return!MsPortalFx.localeCompareIgnoreCase(e||"",t)}function ae(e){return e.toLowerCase()}function ne(e){return ae(MsPortalFx.trimEnd(e,"/"))}function se(e){return`#blade/HubsExtension/DeploymentDetailsBlade/id/${encodeURIComponent(e)}`}async function re({stack:e,track:t},a){const n=await(0,g.getRawArmResource)(t.deploymentUri,a);if(!e)return n;const s=await(0,o.pollDeploymentFromId)(n.content.properties.deploymentId);return t.deployment=s.content,s}t.DeploymentManager=Q=F=__decorate([__metadata("fx:diagnostics",[e,"1"]),s.Class(),__metadata("design:paramtypes",[])],Q);const oe=/^[\s/]*|\/*$/g;function ie(e){return e?"/"+function(e){return e.replace(oe,"")}(e):""}function le(e){return`${ie(e)}?api-version=${(0,k.getFeatureValue)("deployapiver")||"2020-06-01"}`}function ce(e,t,a){const n={store:MsPortalFx.isNullOrUndefined(a)?6:a,keys:t};return e.querySettings(n).then((e=>MsPortalFx.convertArrayToMap(t,MsPortalFx.identity,(t=>e[t]))))}function pe(e,t,a){const n=Object.keys(e);if(!n.some((e=>e===t))&&n.length&&n.length>=a){let t=n[0],a=e[t];(0,k.forEachKey)(e,((n,s)=>{s-a<0&&(a=e[t=n])})),delete e[t]}return e[t]=Date.now(),e}let me=t.DeploymentSettings=w=class{updateUserSettings(e,t,a,n){return e.getAsync(d.SettingsManager).then((s=>Promise.all([ce(s,[G,J,B]),e.get(f.LocationsUserContext).getLocations()]).then((([e,r])=>{const o={},i=(e=X(e))[G]||{},l=e[J]||{},c=e[B]||{};n&&(pe(i,n,w.lastUsedGalleryItemsMaxCount),o[G]=i);const p=MsPortalFx.find(r,(e=>te(e.name,a)||te(e.displayName,a)));return p&&(pe(l,p.name,w.lastUsedLocationsMaxCount),o[$]=p.name,o[J]=l),t&&(pe(c,t,w.lastUsedSubscriptionsMaxCount),o[B]=c),function(e,t,a){const n={store:a||6,settings:t};e.setSettings(n)}(s,o)}))))}getMarketplaceUserSettings(e){return e.getAsync(d.SettingsManager).then((e=>ce(e,[G,B,$]).then((e=>{const t=(e=X(e))[B]||{},[a]=Object.keys(t).sort(((e,a)=>(0,v.compare)(new Date(t[a]),new Date(t[e]))));return{...e,[B]:(0,k.isFeatureEnabled)("mpLastUsedSubscription")?t:a}}))))}async getCreateUserSettings(e){const t=await e.getAsync(d.SettingsManager),a=X(await ce(t,[N.Keys.deploymentsLastUsedLocations,B])),n=a[B]||{},s=Object.keys(n).sort(((e,t)=>(0,v.compare)(new Date(n[t]),new Date(n[e])))),r=a[N.Keys.deploymentsLastUsedLocations]||{},o=Object.keys(r).sort(((e,t)=>(0,v.compare)(new Date(r[t]),new Date(r[e]))));return{[B]:s,[$]:o}}};me.lastUsedGalleryItemsMaxCount=5,me.lastUsedLocationsMaxCount=5,me.lastUsedSubscriptionsMaxCount=10,t.DeploymentSettings=me=w=__decorate([__metadata("fx:diagnostics",[e,"1"]),s.Class()],me);t.getMarketplaceUserSettingsHandler=(0,S.defineHandler)(y.Marketplace.getMarketplaceUserSettingsEndPoint,(e=>e.diContainer.get(me).getMarketplaceUserSettings(e.diContainer))),t.writeLastUsedUserSettingsHandler=(0,S.defineHandler)(N.writeHubsLastUsedUserSettings,(e=>e.diContainer.get(me).updateUserSettings(e.diContainer,e.messageArg.subscriptionId,e.messageArg.resourceGroupLocation,e.messageArg.galleryItemId))),t.notifyDeploymentHandler=(0,S.defineHandler)(y.ResourceManager.notifyDeploymentEndPoint,(e=>{const{options:t,stage:a,date:n,failure:s}="string"==typeof e.messageArg?JSON.parse(e.messageArg):e.messageArg;return e.diContainer.get(h.AuthStateManager).getUserInfo().then((r=>(t.template=t.template&&MsPortalFx.extend2(t.template,{tenant:{name:r.directoryName,id:r.directoryId,objectId:r.objectId}}),t.stack=t.stack&&MsPortalFx.extend2(t.stack,{tenant:{name:r.directoryName,id:r.directoryId,objectId:r.objectId}}),e.diContainer.get(Q).notifyDeployment(e.diContainer,t,a,n,s))))})),t.pollDeploymentHandler=(0,S.defineHandler)(y.ResourceManager.pollDeploymentEndPoint,(async e=>{const{options:t,date:a}="string"==typeof e.messageArg?JSON.parse(e.messageArg):e.messageArg,n=e.diContainer.get(x.DeploymentSession),s=await e.diContainer.get(h.AuthStateManager).getUserInfo();t.template=t.template&&{...t.template,tenant:{name:s.directoryName,id:s.directoryId,objectId:s.objectId}},t.stack=t.stack&&{...t.stack,tenant:{name:s.directoryName,id:s.directoryId,objectId:s.objectId}};const r=e.diContainer.get(Q).pollDeployment(e.diContainer,t,a,e.messageContext.srcWindowId);n.saveDeployment(t);const{track:o}=t;if(o.postProvisioning){const a=e.diContainer.get(M.JourneyManager),n=new C.PdlBladeReference("DeploymentDetailsBlade","HubsExtension",{parameters:{id:o.postProvisioning.id,packageId:o.postProvisioning.packageId,packageIconUri:o.postProvisioning.packageIconUri,primaryResourceId:o.postProvisioning.primaryResourceId,assetTypeId:o.postProvisioning.assetTypeId,provisioningHash:o.postProvisioning.provisioningHash,createBlade:o.postProvisioning.createBlade}}),s=t.template?.telemetryId||t.stack?.telemetryId||"";e.diContainer.get(P.BladeOpener).openBlade(n,{flags:8,telemetryName:"ShellProvisioner"+(s?`_${s}`:"")});const r=a.activeJourney();r&&a.forceDiscardJourney(r.id)}try{const e=await r;return JSON.parse(JSON.stringify(e))}catch(e){return JSON.parse(JSON.stringify(e))}})),t.internalDeploymentHelperHandler=(0,S.defineHandler)(y.ResourceManager.internalDeploymentHelper,(e=>{console.log(`Start Deployment in shell kicked off by ${e.messageContext.srcWindowId}`);const t=e.messageArg.uri;if(4===r.ArmId.parse(t.split("?")[0],!0).kind||t.toLowerCase().includes("/providers/microsoft.resources/deployments/"))return t.includes("validate?api-version")?(0,o.validateAsyncImpl)(e.messageArg).catch((e=>{throw JSON.stringify(e)})):A.batch(e.messageArg).catch((e=>{throw JSON.stringify(e)}))}))})),
define("MsPortalImpl/Services/Services.ProvisioningInitialValues",["require","exports","Fx/ResourceManagement","FxInternal/AsyncLoader","FxHubs/HubsSettingsSchema","MsPortalImpl/UI/UI.JourneyManager"],(function(e,t,a,n,s,r){"use strict";t.determineInitialValues=async function(e,t){const a=await p(e),n=[];if(t?.length>0){if(a.subscriptionIds?.length>0){const e=t.map((e=>e.subscriptionId.toLowerCase()));a.subscriptionIds.forEach((t=>{e.includes(t.toLowerCase())&&n.push(t)}))}if(0===n.length){const e=t.find((e=>l.includes(e.state.toLowerCase())));e&&n.push(e.subscriptionId)}}return{subscriptionIds:n,resourceGroupNames:a.resourceGroupNames,locationNames:a.locationNames,lastUsedSubscriptionIds:a.subscriptionIds}},t.getInitialValues=c,t.getInitialValuesAsync=p;const{createLauncherLastUsedSubscriptionId:o,createLauncherLastUsedResourceGroupLocation:i}=s.Keys,l=["enabled","active","pastdue"];function c(e,t,n,s){const l=e.get(r.JourneyManager).activeJourney(),c=l&&l.getCurrentResourceId(),p=c&&a.ArmId.parse(c,!0),d=[];let u;p&&(d.push(p.resourceGroup),u=p.subscription);const{[i]:g,[o]:y}=t;return u=n||u,s&&m(d,s),{subscriptionIds:y.reduce(m,u?[u]:[]),resourceGroupNames:d,locationNames:g}}async function p(e){const t=await e.getAsync(n.get("MsPortalImpl/Services/Services.DeploymentManager","DeploymentSettings"));return c(e,await t.getCreateUserSettings(e))}function m(e,t){return t&&!e.includes(t)&&e.push(t),e}})),
define("MsPortalImpl/Base/Base.Selectable2.Provisioning",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.Selectable2.Common","FxHubs/MarketplaceRpc","FxHubs/ProvisioningRpc","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Services/Services.DeploymentManager","MsPortalImpl/Base/Base.Selectable2","FxInternal/AsyncLoader","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/Services/Services.ProvisioningInitialValues","Fx/Telemetry","FxHubs/Common/AssetTypeCache"],(function(e,t,a,n,s,r,o,i,l,c,p,m,d,u,g){"use strict";t.OpenBladeHandler=void 0,t.getDynamicCreateBladeReference=async function(t,a){const{galleryItemId:n,inputs:r,catalogId:o,subscriptionId:i}=a;let l,c;try{l=t.get(p.CompositionProvenance)?.instanceId,c=l&&t.get(m.Finder).find(l)}catch{}const d=a.createflow||(0,s.getCreateFlow)({marketplaceGalleryItemId:n,subscriptionId:i,catalogId:o,launchingContext:{telemetryId:MsPortalFx.newGuid(),source:c?[c.locator?.name,c.toString(),l]:["DeepLink"],galleryItemId:n},additionalConfig:r,alternateCreateFlowOptions:{useStackSelectionIfAvailable:!0}},((a,n)=>{(0,p.logToExtension)(e,a,2,n,{waitForExtension:!0,diContainer:t})})),[u,g]=await Promise.all([k(t,{marketplaceResults:d}),d]);if("bladeSelection"in g){const{bladeSelection:e}=g;e.detailBladeInputs={...e.detailBladeInputs,...u.provisioningInputs};return{extension:e.extension,detailBlade:e.detailBlade,detailBladeInputs:{...r,...e.detailBladeInputs},defaultMenuItemId:null}}if(g.bladeInputs.internal_assetTypeInputs)return{extension:g.bladeExtension,detailBlade:g.bladeName,detailBladeInputs:{...r,...g.bladeInputs,...u.provisioningInputs},defaultMenuItemId:null};return{extension:g.bladeExtension,detailBlade:g.bladeName,detailBladeInputs:{...r,...g.bladeInputs},defaultMenuItemId:null}},t.getMarketplaceItemAndInitialValues=k,t.getProvisioningContextHandler=void 0,t.processAssetTypeReference=b;var y=s;const f=(e,t)=>e?.toLowerCase()===t?.toLowerCase(),I=e=>{const t=[];return{add:e=>{t.push(e)},flushTelemetry:()=>{(0,u.trace)({source:"Base.Selectable2.Provisioning",action:e,data:{indicies:t}})}}};async function k(t,a){const n=I("getMarketplaceItemAndInitialValues"),{marketplaceOptions:s,marketplaceResults:r,inputs:o}=a,l=(async()=>{let a=o&&o.fx_marketplaceContext;if(!s?.marketplaceGalleryItemId&&!r)return n.add(2),null;const i=await(r||y.getCreateFlow(s,((a,n)=>{(0,p.logToExtension)(e,a,2,n,{waitForExtension:!0,diContainer:t})})));if("bladeName"in i){n.add(3);const{internal_assetTypeInputs:e,...t}=i.bladeInputs;return{blade:{bladeName:i.bladeName,bladeExtension:i.bladeExtension,detailBladeInputs:t},assetTypeInputs:e}}const l=i.bladeSelection.detailBlade,c=i.bladeSelection.extension;let m=i.bladeSelection.detailBladeInputs;if(a=m.fx_marketplaceContext,delete m.fx_marketplaceContext,a)return n.add(5),{createFlow:null,marketplaceContext:a,blade:{bladeName:l,bladeExtension:c,detailBladeInputs:m}};const{internal_bladeCallerParams:d}=m;if(!d)return n.add(6),{blade:{bladeName:l,bladeExtension:c,detailBladeInputs:m}};n.add(7);const u=FxImpl.mapValues(d,FxImpl.fromSerializableObject);return m=i.createVersion<3?m:null,{createFlow:u,marketplaceContext:null,blade:{bladeName:l,bladeExtension:c,detailBladeInputs:m}}})(),c=t.get(i.DeploymentSettings).getCreateUserSettings(t);return Promise.all([l,c]).then((([e,a])=>{n.add(8);const{marketplaceContext:s,createFlow:r,blade:o,assetTypeInputs:i}=e||{},{launchingContext:l,referenceType:c}=i||{};let u={};if(s)n.add(9),u={...u,...s};else if(r){n.add(10);const{providerConfig:e}=r,{provisioningConfig:t}=e;delete e.provisioningConfig,delete r.providerConfig;const{startboardProvisioningInfo:a,galleryCreateOptions:s}=t,{telemetryId:o}=s.launchingContext,i={...r,...e};u={...u,telemetryId:o,marketplaceItem:{...s.galleryItem,deploymentFragmentFileUris:s.deploymentFragmentFileUris,deploymentName:s.deploymentName,deploymentTemplateFileUris:s.deploymentTemplateFileUris,launchingContext:{telemetryId:o,...s.launchingContext},uiMetadata:i},provisioningConfig:{dontDiscardJourney:t.dontDiscardJourney,dashboardPartReference:{dashboardPartKeyId:a.startboardPartKeyId,partName:a.startboardPart.name,options:{extensionName:a.startboardPart.extension},parameters:null}}}}if(u.initialValues={...(0,d.getInitialValues)(t,a,e?.createFlow?.providerConfig?.provisioningConfig?.galleryCreateOptions?.subscriptionId,e?.marketplaceContext?.resourceGroupName||e?.createFlow?.providerConfig?.provisioningConfig?.galleryCreateOptions?.resourceGroupName)},u.telemetryId||(n.add(11),u.telemetryId=l?.telemetryId||MsPortalFx.getUniqueId()),!u.marketplaceItem){let e,a;n.add(12);try{e=t.get(p.CompositionProvenance)?.instanceId,a=e&&t.get(m.Finder).find(e)}catch{}u.marketplaceItem={categoryIds:[],id:"Microsoft.Portal",itemDisplayName:"NoMarketplace",products:[],version:"",productsWithNoPricing:[],publisherDisplayName:"Microsoft.Portal",deploymentName:"NoMarketplace",launchingContext:{telemetryId:u.telemetryId,source:[...a?[a.locator.name,a.toString()]:[],...e?[e]:[]],galleryItemId:"",...l},deploymentTemplateFileUris:{},uiMetadata:null},u.referenceType=c}const g={...o?.detailBladeInputs||{},_provisioningContext:u};return o&&(o.detailBladeInputs=g),n.flushTelemetry(),{provisioningInputs:g,blade:o}}))}t.getProvisioningContextHandler=(0,c.defineHandler)(r.provisioningContextEndpoint,(e=>k(e.diContainer,e.messageArg)));async function b(t,a,n){const{extensionName:s="",assetType:r,assetKind:o,telemetryId:l=MsPortalFx.getUniqueId()}=t.createAssetTypeOptions,[c,u]=s.split(`${MsPortalFx.Base.Constants.Shell}::`),{marketplaceExtracts:I}=await(0,g.getMarketplaceExtracts)([]),k=I.filter((e=>f(e.assetType,r)&&f(e.assetKind,o)));let[b]=k;if(!b){const t=`No extension has been registered with the asset type ${r} and cannot be used to create it. Please register your extension with the asset type in order to use it.`;throw(0,p.logToExtension)(e,u||c||MsPortalFx.Base.Constants.ExtensionNames.Marketplace,2,t,{waitForExtension:!0,diContainer:a}),new Error(t)}if(c&&([b]=k.filter((e=>f(e.extensionName,c))),!b)){const t=`The extension ${c} has not been registered with the asset type ${r} and cannot be used to create it. Please ensure ${c} is registered with the asset type in order to use it.`;throw(0,p.logToExtension)(e,u,2,t,{waitForExtension:!0,diContainer:a}),new Error(t)}if(u){const[t]=k.filter((e=>f(e.extensionName,u)));t||(0,p.logToExtension)(e,u,2,`Your extension has not been registered with the asset type ${r}. It is currently defaulting to the asset owned by extension ${b.extensionName}. Please register your extension with a different asset type name or explicitly prefix your forCreateAssetType().createReference({ assetType: "${r}" }) call with forExtension("${b.extensionName}") in order to use it. Also please update the metadata of any marketplace items you have referencing this asset type with '"portalfx_createExtensionName": "${b.extensionName}" // or "${u}"'. If you see this error during development, DO NOT DEPLOY WITH THIS CODE. We are tracking this error. The removal of this code allowing a default to another extension is likely being deployed. If you are seeing this error in production, there was an issue treating asset types as globally unique names. They are only unique intra extension. We apologize for any extra work this caused in migrating to create based asset types.`,{waitForExtension:!0,diContainer:a}),b=t||b}const{assetType:D,assetKind:S,extensionName:h,noPdlCreateBlade:x,noPdlCreateExtension:v=h,noPdlCreateParameters:P}=b;let C,M;try{M=a.get(p.CompositionProvenance)?.instanceId,C=M&&a.get(m.Finder).find(M)}catch(e){}const F=(0,d.getInitialValues)(a,await a.get(i.DeploymentSettings).getCreateUserSettings(a)),w=[...C?[C.locator.name,C.toString()]:[],...M?[M]:[]],A={telemetryId:l,referenceType:{...t.createAssetTypeOptions,extensionName:h,assetType:D,assetKind:S},initialValues:F,marketplaceItem:{categoryIds:[],id:"Microsoft.Portal",itemDisplayName:"NoMarketplace",products:[],version:"",productsWithNoPricing:[],publisherDisplayName:"Microsoft.Portal",deploymentName:"NoMarketplace",launchingContext:{telemetryId:l,source:w,galleryItemId:""},deploymentTemplateFileUris:{},uiMetadata:null}};return y.traceCreateFlowLaunched(D,{galleryItemId:t.createAssetTypeOptions.marketplaceId,blade:x,extension:v,context:w,telemetryId:A.telemetryId}),n.bladeName=x,n.extensionName=v,n.parameters={...P,...n.parameters,_provisioningContext:A},n.parameters}let D=t.OpenBladeHandler=class{constructor(e,t){this._dicontainer=e,this._args=t}async onProcessRequest(){const t=this._args.bladeRequest.bladeReference;if(!(0,l.isProvisioningBladeReference)(t))return;const a=this._dicontainer,n=FxImpl.shellInterface(t);if("createAssetTypeOptions"in n)return this._inputParams=await b(n,a,t);n.marketplaceOptions||(n.marketplaceOptions={id:n.marketplaceId,launchingContext:void 0});const{id:r,launchingContext:o,additionalConfig:i,alternateCreateFlowOptions:c,...d}=n.marketplaceOptions,u=(t.parameters||{}).internal_bladeCallerParams;u&&delete t.parameters.internal_bladeCallerParams;const{inputs:g,fx_marketplaceContext:y}=t.parameters||{inputs:null,fx_marketplaceContext:null};let f=g&&g.fx_marketplaceContext;f=f||y;let I,D,S=!0;!f&&r||(S=!1);try{I=this._dicontainer.get(p.CompositionProvenance)?.instanceId,D=I&&this._dicontainer.get(m.Finder).find(I)}catch{}const h=await k(this._dicontainer,{marketplaceResults:u?Promise.resolve(u):S&&(0,s.getCreateFlow)({marketplaceGalleryItemId:r,launchingContext:{galleryItemId:r,telemetryId:MsPortalFx.newGuid(),source:[...D?[D.locator.name,D.toString()]:[],...I?[I]:[]],...o},additionalConfig:i,alternateCreateFlowOptions:c,...d},((t,n)=>{(0,p.logToExtension)(e,t,2,n,{waitForExtension:!0,diContainer:a})})),inputs:t.parameters});this._inputParams=h.provisioningInputs;const{blade:x}=h;x&&(t.bladeName=t.bladeName||x.bladeName,t.extensionName=t.extensionName||x.bladeExtension)}onProcessSelection(){(0,l.isProvisioningBladeReference)(this._args.bladeRequest.bladeReference)&&(this._args.selection.detailBladeInputs={...this._inputParams,...this._args.selection.detailBladeInputs})}};__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),o.Step(2),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",Promise)],D.prototype,"onProcessRequest",null),__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),o.Step(4),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],D.prototype,"onProcessSelection",null),t.OpenBladeHandler=D=__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler"]),a.Class("pipeline"),__metadata("design:paramtypes",[a.Container,n.OpenBladeTaskArgs])],D)}));