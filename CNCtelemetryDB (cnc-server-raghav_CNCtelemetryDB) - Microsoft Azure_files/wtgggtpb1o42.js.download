define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers",["require","exports","Fx/DependencyInjection","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/Services/Services.AssetTypes","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.PropertyTransformers"],(function(e,t,o,i,r,n,s){"use strict";t.BladeRedirector=void 0,t.getBladeOpenerJourneyPathSegment=function(e){const t={master:{part:e.masterPartId,property:e.masterInvocationProperty,command:e.masterCommandName}};return MsPortalFx.toSortedString(t)},t.mapMasterModelToBladeModel=function(e,t,o){const i={},r=new n.PropertyTransformerArgs(e,t,null,i,null);r.propertyChanges.push(n.ObservableChangeArgs.forObject(o.targetProperty,t)),o.opensDynamicBlades&&d(r);o.targetProperty||l(r);return r.propertyChanges.forEach((e=>{const t=e.propertyName;t&&(i[t]=e.propertyValue)})),i};var a=MsPortalFx.Base.Constants;const l=s.PropertyTransformers.getModelToPropertyMapper(),d=s.PropertyTransformers.getDynamicSelectionMapper();let c=t.BladeRedirector=class{constructor(e,t){this._finder=e,this._assetTypeService=t}applyRedirects(e,t,o){const r=this._finder;let n=e;const s=e.getExtensionLocator(),l=i.Locator.forBladeRedirect(s.name,e.name,t),d={};if(r.tryLocate(l,d)){const e=d.value;3===e.type?n=i.Locator.forExtension("HubsExtension").withBlade(a.BladeNames.Hubs.ResourceMenuBlade):2===e.type&&(n=i.Locator.forExtension(e.toExtension||s.name).withBlade(e.toBlade))}const c=n;return n=this._assetTypeService.getMappedBladeLocator(n,e),n&&o&&u(n,t,o)&&(n=1!==c.type||u(c,t,o)?e:c),n}};function u(e,t,o){if(!e.equals(o.locator)||!o.bladeDefinition)return!1;const r=ko.toJS(o.model);return e.equals(i.resourceMenu)?(t.id||"").toLowerCase()===(r.id||"").toLowerCase():!!o.bladeDefinition.inputs&&o.bladeDefinition.inputs.every((e=>t[e]===r[e]))}t.BladeRedirector=c=__decorate([__metadata("fx:diagnostics",[e,"BladeRedirector"]),o.Class(),__metadata("design:paramtypes",[i.DefinitionFinder,r.AssetTypeService])],c)})),
define("MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Store",["require","exports","react","zustand"],(function(e,t,o,i){"use strict";t.useLifetimeManager=t.useDiContainer=t.useBreadCrumbStore=t.LifetimeManagerProvider=t.DiContainerProvider=void 0;const r=o.createContext(void 0),n=o.createContext(void 0);t.useDiContainer=()=>{const e=o.useContext(r);if(!e)throw new Error("DiContainer not found in context. BreadCrumb component must be wrapped with DiContainerProvider.");return e};t.useLifetimeManager=()=>{const e=o.useContext(n);if(!e)throw new Error("LifetimeManager not found in context. BreadCrumb component must be wrapped with LifetimeManagerProvider.");return e};const s=({diContainer:e,children:t})=>o.createElement(r.Provider,{value:e},t);t.DiContainerProvider=s;const a=({lifetimeManager:e,children:t})=>o.createElement(n.Provider,{value:e},t);t.LifetimeManagerProvider=a;t.useBreadCrumbStore=(0,i.create)((e=>({breadcrumbs:[],rootPageType:"None",navigateToBreadcrumb:void 0})));s.displayName="DiContainerProvider",a.displayName="LifetimeManagerProvider"})),
define("MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.DataSource",["require","exports","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Store","MsPortalImpl/Base/Base.DeepLink","MsPortalImpl/Resources/ImplScriptResources"],(function(e,t,o,i,r){"use strict";t.updateBreadCrumbs=function(e,t){void 0!==t&&o.useBreadCrumbStore.setState({rootPageType:t});const i=o.useBreadCrumbStore.getState(),r={bladeId:n,bladeTelemetryName:"Home",bladeTitle:s(i.rootPageType),bladeTitleResolved:!0,isCustomHome:!1,deepLink:a(i.rootPageType),isMenuBlade:!1,isDefaultItemSelected:!1};let l;if(e&&e.length>0){l=e.map((e=>({bladeId:e.bladeId,bladeTelemetryName:e.bladeTelemetryName,bladeTitle:ko.unwrap(e.bladeTitle),bladeTitleResolved:ko.unwrap(e.bladeTitleResolved)??!1,isCustomHome:e.isCustomHome,deepLink:ko.unwrap(e.deepLink),isMenuBlade:ko.unwrap(e.isMenuBlade)??!1,isDefaultItemSelected:ko.unwrap(e.isDefaultItemSelected)??!1})));l.length>0&&l[0].isCustomHome&&(l=l.slice(1)),l=[r,...l]}else l=[r];o.useBreadCrumbStore.setState({breadcrumbs:l})};const n="rootpagelink";function s(e){switch(e){case"Home":return r.AzureHome.home;case"Dashboard":return r.NavBar.home;default:return r.SideBar.allServices}}function a(e){switch(e){case"Home":return(0,i.getHomeDeeplink)();case"Dashboard":return(0,i.getDefaultDashboardDeeplink)();default:return(0,i.getAllServicesDeeplink)()}}})),
define("MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Styles",["require","exports","@griffel/react/makeStyles.esm","@fluentui/tokens/lib/tokens"],(function(e,t,o,i){"use strict";t.useBreadcrumbStyles=void 0;const r="20px",n="3px",s="220px",a="32px",l="10px";t.useBreadcrumbStyles=(0,o.makeStyles)({overflowContainer:{display:"flex",flexWrap:"nowrap",minWidth:0,overflow:"hidden",alignItems:"center",height:r,maxWidth:"100%",paddingLeft:"20px",boxSizing:"border-box",backgroundColor:`${i.tokens.colorNeutralBackground1}!important`,color:`${i.tokens.colorNeutralForeground1}!important`},root:{display:"flex",alignItems:"center",height:r,maxWidth:"100%",boxSizing:"border-box",backgroundColor:"transparent",margin:"0",padding:"0",color:`${i.tokens.colorNeutralForeground1}!important`},overflowItem:{display:"flex",alignItems:"center",flexShrink:0,height:"100%"},clickableItem:{fontSize:`${i.tokens.fontSizeBase300}!important`,fontFamily:`${i.tokens.fontFamilyBase}!important`,fontWeight:`${i.tokens.fontWeightRegular}!important`,lineHeight:`${i.tokens.lineHeightBase300}!important`,flexGrow:0,flexShrink:1,flexBasis:"auto",height:"20px",display:"flex",alignItems:"center",justifyContent:"center",paddingTop:"0px",paddingBottom:"0px",paddingLeft:n,paddingRight:n,boxSizing:"border-box",minWidth:"0px",margin:"0px",overflowX:"hidden",overflowY:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer",color:`${i.tokens.colorNeutralForeground2}!important`,backgroundColor:"transparent",border:"none",textDecorationLine:"none",borderRadius:"4px",transition:"background 0.00001s cubic-bezier(0.33, 0, 0.67, 1), border 0.00001s cubic-bezier(0.33, 0, 0.67, 1), color 0.00001s cubic-bezier(0.33, 0, 0.67, 1)",userSelect:"none",pointerEvents:"all",verticalAlign:"middle",listStyleType:"none",outlineStyle:"none","&:hover":{textDecorationLine:"underline",color:`${i.tokens.colorNeutralForeground1}!important`,backgroundColor:`${i.tokens.colorNeutralBackground1Hover}!important`},"&:active":{color:`${i.tokens.colorNeutralForeground2}!important`,backgroundColor:"transparent"},"&:focus-visible":{outline:`2px solid ${i.tokens.colorStrokeFocus2}!important`,outlineOffset:"2px"}},divider:{flexGrow:0,flexShrink:0,flexBasis:"auto",display:"flex",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center",paddingTop:"0px",paddingBottom:"0px",paddingLeft:n,paddingRight:n,color:`${i.tokens.colorNeutralForeground3}!important`,fontSize:"10px","& svg":{width:"10px",height:"10px"}},overflowMenuContainer:{flexGrow:0,flexShrink:0,flexBasis:"auto",display:"flex",alignItems:"center",height:"100%"},overflowMenuButton:{display:"flex",alignItems:"normal",justifyContent:"center",fontWeight:`${i.tokens.fontWeightRegular}!important`,boxSizing:"border-box",height:r,minWidth:"32px",width:"32px",color:`${i.tokens.colorNeutralForeground2}!important`,backgroundColor:"transparent",border:"none",cursor:"pointer","&:hover":{backgroundColor:`${i.tokens.colorNeutralBackground1Hover}!important`},"&:focus-visible":{outline:`2px solid ${i.tokens.colorStrokeFocus2}!important`,outlineOffset:"2px"}},overflowMenuPopover:{backgroundColor:`${i.tokens.colorNeutralBackground1}!important`,border:`1px solid ${i.tokens.colorNeutralStroke1}!important`,borderRadius:`${i.tokens.borderRadiusMedium}!important`,boxShadow:`${i.tokens.shadow16}!important`,minWidth:s,maxWidth:s},overflowMenuList:{padding:"4px 0",margin:"0",listStyle:"none",backgroundColor:"transparent"},overflowMenuItem:{display:"block",fontSize:`${i.tokens.fontSizeBase300}!important`,fontFamily:`${i.tokens.fontFamilyBase}!important`,fontWeight:`${i.tokens.fontWeightRegular}!important`,lineHeight:a,paddingTop:"0px",paddingBottom:"0px",paddingLeft:l,paddingRight:l,color:`${i.tokens.colorNeutralForeground1}!important`,backgroundColor:"transparent",cursor:"pointer",minHeight:a,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","&:hover":{backgroundColor:`${i.tokens.colorNeutralBackground1Hover}!important`},"&:focus-visible":{outline:`2px solid ${i.tokens.colorStrokeFocus2}!important`,outlineOffset:"-2px"}},fluentProvider:{backgroundColor:"inherit",display:"contents"}})})),
define("MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.React",["require","exports","react","@fluentui/react-breadcrumb","@fluentui/react-breadcrumb/lib/components/BreadcrumbDivider/BreadcrumbDivider","@fluentui/react-breadcrumb/lib/components/BreadcrumbButton/BreadcrumbButton","@fluentui/react-breadcrumb/lib/components/BreadcrumbItem/BreadcrumbItem","@fluentui/react-button/lib/components/MenuButton/MenuButton","@griffel/core/mergeClasses.esm","@fluentui/react-overflow/lib/components/Overflow","@fluentui/react-overflow/lib/components/OverflowItem/OverflowItem","@fluentui/react-overflow/lib/useIsOverflowItemVisible","@fluentui/react-overflow/lib/useOverflowMenu","@fluentui/react-menu/lib/components/Menu/Menu","@fluentui/react-menu/lib/components/MenuTrigger/MenuTrigger","@fluentui/react-menu/lib/components/MenuPopover/MenuPopover","@fluentui/react-menu/lib/components/MenuList/MenuList","@fluentui/react-menu/lib/components/MenuItem/MenuItem","@fluentui/react-provider/lib/components/FluentProvider/FluentProvider","@fluentui/react-tabster/lib/hooks/useArrowNavigationGroup","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Styles","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Store","MsPortalImpl/Widgets/Hooks/useFluentTheme","MsPortalImpl/Widgets/Image/Image.React","_generated/MsPortalImpl/Svg/Startup/Ellipsis.svg","MsPortalImpl/Resources/ImplScriptResources"],(function(e,t,o,i,r,n,s,a,l,d,c,u,m,p,b,g,h,f,v,I,C,y,x,B,S,M){"use strict";t.OverflowMenuItem=t.OverflowMenu=t.BreadCrumbReactComponent=void 0;var P=MsPortalFx.Base;const w="rootpagelink";t.BreadCrumbReactComponent=()=>{const e=(0,C.useBreadcrumbStyles)(),t=(0,y.useDiContainer)(),i=(0,y.useLifetimeManager)(),r=(0,x.useFluentTheme)(t,i);return o.createElement(v.FluentProvider,{theme:r,className:e.fluentProvider},o.createElement(E,null))};const k=({id:e,item:t,onItemClick:i})=>{const r=(0,C.useBreadcrumbStyles)(),n=(0,u.useIsOverflowItemVisible)(e),s=o.useCallback((e=>{t.isRootItem&&t.href?window.location.href=t.href:i(e,t)}),[i,t]);return n?null:o.createElement(f.MenuItem,{className:r.overflowMenuItem,onClick:s,disabled:!t.isClickable},t.text)};t.OverflowMenuItem=k;const _=({itemIds:e,items:t,onItemClick:i})=>{const n=(0,C.useBreadcrumbStyles)(),{ref:s,isOverflowing:l}=(0,m.useOverflowMenu)();return l?o.createElement(o.Fragment,null,o.createElement(p.Menu,null,o.createElement(b.MenuTrigger,{disableButtonEnhancement:!0},o.createElement(a.MenuButton,{ref:s,className:n.overflowMenuButton,icon:o.createElement(B.Image,{image:S}),size:"small",appearance:"transparent"})),o.createElement(g.MenuPopover,{className:n.overflowMenuPopover},o.createElement(h.MenuList,{className:n.overflowMenuList},e.map((e=>{const r=t.find((t=>t.id===e));return r?o.createElement(k,{key:e,id:e,item:r,onItemClick:i}):null}))))),o.createElement(r.BreadcrumbDivider,{className:n.divider})):null};t.OverflowMenu=_;const E=()=>{const e=(0,C.useBreadcrumbStyles)(),t=(0,y.useBreadCrumbStore)((e=>e.breadcrumbs)),a=(0,y.useBreadCrumbStore)((e=>e.navigateToBreadcrumb)),u=(0,I.useArrowNavigationGroup)({axis:"horizontal",circular:!0,memorizeCurrent:!0}),m=o.useMemo((()=>function(e){if(0===e.length)return[];const t=e.map(((e,t)=>({id:e.bladeId,text:e.bladeTitle,href:e.deepLink,isCurrentItem:!1,isRootItem:e.bladeId===w,isDefaultItemSelected:e.isDefaultItemSelected??!1,originalBreadcrumb:e}))),o=t.length-1;return t.map(((e,t)=>({...e,isClickable:e.isRootItem||t<o||!e.isDefaultItemSelected,isCurrentItem:t===o})))}(t)),[t]),p=o.useCallback(((e,o)=>{if(!o.isClickable)return e.preventDefault(),void e.stopPropagation();if(o.originalBreadcrumb){const e=o.id===w,i=t[t.length-1],r=t.findIndex((e=>e.bladeId===o.id));P.Diagnostics.Telemetry.trace({source:"Desktop",action:e?"BreadCrumbHomeClicked":"BreadCrumbClicked",data:{bladeId:e?void 0:o.id,bladeTo:e?"Home":o.originalBreadcrumb.bladeTelemetryName,bladeFrom:i?.bladeTelemetryName,crumbPos:r+1,crumbCnt:t.length-1}})}o.isRootItem||(e.preventDefault(),e.stopPropagation(),a&&o.id&&a(o.id))}),[t,a]),b=o.useMemo((()=>m.filter(((e,t)=>!(e.isCurrentItem&&!e.isClickable)))),[m]),g=o.useMemo((()=>b.map((e=>e.id))),[b]);return!m||m.length<2?null:o.createElement("div",null,o.createElement("nav",{"aria-label":M.Breadcrumb.breadcrumb,role:"navigation",...u},o.createElement(d.Overflow,{overflowDirection:"start"},o.createElement("div",{className:(0,l.mergeClasses)(e.overflowContainer)},o.createElement(_,{itemIds:g,items:b,onItemClick:p}),o.createElement(i.Breadcrumb,{className:e.root,"aria-label":M.Breadcrumb.breadcrumb},b.map(((t,i)=>o.createElement(c.OverflowItem,{key:t.id,id:t.id},o.createElement("div",{className:e.overflowItem},o.createElement(s.BreadcrumbItem,{className:e.clickableItem},o.createElement(n.BreadcrumbButton,{className:(0,l.mergeClasses)(e.clickableItem,t.isClickable?"fxs-breadcrumb-crumb-active":""),href:t.href,disabled:!t.isClickable,onClick:e=>p(e,t)},t.text)),i<b.length-1&&o.createElement(r.BreadcrumbDivider,{className:e.divider}))))))))))}})),
define("MsPortalImpl/Widgets/BreadCrumb/BreadCrumbRenderer.React",["require","exports","react","react-dom/client","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.React","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.Store","MsPortalImpl/Widgets/Widgets.Portal.init"],(function(e,t,o,i,r,n,s){"use strict";t.renderReactBreadCrumb=function(e,t,l){e.classList.toggle(a,!1);const d=(0,s.getPortalViewModel)(l).getRootPageDisplayType();n.useBreadCrumbStore.setState({navigateToBreadcrumb:t=>{$(e).trigger("fxbreadcrumbclick",{bladeId:t})},rootPageType:d});const c=(0,i.createRoot)(e);c.render(o.createElement(n.DiContainerProvider,{diContainer:l},o.createElement(n.LifetimeManagerProvider,{lifetimeManager:t},o.createElement(r.BreadCrumbReactComponent,null)))),t.registerForDispose((()=>{c.unmount(),n.useBreadCrumbStore.setState({navigateToBreadcrumb:void 0})}))};const a="fxs-display-none"})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css",["module"],(function(e){"use strict";return{css:".fxs-breadcrumb-wrapper{display:flex;align-items:center;height:100%;max-width:100%}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb{cursor:text}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active{cursor:pointer}.fxs-breadcrumb-wrapper>.fxs-breadcrumb-crumb-active:hover{text-decoration:underline}.fxs-breadcrumb-crumb{font-size:14px;flex:0 1 auto;height:100%;align-items:center;padding:0 3px;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.fxs-breadcrumb-divider{flex:0 0 auto;display:flex;align-items:center;justify-content:center;height:100%;text-align:center;padding:0 3px}.fxs-breadcrumb-divider svg{transform:rotate(90deg);height:10px;width:10px;margin-top:1px}.fxs-breadcrumb-overflow-btn{flex:0 0 auto;display:flex;align-items:center;justify-content:center;font-weight:200;font-size:24px;box-sizing:border-box;height:20px;width:32px;padding-bottom:14px}.fxs-breadcrumb-dropmenu{flex:0 0 auto}.fxs-breadcrumb-dropmenu .fxs-dropmenu-content{width:220px}.fxs-breadcrumb-overflow .fxs-breadcrumb-crumb{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:32px;padding:0 10px!important}.fxs-breadcrumb-container{display:flex;padding:0 17px;height:20px}.fxs-breadcrumb-crumb:not(.fxs-breadcrumb-crumb-active){display:none}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.BreadCrumb",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Widgets/Widgets.WidgetBase","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Interactions/Interactions.KeyboardNavigation","MsPortalImpl/Base/Base.DeepLink","WeaveDOM/DirectRender/DataAttribute","Weave/Core/Computation","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.BreadCrumb.css","MsPortalImpl/Base/Base.KeyboardHelper","Weave"],(function(e,t,o,i,r,n,s,a,l,d,c,u,m,p){"use strict";t.Widget=t.ViewModel=t.DEV=void 0,(0,c.injectCss)(u);var b=MsPortalFx.Base;const g={deferred:!0},h="rootpagelink";class f extends r.ViewModel{constructor(e){super(),this.getRootPageType=e,this.breadCrumbs=ko.observableArray(),this.breadCrumbsVisibleUI=ko.observableArray([]),this.breadCrumbsOverflowUI=ko.observableArray([]),this.hasOverflow=(0,p.makeWritableComputation)(!1),this.lastVisibleIdx=(0,p.makeWritableComputation)(0)}}function v(e,t,o,i){let r;ko.computed(e,t,(t=>{const n=i?t.slice().reverse():t,s=n.length;r&&r.dispose(),r=e.createChildLifetime();const a=o(),l=s-a.length;if(l>0){const e=[];for(let t=0,o=Math.max(l,5);t<o;t++)e.push({bladeId:null,bladeTitle:ko.observable(),visible:ko.observable(!0),href:ko.observable(),isDefaultItemSelected:ko.observable(!1)});o.push.apply(o,e)}for(let e=0;e<a.length;e++){const t=a[e];if(e<s){const o=n[e];t.bladeId=o.bladeId,o.bladeTitle.subscribeAndRun(r,(e=>{t.bladeTitle(e)})),o.href.subscribeAndRun(r,(e=>{t.href(e)})),t.visible(!0),o.isDefaultItemSelected.subscribeAndRun(r,(e=>{t.isDefaultItemSelected(e)}))}else t.visible(!1)}}))}t.ViewModel=f;class I extends r.Widget{constructor(e,t){super(e,t);const r=this.element,c=this.options,u=this.ltm,p=[{bladeId:h,bladeTelemetryName:"Home",bladeTitle:ko.observable(""),deepLink:ko.observable("#")}],f=ko.observableArray([]);ko.computed(u,(()=>{const e=c.breadCrumbs(),i=!e.length||!e[e.length-1].bladeTitleResolved||e[e.length-1].bladeTitleResolved();ko.ignoreDependencies((()=>{const n=f().slice(),s=p.concat(e);e.length&&e[0].isCustomHome&&s.splice(1,1),s.forEach(((e,i)=>{const r=n[i]={bladeId:e.bladeId,bladeTelemetryName:e.bladeTelemetryName,bladeTitle:e.bladeTitle,visible:n[i]&&n[i].visible||ko.observable(!0),href:e.deepLink,isDefaultItemSelected:e.isDefaultItemSelected||ko.observable(!1)};if(e.bladeId===h){let e,i;switch(t.getRootPageType()){case"Home":e=o.AzureHome.home,i=(0,a.getHomeDeeplink)();break;case"Dashboard":e=o.NavBar.home,i=(0,a.getDefaultDashboardDeeplink)();break;default:e=o.SideBar.allServices,i=(0,a.getAllServicesDeeplink)()}r.bladeTitle(e),r.href(i)}})),n.splice(s.length),i||n.splice(n.length-1,1),MsPortalFx.deepEquals(n,f())||(r.toggleClass("fxs-display-none",n.length<2),f(n))}))}));const I=f.filter(u,(e=>!e.visible()));I.extend(g);const y=this.breadCrumbsVisible=f.filter(u,(e=>e.visible()));v(u,y,c.breadCrumbsVisibleUI,!1),v(u,I,c.breadCrumbsOverflowUI,!1);const x=r.find(".fxs-breadcrumb-container"),B=r.find(".fxs-breadcrumb-wrapper");I.subscribeAndRun(u,(e=>c.hasOverflow(e.length>0)));const S=()=>{const e=f(),t=x.width(),o=e.map((e=>{return t=e.bladeTitle(),C.measureText(t).width+6;var t}));if(o.reduce(((e,t)=>e+t),0)+16*Math.max(0,o.length-1)<=t)e.forEach((e=>e.visible(!0)));else{let i=t-32,r=e.length-1;for(;r>=0&&i>=0;)i-=16+o[r--];const n=r+1;e.forEach(((e,t)=>e.visible(!(t<=n))))}},M=i.throttleByAnimationFrame(S);n.track(u,r.first(),S),ko.computed(u,(()=>{const e=f(),t=MsPortalFx.last(e);t&&t.bladeTitle(),M()}));const P=new s.KeyboardNavigation(u,{element:B,tabTriggers:12,itemSelector:"> .fxs-breadcrumb-crumb-active, .fxs-breadcrumb-dropmenu:not(.weave-display-none2) .fxs-dropmenu-button"});u.registerForDispose([r.setEvents(["click keydown",".fxs-breadcrumb-crumb",e=>{if(m.isCtrlOrCommandOnly(e)||e.shiftKey)return!0;if("click"===e.type||13===e.which||32===e.which){const t=$(e.currentTarget),o=(0,l.getElementData)(e.currentTarget),i=o.bladeId,r=o.bladeTelemetryName,n=i===h;if(t.hasClass("fxs-breadcrumb-crumb-active")&&i){const e=f.peek();b.Diagnostics.Telemetry.trace({source:"Desktop",action:n?"BreadCrumbHomeClicked":"BreadCrumbClicked",data:{bladeId:n?void 0:i,bladeTo:n?"Home":r,bladeFrom:e[e.length-1]?.bladeTelemetryName,crumbPos:e.findIndex((e=>e.bladeId===i))+1,crumbCnt:e.length-1}}),n||t.trigger("fxbreadcrumbclick",{bladeId:i})}n||(e.preventDefault(),e.stopPropagation())}}])]);let w=!1;ko.computed(u,y,(e=>{c.lastVisibleIdx(e.length-1),w||(w=!0,(0,d.invokeAfterChangePropagation)((()=>{w=!1,P.correctState()})))}))}}t.Widget=I;const C=document.createElement("canvas").getContext("2d");C.font="14px az_ea_font,'Segoe UI',az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif"})),
define("MsPortalImpl/Widgets/Widgets.BreadCrumb.Component",["require","exports","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","Weave","_generated/MsPortalImpl/Svg/Startup/CaretUp.svg","FxInternal/Weave/Util","MsPortalImpl/Widgets/Widgets.DropMenu.Component","MsPortalImpl/Widgets/Widgets.DropMenu","FxInternal/Weave"],(function(e,t,o,i,r,n,s,a,l,d){"use strict";function c(e,t){return e>0||t}function u(e,t,o,i){return e&&(o<i||!t)}t.BreadCrumbInner=function(e){const{vm:t}=e;return o("div",{className:"fxs-breadcrumb-container"},o("nav",{className:"fxs-breadcrumb-wrapper","aria-label":i.Breadcrumb.navlabel},o(r.If,{condition:t.hasOverflow,trueFn:()=>{const e=new l.ViewModel(void 0,void 0,".fxs-breadcrumb-crumb-active",!0);e.setItemFocusWhenOpen=!0,e.buttonTooltip(i.Breadcrumb.navhistory),e.alignMenu=0;const n=o("div",{className:"fxs-breadcrumb-overflow-btn fxs-portal-hover",role:"presentation"},"..."),c=o("ul",{className:"fxs-breadcrumb-overflow"},o(r.ForEach,{collection:(0,d.toComputation)(t.breadCrumbsOverflowUI),fn:({item:e})=>o("li",{className:["fxs-portal-hover",{"fxs-display-none":(0,d.toComputation)(e.visible).compose(s.negation)}]},o("a",{className:["fxs-breadcrumb-crumb",{"fxs-breadcrumb-crumb-active":(0,d.toComputation)(e.visible)}],title:(0,d.toComputation)(e.bladeTitle),href:(0,d.toComputation)(e.href),tabindex:"-1",data:e},(0,d.toComputation)(e.bladeTitle)))}));return o("div",{className:"fxs-breadcrumb-dropmenu",afterMount:(t,o)=>{o.registerForDispose(new l.Widget($(t),e,!0))}},o(a.DropMenuInner,{button:n,content:c,vm:e}))}}),o(r.ForEach,{collection:(0,d.toComputation)(t.breadCrumbsVisibleUI),fn:({item:e,index:i})=>{const a=(0,d.toComputation)(e.visible).compose(s.negation),l=(0,r.composeComputation)([(0,d.toComputation)(e.visible),(0,d.toComputation)(e.isDefaultItemSelected),i,t.lastVisibleIdx],u);return o(r.Fragment,null,o(r.If,{condition:(0,r.composeComputation)([i,t.hasOverflow],c),concealmentBehavior:"remove",trueFn:()=>o("div",{className:["fxs-breadcrumb-divider fxs-portal-svg-secondary",{"fxs-display-none":a}],image:n})}),o("a",{className:["fxs-breadcrumb-crumb fxs-portal-text",{"fxs-display-none":a,"fxs-breadcrumb-crumb-active":l}],href:(0,d.toComputation)(e.href),tabindex:"-1",data:e},(0,d.toComputation)(e.bladeTitle)))}})))}})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css",["module"],(function(e){"use strict";return{css:".fxs-journey{overflow-x:hidden;overflow-y:auto;display:flex;flex-direction:column}.fxs-journey-layout{flex:1 1 auto;z-index:0;position:relative}.fxs-journey-layout>.fxs-blade{display:none}.fxs-journey-layout>.fxs-blade.fxs-blade-display-in-journey:last-of-type{display:flex}.fxs-journey-breadcrumb{display:none;z-index:1;box-sizing:border-box;padding-top:8px;flex:0 0 auto}.fxs-show-journey .fxs-journey-breadcrumb{display:block}@media(min-width:640px) and (min-height:500px){.fxs-journey .fxs-blade.fxs-blade-display-in-journey{display:flex}}@media(min-height:500px){.fxs-journey{overflow:hidden}.fxs-journey-layout{height:100%;overflow-x:auto;overflow-y:hidden}.fxs-blade{overflow:hidden}}@media(max-height:499.99999px){.fxs-journey .fxc-gc-vscroll{max-height:calc(100vh - 45px)}.fxs-blade{min-height:calc(100vh - 40px - 20px - 8px)}}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.Journey",["require","exports","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Widgets/Widgets.Blade","MsPortalImpl/Widgets/Widgets.LayoutBase","MsPortalImpl/Widgets/Widgets.StackLayout","MsPortalImpl/Widgets/Widgets.UIElementBase","MsPortalImpl/Widgets/Widgets.BreadCrumb","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Base/Base.Timers","MsPortalImpl/Base/Base.Router","MsPortalImpl/Widgets/Widgets.BreadCrumb.Component","MsPortalImpl/Weave/DirectRender","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Journey.css","MsPortalImpl/Base/Base.Events","Fx/Experimentation","MsPortalImpl/Widgets/BreadCrumb/BreadCrumbRenderer.React","MsPortalImpl/Widgets/BreadCrumb/BreadCrumb.DataSource"],(function(e,t,o,i,r,n,s,a,l,d,c,u,m,p,b,g,h,f,v){"use strict";t.scrollLogDebounce=t.Widget=t.ViewModel=t.EventNames=void 0;var I=a;(0,p.injectCss)(b);const C=window,y=C.fx.environment,x="fxs-journey",B="fxs-blade-lastblade",S="fxs-blade-has-activation",M="fxs-blade-display-in-journey",P=(t.scrollLogDebounce=1e3,1280),w=t.EventNames={addingChild:"addingChild",removingChild:"removingChild"};class k extends s.ViewModel{constructor(e,t,o){super(e),this.getRootPageType=t,this.diContainer=o;const i=new n.ViewModel("fxs-journey-stacklayout-instanceid",void 0,".fxs-extension-frame");i.orientation(r.Orientation.Horizontal),this.stackLayoutOptions=i}getViewSettings(){return{}}}t.ViewModel=k;class _ extends s.Widget{constructor(e,t){super(e,t),this._childElementCount=ko.observable(),this._lastBladeCalcInfo=[],this._lifetime=new FxImpl.TriggerableLifetimeManager,this._scheduleFocusOnLastChild=d.throttleByAnimationFrame((e=>{if(this.ltm&&!this.ltm.isDisposed()&&e&&this._childElementCount()>0){const e=this.options.stackLayoutOptions.childElements(),t=e[e.length-1];o.Widget.getWidget(t,i.Widget).setFocus()}})),this._loadingBladeIdList=[],e.addClass(x),e.toggleClass("fxs-journey-nobladeheader",!!y.chrome.hideBladeHeader);const r=e.find(".fxs-journey-layout");this._layout=new n.Widget(r,t.stackLayoutOptions),this._childElementCount(0);const s=[this._layout,()=>this.element.removeClass(x)],p=[["fxbladerepos",()=>{this._rePositionBlades()}]];if(t.diContainer.get(g.PortalCustomEvents).addHandler(this._lifetime,"fxdeeplinkchanged",(()=>{y.chrome.hideBreadcrumb||this.calculateBreadcrumbs()})),!y.chrome.hideBreadcrumb){const o=e.find(".fxs-journey-breadcrumb");if(t.diContainer.get(h.Experimentation).shellAssignments?.getBooleanValue("newBC")??!1)(0,f.renderReactBreadCrumb)(o[0],this.ltm,t.diContainer);else{const e=new a.ViewModel(t.getRootPageType);this._breadCrumbVM=e,(0,m.applyToElement)({element:o[0],ltm:this.ltm,weaveNode:(0,u.BreadCrumbInner)({vm:e}),weaveContext:{diContainer:t.diContainer},opName:"breadCrumb"}),s.push(new I.Widget(o,e))}p.push(["fxbreadcrumbclick",(e,t)=>{const o=t.bladeId,i=this.getBlades();for(let e=0;e<i.length;++e){const t=i[e];if(t.options.id===o){e<i.length-1&&i[e+1].close(!1),e===i.length-1?t.goToDefaultItem():t.goToFirstDetailContent();break}if(t.goToDetailContent(o)){e<i.length-1&&i[e+1].close(!1);break}}}])}this.ltm.registerForDispose(s.concat(this.element.setEvents(...p)));const b=e.parent(".fxs-panorama");this._rePositionBlades=d.throttleByAnimationFrame((()=>{if(!this.ltm||this.ltm.isDisposed())return;const e=b.width(),t=this._getBladeCalculatedInfo(),o=t.length,i=this._lastBladeCalcInfo.length;this._lastBladeCalcInfo=t,o&&t[o-1].actStyle&&setTimeout((()=>{this._rePositionBlades()}),2e3),i>o?function(e,t){const o=e.length,i=e[o-1],r=e[o-2];o>0&&(i.visibleInJourney?T(e,t)&&(r.visibleInJourney=!0):E(e,t,!0))}(t,e):i===o?E(t,e):function(e,t){const o=e.length;if(e[o-1].subjourney)for(let t=o-2;t>=0&&e[t].visibleInJourney;--t)e[t].visibleInJourney=!1;else{D(e,t).freespace<0&&F(e,o-(T(e,t)?3:2))}}(t,e);let r=!1,n=-1;t.forEach(((e,o)=>{const i=e.widget.element;!function(e,t){const o=e.widget.element,i={};let r=e.maximized?"100%":`${e.idealWidth}px`;window.innerWidth<640?r="100%":e.maximized&&t&&t.visibleInJourney&&t.actStyle&&!e.subjourney&&!e.appblade&&(r=`calc(100% - ${t.idealWidth}px)`);i.width=r,o.css(i).toggleClass(S,e.actStyle).toggleClass("fxs-blade-maximized",e.maximized).toggleClass("fxs-blade-appblade",e.appblade).toggleClass("fxs-blade-has-activation-fit",e.actStyleCanFit)}(e,t[o-1]),i.toggleClass("fxs-blade-firstblade",e.visibleInJourney&&!r).removeClass(B),e.widget.options.collapseVisible(e.actStyle),e.widget.options.hideCloseButton(!0),e.actStyle||e.widget.options.collapsed(!1),e.visibleInJourney&&(r=!0,n=o),e.widget.element.toggleClass(M,e.visibleInJourney);const s=document.getElementsByClassName("fxs-part-reactframe"),a=document.createEvent("Event");a.initEvent("resize",!0,!0);for(let e=0;e<s.length;e++)s[e].dispatchEvent(a)})),n>=0&&t[n].widget.element.addClass(B),o&&this.options.diContainer.get(c.Router).ensureRouteInView("Journey")})),l.track(this.ltm,this.element.first(),(()=>{this._rePositionBlades()}),{ignoreInitialState:!0})}hasChildren(){return this._childElementCount()>0}addChild(e){this.insertChild(e,void 0)}insertChild(e,t){const o=e.element?e.element:e,i=s.Widget.getId(o);this.trigger(w.addingChild,i),this._scheduleFocusOnLastChild(!1),t>=0?this._layout.insertChild(e,t):this._layout.addChild(e),this._childElementCount(this._childElementCount()+1),this.trigger("fxbladerepos")}_getBladeCalculatedInfo(){const e=this.getBlades().map((e=>{const t=e.isMenuBladeLoadingDetailBlade(),o=e.bladeDefinitionLoaded&&!t;return{blade:e,pending:!o&&e.element.hasClass("fxs-blade-shows-pending"),loaded:o}})).filter((e=>e.loaded||e.pending)),t=C.fx.getTimestamp(),o=function(e,t){const o=e.length;return e.map(((e,i)=>{const r=e.blade,n=r.options,s=12===r.getContentWidget().options.bladeStyle.value,a=!s&&!e.pending&&n.useActivationStyle&&(i!==o-1||t&&r.element.hasClass(S)),l=s||e.pending||2===n.displayState()&&!a;return{widget:r,idealWidth:r.idealWidth(a),actStyle:a,maximized:l,subjourney:n.asSubJourney,visibleInJourney:r.element.hasClass(M)||!r.element[0].style.width,appblade:s}}))}(e,this._loadingBladeIdList.some((e=>e.ts+2e3>t)));return o}removeChild(e){const t=this._layout.removeChild(e);return t&&(this.trigger(w.removingChild,e),this._childElementCount(this._childElementCount.peek()-1),this.trigger("fxbladerepos"),this._scheduleFocusOnLastChild(!0)),t}removeChildren(e){const t=this.options,o=t&&t.stackLayoutOptions&&t.stackLayoutOptions.childElements();o&&o.slice(0).forEach((t=>{const o=s.Widget.getId(t);e&&e(o),this.removeChild(o)}))}saveViewSettings(){return this.options.getViewSettings()}setFocus(){if(this._childElementCount()>0){const e=this.options.stackLayoutOptions.childElements()[0],t=o.Widget.getWidget(e,i.Widget);t&&t.setFocus()}}getBlades(){let e=[];return this._childElementCount()>0&&(e=this.options.stackLayoutOptions.childElements().map((e=>o.Widget.getWidget(e,i.Widget)))),e}close(){const e=this.getBlades()[0];e&&e.close(!1)}getFocusedBlade(){const e=$(document.activeElement).closest(".fxs-blade")[0];let t=null;return e&&(t=MsPortalFx.find(this.getBlades(),(t=>t.element[0]===e))),t}setFocusedBlade(e){const t=C.document.querySelectorAll(".fxs-blade.fxs-blade-active"),o=e.parentElement.parentElement;o.classList.add("fxs-blade-active");for(let e=0;e<t.length;++e)t[e]!==o&&t[e].classList.remove("fxs-blade-active")}loadingHint(e,t){const o=MsPortalFx.findIndex(this._loadingBladeIdList,(t=>t.id===e)),i=this._loadingBladeIdList[o],r=C.fx.getTimestamp();t?i?i.ts=r:this._loadingBladeIdList.push({id:e,ts:r}):i&&this._loadingBladeIdList.splice(o,1)}calculateBreadcrumbs(){const e=this.getBlades(),t=[];for(let o=0;o<e.length;o++){const i=o===e.length-1,r=e[o].getBreadCrumbs(i);o>0&&e[o].options.crumb()===e[o-1].options.crumb()?t[t.length-1]=r:t.push(r)}const o=MsPortalFx.mapMany(t,(e=>e));this.options.diContainer.get(h.Experimentation).shellAssignments?.getBooleanValue("newBC")?(0,v.updateBreadCrumbs)(o,this.options.getRootPageType()):this._breadCrumbVM.breadCrumbs(o)}}function E(e,t,o=!1){F(e,D(e,t,o).unfitIdx)}function F(e,t){let o=t+1;for(;o<e.length&&!e[o].visibleInJourney;)e[o++].visibleInJourney=!0;for(;t>=0&&e[t].visibleInJourney;)e[t--].visibleInJourney=!1}function D(e,t,o=!1){const i=t,r=e.length;let n=r-1;for(;n>=0&&(o||e[n].visibleInJourney)&&t>=0&&(n===r-1||!e[n+1].subjourney);){const o=e[n];o.maximized?t=-1:t-=o.idealWidth,(t>=0||n===r-1)&&--n}return n===r-2&&T(e,i)&&--n,{freespace:t,unfitIdx:n}}function T(e,t){const o=e.length,i=e[o-1],r=e[o-2];return o>1&&r.actStyle&&!i.appblade&&!i.subjourney&&t>=P&&t>=i.idealWidth+r.idealWidth}t.Widget=_})),
define("MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Widgets/Widgets.Journey","MsPortalImpl/Widgets/Widgets.Portal.init","FxInternal"],(function(e,t,o,i,r,n,s,a,l){"use strict";t.DelayedBladeManager=void 0;var d=MsPortalFx.Base,c=d.Diagnostics.Telemetry;const u=d.Diagnostics.createLog(e),m=MsPortalFx.getUniqueIdGenerator("DBS");function p(e,t){e&&e.enableTrace&&u.verbose(`${t} Debug Id: '${e.debugId}'.`)}t.DelayedBladeManager=class{constructor(e,t,o){if(this._journeyEventAttached=!1,this._loadingVisible=!1,this._config=o,this._portal=(0,a.getPortalViewModel)(o.diContainer),o&&void 0===o.enableTrace&&(o.enableTrace=r.isDesktopTraceEnabled),this._loadingHintId=m(),t){let i,r,n="Selectable";if(t.delayedBladeSelection){const e=t;i=e.delayedBladeSelection,r=t=>{e.selectedValue(t),e.isSelected(!0)}}else if(t._msPortalFxDelayedBladeSelection){n="SelectableSet";const e=t;i=e._msPortalFxDelayedBladeSelection,r=t=>{e.selectedItems.splice(0,0,t),e.activateAllSelectedItems()}}i&&(c.trace({source:"Shell",action:"DelayedBladeManagerSubscribe",extension:o.extension,data:{viewModelType:n,id:o.debugId}}),this._processDelayedBladeSelection(e,i,r,o.extension))}}_loadingHintSignal(e){this._loadingVisible!==e&&(this._loadingVisible=e,this._portal.customEvents.trigger("fxloadingontopbar",{id:this._loadingHintId,cancel:!e}))}_processDelayedBladeSelection(e,t,o,i){t.subscribeAndRun(e,(t=>{t&&(this._journeyEventAttached||(this._journeyEventAttached=!0,this._portal.customEvents.addHandler(e,s.EventNames.addingChild,(()=>this._abort())),e.registerForDispose([()=>{this._loadingHintSignal(!1)}])),this._processDelayedBladeSelectionChange(t,o,i))}))}_abort(){this._currentBladeSelectionPromise=null,this._loadingHintSignal(!1)}_processDelayedBladeSelectionChange(t,r,s){const a=this._config,d=a.diContainer.get(i.JourneyManager),u=a.diContainer.get(o.Finder),m=a.getSelectableContainerComposition(),b=u.findBlades(m).filter((e=>!(1&e.flags)));if(b.length>0){if(!d.confirmBladesCanClose(b))return p(a,"Closing of detail blade(s) was cancelled by user, aborting delayed blade selection operation."),void this._abort();{const e=b[0].widget;e&&e.options.loaded(!1),p(a,"Closing all detail blades except the first one."),(b||[]).forEach(((e,t)=>{t&&d.forceCloseBlade(e)}))}}else this._currentBladeSelectionPromise||this._loadingHintSignal(!0);const g=this._currentBladeSelectionPromise=Promise.resolve(t.selectedValuePromise);l.tryImmediateResolve(g,(e=>{g===this._currentBladeSelectionPromise?(c.trace({source:"Shell",action:"DelayedBladeManagerOpenBlade",extension:this._config.extension,data:{selectedValue:e,id:this._config.debugId}}),this._loadingHintSignal(!1),p(a,"Activate master selectable. Value: {0}.".format(ko.toJSON(e))),r(e)):p(a,"Another delayed operation is underway, selected value will be ignored. Value: {0}.".format(ko.toJSON(e)))}),(t=>{g===this._currentBladeSelectionPromise&&this._loadingHintSignal(!1);const o=m&&m.toString()||"N/A",i=FxImpl.createError("Promise provided to Selectable.delayedBladeSelection/SelectableSet.setCreateDelayedBladeSelection has been rejected. PartId:"+o,{innerErrors:t});(0,n.logToExtension)(e,s,2,i)}))}}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder"],(function(e,t,o,i){"use strict";t.SelectableSetBinderBase=t.SelectableSetBinder=void 0;var r=FxImpl.TriggerableLifetimeManager,n=i.CompositionBinder;class s extends r{get selectablePath(){return this._selectablePath}constructor(e,t,o,i,r,n){super(),this._diContainer=e,this._bindings=[],this._selectablePath=t,this._modelId=o,this._modelIdPostFix=i,this._inputs=r,this._referenceComposition=n,this.registerForDispose((()=>{this._bindings.forEach((e=>{e.unbind()})),this._bindings=[]}))}createTargetForSelectedItem(e){const t=this._bindElement(e,this._inputs,this._referenceComposition);return this._deleteBindings(t),t}_bindElement(e,t,i,r){const s=[],a=[];t.forEach((e=>{6===e.valuesFrom[0].referenceType?s.push(e):a.push(e)}));const l=r||{},d=this._modelId+this._modelIdPostFix,c=new o.PropertyBindings(d,l);let u;return this._bindings.push(c),a.length>0&&(u=n.mapInputBindingDefinitions(a,i),u.forEach((e=>{o.setModelValue(l,e.targetProperty,ko.observable())})),n.setupPropertyBindings(this._diContainer,i,c,u)),s.forEach(((t,i,r)=>{o.getModelValue(l,t.property).exists||o.setModelValue(l,t.property,ko.observable()),c.mapProperty(t.valuesFrom[0].property,t.property).bind(d,e,!0)})),l}_deleteBindings(e){const t=this._findBindings(e);t&&(t.unbind(),MsPortalFx.remove(this._bindings,t))}_findBindings(e){return MsPortalFx.find(this._bindings,(t=>t.targetModel===e))}}t.SelectableSetBinderBase=s;function a(e,t,o){return MsPortalFx.find(e.selectableItems(),(e=>d(t,e.data,o)))}function l(e,t,o){return MsPortalFx.find(e(),(e=>d(t,o,e)))}function d(e,t,i){return Object.getOwnPropertyNames(e).reduce(((r,n)=>{let s;if(!r)return r;const a=o.getModelValue(i,n,!0);return!!a.exists&&(s=o.getModelValue(t,e[n],!0),MsPortalFx.deepEquals(a.value,s.value,!0))}),!0)}function c(e,t,o,i,r,n,s){let a=[];ko.reactor(e,(()=>{ko.utils.compareArrays(a,t()).forEach((e=>{switch(e.status){case"added":case"retained":if(!o().some((t=>i(e.value,t)))){const t=r(e.value);t&&o.push(t)}break;case"deleted":o.remove((t=>!!i(e.value,t)&&(s(t),!0))),n(e.value)}})),a=t.slice(0)}))}t.SelectableSetBinder=class extends s{constructor(e,t,o,i,r,n,s){super(e,t,o," - [SelectableSetElement]",n,s);let u=!1,m=!1;const p=n.reduce(((e,t)=>{const o=t.valuesFrom;return o&&o.length&&6===o[0].referenceType&&(e[t.property]=o[0].property),e}),{}),b=r.activatedItems;if(b().forEach((e=>{const t=a(i,p,e);t&&(t.isActivated(!0),t.isSelected(!0),this._bindElement(t.data,n,s,e))})),i.activatedItems().forEach((e=>{l(b,p,e)||b.push(this._bindElement(e,n,s))})),b().length>this._bindings.length){const e=this.createChildLifetime();i.selectableItems.subscribeArrayAdds(e,(t=>{const o=l(b,p,t.data);null===o||this._findBindings(o)||(t.isSelected(!0),t.isActivated(!0),this._bindElement(t.data,n,s,o),this._bindings.length>=b().length&&e.dispose())}))}i.activatedItems.subscribeArrayChanges(this,(e=>{if(!m){const t=l(b,p,e);try{u=!0,t||b.splice(0,0,this._bindElement(e,n,s))}finally{u=!1}}}),(e=>{if(!m)try{u=!0,b.remove((t=>!!d(p,e,t)&&(this._deleteBindings(t),!0)))}finally{u=!0}})),b.subscribeArrayChanges(this,(e=>{const t=a(i,p,e);if(t){if(!u)try{m=!0,t.isSelected(!0),t.isActivated(!0)}finally{m=!1}this._findBindings(e)||this._bindElement(t.data,n,s,e)}}),(e=>{if(!u)try{m=!0,i.activatedItems.remove((t=>!!d(p,t,e)&&(this._deleteBindings(e),!0)))}finally{m=!1}})),function(e,t,o,i,r,n){const s=t.itemsWithChildEdits;c(e,s,o,((e,t)=>e.editScopeId===t.editScopeId&&r(e.item,t.item)),(e=>({editScopeId:e.editScopeId,item:i(e.item)})),(e=>{}),(e=>{n(e.item)})),c(e,o,s,((e,t)=>t.editScopeId===e.editScopeId&&r(t.item,e.item)),(e=>{const o=MsPortalFx.find(t.selectableItems(),(t=>r(t.data,e.item)));if(o)return{editScopeId:e.editScopeId,item:o.data}}),(e=>{n(e.item)}),(e=>{}))}(this,i,r.itemsWithChildEdits,(e=>this._bindElement(e,n,s)),((e,t)=>d(p,e,t)),(e=>{this._deleteBindings(e)}))}}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.CompositionBinder","MsPortalImpl/UI/Compositions/UI.Composition.DelayedBladeManager","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/UI/Compositions/UI.Composition.SelectableSetBinder"],(function(e,t,o,i,r,n,s,a,l,d,c,u,m,p,b,g){"use strict";t.BladeOpener=void 0,t.createOrGetInternalSelectionState=W;var h=FxImpl.TriggerableLifetimeManager,f=MsPortalFx.Base.Diagnostics,v=c.mapMasterModelToBladeModel,I=MsPortalFx.deepEquals;const C=f.createLog(e),y=MsPortalFx.noop,x="internal.selectable",B=ko.toJS,S=s.Locator.forExtension,M=(0,r.createDescriptor)(d.Configuration,d.Resources,void 0);function P(e){return!!(e.value&&16&e.value.flags)}M.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler","OpenBladeHandler",((e,t,o)=>!P(o))),M.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable1","SelectableV1Handler",((e,t,o)=>!t.selectable2&&!P(o))),M.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Selectable2","SelectableV2Handler",((e,t,o)=>t.selectable2&&!P(o))),M.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PendingBladeHint","PendingBladeHandler",((e,t,o)=>P(o))),M.registerAsync("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.PPV3","ParameterProviderV3Handler",((e,t,o)=>!P(o)&&t.selectable2&&o.value&&!!o.value.container));let w=t.BladeOpener=class extends h{constructor(e,t){super(),this._diContainer=e,this.bladeOpenedCallbacks=$.Callbacks(),this.selectableSetBinders=[],this.options=MsPortalFx.extend2(d.DefaultConfiguration,t),this.invocationPropertyBindings=new b.PropertyBindings(this.options.masterModelId+"-[Invocation]",{}),this.invocationQueue=this._diContainer.get(U),this.bladeOpenedCallbacks.add(this.options.onBladeOpened),this.registerForDispose([()=>{this.invocationPropertyBindings.unbind()},()=>this.bladeOpenedCallbacks.empty()])}registerInvocationProperty(e,t,o){const i=this.createChildLifetime(),r=this._diContainer.get(a.JourneyManager),n=this._diContainer.get(p.Finder);let s=null;const g=n.findPartsContainer(this.options.referenceComposition),h=_(this.options,e),f=A(this._diContainer,this.options,i,e,!0,this.selectableSetBinders),v={container:g,bladeOpenedCallbacks:this.bladeOpenedCallbacks,bladesClosedByPart:new WeakMap,detailsBladeLocator:h,disableInvocation:t,isThrottled:ko.observable(!1),resettingMasterArrayValue:!1,registrationInfo:void 0,prevValue:void 0,previousInvocationPromise:void 0};v.selectable2=f.selectable2;const I=M.createPipeline(this._diContainer,i,this.options,v);if(!f.success)return;v.registrationInfo=function(e,t,o,i,r){let n,s,a;const l=t.referenceComposition,d=e.get(p.Finder);l?(n=k(i.additionalInputArguments,l,b.ReferenceScope.MasterContainer),s=k(r.invocationInputArguments,l,b.ReferenceScope.MasterContainer,i,r.isSelectableSetV1)[0],a=u.CompositionBinder.mapInputBindingDefinitions(i.outputArguments,l,(e=>{e.source.scope=b.ReferenceScope.DetailsContainer})),new m.DelayedBladeManager(o,E(t,s),{diContainer:e,debugId:t.masterModelId,extension:t.referenceExtension.name,getSelectableContainerComposition:()=>d.findPartsContainer(l)})):s={targetProperty:void 0,source:{property:r.invocationInputArguments[0].valuesFrom[0].property,modelType:0,scope:1,cardinality:0,partLocator:void 0,id:"Desktop"},optional:!1,isIdentityInput:!1,selectableSetV1:!1,opensDynamicBlades:!0};return{additionalInputs:n||[],invocationInput:s,invocationOutputs:a||[],detailsDefinition:i}}(this._diContainer,this.options,i,e,f);const y=v.registrationInfo.invocationInput,x=()=>{const e=(0,b.getModelValue)(this.options.masterModel,y.source.property).value;return v.selectable2?e():B(e)};v.prevValue=x(),function(e,t,o,i){const r=E(t,o);if(r&&r.isSelected&&r.isCommandSelected){const n=r.isSelected,s=r.isCommandSelected,a=e.get(p.Finder).findBlades(t.referenceComposition).filter((e=>e.masterInvocationProperty===o.source.property&&t.isBladeOpenedByMaster(e)));s()&&0===a.length&&s(!1),n()&&0===a.length?(n(!1),i()):!n()&&a.length>0?(i(),n(!0)):i()}}(this._diContainer,this.options,y,(()=>{f.updateSelectedValue()})),function(e,t,o,i,r){const n=t.get(a.JourneyManager);let s,d=n.activeJourney();const u=o.referenceComposition&&o.referenceComposition.getCompositionType()===l.CompositionType.StartboardPart;let m=null;const b=r=>{r&&r.originTile&&(u&&r.originTile.id!==o.referenceComposition.id||(s=e.createChildLifetime(),function(e,t,o,i,r){if(!i)throw new Error("Journey is required.");const n=E(t,r),s={timestamp:Date.now(),locator:null,masterInvocationProperty:r.source.property};t.configureBindings&&s.bindings&&s.bindings.length&&t.configureBindings(s.bindings);t.configureBladeDescriptor(s);const a=c.getBladeOpenerJourneyPathSegment(s),l=e.get(p.Finder);R(t,l,n,i,a,r),i.ambientSettings.getObservable().subscribe(o,(()=>{R(t,l,n,i,a,r)}))}(t,o,s,r,i),u&&r.onDispose((()=>{s&&(s.dispose(),s=null)}))))};b(d),u&&(m=()=>{s||(d=n.activeJourney(),b(d))},r.add(m),e.registerForDispose((()=>{r.remove(m)})))}(i,this._diContainer,this.options,y,this.bladeOpenedCallbacks),t&&t.subscribe(i,(e=>{e?((0,d.traceInvocationChange)(C,"Disabled listening for invocation property change.",this._diContainer,this.options,y,x()),V(r,n,this.options,v.bladesClosedByPart,y)):(v.prevValue=x(),void 0!==v.prevValue&&N(this.options,`Selectability was enabled for the part (container.isSelectable(true)) and the part is already in a selected state.  Current selection state will be ignored and blade will not be opened. Part Id: ${this.options.masterModelId}`,v.prevValue))}));const S=y.source.property,P=this.invocationPropertyBindings;return(0,b.setModelValue)(P.targetModel,S,B(v.prevValue)),s=P.addProperty(S).bind(this.options.masterModelId,this.options.masterModel,!!v.selectable2,(e=>{const t=x(),o={timestamp:Date.now(),value:t,invocationInput:y,propertyChanges:e};(0,d.traceInvocationChange)(C,"Detected invocation property change.",this._diContainer,this.options,y,t),v.selectable2?this.invocationQueue.enqueue({id:S,pipeline:I,taskArgs:o}):I.startTask(o)}),(e=>{N(this.options,`Failed to subscribe to changes for the selectable ${S}. Error: ${e}`)})),i.registerForDispose((()=>{r.activeJourney()&&!this._diContainer.isDisposed()&&V(r,n,this.options,v.bladesClosedByPart,y),P.removeProperty(s)})),o&&o.registerForDispose(i),{viewStatePropertyRemovals:f.viewStatePropertyRemovals}}modifyViewStateProperties(e,t){return e.filter((e=>!t.viewStatePropertyRemovals.some((t=>e===t))))}createBladeModelForSelectedItem(e,t){const o=e.invocationInputArguments,i=new h,r=A(this._diContainer,this.options,i,e,!1,this.selectableSetBinders),n=k(r.invocationInputArguments,this.options.referenceComposition,b.ReferenceScope.MasterContainer,e)[0];let s,a={},l=_(this.options,e);const c=()=>{const e=this.options.referenceComposition;return e.containerModel||e.getBindableContainer().getViewModel()};return r.updateSelectedValue(),l||e.blade||(l=(0,d.mapDynamicSelectionToBladeLocator)(this._diContainer,t,S(this.options.referenceExtension.name),this.options.masterModelId)),o&&o.length&&o[0].property?a[n.targetProperty]=t:(s=t,!o&&e.selectablePath&&this.selectableSetBinders.some((o=>o.selectablePath===e.selectablePath&&(s=o.createTargetForSelectedItem(t),!0))),a=v(this.options.referenceComposition.locator.toString(),s,n)),(e.additionalInputArguments||[]).forEach((e=>{if(e.valuesFrom&&e.valuesFrom.length){const t=e.property,o=e.valuesFrom[0];0!==o.referenceType||o.part&&o.part!==this.options.referenceComposition.locator.name?1===o.referenceType?a[t]=c()[o.property]:(a[t]=void 0,C.warning(`Part Selection: Blade ${l} Property ${t} has an input that's from part ${o.part} instead of its list part ${this} or the blade.`)):a[t]=(0,b.getModelValue)(this.options.masterModel,o.property).value}})),i.dispose(),{model:a,locator:l}}};function k(e,t,o,i,r){return u.CompositionBinder.mapInputBindingDefinitions(e,t,((e,t)=>{e.source.scope=o,e.selectableSetV1=void 0!==r?r:i&&i.isMultiple,e.opensDynamicBlades=i&&!i.blade}))}function _(e,t){const o=e.referenceExtension;return t.blade&&t.bladeExtension?S(t.bladeExtension).withBlade(t.blade):t.blade&&o?S(o.name).withBlade(t.blade):null}function E(e,t){return function(e,t){const o=e.lastIndexOf("."),i=o>0?e.substring(0,o):"";return(0,b.getModelValue)(t,i).value}(t.source.property,e.masterModel)}function F(e,t,o){return e(ko.unwrap(o?(0,b.getModelValue)(t,o).value:t))}function D(e,t,o,i,r,n){let s;if(n){const n=u.CompositionBinder.mapInputBindingDefinitions(i.selectableBindings,o.referenceComposition),a={},l=new b.PropertyBindings(o.masterModelId+"-[Selection]",a),d=(0,b.getModelValue)(o.masterModel,r).value,c=function(e,t,o){let i=t;if(!t)return;i.lock&&i.setInternalSelectedValue&&i.isLocked||(N(e,`This property '${o}' must be of type MsPortalFx.ViewModels.Selectable, view model = '${e.masterModelId}'`),i={lock:y,setInternalSelectedValue:function(e){t.selectedValue(e)},isLocked:y});return i}(o,d,r);s=()=>{c&&c.setInternalSelectedValue(!0)},n.length>0&&(o.configureBindings&&o.configureBindings(n),e.registerForDispose((()=>{l.unbind()})),n.forEach((e=>{const t=(0,b.getModelValue)(a,e.targetProperty).value;(0,b.setModelValue)(a,e.targetProperty,ko.observable(t))})),u.CompositionBinder.setupPropertyBindings(t,o.referenceComposition,l,n),s=()=>{c&&(c.lock(),c.setInternalSelectedValue(l.targetModel),n.forEach((t=>{a[t.targetProperty].subscribe(e,(e=>{d.isSelected()&&c.setInternalSelectedValue(l.targetModel)}))})))})}return{invocationInputArguments:[{valuesFrom:[{property:r+".value",referenceType:0}]}],updateSelectedValue:s||y,isSelectableSetV1:!1,viewStatePropertyRemovals:[],success:!0}}function T(e,t,o,i,r,n){let s;const a=o.masterModel,l=(d=r.selectablePath,{path:ko.observable(d),activatedItems:ko.observableArray(),itemsWithChildEdits:ko.observableArray()});var d;const c=r.selectablePath+".activatedItems";let u;const m=x;let p="",h="";const f=[];let v=!0;const I=(0,b.getModelValue)(o.masterModel,r.selectablePath).value;I&&I.activatedItems&&(u=I.activatedItems);const B=W(a),S=r.selectablePath;return n?(h=m+"._sets."+B._sets().length.toString(),p=h+".activatedItems",B._sets.push(l),f.push(c,S+".selectedItems",S+".itemsWithChildEdits"),I&&u?(s=new g.SelectableSetBinder(t,S,o.masterModelId,I,l,r.selectableBindings,o.referenceComposition),i.push(s),e.registerForDispose((()=>{s.dispose(),MsPortalFx.remove(i,s)}))):(N(o,`The view model for '${o.masterModelId}' is missing the required property '${c}' needed to open the child blade(s) '${r.blade}'`),v=!1)):(B._sets().some(((e,t)=>e.path()===S&&(h=m+"._sets."+t.toString(),p=h+".activatedItems",!0))),""===p&&(C.error(`Failed to find a selectable set reflection for view model '${o.masterModelId}'. Selectable set path is '${S}'`),v=!1)),{invocationInputArguments:[{valuesFrom:[{property:p,referenceType:0}]}],updateSelectedValue:y,isSelectableSetV1:!0,viewStatePropertyRemovals:f,success:v}}function W(e){let t=e.internal.selectable();return t||(t={_sets:ko.observableArray(),_selectables:ko.observableArray(),_dynamicSelections:ko.observableArray(),_selectable2Invocations:{},_contextMenu2Selectables:ko.observable({}),commandBar2Selectables:ko.observable({}),callbacks:ko.observableArray()},e.internal.selectable(t)),t}function V(e,t,o,i,r){const n=t.findBlades(o.referenceComposition).filter((e=>!e.isDisposed()&&e.masterInvocationProperty===r.source.property&&o.isBladeOpenedByMaster(e))),s=e.confirmBladesCanClose(n);if(s)for(let t=n.length-1;t>=0;t--){const r=n[t];o.removeOutputBindings(r),i.set(r,!0),e.forceCloseBlade(r)}return s}function O(e,t,o,i){W(t.masterModel);var r,n;return(r=t.masterModel,n=i,F(FxImpl.tryGetSelectableViewModelContract,r,n))._msPortalFxSelectable2?L(e,t,o,i+"._msPortalFxSelectable2"):(i+="._msPortalFxSelectable",o[0].valuesFrom[0].property=i+".value",{success:!0,isSelectableSetV1:!1,invocationInputArguments:o,viewStatePropertyRemovals:[],updateSelectedValue:y})}function L(e,t,o,i){const r=t.masterModel,s=W(r),a=(l=e,F((e=>(0,n.getOrCreate)(l,e)),r,i));var l;const d=i.replace(/\./g,"_");return s._selectable2Invocations[d]=a.value,s.callbacks.push(a.callbacks),o[0].valuesFrom[0].property="internal.selectable._selectable2Invocations."+d,{success:!0,isSelectableSetV1:!1,invocationInputArguments:o,viewStatePropertyRemovals:[],updateSelectedValue:y,selectable2:a}}function R(e,t,o,i,r,n){const s=o,a=o,l=t.findPartsContainer(e.referenceComposition).journeyPath.concat([r]),d=i.ambientSettings.getItemsUnderPath(l);s&&s.selectedValue?s.hasChildEdits(d.length>0):a&&a.itemsWithChildEdits&&function(e,t,o,i,r){const n=(t,o,i,r)=>{t.forEach(((t,n)=>{const s=v(e,t,i),a=MsPortalFx.find(o,(e=>I(s,e.invocationModel)));r(t,n,a&&a.editScopeId)}))};if(0===i.length){const e=t.itemsWithChildEdits,o=e().length;o>0&&e.splice(0,o)}else{const e=MsPortalFx.mapMany(i,(e=>{if(e.path.length-o.length>2)return[];const t=e.path[o.length];let i;try{i=MsPortalFx.parseSortedString(t)}catch(t){C.error(`Failed to parse journey path segment. Path: '${JSON.stringify(e.path)}'. Error: '${t.message}'.`)}const r=i&&i.model,n=e&&e.value&&e.value.editScope&&e.value.editScope.editScopeId;return r&&n?[{invocationModel:r,editScopeId:n}]:[]})),s=t.itemsWithChildEdits().slice();let a=!1;n(t.activatedItems(),e,r,((e,t,o)=>{o&&(s.some((t=>I(t.item,e)))||(a=!0,s.push({item:e,editScopeId:o})))})),s.length>e.length&&n(s.map((e=>e.item)),e,r,((e,t,o)=>{o||(a=!0,s.splice(t,1))})),a&&t.itemsWithChildEdits(s.slice())}}(e.masterModelId,a,l,d,n)}function A(e,t,o,i,r,n){let s,a,l;if(i.invocationInputArguments&&i.invocationInputArguments.length>0){if(a=i.invocationInputArguments,l=i.isMultiple,a=(e=>e.map((e=>MsPortalFx.clone(e,!0,!1))))(i.invocationInputArguments),!i.blade&&i.invocationInputArguments[0].valuesFrom&&i.invocationInputArguments[0].valuesFrom.length>0){s=i.invocationInputArguments[0].valuesFrom[0].property;const o=t.masterModel;if(s="container.selectable"===s?"container":s,c=o,u=s,F(FxImpl.tryGetSelectableViewModelContract,c,u))return O(e,t,a,s);if(function(e,t){return F(FxImpl.isSelectable2,e,t)}(o,s))return L(e,t,a,s);(0,d.isSelectableSet)(o,s)?(l=!0,a[0].valuesFrom[0].property=s+".activatedItems"):(0,d.isSelectable)(o,s)&&(l=!1,a[0].valuesFrom[0].property=s+".value")}return{success:!0,isSelectableSetV1:l,invocationInputArguments:a,viewStatePropertyRemovals:[],updateSelectedValue:y}}var c,u;return function(e,t,o,i,r,n){let s={success:!0,isSelectableSetV1:!1,invocationInputArguments:null,viewStatePropertyRemovals:[],updateSelectedValue:y};if(i.selectablePath)if((0,d.isSelectableSet)(t.masterModel,i.selectablePath)){if(!i.selectableBindings||!i.selectableBindings.some((e=>!!(e.valuesFrom&&e.valuesFrom.length>0)&&6===e.valuesFrom[0].referenceType)))return s.success=!1,N(t,`The view model '${t.masterModelId}' has a selectable source '${i.selectablePath}' that is a selectable set.  There must be at least one <BladeInput> which has SelectedItem as the Source for a selectable set to indentify which row is opening the blade.`),s;s=T(o,e,t,n,i,r)}else(0,d.isSelectable)(t.masterModel,i.selectablePath)?s=D(o,e,t,i,i.selectablePath,r):(s.success=!1,N(t,`The view model for '${t.masterModelId}' with property '${i.selectablePath}' must of type MsPortalFx.ViewModels.Selectable or MsPortalFx.ViewModels.SelectableSet to open the child blade(s) '${i.blade}'`));else s=function(e,t,o,i,r){return D(e,t,o,i,"container.selectable",r)}(o,e,t,i,r);return s}(e,t,o,i,r,n)}function N(t,o,r){(0,i.logToExtension)(e,t.referenceExtension.name,2,o,{contextData:r})}t.BladeOpener=w=__decorate([__metadata("fx:diagnostics",[e,"BladeOpener"]),o.Class("composition"),__metadata("design:paramtypes",[o.Container,d.OpenerConfiguration])],w);let U=class{constructor(){this.queue=[]}enqueue(e){const t=this.queue,o=!t.length;MsPortalFx.remove(t,(t=>t.pipeline===e.pipeline),1),t.push(e);const i=e=>{e.pipeline.startTask(e.taskArgs).finally((()=>{t.shift(),t.length&&i(t[0])}))};o&&i(t[0])}};U=__decorate([__metadata("fx:diagnostics",[e,"InvocationQueue"]),o.Class()],U)}));