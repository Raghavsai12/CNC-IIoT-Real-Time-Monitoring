define("MsPortalImpl/Auth/MsalJsWrapper",["require","exports","@azure/msal-browser-1p"],(function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthError=t.InteractionRequiredAuthError=t.AccountInfo=t.AuthenticationScheme=t.PairwiseBrokerApplication=void 0,t.initializePublicClientApplication=function(e,n,o){let i;i=e===l.portalClientId?{actAsBroker:!0,preferredInteractionType:u,brokerMessageTimeout:6e4}:{preferredInteractionType:u,allowBrokering:!0,trustedBrokerDomains:[d],brokerMessageTimeout:6e4};return new t.PairwiseBrokerApplication(function(e,t,n){const o=t||"organizations",i={auth:{clientId:e,authority:p(s.fxAadAuthority)+o},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{logLevel:r.LogLevel.Verbose,loggerCallback:(e,t,o)=>{if(MsPortalFx.isFeatureEnabled("enableauthtelemetry")){if(o)return i={action:"MsalLoggerCallbackPii",data:{level:e,correlationId:n}},void a.trace({source:"MsalJsWrapper",action:i.action,data:i.data});switch(e){case r.LogLevel.Error:return void c.error(t);case r.LogLevel.Info:case r.LogLevel.Verbose:return void c.verbose(t);case r.LogLevel.Warning:return void c.warning(t)}}var i}}}};MsPortalFx.isFeatureEnabled("nativebroker")&&(i.system.allowPlatformBroker=!0);return i}(e,n,o),i)},t.initializeBrokering=async function(e){const{msalObj:t,correlationId:r,spaAuthCode:n,spaAccountId:a}=e;if(n)return await t.initializeBrokering({codeRequest:{code:n,correlationId:r}});if(a)return await t.initializeBrokering({codeRequest:{nativeAccountId:a,correlationId:r,scopes:[l.armAadResource+"/.default"]}});return await t.initializeBrokering()},t.handleRedirectPromise=async function(e,t){return await e.handleRedirectPromise(t)},t.initialize=async function(e){return await e.initialize()},t.acquireTokenSilent=async function(e){const{authority:r,scopes:n,msalObj:a,userAccountInfo:s,correlationId:c,sshTokenData:l,popTokenData:u,claims:d,forceRefresh:p}=e;let m={account:s,scopes:n,authority:r,correlationId:c,claims:d,forceRefresh:p,cacheLookupPolicy:0};l&&(m={...m,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:l.jwk,sshKid:l.kid});u&&(m={...m,...u,authenticationScheme:t.AuthenticationScheme.POP});MsPortalFx.isFeatureEnabled("nativebroker")&&(m={...m,extraQueryParameters:{webnativebridge:"true"}});const g=h({action:"acquireTokenSilent",name:a.getConfiguration()?.auth?.clientId},c);try{const e=await a.acquireTokenSilent(m);return o(g,!0,{scope:n[0],correlationId:c}),e}catch(e){throw i(g,{scope:n[0],correlationId:c,error:e instanceof Error?e?.message:e?.toString()}),e}},t.acquireTokenPopup=async function(e){const{scopes:r,msalObj:n,userAccountInfo:a,correlationId:s,sshTokenData:c,popTokenData:l,claims:u}=e;let d={account:a,scopes:r,correlationId:s,claims:u};c&&(d={...d,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:c.jwk,sshKid:c.kid});l&&(d={...d,...l,authenticationScheme:t.AuthenticationScheme.POP});MsPortalFx.isFeatureEnabled("nativebroker")&&(d={...d,extraQueryParameters:{webnativebridge:"true"}});const p=h({action:"acquireTokenPopup",name:n.getConfiguration().auth.clientId},s);try{const e=await n.acquireTokenPopup(d);return o(p,!0,{scope:r[0],correlationId:s}),e}catch(e){throw i(p,{scope:r[0],correlationId:s,error:e instanceof Error?e?.message:e?.toString()}),e}},t.ssoSilent=async function(e){const{scopes:r,msalObj:n,userAccountInfo:a,correlationId:s,popTokenData:c}=e;let l={account:a,scopes:r,correlationId:s,...c};c&&(l={...l,authenticationScheme:t.AuthenticationScheme.POP});const u=h({action:"ssoSilent",name:n.getConfiguration().auth.clientId},s);try{const e=await n.ssoSilent(l);return o(u,!0,{scope:r[0],correlationId:s}),e}catch(e){throw i(u,{scope:r[0],correlationId:s,error:e instanceof Error?e?.message:e?.toString()}),e}},t.acquireTokenRedirect=async function(e){const{scopes:r,msalObj:n,userAccountInfo:a,correlationId:s,sshTokenData:c,popTokenData:l,claims:u,redirectUri:d}=e;let p={account:a,scopes:r,correlationId:s,claims:u,redirectUri:d};c&&(p={...p,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:c.jwk,sshKid:c.kid});l&&(p={...p,...l});MsPortalFx.isFeatureEnabled("nativebroker")&&(p={...p,extraQueryParameters:{webnativebridge:"true"}});const m=h({action:"acquireTokenRedirect",name:n.getConfiguration()?.auth?.clientId},s);try{const e=await n.acquireTokenRedirect(p);return o(m,!0,{scope:r[0],correlationId:s}),e}catch(e){throw i(m,{scope:r[0],correlationId:s,error:e instanceof Error?e?.message:e?.toString()}),e}},t.getAllAccounts=function(e){return e.getAllAccounts()},t.logoutRedirect=function(e){return e.msalObj.logoutRedirect({onRedirectNavigate:()=>!1})};var n=MsPortalFx.Base.Diagnostics,a=n.Telemetry;t.PairwiseBrokerApplication=r.PairwiseBrokerApplication,t.AuthenticationScheme=r.AuthenticationScheme,t.AccountInfo=r.AccountInfo,t.InteractionRequiredAuthError=r.InteractionRequiredAuthError,t.AuthError=r.AuthError;const o=a.endTrace,i=a.cancelTrace,s=FxImpl.internalEnv,c=n.createLog(e),l=fx.environment.auth,u=r.InteractionType.Redirect,d=window.location.origin;function p(e){return MsPortalFx.ensureSuffix(e,"/")}function h(e,t){return a.startTrace({source:"MsalJsWrapper",action:e.action,name:e.name,data:{...e.data,correlationId:t}})}})),
define("MsPortalImpl/Services/PortalAuthHandler",["require","exports","Fx/Composition","Fx/Redirect","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Auth/MsalJsWrapper","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/UI/UI.NavigationManager"],(function(e,t,r,n,a,o,i,s){"use strict";t.MsalClientAuth=t.DEV=void 0;var c=MsPortalFx.Base,l=c.Diagnostics,u=FxImpl.Security,d=l.Telemetry,p=c.Net2,h=c.Resources,m=c.QueryStringBuilder,g=c.UriBuilder;const I=window,f=l.createLog(e),k=MsPortalFx.encodeHtml,A=d.endTrace,x=d.cancelTrace,P=fx.environment,T=P.auth,w=T.portalClientId,M=u.tokenErrors,S=h.getAppRelativeUri("/api/PortalAuthorization/ProvisionServicePrincipal"),C=a.Shell.Dialogs,y=P.links.aadErrorCodes,R=MsPortalFx.ensureSuffix(h.getAppRelativeUri("/"),"/"),_=new Map([["50057:",M.accountDisabled],["50001:",M.appNotProvisioned],["500014:",M.appNotProvisioned],["1001010:",M.appNotProvisioned],["70002:",M.credentialsExpired],["50173:",M.credentialsExpired],["50135:",M.credentialsExpired],["53000:",M.deviceUncompliant],["500113:",M.missingBrokerReplyUrl],["700046:",M.missingBrokerReplyUrl],["50020:",M.passthroughUserError],["50076:",M.requiresMFA],["50078:",M.requiresMFA],["50079:",M.requiresMFA],["50158:",M.requiresMFA],["70008:",M.sessionEnded],["50132:",M.sessionEnded],["70043:",M.sessionEnded],["broker_timeout",M.brokerTimeout],["post_request_failed",M.noNetwork],["no_network_connectivity",M.noNetwork],["endpoints_resolution_error",M.noNetwork]]);let b;try{b=JSON.parse(MsPortalImpl.sessionStorage.getItem("InteractionRequiredErrorSeenMap")||null)||Object.create(null)}catch{b=Object.create(null)}function E(e,t){d.trace({source:"PortalAuthHandler",action:e.action,actionModifier:e.actionModifier,name:e.name,data:{...e.data,correlationId:t}})}function F(e,t,r){d.trace({source:"PortalAuthHandler",action:t.action,actionModifier:e,data:{...t.data,correlationId:r}})}function v(e,t){return d.startTrace({source:"PortalAuthHandler",action:e.action,name:e.name,data:{correlationId:t}})}function D(e){try{const e=JSON.stringify(b);MsPortalImpl.sessionStorage.setItem("InteractionRequiredErrorSeenMap",e)}catch(t){d.trace({source:"PortalAuthHandler",action:"StoreInteractionRequiredErrorSeenMap",actionModifier:"Failed",data:{error:MsPortalFx.getLogFriendlyMessage(t),correlationId:e}})}}function O(e,t){if(!e)return null;if(!e.startsWith("Bearer"))return E({action:"parseWwwAuthHeader",data:{reason:"InvalidPrefix",prefix:e.slice(0,7)}},t),null;let r="",n="",a="",o=-1;return(e=e.replace("\n",",")).substring(7).split(",").forEach((e=>{const t=/^(.+)="(.*)"$/.exec(e.trim());if(o=t?.length,3===o){const e=t[2];switch(t[1]){case"authorization_uri":r=e;break;case"error":n=e;break;case"claims":a=atob(e)}}})),E({action:"parseWwwAuthHeader",data:{authorization_uri:r,error:n,includesClaims:!!a,regexCount:o}},t),a}function q(e,t,r){let n=Object.create(null);if(e)try{n=JSON.parse(e)}catch(e){E({action:"parsingClaimsFailed",name:t,data:{error:e}},r)}const a=n.access_token=n.access_token||{},o=a.xms_cc=a.xms_cc||{};return(o.values=o.values||[]).push("cp1"),JSON.stringify(n)}function B(e){const t=(e||{}).message||"";let r=M.unknown;return _.forEach(((e,n)=>{t.includes(n)&&(r=e)})),{status:r,errorMessage:t,authHeader:null,expiresAt:null,expiresInMs:null}}class N{constructor(e,t,r,n){this._authStateManager=e,this._windowManager=t,this._dialogManager=r,this._assignments=n,this._extensionPCAppCache=new Map,this._modalDialogCopyTextErrors=[],this._portalAppInitRetryCounter=0,this._stalledPromise=null;const a=e.bootstrapState,o=e.bootstrapState.user;this._currentTenantId=o.tenantId,this._currentPreferredUsername=o.preferredUsername,this._loginReplyUrlPath=a.loginReplyUrlPath,this._lastRefreshTokenRenewalTime=a.createdOn,this._portalPCAppPromise=this._initializePortalPCApp(),this._portalPCAppPromise.then((e=>{e&&MsPortalImpl.sessionStorage.removeItem("spaAuthCodeRenewed")}))}static getInstance(e,t,r,n){return N._instance||(N._instance=new N(e,t,r.get(i.DialogManager),n)),N._instance}async acquireTokenForPortal(e){const{scopes:t,wwwAuthHeader:r,addXmsCcClaim:n,popTokenData:a,isBackground:o,correlationId:i}=e,s=v({action:"portalTokenRequest",name:w},i);let c="";r&&(c=O(r,i)),n&&(c=q(c,w,i));const l=await this._portalPCAppPromise,u=this._userAccountInfo;if(!l||!u)return x(s,{reason:"missingPrereqsForTokenRequestForPortal",scopes:t,isPortalPublicClientAppInitialized:!!l,isUserAccountInfoInitialized:!!u,addXmsCcClaim:n,includesWwwAuthHeader:!!r,correlationId:i}),null;const d=await this._handleTokenRequest({appId:w,msalClientObject:l},{authority:MsPortalFx.ensureSuffix(FxImpl.internalEnv.fxAadAuthority,"/")+this._currentTenantId,scopes:t,isBackground:o,claims:c,forceRefresh:this._authStateManager.bootstrapState?.forceSignIn,popTokenData:a,correlationId:i});return A(s,!!d?.authHeader,{scopes:t,addXmsCcClaim:n,includesWwwAuthHeader:!!r,correlationId:i}),d}async acquireTokenForExtension(e){const{extensionClientId:t,scopes:r,tenantId:n,wwwAuthHeader:a,sshTokenData:o,popTokenData:i,addXmsCcClaim:s,isBackground:c}=e;let{correlationId:l}=e;l||(l=MsPortalFx.newGuid(),E({action:"acquireTokenForExtension",actionModifier:"NoCorrelationId"},l));const u=this._currentTenantId,d={scopes:r,extensionClientId:t,customTenantId:n,addXmsCcClaim:s,correlationId:l,includesWwwAuthHeader:!!a,includesSshTokenData:!!o,includesPopTokenData:!!i},p=v({action:"extensionTokenRequest",name:t},l);let h="";a&&(h=O(a,l)),s&&(h=q(h,w,l));const m=this._extensionPCAppCache.get(t);let g=m;if(!g||n!==u)try{g=await this._initializeExtensionPCApp(t,l,n)}catch(e){return{status:M.unknown,errorMessage:e,authHeader:null,expiresAt:null,expiresInMs:null}}const I=this._userAccountInfo;if(!g||!I)return x(p,{reason:"missingPrereqsForTokenRequestForExtension",isExtensionPublicClientAppInitialized:!!g,isUserAccountInfoInitialized:!!I,...d}),null;const f=this._authStateManager.bootstrapState?.forceSignIn||n&&n!==this._currentTenantId,k=await this._handleTokenRequest({appId:t,msalClientObject:g},{authority:MsPortalFx.ensureSuffix(FxImpl.internalEnv.fxAadAuthority,"/")+(n||u),scopes:r,isBackground:c,sshTokenData:o,popTokenData:i,claims:h,forceRefresh:f,customTelemetryData:{isCachedExtensionPublicClientApp:!!m},correlationId:l});return A(p,!!k?.authHeader,d),k}async localLogout(){const e=await this._portalPCAppPromise;return o.logoutRedirect({msalObj:e})}async _initializePortalPCApp(){const e=this._currentTenantId,t=this._currentPreferredUsername;if(!e)throw"No tenant ID was passed when initializing the portal public client application using MSAL.js";let r="PortalAuthHandler.UnknownError";const a=MsPortalFx.newGuid(),i="true"===MsPortalImpl.sessionStorage.getItem("hasUserBeenRedirectedForLoginError"),c=v({action:"portalAppInit",name:w},a),{spaAccountId:l,spaAuthCode:u,createdOn:d}=this._authStateManager.bootstrapState,p=this._loginReplyUrlPath,h=o.initializePublicClientApplication(w,e,a);try{let e;await o.initializeBrokering({msalObj:h,correlationId:a,spaAuthCode:u,spaAccountId:l}),(u||l)&&this._authStateManager.clearSpaAuthCode();try{const t=JSON.parse(MsPortalImpl.sessionStorage.getItem("Redirect_BootParameters")||"{}");t.msalHash&&(e=t.msalHash,MsPortalImpl.sessionStorage.setItem("Redirect_BootParameters",JSON.stringify({...t,msalHash:""})))}catch(e){}await o.initialize(h);const t=await o.handleRedirectPromise(h,e);if(t){if(t.account)return A(c,!0,{reason:"portalAppInit_CompleteViaRedirectPromise",correlationId:a,isNativeAccountIdPresent:!!t.account.nativeAccountId}),this._userAccountInfo=t.account,h;A(c,!0,{reason:"portalAppInit_fatalNoAccountFound",correlationId:a}),f.error("Calling 'handleRedirectPromise' returned an AuthenticationResult object with a missing 'account' property. This is an error in the MSAL.js library.")}else{const e=function(e,t,r,n){return E({action:"validateCurrentAccountInMsalJs",data:{tenantIdToMatch:t,preferredUsernameToMatch:r,numberOfCurrentAccounts:e.length,accountsSummary:JSON.stringify((e||[]).map((e=>({tenantId:e.tenantId,username:e.username?.substring(0,6),preferredUsername:e.idTokenClaims?.preferred_username?.substring(0,6)}))))}},n),e&&e.length>0?MsPortalFx.find(e,(e=>e.tenantId===t&&(e.username===r||e.idTokenClaims?.preferred_username?.toLowerCase()===r.toLowerCase()))):null}(o.getAllAccounts(h),this._currentTenantId,this._currentPreferredUsername,a);if(A(c,!0,{reason:e?"portalAppInit_CompleteViaAccountsSearch":"portalAppInit_fatalNoAccountFoundInSignedInAccounts",correlationId:a,isNativeAccountIdPresent:!!e?.nativeAccountId}),e)return this._userAccountInfo=e,h}}catch(e){r=(e.message||e).replace(/<.*?>/g,"[REDACTED_TEXT]");const t=++this._portalAppInitRetryCounter,o=MsPortalImpl.sessionStorage.getItem("spaAuthCodeRenewed");if(x(c,{reason:`portalAppInit_Failed_${t}`,correlationId:a,spaAuthCodeRenewed:o,exceptionMessage:r,exceptionStack:e.stack}),r.includes("AADSTS70008:")){if(!o)return MsPortalImpl.sessionStorage.setItem("spaAuthCodeRenewed","true"),await n.forceSignIn({reason:"Renew the SPA auth code in this user's session."}),null}else if(t<=3)return await this._initializePortalPCApp()}MsPortalImpl.sessionStorage.removeItem("spaAuthCodeRenewed");let I="",k="";if(i)I=s.getErrorPageUri("SigninFailed",r),k="PortalAppInitFailed";else{MsPortalImpl.sessionStorage.setItem("hasUserBeenRedirectedForLoginError","true");const r=new g((e=>R+e.slice(1))(p));r.path+="@"+e,r.query=new m(window.location.search),r.query.setParameter("loginHint",t),I=r.toString(),k="PortalAppInitFailedHenceRedirectToLoginOnce"}return E({action:"redirectOnPortalAppInitFailure",data:{currentTenantId:e,hasUserBeenRedirectedForLoginError:i,loginReplyUrlPath:p,msaljsTokensExperiment:this._assignments.getBooleanValue("msaljsexp")+"",msaljsTokensFeatureFlag:MsPortalFx.isFeatureEnabled("msaljs")+"",msaljsLoginExperiment:this._assignments.getBooleanValue("msaljsloginexp")+"",msalVersion:h?.broker?.logger?.packageVersion,msalPackageName:h?.broker?.logger?.packageName,redirectReason:k,spaAccountId:l?.substring(0,10),spaAuthCode:u?.substring(0,10),userAuthenticatedAtUtc:new Date(d).toISOString()}},a),MsPortalFx.Base.Diagnostics.Telemetry.flush(),await new Promise((e=>setTimeout(e,3e3))),this._windowManager.redirect({uri:I,redirectAction:2,reason:k}),null}async _initializeExtensionPCApp(e,t,r){const n=await this._portalPCAppPromise,a=this._userAccountInfo,i={extensionClientId:e,correlationId:t},s=v({action:"extensionAppInit",name:e},t);if(!n||!a)return E({action:"missingPrereqsForExtensionInit",name:e,data:{isPortalPublicClientAppInitialized:!!n,isUserAccountInfoInitialized:!!a}},t),null;const c=o.initializePublicClientApplication(e,r||this._currentTenantId,t);try{return await o.initializeBrokering({msalObj:c,correlationId:t}),await o.initialize(c),await o.handleRedirectPromise(c),r||this._extensionPCAppCache.set(e,c),A(s,!0,i),c}catch(r){throw A(s,!1,i),new MsPortalFx.Errors.Error({message:`Initialization of extension '${e}' has failed with the following error: `+MsPortalFx.getLogFriendlyMessage(r)+`. CorrelationId: ${t}`,innerErrors:r})}}async _handleTokenRequest(e,t){const{appId:r}=e,{correlationId:n}=t,a=await this._handleTokenRequestHelper(e,t,this._userAccountInfo,this._loginReplyUrlPath);return MsPortalFx.isFeatureEnabled("createserviceprincipal")&&a?.status===M.appNotProvisioned&&!t.scopes.some((e=>e.includes(T.armAadResource)))&&r!==w&&await async function(e,t){const r=v({action:"ProvisionServicePrincipal",name:e},t);let n="";try{n=(await p.postJSON({uri:S,dataType:"json",setAuthorizationHeader:!0,performRetry:!1},{extensionClientId:e})).errorMessage}catch(r){n=`Failed to provision service principal for the extension application '${e}' in the current tenant.Details: ${MsPortalFx.getLogFriendlyMessage(r)}. CorrelationId: ${t}`}const a=!n;return A(r,a,{extensionClientId:e,errorMessage:n,correlationId:t}),a}(r,n)?await this._handleTokenRequestHelper(e,t,this._userAccountInfo,this._loginReplyUrlPath):a}async _handleTokenRequestHelper(e,t,n,a){const{msalClientObject:i}=e,{authority:s,customTelemetryData:c,claims:l,sshTokenData:u,popTokenData:d,forceRefresh:p,isBackground:h,correlationId:m}=t,g=t.scopes||d.scopes,{clientId:f,clientCapabilities:A}=i.getConfiguration().auth,x=Date.now()-this._lastRefreshTokenRenewalTime>=432e5,P={authority:s,clientCapabilities:A,clientId:f,correlationId:m,includesPopTokenData:!!d,includesSshTokenData:!!u,lastRefreshTokenRenewalTime:this._lastRefreshTokenRenewalTime,useSsoSilent:x,scopes:g,includesNativeAccountId:!!n?.nativeAccountId,pageVisible:this._authStateManager.getPageVisibility()},T={msalObj:i,correlationId:m,authority:s,scopes:g,userAccountInfo:n,claims:l,sshTokenData:u,popTokenData:d,forceRefresh:p},S=e=>{const{includesAccessToken:t,tokenType:r,tokenFetchMethod:n,expiresOn:a,extExpiresOn:o,fromCache:i,fromNativeBroker:s}=e;F("authorized",{action:"tokenRequestSuccess",data:{...P,...c,tokenFetchMethod:n,includesAccessToken:t,tokenType:r,expiresOn:a,expiresInMs:a?a.getTime()-Date.now():void 0,extExpiresOn:o,extExpiresInMs:o?o.getTime()-Date.now():void 0,fromCache:i,fromNativeBroker:s,...e.additionalData}},m)},R=e=>{F("unauthorized",{action:"tokenRequestFailure",data:{...P,...c,exceptionErrorCode:e.errorCode,exceptionErrorMessage:e.message,exceptionMessage:e.message,exceptionStack:e.stack}},m)},_=async e=>{if(this._stalledPromise){E({action:e,actionModifier:"BeginWait"},m);const t=await this._stalledPromise;return E({action:e,actionModifier:"EndWait"},m),t}return null};await _("beforeAcquireTokenSilentCall");try{let e;d||x?(x&&(this._lastRefreshTokenRenewalTime=Date.now(),T.forceRefresh=!0),e=await o.ssoSilent(T)):e=await o.acquireTokenSilent(T),S({includesAccessToken:!!e.accessToken,tokenType:e.tokenType,tokenFetchMethod:"acquireTokenSilent",expiresOn:e.expiresOn,extExpiresOn:e.extExpiresOn,fromCache:e.fromCache,fromNativeBroker:e.fromNativeBroker});const{accessToken:t,expiresOn:r,tokenType:n}=e;return{authHeader:`${n} ${t}`,expiresAt:r.getTime(),expiresInMs:r.getTime()-Date.now()}}catch(e){let t=e;if(R(t),h)return{status:M.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null};let n=t.message.includes("AADSTS700084:");if(n)try{const e=await o.ssoSilent(T),{accessToken:t,expiresOn:r,extExpiresOn:n,tokenType:a,fromCache:i,fromNativeBroker:s}=e;return S({includesAccessToken:!!t,tokenType:a,tokenFetchMethod:"ssoSilent_RefreshTokenExpired",expiresOn:r,extExpiresOn:n,fromCache:i,fromNativeBroker:s}),{authHeader:`${a} ${t}`,expiresAt:r.getTime(),expiresInMs:r.getTime()-Date.now()}}catch(e){R(e),t=e,n=e.message.includes("AADSTS700084:")}const i=t instanceof o.InteractionRequiredAuthError;if(i||n){const e=k(t.message),s=async()=>{E({action:"detectedInteractionRequiredAuthError",data:{isRefreshTokenExpired:n,correlationId:m}},m);const i=Q.defer(),s=Object.create(null);if(y&&(s.learnMoreText=C.learnMore,s.onClickLearnMore=new r.ClickableLink(y,"_blank",null,MsPortalFx.noop,"AadErrorCodes")),this._modalDialogCopyTextErrors.push({errorMessage:e,clientId:f,scopes:g}),this._stalledPromise){const e=await _("uponConsecutiveInteractionRequiredError");if(4!==e.dialogResult)return{dialogResult:e.dialogResult,tokenResult:{status:M.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null}}}E({action:"displayingModalDialog",data:{scope:g[0],correlationId:m}},m);const c=await this._dialogManager.showModalDialog({title:C.claimsErrorGenericTitle,description:C.claimsErrorGenericDescription.format(`${e}`,y?'<a class="msportalfx-ext-link" href="" data-bind="text: learnMoreText, fxclick: onClickLearnMore"></a>':"")+'<div class="fxt-copy"><a href="#" data-bind="text: copyText, click: copyClick"></a></div>',templateViewModel:MsPortalFx.extend2(s,{copyText:C.copyText,copyClick:()=>{const e=FxImpl.createElement("pre");e.textContent=JSON.stringify({sessionId:MsPortalFx.sessionId,errors:this._modalDialogCopyTextErrors},null,2),document.body.appendChild(e);const t=I.getSelection();t.removeAllRanges();const r=document.createRange();r.selectNodeContents(e),t.addRange(r),I.document.execCommand("copy"),e.remove()}}),defaultButtonText:C.claimsErrorButtonText,cancelButtonText:C.connectionErrorCancelButtonText,buttons:2,uiShield:{hidePromise:i.promise}});if(this._modalDialogCopyTextErrors=[],4!==c)return i.resolve(),{dialogResult:c,tokenResult:{status:M.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null}};E({action:"initiatingAcquireTokenRedirect",data:{scope:g[0],correlationId:m}},m),MsPortalImpl.sessionStorage.setItem("forceSignIn","true"),this._authStateManager.clear();try{if(f.toLowerCase()===w)return await o.acquireTokenRedirect({...T,redirectUri:a}),null;const{accessToken:e,expiresOn:t,extExpiresOn:r,tokenType:n,fromCache:i,fromNativeBroker:s}=await o.acquireTokenPopup(T);return S({includesAccessToken:!!e,tokenType:n,tokenFetchMethod:"acquireTokenPopup",expiresOn:t,extExpiresOn:r,fromCache:i,fromNativeBroker:s}),{dialogResult:c,tokenResult:{authHeader:`${n} ${e}`,expiresAt:t.getTime(),expiresInMs:t.getTime()-Date.now()}}}catch(e){return R(e),{dialogResult:c,tokenResult:B(e)}}};if(MsPortalFx.isFeatureEnabled("msaljs")&&MsPortalFx.isFeatureEnabled("msaljswithfallback")&&(!d&&!u)&&i){if(b[f]=b[f]?b[f]:Object.create(null),b[f][g[0]])return b[f][g[0]]=null,D(m),B(t);b[f][g[0]]=!0,D(m)}this._stalledPromise=s();const c=await this._stalledPromise;return this._stalledPromise=null,c.tokenResult}return B(t)}}}t.MsalClientAuth=N}));