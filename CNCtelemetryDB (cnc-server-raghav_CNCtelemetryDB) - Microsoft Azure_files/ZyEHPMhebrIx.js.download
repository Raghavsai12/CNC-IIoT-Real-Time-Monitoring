define("MsPortalImpl/UI/Compositions/UI.Composition.Selectable2Registrar",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Events","MsPortalImpl/UI/UI.LinkHandler","Fx"],(function(e,t,r,a,n,o,i,l,s,c){"use strict";t.attachFxClickHandler=function(t,a,n,o){const l=o||new FxImpl.TriggerableLifetimeManager;o||ko.utils.domNodeDisposal.addDisposeCallback(t,(()=>{l.dispose()}));const d=$(t),u=a.$data,f=a.$dicontainer||r.container,m=p(f,l,d,C,B(u)),h="A"===t.tagName;let b=!0,v=!0;const I=e=>{e=v||!!e,t.setAttribute("aria-disabled",`${e}`),d.toggleClass("azc-text-disabled",e);const r=ko.unwrap(a.$tabIndex),n=e?-1:r||0;t.setAttribute("tabindex",`${n}`)};let P,A=(e,t,r)=>!0;const M=ko.observable(""),w=(0,s.getLinkTelemetryLogger)(d,M,"LinkRightClicked");t.addEventListener("contextmenu",(e=>{w()})),ko.reactor(l,(()=>{try{P&&P.dispose(),P=l.createChildLifetime();const r=ko.unwrap(n);M(r?.telemetryName||""),ko.ignoreDependencies((()=>{let n;if("function"==typeof r){const a=r;n=r=>{r.stopPropagation();const n=h&&t.getAttribute(k)||"";if(s.defaultHref===n)r.preventDefault();else if(h&&"keydown"===r.type&&(13===r.which||32===r.which&&"button"===t.getAttribute("role"))||"BUTTON"===t.tagName&&(32===r.which||13===r.which))return;c.isPromiseLike(a)&&i.logToExtension(e,t,2,FxImpl.createError("fxclick binding argument is not a callback function. The click handler is "+a)),m.invokeClick(u,a,r)}}else if(n=r,n?.attachHoverCard){const t=ko.unwrap(n.resourceId);MsPortalFx.Base.Promises.cancelOnDispose(l,Promise.all([MsPortalFx.require(e.normalize("MsPortalImpl/Widgets/Widgets.HoverCard")),MsPortalFx.require(e.normalize("MsPortalImpl/Widgets/ResourceHoverCard"))])).then((([e,r])=>{e.attach(l,d.parent(),".fxs-fxclick",(a=>{const n=new r.ViewModel(t,$(a.currentTarget),f);return n.positionHint=3,g({source:"ResourceHoverCard",action:"InitialReveal",name:t,data:{hoverCardLocation:r.HoverCardSource.ResourceLink}}),new e.Widget(e.getBalloonElement(t,r.HoverCardSource.ResourceLink),n,f)}),f)}))}const o=(0,s.getUriAndHandler)(P,f,n,!h);let p=v;o.uri.subscribeAndRun(P,(e=>{if(v=!e,(a.$disabled||p!==v)&&(p=v,I(a.$disabled&&a.$disabled())),h){let r=!1;b&&(r=!!t.getAttribute(k)),r&&e===s.defaultHref||(e?(t.setAttribute(k,e),b=!1):(t.removeAttribute(k),b=!1))}})),o.errorMessage.subscribeAndRun(P,(r=>{r&&i.logToExtension(e,t,1,FxImpl.createError(`fxclick failure: ${MsPortalFx.getLogFriendlyMessage(r)}`))})),A=o.handler}))}catch(r){i.logToExtension(e,t,2,FxImpl.createError(`fxclick failed to read value: ${MsPortalFx.getLogFriendlyMessage(r)}`))}})),ko.reactor(l,[a.$disabled,a.$tabIndex],I),t.classList.add(x);const S=r=>{if(ko.unwrap(a.$disabled)||"true"===t.getAttribute("aria-disabled")){if("click"===r.type||"keydown"===r.type&&(13===r.which||32===r.which&&("BUTTON"===t.tagName||"button"===t.getAttribute("role"))))return!1}else try{return A(r,m,M())}catch(r){i.logToExtension(e,t,2,FxImpl.createError("fxclick failed to execute click handler",{innerErrors:r,data:{databind:$(t).attr("data-bind")}}))}};l.registerForDispose([()=>t.classList.remove(x),d.setEvents(["click",S],["keydown",S])]),m.activated.subscribeAndRun(l,(e=>{const t=!!e;!function(e,t){t?(e.closest(".fxs-part-content").find("."+F).removeClass(y),e.addClass(y)):e.removeClass(y)}(d,t),t&&d.trigger($.Event("fxselectableactivated",{activated:m.activated}))}))},t.createFxColumnSelectable=function(e,t,r,a,o){const i=m(a);let s,c;const d=ko.observable(),u=h(e,"FxGrid_"+o,i,(e=>{const r=e;ko.reactor(t,(()=>{const t=r.activationState();if(t){const r=t.current&&t.current.item;r!==c&&(d(e.value()),c=r,c&&s&&(s.trigger($.Event("fxselectableactivated",{activated:d})),s=null))}}))}));return{activated:d,invokeClick:(e,t,a)=>{const n=i&&i.internal&&i.internal.elements||ko.observableArray(),o=(0,l.getOrCreateFxElement)(t[0],n);u?(s=t,u.invokeClickCallback(3,i,r,e,o,{row:a,element:o})):e({row:a,element:o})},openBlade:async(t,r,a)=>{u&&(s=r,e.get(n.BladeOpener).openBlade(t,{selectable:u,flags:0,selectedItem:a}))},openContextPane:async(t,r,a)=>{u&&(s=r,e.get(n.BladeOpener).openBlade(t,{selectable:u,flags:1,selectedItem:a}))}}},t.discoverSelectables=O,t.getListSelectableWithClickHandler=function(e,t,r,a){const n=M(e,t,r,$.noop),o=n,i=m(r);return o.onClick=e=>{n.invokeClickCallback(3,i,t,a,void 0,e.item,e.metadata)},o},t.getSelectableWithClickHandler=M,t.registerOpenBladeCommands=function(e,t,r,a,n){const o=e.filter((e=>10===e.type));if(0===o.length)return!0;if(!function(e,t){e=e||[];const r="Found {0} OpenBladeCommmand2 items with a null or undefined '{1}' property. Source: '{2}'";function a(a){const n=e.filter((e=>!e[a]));return n.length&&b.error(r.format(n.length,a,t)),!!n.length}if(["id","selectable"].some(a))return!1;const n=e.map((e=>e.id)),o=function(e){const t={},r=[];return(e||[]).forEach((e=>{t[e]&&r.push(e),t[e]=!0})),r}(n);if(o.length)return b.error("Found multiple OpenBladeCommand2 items have the same id. Ids must be unique. Duplicate Id(s): '{0}', Source: '{1}'".format(JSON.stringify(o),t)),!1;return!0}(o,r.locator))return!1;const i=u(t)[a],l={};return o.forEach((e=>{const a=e.selectable,n=f(r.diContainer,a);l[n.id]=a,n.registerForDispose({dispose:()=>{const e=MsPortalFx.clone(i(),!1);delete e[n.id],i(e)}}),ko.reactor(n,(()=>{n.isSelected()&&t.internal.activeOpenBladeCommand(e)}))})),i(l),!0},t.registerSelectables=function(e,t,r,a){const n=new Map,o=()=>{!function(e,t,r){const a=O(t);ko.ignoreDependencies((()=>{const t=[];e.forEach(((e,r)=>{a.has(r)||t.push(e)})),t.forEach((t=>{e.delete(t.selectable)})),a.forEach(((t,a)=>{e.has(a)||(!function(e,t,r){const a=r.getBladeOpener(),n={invocationInputArguments:[{valuesFrom:[{referenceType:0,property:t.path}]}]},o=f(r.diContainer,t.selectable);a.registerInvocationProperty(n,void 0,o)}(r.diContainer,t,r),e.set(a,t))}))}))}(n,t,r)};a?ko.computed(e,o).extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"}}):o()};var d=MsPortalFx.Base.Diagnostics,u=o.createOrGetInternalSelectionState,p=a.getFxClickSelectable,f=a.getOrCreate,m=a.findExtensionViewModel,h=a.getOrCreateOpenBladeSelectable,g=MsPortalFx.Base.Diagnostics.Telemetry.trace;const b=d.createLog(e),C="fxclick",k="href",x="fxs-fxclick",v=15,I=["_msPortalFxShell","_msPortalFxOpenBladeSelectable","_msPortalFxSelectable","_msPortalFxSelectable2"],P=["selectable","activeOpenBladeCommand"];const F="msportalfx-activated",y=`${F} ext-${F}`;let A=0;function B(e){let t=MsPortalFx.Base.ProxiedObservables.data(e,C);return t||(t=C+A++,MsPortalFx.Base.ProxiedObservables.data(e,C,t)),t}function M(e,t,r,a){const n=m(r);if(n){const r=B(t),o=h(e,r,n);return o.onClick=()=>{o.invokeClickCallback(1,n,t,a)},o}}function w(e,t){try{let r=ko.unwrap(e[t]);return(Array.isArray(r)||"object"!=typeof r)&&(r=void 0),r}catch(e){return}}function S(e,t){return e?e+"."+t:t}function O(e){const t=new Map;return E(e,"content",t),E(e,"container",t,I),E(e,"internal",t,P),t}function E(e,t,r,a){const n=w(e,t),o=[{path:t,value:n,unprocessedChildProperties:a?a.slice():L(n)}];for(;o.length;){const e=o[o.length-1];if(e.unprocessedChildProperties.length){const t=e.unprocessedChildProperties.shift(),a=w(e.value,t);if(a)if(FxImpl.isSelectable2(a))r.set(a,{path:S(e.path,t),selectable:a});else if(o.length<v){const r={path:S(e.path,t),value:a,unprocessedChildProperties:L(a)};o.push(r)}}else o.pop()}}function L(e){return Object.keys(e).filter((e=>{return!(95===(t=e).charCodeAt(0)&&(109!==t.charCodeAt(1)||115!==t.charCodeAt(2)||80!==t.charCodeAt(3)||111!==t.charCodeAt(4)||114!==t.charCodeAt(5)||116!==t.charCodeAt(6)||97!==t.charCodeAt(7)||108!==t.charCodeAt(8)||70!==t.charCodeAt(9)||120!==t.charCodeAt(10)));var t}))}}));