define("_generated/MsPortalImpl/Svg/Internal/CollapseAll.svg",["require","exports"],(function(e,t){"use strict";t.type=t.data=void 0;t.type=1,t.data="<svg viewBox='0 0 18 18' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M14.932 0 9 6.18 3.068 0 2.25.851 9 7.875 15.75.851 14.932 0ZM3.068 18 9 11.82 14.932 18l.818-.851L9 10.125l-6.75 7.024.818.851Z'/></g></svg>"})),
define("_generated/MsPortalImpl/Svg/Internal/ExpandAll.svg",["require","exports"],(function(e,t){"use strict";t.type=t.data=void 0;t.type=1,t.data="<svg viewBox='0 0 18 18' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M14.932 7.875 9 1.695l-5.932 6.18-.818-.851L9 0l6.75 7.024-.818.851Zm-11.864 2.25L9 16.305l5.932-6.18.818.851L9 18l-6.75-7.024.818-.851Z'/></g></svg>"})),
define("MsPortalImpl.Controls/Controls/Lists/Menu.Component",["require","exports","Weave/DirectMode","Weave","MsPortalImpl.Controls/Controls/Lists/List1/ListView1.Component","MsPortalImpl.Controls/Controls/SearchBox.Component","FxInternal/Weave","Fx/Images","MsPortalImpl/Resources/ImplScriptResources","_generated/MsPortalImpl/Svg/Internal/ExpandAll.svg","_generated/MsPortalImpl/Svg/Internal/CollapseAll.svg","MsPortalImpl/Base/Base.BrowserDetection"],(function(e,t,s,i,a,o,n,l,r,c,d,u){"use strict";function m(e){let t,i;switch(e.state){case 0:case 1:t=l.Images.Star({palette:3}),i="fxc-menu-unfavorite";break;case 3:t=l.Images.Favorite({palette:3}),i="fxc-menu-favorite";break;case 2:case 4:t=l.Images.Favorite({palette:5}),i="fxc-menu-favorite"}return s("div",{image:t,className:`fxc-menu-favoriteicon ${i}`,"data-itemId":e.itemId,title:e.displayText,role:"button"})}t.MenuInner=function(e){const{state:t}=e,m=(0,n.toComputation)(t.favoriteMenuItemsListLength).compose((e=>e>=7)),p=t.listState.vivaListViewModel.plugins.groupable,f=r.Menu.favoriteKeyboardShortcut.split("{0}");return s(i.SetContext,{isMaxFavoritesReached:m,favoritesList:(0,n.toComputation)(t.favoriteItems),unmatchedFavoriteItems:(0,n.toComputation)(t.unmatchedFavoriteItems)},s(i.Fragment,null,s("div",{className:"fxc-menu-header"},t.searchBoxViewModel?s("div",{className:"fxc-menu-search"},s(o.SearchBoxInner,{vm:t.searchBoxViewModel,state:t.searchBoxState})):s("div",{className:"fxc-menu-nosearch-placeholder"}),MsPortalFx.isFeatureEnabled("useOldMenu")?null:s("button",{className:(0,n.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?"fxc-menu-collapseexpandall fxc-menu-collapseall":"fxc-menu-collapseexpandall fxc-menu-expandall")),image:(0,n.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?l.Images.CustomImageWithOptions(d,{}):l.Images.CustomImageWithOptions(c,{}))),title:(0,n.toComputation)(p.shouldCollapseOrExpand).compose((e=>"collapse"===e?r.Menu.collapseAllHeaders:r.Menu.expandAllHeaders)),onClick:()=>p.toggleCollapseStatusOfAllGroupHeaders(),type:"button"})),s("div",{className:"fxc-menu-scrollarea"},s("div",{className:["fxc-menu-grid",{"fxs-maxfavoritesreached":m}]},s(a.ListViewInner,{vm:t.listViewModel,state:t.listState}))),MsPortalFx.isFeatureEnabled("useOldMenu")?null:s("div",{className:"fxc-menu-footer"},f[0],s("kbd",null,u.isMac?"Cmd":"Ctrl"),"+",s("kbd",null,"Shift"),"+",s("kbd",null,"F"),f[1])))},t.menuGroupHeader=function(e){const t=e.value!==MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess,a=(0,n.toComputation)(e.isCollapsed);return s(i.Fragment,null,MsPortalFx.isFeatureEnabled("useOldMenu")?null:s("div",{image:a.compose((e=>e?l.Images.Chevron():l.Images.CaretDown())),className:["fxc-menu-icon","fxc-menu-groupheader-icon",t?"":"fxs-display-none"]}),s("div",{className:["fxc-menu-groupheader",t?"":"fxs-display-none"]},e.value))},t.menuItem=function(e){const t=(0,n.toValueOrComputation)(e.displayText),a=(0,n.toValueOrComputation)(e.id);return s(i.Fragment,null,s("div",{image:(0,n.toValueOrComputation)(e.icon),className:"fxc-menu-icon msportalfx-svg-c07"}),s("div",{className:"fxc-menu-listView-item","data-telemetryName":`Menu-${e.id}`},t),s(i.GetContext,{fn:o=>{const{favoritesList:l,isMaxFavoritesReached:c,unmatchedFavoriteItems:d}=o,u=l.compose((t=>t.includes(e.id))),p=d.compose((t=>t.includes(e.id)));return MsPortalFx.isFeatureEnabled("useOldMenu")?null:s(i.If,{condition:u,trueFn:()=>s(i.If,{condition:p,trueFn:()=>s(m,{state:1,displayText:r.Menu.unmatchedMenuItem,itemId:a}),falseFn:()=>s(m,{state:0,displayText:(0,i.composeComputation)([t],(e=>r.Menu.removeFavoriteItem.format(e))),itemId:a})}),falseFn:()=>s(i.If,{condition:c,trueFn:()=>s(m,{state:2,displayText:r.Menu.maxFavoritesReached,itemId:a}),falseFn:()=>s(i.If,{condition:(0,n.toComputation)(e.metadata?.disabled),trueFn:()=>s(m,{state:4,displayText:r.Menu.cantFavoriteDisabledItem,itemId:a}),falseFn:()=>s(m,{state:3,displayText:(0,i.composeComputation)([t],(e=>r.Menu.addFavoriteItem.format(e))),itemId:a})})})})}}))}})),
define("_generated/Less/MsPortalImpl.Controls/Controls/Lists/Menu.css",["module"],(function(e){"use strict";return{css:'.fxc-menu{display:flex;flex-direction:column}.fxc-menu-groupheader{padding:0;font-size:13px;line-height:1.385;line-height:32px;border-bottom-color:inherit;border-bottom-style:solid;border-bottom-width:1px}.ext-menublade-part{height:100%}.fxc-menu-search{flex:0 0 auto;min-height:23px;margin:7px 35px 7px 20px}.fxc-menu-nosearch-placeholder{display:block;flex:0 0 24px;min-height:24px}.fxc-menu-scrollarea{overflow:auto;flex:1 1 auto}.fxc-menu-footer{font-size:10px;padding:4px 12px;text-align:center;font-style:italic}.fxc-menu-icon{height:15px;width:15px;flex:0 0 auto}.fxc-menu-favoriteicon{opacity:0;width:12px;height:15px;flex:0 0 auto}.fxc-menu-item:hover .fxc-menu-favoriteicon,.fxc-menu-item:focus .fxc-menu-favoriteicon,.fxc-menu-item:active .fxc-menu-favoriteicon,.azc-listView-item:focus-visible .fxc-menu-favoriteicon{opacity:1}.azc-group-quickaccess .fxc-menu-favoriteicon{display:none}.fxs-maxfavoritesreached .fxc-menu-favorite{cursor:default}.fxc-menu-grid{padding:0}.fxc-menu-grid .azc-listView-item{display:flex;font-size:13px;margin:0}.fxc-menu-grid .azc-listView-item[aria-disabled="true"] .fxc-menu-listView-item,.fxc-menu-grid .azc-listView-item[aria-disabled="true"] .fxc-menu-icon{opacity:.5}.fxc-menu-grid .fxc-menu-item{display:flex;align-items:center;width:100%;padding:7px 20px;box-sizing:border-box;min-height:32px;overflow:hidden}.fxc-menu-grid .fxc-menu-item:hover,.fxc-menu-grid .fxc-menu-item:focus,.fxc-menu-grid .fxc-menu-item:active{text-decoration:none}.fxc-menu-grid .fxc-menu-icon{position:relative;padding-right:10px;align-self:flex-start;margin-top:2px}.fxc-menu-grid .fxc-menu-icon.fxc-menu-groupheader-icon{align-self:center;margin-top:0}.fxc-menu-grid .fxc-menu-listView-item{overflow:hidden;text-overflow:ellipsis;flex-grow:1}.fxc-menu-grid .azc-listView-groupheader{margin:0 20px}.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default{display:none}.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default .fxs-part{overflow:hidden!important}.fxs-menublade .fxs-blade-content-container.fxs-blade-content-container-default-overlay .fxs-blade-content-container-default{display:inherit}.fxc-menu .azc-listView-group{margin-bottom:8px}@media(min-width:640px) and (min-height:500px){.fxs-menublade .fxs-blade-content-container .fxs-blade-content-container-default{display:flex}}.fxc-menu.fxc-collapsible-menu{flex-direction:column;align-content:flex-start}.fxc-menu.fxc-collapsible-menu .fxs-portal-activated{box-shadow:inset 2px 0 var(--colorButtonBackgroundPrimary);font-weight:600}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup{margin:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-groupheader-icon{width:12px;padding:2px}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-groupheader,.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .azc-listView-collapsible-groupheader{border:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-item,.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .azc-listView-collapsible-groupheader{column-gap:8px}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .azc-listView-collapsible-groupheader{padding:6px 0 7px 20px}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup .fxc-menu-groupheader{text-align:start;line-height:normal}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup ul{margin-left:0}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup ul a.fxc-menu-item .fxc-menu-icon{height:16px;width:16px;padding-right:0;align-self:auto}.fxc-menu.fxc-collapsible-menu .azc-listView-collapsibleGroup:not(.azc-group-quickaccess) .fxc-menu-item{padding-left:44px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header{display:flex;flex-flow:row;gap:4px;align-items:center;justify-content:space-between;margin:7px 34px 7px 16px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-search{flex-grow:1;flex-shrink:1;margin:0}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall{height:24px;width:24px;display:flex;padding:8px;border:0}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall>svg{width:8px;height:8px}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall:hover{background-color:var(--colorControlBackgroundHover)}.fxc-menu.fxc-collapsible-menu .fxc-menu-header .fxc-menu-collapseexpandall:active{background-color:var(--colorControlBackgroundSelected)}',moduleId:e.id}})),
define("MsPortalImpl.Controls/Controls/Lists/Menu",["require","exports","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Base/Base.Selectable2","Fx/Controls/SearchBox","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Base/Base.DeepLink","MsPortalImpl.Controls/Controls/Base/Base","MsPortalImpl.Controls/Controls/Lists/Menu.Component","MsPortalImpl.Controls/Controls/Lists/List1/ListView1","MsPortalImpl.Controls/Controls/SearchBox","MsPortalImpl.Controls/Controls/Lists/List1/ListView1.InternalViewModel","fuse","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Lists/Menu.css","FxInternal/Controls/ListView1","MsPortalImpl/Services/Services.Storage","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Services/Services.Settings","Fx/Images","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Services/Services.GeneralSettings","Fx","Fx/Errors","FxInternal/Utils/Promise"],(function(e,t,s,i,a,o,n,l,r,c,d,u,m,p,f,h,x,g,v,b,I,M,w,y,F){"use strict";t.WidgetUIState=t.Widget=t.MenuFavoritesGroupId=t.InnerTsxComponent=void 0,(0,p.injectCss)(f);var C=MsPortalFx.Base.Promises;const k=MsPortalFx.Base.Diagnostics.createLog(e),S=i.getOrCreate,_="fxc-menu",P={shouldSort:!0,includeScore:!0,includeMatches:!0,tokenize:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:[{name:"displayText",weight:.8},{name:"keywords",weight:.3}],getFn:(e,t)=>{const s=ko.unwrap(e[t]);return"displayText"===t?s:"string"==typeof s?s.split(","):s}};class L extends l.WidgetUIState{constructor(e){super(),this.queryString=ko.observable(""),this.searchMissCallbacks=$.Callbacks(),this.ariaLabel=ko.observable(""),this.menuIdentificationKey=ko.observable(void 0),this.favoriteMenuItemsListLength=ko.observable(0),this.unmatchedFavoriteItems=ko.observableArray([]),this.favoriteItems=ko.observable([]);const t=e.vm,s=e.diContainer.get(x.StorageService),i=e.diContainer.get(M.GeneralSettings),o=ko.observable({}),n=new Map;t.groups.subscribe(this._ltm,(e=>{for(const t of e)n.set(ko.unwrap(t.displayText),t.id)})),ko.computed(this._ltm,this.menuIdentificationKey,(e=>{const t=e?JSON.parse(s.getValue(x.ComponentName.Menu,R(e),0)||"{}"):{};Object.prototype.hasOwnProperty.call(t,I.Menu.favorites)||(t[I.Menu.favorites]=!1),o(t),U("GroupableStateStorage","GroupableStateFetched",{keyUsed:e,isCollapsedByDefault:3===(0,M.getMenuBehaviorSettingFromSettings)(i),verboseUserSettingForCollapse:(0,M.stringifyDefaultMenuCollapseState)(i.defaultMenuCollapseState()),groupableStateMap:t})}));let l=null;ko.computed(this._ltm,[o,this.menuIdentificationKey],((e,t)=>{t&&(s.setValue(x.ComponentName.Menu,R(t),JSON.stringify(e),0),l&&clearTimeout(l),l=setTimeout((()=>{l=null,U("GroupableStateStorage","GroupableStateSaved",{keyUsed:t,isCollapsedByDefault:3===(0,M.getMenuBehaviorSettingFromSettings)(i),verboseUserSettingForCollapse:(0,M.stringifyDefaultMenuCollapseState)(i.defaultMenuCollapseState()),groupableStateMap:e})}),1e3))}));const m=this.listViewModel=new u.ViewModel(this._ltm,h.Extensions.Selectable|h.Extensions.Groupable|h.Extensions.ContextMenu,{ariaLabel:this.ariaLabel,groupable:{groupKey:ko.observable("group"),order:ko.observable(h.GroupOrder.Collection),headerTsxFn:r.menuGroupHeader,searchState:ko.observable(0),selectedGroup:ko.observable(),collapseStatusMap:o,nonCollapsibleGroups:[{groupNameId:MsPortalFx.Assets.QuickAccessGroupId,value:MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess},{value:" "}],isCollapsedByDefault:3===(0,M.getMenuBehaviorSettingFromSettings)(i),collapseOrExpandAllListener:e=>{U("MenuCollapseOrExpandAllClick",e?"CollapseAll":"ExpandAll",{keyUsed:this.menuIdentificationKey()})},collapseOrExpandListener:(e,t)=>{U("MenuGroupCollapseOrExpand",t?"Collapse":"Expand",{keyUsed:this.menuIdentificationKey(),headerName:e,headerId:n.get(e)})}},selectable:{listRole:!0}},r.menuItem);m.outlineStyle(!1),m.extensionOptions.selectable.activateOnSelected=!0,this.listState=new c.WidgetUIState({vm:m,isTrusted:!0,sanitizationContext:e.sanitizationContext}),t.showSearch&&(this.searchBoxViewModel=a.create(this._ltm,{resultLimit:0,hideSuggestions:!0,update:e=>{this.queryString(e);let t=[];return e.trim()?(m.extensionOptions?.groupable?.searchState(1),t=function(e,t){let s=D(e=e.trim(),t);if(e.split(" ").length>1){const i=D(e,t,!0);s.push(...i),s.sort(((e,t)=>e.score-t.score)),s=MsPortalFx.unique(s,((e,t)=>MsPortalFx.areEqual(e.item.id,t.item.id)))}return s.map((e=>ko.unwrap(e.item.displayText)))}(e.toLowerCase(),m.items()),0===t.length?(this.searchMissCallbacks.fire({query:this.queryString()}),m.items().forEach((s=>{const i=ko.unwrap(s.displayText);ko.isObservable(s.metadata?.hidden)?s.metadata.hidden?.(!t.includes(i)):z(s,e,this.menuIdentificationKey())}))):m.items().forEach((s=>{const i=ko.unwrap(s.displayText);ko.isObservable(s.metadata?.hidden)?s.metadata.hidden?.(!t.includes(i)):z(s,e,this.menuIdentificationKey())}))):(m.items().forEach((t=>{ko.isObservable(t.metadata?.hidden)?t.metadata.hidden?.(!1):z(t,e,this.menuIdentificationKey())})),m.extensionOptions?.groupable?.searchState(0)),Promise.resolve(t)},submit:e=>(this.queryString(e),Promise.resolve(!0))}),this.searchBoxState=new d.WidgetUIState({diContainer:e.diContainer,vm:this.searchBoxViewModel}))}}t.WidgetUIState=L;t.InnerTsxComponent=r.MenuInner;class T extends s.Widget{constructor(e,t,s,i){super(e,t,s,i),this._overview=ko.observable(),this._callbacks=$.Callbacks(),this._noDefaultIdDeferred=Promise.withResolvers(),this._favoriteItems=ko.observableArray([]),this.selectedItemText=ko.observable(),t._msPortalFxData.storageKey.subscribeAndRun(this.ltm,(e=>{e?this.state.menuIdentificationKey(e):this.state.menuIdentificationKey(this._diContainer.get(g.CompositionProvenance).locator.getCacheFriendlyKeyPart())})),this._partContainer=e.parent(),e.addClass(_),MsPortalFx.isFeatureEnabled("useOldMenu")||e.addClass("fxc-collapsible-menu"),t.showSearch&&e.parents(".fxs-blade-content-wrapper").addClass("fxs-menu-show-search");const a=this.ltm;i.ariaLabel()||i.ariaLabel(e.closest(".fxs-blade").find(".fxs-blade-title-titleText").text());const{items:l,selectableMap:r,options:u}=this._data=t._msPortalFxData,m=this._data.menuDeepLink||ko.observable("");this.getResourceType=()=>(u.peek()||{}).resourceType;const p=ko.observableArray([]),f={};ko.explicitComputed(a,[l,this._overview],((e,t)=>{const s=this._overview(),i=[];s&&i.push(s),p(i.concat(e))})),m.subscribe(a,(e=>{e&&p().forEach((t=>{const s=t.id;f[s]((0,n.replaceMenuIdFromDeepLink)(e,s))}))}));const h=ko.observable(!1);this.state.favoriteMenuItemsListLength.subscribeAndRun(this.ltm,(e=>h(e>=7))),this._visibleItems=p.map(a,((e,t)=>{const s=t.id;if(!s)return k.warning("Menu item without an ID found in the menu items list.",1,{menuItem:t,menuId:this.state.menuIdentificationKey()}),null;ko.ignoreDependencies((()=>{if(!f[s]){const e=m();f[s]=ko.observable(e&&this._selectedItem&&(0,n.replaceMenuIdFromDeepLink)(e,s)||"#")}}));const i=MsPortalFx.extend({metadata:{},url:f[s]},t);return!i.metadata.disabled&&(i.metadata.disabled=ko.observable(!1)),i.metadata.hidden=ko.observable(!1),i.enabled?.subscribeAndRun(e,(e=>i.metadata.disabled(!e))),i})).filter(a,(e=>e&&(!e.visible||e.visible())));const x=this.state.listViewModel;if(MsPortalFx.isFeatureEnabled("useOldMenu"))this._visibleItems.subscribeAndRun(a,x.items);else{const e=[];ko.computed(this.ltm,this.state.menuIdentificationKey,(t=>{const s=G(t);U("FavoritesStorage","WillStartFetch",{keyUsed:s}),this._diContainer.get(v.SettingsManager).querySetting(8,s).then((t=>{if(t?.storedFavorites){e.push(this._visibleItems.subscribeAndRun(this.ltm,(e=>{this._favoriteItems(t.storedFavorites.map((t=>{const i=e.find(K(t));if(i)return U("FavoritesMatching","MatchFound",{favoriteId:t.id,keyUsed:s}),this.state.unmatchedFavoriteItems.remove(t.id),{...i,group:I.Menu.favorites,groupId:E};U("FavoritesMatching","MatchNotFound",{favoriteId:t.id,keyUsed:s}),this.state.unmatchedFavoriteItems.indexOf(t.id)<0&&this.state.unmatchedFavoriteItems.push(t.id);return{id:t.id,aggregatedKeywords:"",displayText:t.displayText??t.id,group:I.Menu.favorites,groupId:E,icon:b.Images.Blank(),enabled:ko.observable(!1),supplyBladeReference:()=>new FxImpl.Composition.Selectable.PdlBladeReference("",""),metadata:{disabled:ko.observable(!0)},url:ko.observable("#")}})))})));const i=new Date;i.setMonth(i.getMonth()-1),new Date(t.lastModified)<i&&this.updateSavedFavoriteItems(t.storedFavorites).then((()=>{U("FavoritesStorage","FavoritesSaved",{favorites:t.storedFavorites.map((e=>e.id)),keyUsed:s,isRefresh:!0})})).catch((e=>{k.error(new Error("Request to refresh a one month old record of Favorites failed"),void 0,{data:e})}))}})).catch((e=>{k.error(new Error("FavoritesFetchedFailed, request to fetch list of Favorites from server failed"),void 0,{data:e})}))})),ko.computed(a,(()=>{const e=x.extensionOptions?.groupable?.nonCollapsibleGroups??[],t=this._visibleItems().reduce(((t,s,i)=>e.some((e=>void 0!==e.groupNameId&&e.groupNameId===s.groupId||e.value===s.group))?i:t),-1);x.items([...this._visibleItems().slice(0,t+1),...this._favoriteItems(),...this._visibleItems().slice(t+1)])}))}e.on("click",".fxc-menu-favoriteicon",(e=>{if(e?.currentTarget instanceof HTMLElement){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t=e.currentTarget.dataset?.itemid;t&&this.toggleFavoriteItemFromId(t)}})),e.on("keydown",(e=>{if("F"===e.key&&(e.ctrlKey||e.metaKey)&&e.shiftKey){const e=document.activeElement.querySelector(".fxc-menu-favoriteicon");e instanceof HTMLElement&&void 0!==e.dataset.itemid&&this.toggleFavoriteItemFromId(e.dataset.itemid)}}));const M=x.extensionOptions.selectable.selectedItem,w=new C.CancelationToken;M.subscribe(a,(e=>{this.resetStartupLifetimeManager(),w.cancel();const t=this._overview();let s;if(e){let i;this._selectedTab?.menuId===e.id?i=r()[this._selectedTab.tabMenuId]:(this._selectedTab=null,i=r()[e.id]);const a=S(this._diContainer,i);if(!a.isSelected()){this._clickSelectable(e,a);const i=this._selectedItem;this._selectedItem=e;const o=a.isSelected.subscribe(a.createChildLifetime(),(n=>{a.isCanceled&&i&&r()[i.id]&&(x.extensionOptions.selectable.selectedItem(i),this._selectedItem=i,s=(t&&t.id)===i.id?null:ko.unwrap(i.displayText)),e===x.extensionOptions.selectable.selectedItem()&&x.extensionOptions.selectable.selectedItem(null),o.dispose()}))}s=(t&&t.id)===e.id?null:ko.unwrap(e.displayText)}this.selectedItemText(s)})),M.subscribe(a,(e=>{x.extensionOptions.groupable?.selectedGroup?.(e?.group)})),e.on("click",".fxc-menu-item",(e=>{if(o.isCtrlOrCommandOnly(e)||e.shiftKey)return!0;e.preventDefault()})),this._favoriteItems.subscribe(a,(e=>{this.updateFavoriteItemsStorage(e)})),e.trigger("fxregistermenu",this);const y={weaveContext:this.weaveContext};this.ltm.registerForDispose(new c.Widget(e.find(".fxc-menu-grid"),x,y,this.state.listState)),this.state.searchBoxViewModel&&this.ltm.registerForDispose(new d.Widget(e.find(".fxc-menu-search"),this.state.searchBoxViewModel,y,this.state.searchBoxState)),this._favoriteItems.subscribeAndRun(this.ltm,(e=>{this.state.favoriteMenuItemsListLength(e.length),this.state.favoriteItems(e.map((e=>e.id)))})),this.getTelemetryInfo=()=>{const e=u.peek()||{},t={itemCount:this._visibleItems.peek().length};return MsPortalFx.extendStringMapIntoMap(t,e,((e,t)=>MsPortalFx.isPrimitive(e)?e:void 0),!0),t}}onItemClick(e){this._callbacks.add(e)}onSearchMiss(e){this.state.searchMissCallbacks.add(e)}resetStartupLifetimeManager(){this._startupLifetimeManager&&this._startupLifetimeManager.dispose()}saveFavoriteItem(e){e.metadata?.disabled()||(this._favoriteItems().find(K(e))?k.warning(`Menu item to be favorited is already in Favorites list, ${ko.unwrap(e.displayText)}, ID: ${e.id}`):this._favoriteItems().length>=7?(k.warning(`Favorites list is full with 7 items, cannot add new item ${ko.unwrap(e.displayText)}, ID: ${e.id}.`),U("FavoriteUserActions","FavoriteItemLimitHit",{itemId:e.id,keyUsed:G(this.state.menuIdentificationKey())})):e.groupId===MsPortalFx.Assets.QuickAccessGroupId?k.warning(`Cannot add QuickAccess items to Favorites list, trying to add ${ko.unwrap(e.displayText)}, ID: ${e.id}.`):(this._favoriteItems.push({...e,groupId:E,group:I.Menu.favorites}),U("FavoriteUserActions","FavoriteItemAdded",{itemId:e.id,keyUsed:G(this.state.menuIdentificationKey())})))}removeFavoriteItem(e){this._favoriteItems().find(K(e))?(this._favoriteItems.remove(K(e)),U("FavoriteUserActions","FavoriteItemRemoved",{itemId:e.id,keyUsed:G(this.state.menuIdentificationKey())})):k.warning(`Menu item to be unfavorited is not found in Favorites list, ${ko.unwrap(e.displayText)}, ID: ${e.id}`)}updateFavoriteItemsStorage(e){const t=e.map((e=>e.id));return this.updateSavedFavoriteItems(e).then((()=>{U("FavoritesStorage","FavoritesSaved",{favorites:t,keyUsed:G(this.state.menuIdentificationKey()),isRefresh:!1})})).catch((e=>{k.error("Failed to update Favorites storage",void 0,{data:e})}))}updateSavedFavoriteItems(e){return this._diContainer.getAsync(v.SettingsManager).then((t=>{const s=G(this.state.menuIdentificationKey()),i={storedFavorites:e.map((e=>({id:e.id,displayText:ko.unwrap(e.displayText)}))),lastModified:(new Date).toISOString()};return t.setSetting(8,s,i)}))}setDefaultId(e){const t=this.state.listViewModel,s=e.recommendedId,i=t.extensionOptions.selectable.selectedItem;i()&&i(null);const{selectableMap:a,options:o}=this._data;this.resetStartupLifetimeManager();const n=this._startupLifetimeManager=this.ltm.createChildLifetime(),l=ko.observable(),r=(e,s=!0)=>{s?t.extensionOptions.selectable.selectedItem(e):l()?t.extensionOptions.selectable.selectedItem(V(this._visibleItems(),l())):t.extensionOptions.selectable.selectedItem(MsPortalFx.first(this._visibleItems()))};ko.computed(n,[a,this._visibleItems,l],((t,i,a)=>{if(!t||!a)return;if(e.bladeReference&&t[s]){S(this._diContainer,t[s]).referenceOverride=e.bladeReference,e.bladeReference=null}const o=MsPortalFx.find(i,(e=>this._selectedItem&&e.id===this._selectedItem.id));(o?O(n,o,500,r):Promise.resolve(!1)).then((e=>{if(e||n.isDisposed())return;const s=V(i,a);if(s)B(s,a.toLowerCase())||(this._selectedTab={menuId:s.id,tabMenuId:a}),O(n,s,500,r);else if(t[a]){let e=!1;MsPortalFx.forEachKey(t,((s,a)=>{if(e)return;const o=S(this._diContainer,t[s]),l=MsPortalFx.find(i,(e=>e.id===s));l&&(!o.isSelected()||l.enabled&&!l.enabled()?ko.computed(n,[o.isSelected,l.enabled||ko.observable(!0)],((e,t)=>{e&&t&&(r(l),this.resetStartupLifetimeManager())})):(e=!0,r(l),w.nextTick((()=>this.resetStartupLifetimeManager()))))}))}else{const e=MsPortalFx.first(i);e&&O(n,e,-1,r)}}))}));const c=o.subscribe(n,(e=>{if(!e)return;const t=e.overview;let i=e.defaultId;t?(this._overview(MsPortalFx.extend2(t,{groupId:MsPortalFx.Assets.QuickAccessGroupId,group:MsPortalFx.Resources.Strings.Part.SettingList.Group.quickAccess,aggregatedKeywords:[t.displayText].concat(t.keywords).join(" ")})),i||(i=t.id)):this._overview(null),i=s||i,i?l(i):this._noDefaultIdDeferred.resolve()}));e.rebinding||c.callback(o())}hasMenuItem(e){const t=V(this._visibleItems(),e);return Promise.resolve(!!t)}switchItem(e,t,s){this._selectedTab=null;const i=s?this._favoriteItems():this._visibleItems(),a=V(i,e);let o=a;if(o||(o=MsPortalFx.first(i),t=void 0),o.tabItems&&(this._selectedTab={menuId:a.id,tabMenuId:e}),this._selectedItem?.id===e){S(this._diContainer,this._data.selectableMap()[a.id]).refresh()}if(t){const{selectableMap:s}=this._data,i=S(this._diContainer,s()[e]);i.referenceOverride=t,o&&this._clickSelectable(o,i)}o&&this.state.listViewModel.extensionOptions.selectable.selectedItem(o)}internalGetAndSelectItem(e){const t=V(this._visibleItems().filter((e=>e)),e);if(t&&this._selectedItem?.id===t.id&&t.tabItems){this._selectedTab={menuId:t.id,tabMenuId:e};const s=A(t,e);if(s){let t;return t=s.supplyBladeReference?Promise.resolve(s.supplyBladeReference()):(0,F.ensureAsyncMethodReturnsPromiseForBackCompat)(s.supplyBladeReferenceAsync,s),t.then((t=>Object.create(t,{menuId:{configurable:!0,enumerable:!0,value:e,writable:!0}})))}}return null}getSelectedItem(){if(this._selectedTab){return A(V(this._visibleItems(),this._selectedTab.menuId),this._selectedTab.tabMenuId)}return this._selectedItem}getPartContainer(){return this._partContainer}dispose(){this._cleanElement(_),super.dispose()}selectDefaultItem(){this.state.listViewModel.extensionOptions.selectable.selectedItem(this._visibleItems.peek()[0])}getDefaultItem(){return this._visibleItems.peek()[0]}_clickSelectable(e,t){t.onClick(),this._callbacks.fire(e.id,{query:this.state.queryString(),group:e.groupId,displayText:e.displayText})}toggleFavoriteItemFromId(e){const t=V(this._visibleItems(),e);if(this._favoriteItems().find(K(e))){const t=V(this._favoriteItems(),e);if(this._selectedItem?.groupId===E&&this._selectedItem?.id===e){const e=this._visibleItems().find(K(this._selectedItem));e?this.state.listViewModel.extensionOptions.selectable.selectedItem(e):this.selectDefaultItem()}this.removeFavoriteItem(t)}else this.saveFavoriteItem(t)}}function O(e,t,s,i){const a=Promise.withResolvers(),o=e.createChildLifetime();let n;return t.enabled?t.enabled.subscribeAndRun(o,(e=>{e&&a.resolve(!0)})):a.resolve(!0),-1!==s&&(n=setTimeout((()=>{a.resolve(!1)}),s)),a.promise.finally((()=>{n&&clearTimeout(n),o.dispose()})).then((e=>(i(t,e),e)))}function B(e,t){if(!e?.id||!t)return!1;const s=e.id.toLowerCase(),i=t.replace(/\s/g,"");return s===t||s===i}function V(e,t){const s=t?t.toLowerCase():"";return MsPortalFx.find(e,(e=>B(e,s)||!!A(e,s)))}function A(e,t){const s=t?t.toLowerCase():"";return MsPortalFx.find(e.tabItems||[],(e=>B(e,s)))}function D(e,t,s){const i=s?MsPortalFx.extend({matchAllTokens:!0},P):P;let a=new m(t,i).search(e);a=a.filter((e=>e.score<=i.threshold));return a.reduce(((e,t)=>(t.score<=i.threshold&&e.push(t),e)),[]).sort(((e,t)=>e.score-t.score))||[]}function G(e){return`${e}-favorites`}function R(e){return`${e}-collapseStatus`}t.Widget=T,T.flightNewRender=!0;const E=t.MenuFavoritesGroupId="favorites_group";function K(e){const t="string"==typeof e||"number"==typeof e?e:e.id;return e=>t===e.id}function z(e,t,s){k.warning(new y.FxError({message:`Metadata.hidden property is not defined or not an observable for: group "${e.group}", item "${ko.unwrap(e.displayText)}"`,errorLevel:1,data:{group:e.group,groupId:e.groupId,item:ko.unwrap(e.displayText),searchQuery:t,menuKey:s,typeofHidden:typeof e.metadata?.hidden}}))}function U(e,t,s){MsPortalFx.Base.Diagnostics.Telemetry.trace({source:"MenuBlade",action:e,actionModifier:String(t),data:s})}}));