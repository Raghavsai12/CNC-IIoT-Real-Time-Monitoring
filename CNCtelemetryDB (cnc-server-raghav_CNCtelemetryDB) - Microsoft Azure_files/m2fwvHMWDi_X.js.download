define("MsPortalImpl.Controls/Fields/Section.shim",["require","exports","Weave/DirectMode","FxInternal/WeaveControls/Section.Component.Internal","Weave","FxInternal/Weave","MsPortalImpl/Weave/Components","FxInternal/Weave/Components/PcControl","FxInternal"],(function(t,e,a,s,i,n,o,l,r){"use strict";e.isAmdViewModel=m,e.isHtmlContent=h,e.shimFxSectionVMToSectionInnerProps=c,e.tryWeaveSectionInnerContent=function(t){const e=t.vm;if(d&&m(e)&&1===e.style())return(0,s.SectionInner)(c(e,!1),void 0)};const d=MsPortalFx.isFeatureEnabled("weavesection");function c(e,s){const d=(0,n.toComputation)(e.dirty);return{name:s?null:(0,n.toComputation)(e.name).compose((e=>e?a(o.HtmlOrKo,{require:t,content:e}):null)),children:(0,n.toComputation)(e.children).composeArray(r.identity).cMap(n.toValueOrComputation).cMap((function(e){return a(i.Fragment,null,function(e){if(h(e))return a("div",{className:"fxt-tabs-inner"},a(o.Ko,{content:e,require:t}));if(e)return a(l.PcControl,{className:15===e.controlType?null:"fxc-section-control",vm:e,container:null})}(e),a(i.Aggregatable,{dirty:d}))})),disabled:(0,n.toComputation)(e.disabled),leftLabelPosition:!(!e.leftLabelPosition||!e.leftLabelPosition()),leftLabelWidth:e.leftLabelWidth&&e.leftLabelWidth(),smartAlignLabel:!!e.smartAlignLabel}}function h(t){return t&&t.htmlTemplate&&23!==t.controlType}function m(t){return!!t.leftLabelWidth||!!t.smartAlignLabel}})),
define("MsPortalImpl.Controls/Fields/Section",["require","exports","MsPortalImpl/TsxStringMode/Tsx","_generated/MsPortalImpl/Svg/Startup/Ellipsis.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Interactions/Interactions.DismissHandler","Viva.Controls/Util/Viva.TemplateEngine","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Base/Base.SvgHelper","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Base/Base.Timers","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Widgets/Widgets.Common","MsPortalImpl/Weave/Util","MsPortalImpl.Controls/Fields/Section.shim","FxInternal/Css","FxInternal/_generated/Less/WeaveControls/Section.Component.css","MsPortalImpl.Controls/Fields/Base/LabelAndBalloonWidget","Fx/Controls/Section"],(function(t,e,a,s,i,n,o,l,r,d,c,h,m,u,b,f,p,x,g,v){"use strict";e.Widget=e.Section=void 0,Object.defineProperty(e,"createVm",{enumerable:!0,get:function(){return v.create}}),e.tryWeaveInnerContent=void 0;var _=a,C=i;(0,p.injectCss)(x);var w=MsPortalFx.Base.Diagnostics.Telemetry;const y=window.document.implementation.createHTMLDocument(""),I="fxc-section",T="fxc-section-name",S="fxc-section-wrapper",M="fxc-section-row",F="fxc-section-column",P="fxc-section-dependent",B="fxc-section-tabs",W="fxc-section-control",L="fxc-section-singlecontrol",H="fxc-tabs-menu",O="fxc-tabs-menu-content",k="fxc-tabs-menu-open",A="fxc-section-tab-dirty",D="fxc-tab-required",E="fxc-tab-required-item",K="fxc-tab-invalid",N="fxc-tabs-itemslist",q="fxc-tabs-container",V="fxc-section-tab-item",U="fxc-section-tab-item-icon",z="fxc-tab-invalid-icon",R="msportalfx-form",j="msportalfx-form-regular",J="fxc-left-label-fixed",Q="fxc-smart-labels",G="msportalfx-tooltip-overflow",X="fxs-portal-border",Y=_.tsx(a.KoIf,{condition:"$parent.allowClosableTabs"},_.tsx("span",{class:U,"data-bind":{image:"MsPortalFx.Base.Images.Discard()"}})),Z=(t=!1)=>_.tsx(a.KoIf,{condition:"$data && $data.visible && $ko.unwrap($data.visible)"},_.tsx("div",{role:"tab",class:V,"data-bind":{attr:{id:`$ctl._tabUsedId($index(), ${t}, false)`,tabindex:`$ctl._focused($index(), ${t})`,"aria-controls":`$ctl._tabUsedId($index(), ${t}, true)`,"aria-selected":'$data.active() ? "true" : "false"',"aria-setsize":"$ctl._tabSetSize","aria-posinset":"$ctl._tabPosInSet($index())","aria-invalid":"!$data.valid()","aria-disabled":"$data.disabled","aria-describedby":"$data.required && $data.required() ? $ctl._requiredDescId : null"},css:{"azc-br-active fxs-portal-text":"$data.active()",[A]:"$data.dirty","fxc-tab-disabled azc-fill-disabled":"$data.disabled",[E]:"$data.required && $data.required() && !(!$data.valid() && $parent.showValidationStatusOnTabs && $parent.showValidationStatusOnTabs())"}}},_.tsx("span",{class:[O,G]},_.tsx(a.KoIf,{condition:"!$data.valid() && $parent.showValidationStatusOnTabs"},_.tsx("span",{title:g.errorLabel,"aria-label":g.errorLabel,role:"img",class:z,"data-bind":{image:`MsPortalFx.Base.Images.StatusBadge.Critical({customClass: "${g.errorSvgClass}",})`}})),_.tsx("span",{"data-bind":{untrustedContent:"$data.name"}}),Y),_.tsx("span",{"aria-hidden":"true",class:[O,G,"fxc-section-tab-placeholder"]},_.tsx(a.KoIf,{condition:"!$data.valid() && $parent.showValidationStatusOnTabs"},_.tsx("span",{title:g.errorLabel,"aria-label":g.errorLabel,role:"img",class:z,"data-bind":{image:`MsPortalFx.Base.Images.StatusBadge.Critical({customClass: "${g.errorSvgClass}",})`}})),_.tsx("span",{"data-bind":{untrustedContent:"$data.name"}}),Y))),tt=_.tsx(a.Root,null,_.tsx(a.KoIf,{condition:"$data.name"},_.tsx("div",{class:["fxc-section-legend azc-br-muted",T],"data-bind":{untrustedContent:"$data.name"}})),_.tsx(a.KoIf,{condition:"$data.style() === 4"},_.tsx("div",{class:[q,X]},_.tsx("div",{role:"tablist",class:[N,"fxc-tabs-headers"],"data-bind":{css:{[D]:"$data.showRequiredStatusOnTabs",[K]:"$data.showValidationStatusOnTabs"}}},_.tsx(a.KoForEach,{items:"$data.children"},Z())),_.tsx("div",{class:H},_.tsx("span",{tabindex:"0",role:"button","aria-expanded":"false",class:"fxs-portal-svg-secondary","data-bind":{attr:{"aria-label":"$ctl._menuBtnAriaLabel",title:"$ctl._menuBtnAriaLabel"}}},(0,r.getSvgReferenceOrFallBackToData)(s).outerHTML),_.tsx("div",{class:[N,"azc-bg-default","msportalfx-shadow-level2"]},_.tsx(a.KoForEach,{items:"$data.children"},Z(!0)))),_.tsx("label",{class:"fxs-hide-accessible-label","data-bind":{attr:{id:"$ctl._requiredDescId"}}},C.required)),_.tsx(a.KoForEach,{items:"$data.children"},_.tsx(a.KoIf,{condition:"$data"},_.tsx("div",{role:"tabpanel","data-bind":{pcControl:"$data.tabSection",visible:"visible() && active()",attr:{id:"$ctl._panelUsedId($index(), false)","aria-labelledby":"$ctl._panelUsedId($index(), true)"}}})))),_.tsx(a.KoIfNot,{condition:"$data.style() === 4"},_.tsx(a.KoForEach,{items:"$data.children"},_.tsx(a.KoIf,{condition:"$ctl._verifyHtmlContent($data)"},_.tsx("div",{class:"fxt-tabs-inner","data-bind":{untrustedContent:"$data"}})),_.tsx(a.KoIfNot,{condition:"$ctl._verifyHtmlContent($data)"},_.tsx(a.KoIf,{condition:"$ctl._verifyDynamicSection($data)"},_.tsx("div",{"data-bind":{pcControl:"$data",style:{width:"$ctl._applyWidth($data, $parent, $index())"}}})),_.tsx(a.KoIfNot,{condition:"$data && $ctl._verifyDynamicSection($data)"},_.tsx("div",{class:W,"data-bind":{pcControl:"$data"}})))))),et=_.tsx(a.KoTemplate,{options:"{ name: 'sectionTemplate', data: $data.data }"}),at=[M,F,B,S,P,X,L].join(" "),st={};st[3]=M,st[0]=F,st[4]=B,st[2]=S+" "+P+" "+X,st[6]=S+" "+L;const it="MouseClick",nt="KeyboardEvent",ot="OnLoad",lt="Programmatically";e.tryWeaveInnerContent=f.tryWeaveSectionInnerContent;class rt extends l.Widget{constructor(t,e,a){super(t,e,a),this._populateTimer=null,this._activeChangedByWidget=!1,this._hasColumn=ko.observable(!1),this._panelBaseId=MsPortalFx.getUniqueId(),this._tabBaseId=MsPortalFx.getUniqueId(),this._focusedTab=ko.observable(0),this._menuBtnAriaLabel=C.CommandBar.more,this._requiredDescId=MsPortalFx.getUniqueId(),this._setTabOverflowContent=this.weaveContext?null:(0,h.throttleByAnimationFrame)((()=>{const t=this.element.find(`.${H}`).outerWidth()||0,e=$(this.element.find(`.${q} > div.${N}`)[0]),a=e.find(`> .${V}`);let s=e.width()-t;s<=0&&(s=320);let i=0,n=0;if(this._tabHeaders=[],a.each(((t,e)=>{this._tabHeaders.push($(e));const a=this.options.children()[t];a&&a.active()&&(n=t)})),n>0){for(let t=n;t>=0;t--){const e=$(a[t]);i+=e.outerWidth(!0),e.toggleClass("fxc-section-tab-item-hidden",i>s)}n++}for(let t=n;t<a.length;t++){const e=$(a[t]);i+=e.outerWidth(!0),e.toggleClass("fxc-section-tab-item-hidden",i>s)}$(this.element.find(`.${H}`)[0]).toggleClass("fxc-tabs-menu-active",i>s)})),this._appliedWidthSubscription=new Map;const s=this.options,n=s.children,l=this.ltm,r=4===s.style();let b;s.disableStyles||t.addClass(I),(0,f.isAmdViewModel)(s)&&ko.unwrap(s.leftLabelWidth)&&t.addClass(R).addClass(j).addClass(J),this.weaveContext||(4===s.style()&&(this._tabSetSize=ko.computed(l,[s.children],(t=>t.length))),t.html(et),(this.templateEngine=new o.StringTemplateEngine).setTemplate("sectionTemplate",tt),this._bindDescendants()),t.find(`.${T}`).each(((t,e)=>{const a=`azc-form-guid-${MsPortalFx.getUniqueId()}`;e.id=a,$(e.parentElement).find(`.${W}`).each(((t,e)=>{$(e).attr("aria-labelledby",a),$(e).attr("role")||$(e).attr("role","group")}))}));const p=(0,h.throttleByAnimationFrame)((e=>{b!==e&&(b=e,b>480?t.addClass(j).addClass(J):t.removeClass(j).removeClass(J))}));if((0,f.isAmdViewModel)(s)&&s.smartAlignLabel&&(t.addClass(R).addClass(Q),p(this.element.width()),r||(0,m.track)(l,this.element.first(),(t=>{p(t)}))),r){const e=ko.contextFor(t[0]),a=e&&e.$partName;this._extensionName=e&&e.$extensionName,this._extensionName&&(this._telemetrySource=["Extension",this._extensionName,"Blade",a].join("/"));const o=s.telemetrySource;o&&(this._extensionName=o.extension,this._telemetrySource=o.source);const r=n;let d;if(!this.weaveContext){$(window).setEvents(["resize",()=>{this._toggleMenu(!1)}]);let t=MsPortalFx.find(r(),(t=>t&&ko.unwrap(t.active)));if(!t){const e=r()[0];e&&e.active&&(t=e)}t&&this._tabActivated(t,this.options,ot),s._msPortalFxSetFocusOnTab&&s._msPortalFxSetFocusOnTab.subscribeAndRun(l,(t=>{if(!MsPortalFx.isNullOrUndefined(t)){const e=this.element.closest(".fxs-blade");if(e.find(":focus").length||e[0]===document.activeElement){const e=this._tabSetSize();if(e&&t>-1&&t<=e){const a=dt(t,0,e-1);this._focusedTab(a),setTimeout((()=>{this._tabHeaders&&this._tabHeaders[a]&&this._tabHeaders[a].focus()}),50)}}}})),r.map(l,((t,e)=>{e&&15===e.controlType&&e.active.subscribe(t,(t=>{t&&!this._activeChangedByWidget&&(this._activeChangedByWidget=!0,this._tabActivated(e,this.options,lt),this._activeChangedByWidget=!1)}))}))}const c=this.weaveContext?null:()=>{r().forEach((t=>{if(t&&15===t.controlType){const e=t.tabHasBeenLoaded;t.populateSection(),e&&!e()&&this._tabSelected(t)}}))};if(!this.weaveContext){d=!1;const t=s.showRequiredStatusOnTabs,e=s.showValidationStatusOnTabs;(t||e)&&ko.reactor(l,[t,e],(()=>{d=t()||e(),d&&c()})),this._populateTimer=setTimeout((()=>{c(),this._setTabOverflowContent()}),3e3)}if((0,m.track)(l,this.element.first(),(t=>{this.weaveContext||this._setTabOverflowContent(),(0,f.isAmdViewModel)(s)&&s.smartAlignLabel&&p(t)})),!this.weaveContext){r.subscribeAndRun(l,(()=>{this._setTabOverflowContent(),d&&c()}));const t=t=>{const e=$(t.currentTarget),a=parseInt(e.attr("aria-posinset")||e.parent().parent().attr("aria-posinset"))-1,n=ko.contextFor(t.currentTarget).$parent,o=n.children();if(ko.unwrap(this.vm.alertOnClose)&&o[a]&&o[a].dirty&&o[a].dirty()&&!window.confirm(i.Desktop.confirmEditScopeDiscard))return;const l=o[a]&&o[a].active&&o[a].active();this._tabHeaders&&this._tabHeaders.length&&this._tabHeaders.splice(a,1),o.splice(a,1),n.children(o);const r=this._tabHeaders&&this._tabHeaders.length;if(r){let t=0;a>r-1&&(t=r-1);const e=s.children()[t];e&&(l&&e.active(!0),this._tabHeaders[t].focus())}},e=(t,e)=>{if($(t.target).parents(".fxc-tabs-menu").length){const t=$(document.activeElement);e?t.prev().focus():t.next().focus()}else{const a=this._tabHeaders,s=dt(this._focusedTab()-(e?1:-1),0,this._tabSetSize()-1);if($(a[s]).is(":visible")){t.stopPropagation();const e=this._tabHeaders;this._focusedTab(s),e[s].focus()}}},a=`.${H} span[role=button]`;this.ltm.registerForDispose(this.element.setEvents(["click",`.${V}`,t=>{const e=ko.contextFor(t.currentTarget);this._tabActivated(e.$data,e.$parent,it)}],["click",`.${U}`,e=>(t(e),!1)],["keydown",`.${V}`,a=>{switch(a.which){case 13:{a.stopPropagation();const t=ko.contextFor(a.target);this._tabActivated(t.$data,t.$parent,nt);break}case 37:case 38:return e(a,!0),!1;case 39:case 40:return e(a),!1;case 46:return ko.unwrap(s.allowClosableTabs)&&t(a),!1}}],["click",a,t=>{this._toggleMenu(),t.stopPropagation()}],["keydown",a,t=>{13!==t.which&&32!==t.which&&40!==t.which||(this._toggleMenu(),t.stopPropagation())}],["keydown",`.${H}`,t=>{27===t.which&&(this._toggleMenu(!1),this.element.find(a).focus(),t.stopPropagation())}]))}}s.valid.subscribe(l,(e=>t.toggleClass("fxc-section-invalid",!e))),s.dirty.subscribe(l,(e=>t.toggleClass("fxc-section-dirty",e))),s.minHeight&&t.css("min-height",`${s.minHeight}px`),this.weaveContext||(this.ltm.registerForDispose(this.element.setEvents(["keydown",t=>{if(13===t.which){const a=e.submit();if(a)return t.stopPropagation(),a().then((t=>{}))}}])),n.subscribeAndRun(l,(e=>{c.isChrome&&(0,u.waitForBindings)(t[0]).finally((()=>{if(t.is((0,d.getUnhideSelector)())){const e=t.find("> .fxc-left-label");e.length>1&&(e.removeClass("fxc-left-label"),setTimeout((()=>{e.addClass("fxc-left-label")})))}})),this._hasColumn(3===s.style()&&e.some((t=>t.style&&0===t.style())))}))),ko.computed(l,[s.style,this._hasColumn],((e,a)=>{if(!s.disableStyles){let s=a||3!==e?st[e]:S;s=s||S,t.removeClass(at).addClass(s),s===M&&t.attr("role","presentation")}}))}dispose(){const t=this.options;if(this._cleanElement(I,at,t.cssClass(),R,j,J,Q||""),t.minHeight&&this.element.css("min-height",""),!this.weaveContext){const t=this._populateTimer;null!==t&&clearTimeout(t),this._populateTimer=null}super.dispose()}get options(){return this._options}_applyWidth(t,e,a){let s;if((0===t.style()||t.width&&t.width())&&4!==e.style()){let i=0,n=0;const o=e.children(),l=this._appliedWidthSubscription;o.forEach((function(t){const e=ko.unwrap(t.width);e&&(n++,i+=e)})),s=i>100?1:t.width()?o[a].width():(100-i)/(e.children().length-n),l.get(t)||l.set(t,this.options.width.subscribe(this.ltm,(s=>{this.element.attr("width",this._applyWidth(t,e,a))})))}return s?s+"%":""}_getTelemetryName(t){const e=ko.unwrap(t.telemetryName);if(e)return e;let a=ko.unwrap(t.name);return(0,f.isHtmlContent)(a)?(a=a.htmlTemplate,$($.parseHTML(a,y)).text()):a}_tabActivated(t,e,a){if(this.weaveContext)throw new Error("_tabActivated shouldn't be called in Weave mode");if(t.disabled()&&!this._activeChangedByWidget)return;let s=this._tabActivateChildLifetime;s&&s.dispose(),s=this._tabActivateChildLifetime=this.ltm.createChildLifetime();const i=ko.unwrap(e.children),n=MsPortalFx.findIndex(i,(e=>e===t));if(this._lastTabOpened){const t=new Date,e=t.getTime()-this._lastTabOpened.getTime();this._lastTabOpened=t,w.trace({action:"TabClosed",extension:this._extensionName,source:this._telemetrySource,duration:e,name:this._getTelemetryName(this._currentActiveTab),data:{index:MsPortalFx.findIndex(i,(t=>t&&t.active&&t.active()))}})}else this._lastTabOpened=new Date;t.active()?this.element.scrollTop(0):(this._activeChangedByWidget=!0,t.active(!0),this._activeChangedByWidget=!1),this._currentActiveTab=t,w.trace({action:"TabOpened",extension:this._extensionName,source:this._telemetrySource,name:this._getTelemetryName(t),actionModifier:a,data:{index:n}}),e.children.map(s,((e,a)=>{a!==t&&a&&a.active(!1)})),!t.tabHasBeenLoaded()&&this._tabSelected(t),this._toggleMenu(!1),this.element.find(".azc-br-active").is(":visible")||this._setTabOverflowContent(),this._focusedTab(n)}_tabSelected(t){if(this.weaveContext)throw new Error("_tabSelected shouldn't be called in Weave mode");t.tabHasBeenLoaded(!0);const e=t.populateSection();"function"==typeof e?e().then(t.tabSection):t.tabSection(t)}_toggleMenu(t){if(this.weaveContext)throw new Error("_toggleMenu shouldn't be called in Weave mode");const e=$(this.element.find(`.${H}`)[0]);"boolean"!=typeof t&&(t=!e.hasClass(k)),e.toggleClass(k,t).find("[role=button]").attr("aria-expanded",t);const a=t=>!!$(t).parents(".fxc-tabs-menu-open").length&&0,s={dismissFn:()=>{this._toggleMenu(!1)},shouldDismissOnFocusOutFn:a,shouldDismissOnMouseDownFn:a,shouldDismissOnMouseWheelFn:a,shouldDismissOnScroll:!1,logName:"tab menu"};if(t){if($(e.find(".fxc-section-tab-item")[0]).focus(),!this._dismissHandleLifetime||this._dismissHandleLifetime.isDisposed()){(0,n.dismissByLogName)("tab menu"),(0,n.register)(s);(this._dismissHandleLifetime=this.ltm.createChildLifetime()).registerForDispose((()=>{(0,n.unregister)(s)}))}}else this._dismissHandleLifetime&&(this._dismissHandleLifetime.dispose(),this._dismissHandleLifetime=null)}_panelUsedId(t,e){return(e?this._tabBaseId:this._panelBaseId)+t}_tabUsedId(t,e,a){const s=a?this._panelBaseId:this._tabBaseId,i=this.options.children().length;return e?s+(t+i):t<i?s+t:null}_tabPosInSet(t){return t+1}_verifyDynamicSection(t){return t&&15===t.controlType}_verifyHtmlContent(t){return(0,f.isHtmlContent)(t)}_focused(t,e){return t!==this._focusedTab()||e?"-1":"0"}}e.Widget=rt,rt.flightNewRender=!0;e.Section=(0,b.createControlComponentForKO)({widgetCtor:rt});function dt(t,e,a){return Math.min(Math.max(t,e),a)}}));