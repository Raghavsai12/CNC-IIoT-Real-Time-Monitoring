/*!
 * Fuse.js v3.4.4 - Lightweight fuzzy-search (http://fusejs.io)
 * 
 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
 * All Rights Reserved. Apache Software License 2.0
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?
define("fuse",[],t):"object"==typeof exports?exports.Fuse=t():e.Fuse=t()}(this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t){e.exports=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,i){function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var a=i(2),o=i(8),n=i(0),l=function(){function e(t,i){var s=i.location,r=void 0===s?0:s,a=i.distance,n=void 0===a?100:a,l=i.threshold,c=void 0===l?.6:l,d=i.maxPatternLength,u=void 0===d?32:d,p=i.caseSensitive,f=void 0!==p&&p,h=i.tokenSeparator,g=void 0===h?/ +/g:h,y=i.findAllMatches,m=void 0!==y&&y,b=i.minMatchCharLength,v=void 0===b?1:b,x=i.id,w=void 0===x?null:x,C=i.keys,S=void 0===C?[]:C,k=i.shouldSort,F=void 0===k||k,I=i.getFn,M=void 0===I?o:I,T=i.sortFn,_=void 0===T?function(e,t){return e.score-t.score}:T,A=i.tokenize,P=void 0!==A&&A,L=i.matchAllTokens,B=void 0!==L&&L,D=i.includeMatches,R=void 0!==D&&D,N=i.includeScore,H=void 0!==N&&N,E=i.verbose,$=void 0!==E&&E;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:n,threshold:c,maxPatternLength:u,isCaseSensitive:f,tokenSeparator:g,findAllMatches:m,minMatchCharLength:v,id:w,keys:S,includeMatches:R,includeScore:H,shouldSort:F,getFn:M,sortFn:_,verbose:$,tokenize:P,matchAllTokens:B},this.setCollection(t)}var t,i;return t=e,(i=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var i=this._prepareSearchers(e),s=i.tokenSearchers,r=i.fullSearcher,a=this._search(s,r),o=a.weights,n=a.results;return this._computeScore(o,n),this.options.shouldSort&&this._sort(n),t.limit&&"number"==typeof t.limit&&(n=n.slice(0,t.limit)),this._format(n)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var i=e.split(this.options.tokenSeparator),s=0,r=i.length;s<r;s+=1)t.push(new a(i[s],this.options));return{tokenSearchers:t,fullSearcher:new a(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,i=this.list,s={},r=[];if("string"==typeof i[0]){for(var a=0,o=i.length;a<o;a+=1)this._analyze({key:"",value:i[a],record:a,index:a},{resultMap:s,results:r,tokenSearchers:e,fullSearcher:t});return{weights:null,results:r}}for(var n={},l=0,c=i.length;l<c;l+=1)for(var d=i[l],u=0,p=this.options.keys.length;u<p;u+=1){var f=this.options.keys[u];if("string"!=typeof f){if(n[f.name]={weight:1-f.weight||1},f.weight<=0||f.weight>1)throw new Error("Key weight has to be > 0 and <= 1");f=f.name}else n[f]={weight:1};this._analyze({key:f,value:this.options.getFn(d,f),record:d,index:l},{resultMap:s,results:r,tokenSearchers:e,fullSearcher:t})}return{weights:n,results:r}}},{key:"_analyze",value:function(e,t){var i=e.key,s=e.arrayIndex,r=void 0===s?-1:s,a=e.value,o=e.record,l=e.index,c=t.tokenSearchers,d=void 0===c?[]:c,u=t.fullSearcher,p=void 0===u?[]:u,f=t.resultMap,h=void 0===f?{}:f,g=t.results,y=void 0===g?[]:g;if(null!=a){var m=!1,b=-1,v=0;if("string"==typeof a){this._log("\nKey: ".concat(""===i?"-":i));var x=p.search(a);if(this._log('Full text: "'.concat(a,'", score: ').concat(x.score)),this.options.tokenize){for(var w=a.split(this.options.tokenSeparator),C=[],S=0;S<d.length;S+=1){var k=d[S];this._log('\nPattern: "'.concat(k.pattern,'"'));for(var F=!1,I=0;I<w.length;I+=1){var M=w[I],T=k.search(M),_={};T.isMatch?(_[M]=T.score,m=!0,F=!0,C.push(T.score)):(_[M]=1,this.options.matchAllTokens||C.push(1)),this._log('Token: "'.concat(M,'", score: ').concat(_[M]))}F&&(v+=1)}b=C[0];for(var A=C.length,P=1;P<A;P+=1)b+=C[P];b/=A,this._log("Token score average:",b)}var L=x.score;b>-1&&(L=(L+b)/2),this._log("Score average:",L);var B=!this.options.tokenize||!this.options.matchAllTokens||v>=d.length;if(this._log("\nCheck Matches: ".concat(B)),(m||x.isMatch)&&B){var D=h[l];D?D.output.push({key:i,arrayIndex:r,value:a,score:L,matchedIndices:x.matchedIndices}):(h[l]={item:o,output:[{key:i,arrayIndex:r,value:a,score:L,matchedIndices:x.matchedIndices}]},y.push(h[l]))}}else if(n(a))for(var R=0,N=a.length;R<N;R+=1)this._analyze({key:i,arrayIndex:R,value:a[R],record:o,index:l},{resultMap:h,results:y,tokenSearchers:d,fullSearcher:p})}}},{key:"_computeScore",value:function(e,t){this._log("\n\nComputing score:\n");for(var i=0,s=t.length;i<s;i+=1){for(var r=t[i].output,a=r.length,o=1,n=1,l=0;l<a;l+=1){var c=e?e[r[l].key].weight:1,d=(1===c?r[l].score:r[l].score||.001)*c;1!==c?n=Math.min(n,d):(r[l].nScore=d,o*=d)}t[i].score=1===n?o:n,this._log(t[i])}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var i=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===s(t)&&null!==t){if(-1!==i.indexOf(t))return;i.push(t)}return t}))),i=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var i=e.output;t.matches=[];for(var s=0,r=i.length;s<r;s+=1){var a=i[s];if(0!==a.matchedIndices.length){var o={indices:a.matchedIndices,value:a.value};a.key&&(o.key=a.key),a.hasOwnProperty("arrayIndex")&&a.arrayIndex>-1&&(o.arrayIndex=a.arrayIndex),t.matches.push(o)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var a=0,o=e.length;a<o;a+=1){var n=e[a];if(this.options.id&&(n.item=this.options.getFn(n.item,this.options.id)[0]),r.length){for(var l={item:n.item},c=0,d=r.length;c<d;c+=1)r[c](n,l);t.push(l)}else t.push(n.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(t.prototype,i),e}();e.exports=l},function(e,t,i){function s(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var r=i(3),a=i(4),o=i(7),n=function(){function e(t,i){var s=i.location,r=void 0===s?0:s,a=i.distance,n=void 0===a?100:a,l=i.threshold,c=void 0===l?.6:l,d=i.maxPatternLength,u=void 0===d?32:d,p=i.isCaseSensitive,f=void 0!==p&&p,h=i.tokenSeparator,g=void 0===h?/ +/g:h,y=i.findAllMatches,m=void 0!==y&&y,b=i.minMatchCharLength,v=void 0===b?1:b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:n,threshold:c,maxPatternLength:u,isCaseSensitive:f,tokenSeparator:g,findAllMatches:m,minMatchCharLength:v},this.pattern=this.options.isCaseSensitive?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=o(this.pattern))}var t,i;return t=e,(i=[{key:"search",value:function(e){if(this.options.isCaseSensitive||(e=e.toLowerCase()),this.pattern===e)return{isMatch:!0,score:0,matchedIndices:[[0,e.length-1]]};var t=this.options,i=t.maxPatternLength,s=t.tokenSeparator;if(this.pattern.length>i)return r(e,this.pattern,s);var o=this.options,n=o.location,l=o.distance,c=o.threshold,d=o.findAllMatches,u=o.minMatchCharLength;return a(e,this.pattern,this.patternAlphabet,{location:n,distance:l,threshold:c,findAllMatches:d,minMatchCharLength:u})}}])&&s(t.prototype,i),e}();e.exports=n},function(e,t){var i=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(i,"\\$&").replace(s,"|")),a=e.match(r),o=!!a,n=[];if(o)for(var l=0,c=a.length;l<c;l+=1){var d=a[l];n.push([e.indexOf(d),d.length-1])}return{score:o?.5:1,isMatch:o,matchedIndices:n}}},function(e,t,i){var s=i(5),r=i(6);e.exports=function(e,t,i,a){for(var o=a.location,n=void 0===o?0:o,l=a.distance,c=void 0===l?100:l,d=a.threshold,u=void 0===d?.6:d,p=a.findAllMatches,f=void 0!==p&&p,h=a.minMatchCharLength,g=void 0===h?1:h,y=n,m=e.length,b=u,v=e.indexOf(t,y),x=t.length,w=[],C=0;C<m;C+=1)w[C]=0;if(-1!==v){var S=s(t,{errors:0,currentLocation:v,expectedLocation:y,distance:c});if(b=Math.min(S,b),-1!==(v=e.lastIndexOf(t,y+x))){var k=s(t,{errors:0,currentLocation:v,expectedLocation:y,distance:c});b=Math.min(k,b)}}v=-1;for(var F=[],I=1,M=x+m,T=1<<x-1,_=0;_<x;_+=1){for(var A=0,P=M;A<P;)s(t,{errors:_,currentLocation:y+P,expectedLocation:y,distance:c})<=b?A=P:M=P,P=Math.floor((M-A)/2+A);M=P;var L=Math.max(1,y-P+1),B=f?m:Math.min(y+P,m)+x,D=Array(B+2);D[B+1]=(1<<_)-1;for(var R=B;R>=L;R-=1){var N=R-1,H=i[e.charAt(N)];if(H&&(w[N]=1),D[R]=(D[R+1]<<1|1)&H,0!==_&&(D[R]|=(F[R+1]|F[R])<<1|1|F[R+1]),D[R]&T&&(I=s(t,{errors:_,currentLocation:N,expectedLocation:y,distance:c}))<=b){if(b=I,(v=N)<=y)break;L=Math.max(1,2*y-v)}}if(s(t,{errors:_+1,currentLocation:y,expectedLocation:y,distance:c})>b)break;F=D}return{isMatch:v>=0,score:0===I?.001:I,matchedIndices:r(w,g)}}},function(e,t){e.exports=function(e,t){var i=t.errors,s=void 0===i?0:i,r=t.currentLocation,a=void 0===r?0:r,o=t.expectedLocation,n=void 0===o?0:o,l=t.distance,c=void 0===l?100:l,d=s/e.length,u=Math.abs(n-a);return c?d+u/c:u?1:d}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=[],s=-1,r=-1,a=0,o=e.length;a<o;a+=1){var n=e[a];n&&-1===s?s=a:n||-1===s||((r=a-1)-s+1>=t&&i.push([s,r]),s=-1)}return e[a-1]&&a-s>=t&&i.push([s,a-1]),i}},function(e,t){e.exports=function(e){for(var t={},i=e.length,s=0;s<i;s+=1)t[e.charAt(s)]=0;for(var r=0;r<i;r+=1)t[e.charAt(r)]|=1<<i-r-1;return t}},function(e,t,i){var s=i(0);e.exports=function(e,t){return function e(t,i,r){if(i){var a=i.indexOf("."),o=i,n=null;-1!==a&&(o=i.slice(0,a),n=i.slice(a+1));var l=t[o];if(null!=l)if(n||"string"!=typeof l&&"number"!=typeof l)if(s(l))for(var c=0,d=l.length;c<d;c+=1)e(l[c],n,r);else n&&e(l,n,r);else r.push(l.toString())}else r.push(t);return r}(e,t,[])}}])})),
define("MsPortalImpl/UI/Hubs/UI.FavoritesManagerDeferred",["require","exports","Fx/DependencyInjection","MsPortalImpl/Services/Services.AssetTypes","MsPortalImpl/Services/Services.BrowseCuration","MsPortalImpl/UI/Hubs/UI.BrowseManager","MsPortalImpl/UI/Hubs/UI.FavoritesManager","fuse","Fx/Controls/Toolbar","MsPortalImpl/Services/Services.Recents","FxHubs/ResourceManagement","MsPortalImpl/Resources/ImplScriptResources","Fx","FxHubs/ArtHelpers/ArgBrowseHelpers","Fx/Composition/Selectable","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/Base/Base.Router","FxInternal","MsPortalImpl/Services/Services.ServiceHubsManager","MsPortalImpl/UI/Hubs/UI.ServiceHubs","MsPortalImpl/UI/Hubs/UI.PortalServices","Fx/Experimentation"],(function(e,t,i,s,r,a,o,n,l,c,d,u,p,f,h,g,y,m,b,v,x,w){"use strict";t.FavoritesManagerDeferred=void 0,t.getFavoriteTypeDescription=function(e){let t;if(e.serviceHub)t=e.serviceHub.serviceMenuManifest.description;else if(e.portalService)t=e.portalService.portalServiceManifest.description;else{const i=$(e);t=i?.description}return t},t.getServiceCreateLink=function(e){if(!e?.assetType)return{createLink:null,createBladeReference:null};const t=$(e);let i,s;t?.marketplaceItemId?i=`#create/${t.marketplaceItemId}`:t?.noPdlCreateBlade&&(s=t.claimedMarketplaceIds?new h.ProvisioningBladeReference("",e.assetType.extension,{extensionName:e.assetType.extension,assetType:t.name,marketplaceId:void 0}):new h.ProvisioningBladeReference(t.noPdlCreateBlade,t.noPdlCreateExtension||e.assetType.extension));return{createLink:i,createBladeReference:s}},t.promoteSearchResults=N,t.tokenFavoritesPerCategory=t.tokenFavorites=void 0;var C=MsPortalFx.Base,S=C.Constants.AssetNames,k=FxImpl.Assets,F=C.Diagnostics,I=F.Telemetry,M=l.ToolbarItems.createBasicButton;function T(e,t){return(e.item.isPartner?1:0)-(t.item.isPartner?1:0)}F.createLog(e);const _=/\s+/g,A=MsPortalFx.find,P=MsPortalFx.stableSort;t.tokenFavorites=void 0,t.tokenFavoritesPerCategory=void 0;const L={shouldSort:!0,includeScore:!0,includeMatches:!0,tokenize:!0,threshold:.3,location:0,distance:100,maxPatternLength:32,minMatchCharLength:2,keys:[{name:"label",weight:.9},{name:"keywords",weight:.3},{name:"resourceType",weight:.1},{name:"includes",weight:.5}]},B=MsPortalFx.extend({matchAllTokens:!0},L);function D(e,t,i){return t===S.BrowseResourceGroupBlade&&(t=S.ResourceGroups),k.getAssetTypeOrResourceTypeIdByWindowId(e,t)+(i?"."+i.toLowerCase():"")}function R(e,t,i){return e&&("AllServices"===t&&i.portalService.showInAllServices||"GlobalSearch"===t&&i.portalService.showInGlobalSearch)}function N(e,t,i){const s=t.toLocaleLowerCase(),r=[],a=[];e.forEach((e=>{(e.item.serviceHub?.serviceMenuManifest.display||e.item.portalService?.portalServiceManifest.display||e.item.assetType?.compositeDisplayName.service||"").toLocaleLowerCase().startsWith(s)?r.push(e):a.push(e)}));let o=[...r,...a];switch(i){case"rankmatch":{const e=[],t=[];o.forEach((i=>{(i.item.serviceHub?.serviceMenuManifest.display||i.item.portalService?.portalServiceManifest.display||i.item.assetType?.compositeDisplayName.service||"").toLocaleLowerCase().includes(s)?e.push(i):t.push(i)})),e.sort(T),o=[...e,...t];break}case"rankmatchandfuzzy":{const e=[],t=[];o.forEach((i=>{(i.item.serviceHub?.serviceMenuManifest.display||i.item.portalService?.portalServiceManifest.display||i.item.assetType?.compositeDisplayName.service||"").toLocaleLowerCase().includes(s)?e.push(i):t.push(i)})),e.sort(T),t.sort(T),o=[...e,...t];break}}return o}function H(e){const{filter:t,possibleFavorites:i,matchAllTokens:s,globalSearchKeywords:r,rank1PServiceExperiment:a}=e;let o=new n(i,s?B:L).search(t);o=o.filter((e=>e.score<=L.threshold));const l=o.reduce(((e,t)=>(function(e){if(e.item.boost)if(e.item.boost>2&&(e.item.boost=2),e.item.boost<-2&&(e.item.boost=-2),e.item.boost>0)e.score=Math.pow(e.score,1+e.item.boost);else if(e.item.boost<0){const t=1+Math.abs(e.item.boost);e.score=Math.pow(e.score,1/t)}}(t),t.score<=L.threshold&&e.push(t),e)),[]);if(l.sort(((e,t)=>e.score-t.score)),r){const e=r.find((e=>e.toLocaleLowerCase()===t.toLocaleLowerCase()));if(e?.length)return l}return N(l,t,a)}let E=t.FavoritesManagerDeferred=class{constructor(e,t,i,a,n,l,d,u,f,h){this._assetTypeService=e,this._browseManager=t,this._favoritesManager=i,this._diContainer=a,this._recentsManager=n,this._router=l,this._serviceHubsManager=d,this._serviceHubUIManager=u,this._portalServiceUIManager=f,this._experimentationManager=h,this.categories=ko.observableArray(),this.categoriesLookup={},this.showCategories=ko.observable(!1),this.allFavoriteTypes=ko.observableArray(),this.possibleFavoritesLookup={},this._ltm=new FxImpl.TriggerableLifetimeManager,this._extensionToDefaultCategoryMap={},this._assetTypes=ko.observable(),this._subCategoriesLocalizedNameMap={},this._allServiceHubs={},this._rank1PServiceExperiment=this._experimentationManager.shellAssignments.getStringValue("searchrank1pservice"),this._recentsManager=this._diContainer.get(c.RecentServicesManager),this._assetTypes([]),m.tryImmediateResolve(this._assetTypeService.assetTypesComplete,(()=>{const e=this._browseManager.getFilteredAssetTypes()||[];e.length&&this._assetTypes(e)})),this.initializeCategories=(0,p.memoizePromise)((()=>{if(this._categoriesWithSubCategories)return Promise.resolve(this._categoriesWithSubCategories);const e=this._curationPromise||(0,r.getBrowseCuration)({applyServiceHubVisibility:!0,diContainer:this._diContainer}),t=MsPortalFx.isFeatureEnabled("allserviceswithoverview")?(0,r.getAllServicesAdditionalData)():Promise.resolve(null);return Promise.all([e,t,this._serviceHubsManager.getAllServiceHubs(),this._assetTypeService.assetTypesComplete]).then((([e,t,i])=>{this._discoveryPolicy=e.discoveryPolicy||0,this._curationSearchKeywords=e.globalSearchKeywords;for(const e of i)this._allServiceHubs[e.globalId]=e;const r=(e,i)=>{const r=t&&t.categoriesDataMap[e],a={id:e,showLabel:ko.observable(!0),isFilteredOut:ko.observable(!1),isHidden:ko.pureComputed((()=>!a.possibleFavorites().some((e=>!e.isHidden())))),label:(0,s.provideCategoryName)(e),count:ko.observable(0),possibleFavorites:ko.observableArray(),sourceCategory:i,freeTrainings:r&&r.trainings,usefulLinks:r&&r.usefulLinks,seeAllTrainingsLink:r&&r.seeAllTrainingsLink};return a},a=e.categories||[],n=a.map((e=>r(e.id,e)));if(n&&n.length){const e=this._uncuratedCategory=r("uncurated");n.push(e)}this.categories(n),this.allFavoriteTypes().forEach((e=>{if(!e.serviceHub&&!e.portalService){const t=o.getAssetTypeKind(e.assetType,e.kind),i=e.assetType,s=o.getAssetTypeDisplayText(i,t);e.label=s,e.labelId=s.replace(_,""),e.image=o.getAssetTypeIcon(i,t),e.keywords=(o.getAssetTypeKeywords(i,t)||"").split(","),e.isHidden(e.isHidden())}}));const l={};return a.forEach((e=>{(e.discoveryExtensions||[]).forEach((t=>{l[t]=A(n,(t=>t.id===e.id))||this._uncuratedCategory}))})),this._extensionToDefaultCategoryMap=l,this._loadFlyoutMenu().then((e=>(this._categoriesWithSubCategories=e,e)))}))}))}updateForRecents(e,t){return this.initializeCategories().then((()=>this._recentsManager.getServices().then((i=>{const s=i&&i.length||0,r=e&&e.length;let a;if(t){if(e||(a=s>t?t:s),r>=t)return e.slice(0,t);a=t-r>=s?s:t-r}else a=s;if(0===a)return;const o=i.slice(0);o.sort(((e,t)=>t.timeStamp-e.timeStamp));const n=e&&e.slice(0)||[];for(let t=0;t<a;t++)if(!e||!MsPortalFx.find(e,(e=>o[t].assetId===e.id.toLowerCase()))){const e=this.possibleFavoritesLookup[o[t].assetId?.toLowerCase()||o[t].serviceHubFavoriteTypeId||o[t].portalServiceFavoriteId];e&&n.push({...e,relevanceScore:ko.observable(1),matches:ko.observable(),isHidden:ko.observable(!1),isFilteredOut:ko.observable(!1),commandsToolbarDetailView:ko.observable()})}return n}))))}_filterServices(e,t,i,s,r,a,o,n,l){const c=new Set,d=[];if(t=t?.trim(),s?i=i.filter((t=>{if(t.portalService){return R(n,e,t)}return!t.serviceHub||l})):i.forEach((t=>{if(t.isFilteredOut(!1),t.relevanceScore(0),t.matches({highLightedDisplayName:"",highLightedSecondaryName:""}),t.portalService){const i=R(n,e,t);t.isHidden(!i)}t.serviceHub&&t.isHidden(!l)})),t){let e=H({filter:t,possibleFavorites:i,rank1PServiceExperiment:this._rank1PServiceExperiment,matchAllTokens:!1,globalSearchKeywords:s?this._curationSearchKeywords:void 0});if(t.split(" ").length>1){const r=H({filter:t,possibleFavorites:i,rank1PServiceExperiment:this._rank1PServiceExperiment,matchAllTokens:!0,globalSearchKeywords:s?this._curationSearchKeywords:void 0});e.push(...r),e.sort(((e,t)=>e.score-t.score));const a=this._curationSearchKeywords?.find((e=>e.toLocaleLowerCase()===t.toLocaleLowerCase()));a?.length||(e=N(e,t,this._rank1PServiceExperiment)),e=MsPortalFx.unique(e,((e,t)=>MsPortalFx.areEqual(e.item.id,t.item.id)))}const r={},a=2;let p,f=1;e.forEach((e=>{const t=e.item.portalService||e.item.serviceHub;if(!e.item.isHidden()||t){let t="";if(o){const i=[],s=[],r=[],o=e.matches;for(let e=0;e<o?.length;e++){if("label"===o[e].key){t="";break}let n=0;const l=[],c=o[e].value?.length;o[e].indices.forEach((t=>{t[1]-t[0]>=a&&(l.push(o[e].value.slice(n,t[0])+"<b>"+o[e].value.slice(t[0],t[1]+1)+"</b>"),n=t[1]+1)})),n<c&&l.push(o[e].value.slice(n,c+1));const d=l.join("");switch(o[e].key){case"keywords":i.push(d);break;case"resourceType":s.push(d);break;case"includes":r.push(d)}}i.length?t=`${u.Search.keywordSubNameFmt.format(i.join(","))}`:s.length?t=`${u.Search.resourceTypeSubNameFmt.format(s.join(","))}`:r.length&&(t=`${u.Search.includesSubNameFmt.format(r.join(","))}`)}else{const i=e.matches.filter((e=>"keywords"===e.key||"resourceType"===e.key||"includes"===e.key));t=i[0]&&`${u.Search.keywordSubNameFmt.format(i[0].value.trim())}`}r[e.item.id]={relevance:f++,matchData:{highLightedDisplayName:"",highLightedSecondaryName:t}},c.add(e.item.id)}})),i.forEach((e=>{const t=r[e.id],i=t&&t.relevance||0,a=t&&t.matchData;if(s){if(t){const s=ko.observable(e.isHidden());(n&&e.portalService||l&&e.serviceHub)&&s(!1),p={relevanceScore:ko.observable(i),id:e.id,kind:e.kind,image:e.image,isFavorite:e.isFavorite,label:e.label,labelId:e.labelId,keywords:e.keywords,matches:ko.observable(a),uri:e.uri,opensExternal:e.opensExternal,isHidden:s,isFilteredOut:ko.observable(!t),assetType:e.assetType,isDisabled:e.isDisabled,isPartner:e.isPartner,commandsToolbarDetailView:ko.observable(),portalService:e.portalService,serviceHub:e.serviceHub},d.push(p)}}else e.relevanceScore(i),e.matches(a),e.isFilteredOut(!t)}))}return(r&&"All"!==r||a&&"All"!==a)&&i.forEach((e=>{const t=e.isFilteredOut(),i=function(e,t){const{releaseStatus:i,serviceProvider:s}=t,r=i&&("Preview"===i&&!e.isPreview||"GA"===i&&e.isPreview),a=s&&("Partner"===s&&!e.isPartner||"Microsoft"===s&&e.isPartner);return r||a}(e,{releaseStatus:r,serviceProvider:a}),o=t||i;o&&(c.delete(e.id),s?MsPortalFx.remove(d,e):e.isFilteredOut(o))})),{filteredTypes:s?d:i,matchCount:t?c.size:i.filter((e=>!e.isFilteredOut()&&!e.isHidden())).length}}filterAllServices(e){return e.possibleFavorites?.length?Promise.resolve(this._filterServices(e.source,e.filter,e.possibleFavorites,e.dontApplyVisibility,e.releaseStatus,e.serviceProvider,e.showKeywordAndTypeMatches,e.includePortalServices,e.includeServiceHubs)):this.initializeCategories().then((()=>Promise.resolve(this._filterServices(e.source,e.filter,this.allFavoriteTypes(),e.dontApplyVisibility,e.releaseStatus,e.serviceProvider,e.showKeywordAndTypeMatches,e.includePortalServices,e.includeServiceHubs))))}getCreateCommandForService(e){let t,i=e.assetTypeInfo.assetType?.assetTypeManifest||{};e.assetTypeInfo.kind&&e.assetTypeInfo.assetType.kindMap&&(t=e.assetTypeInfo.kind.toLowerCase(),i=e.assetTypeInfo.assetType.kindMap[t]||e.assetTypeInfo.assetType.assetTypeManifest);const s=e.assetTypeInfo.assetType?.extension,r=s&&i.claimedMarketplaceIds?i.name:null;if(i.marketplaceItemId||i.marketplaceMenuItemId||i.noPdlCreateBlade)return M(e.lifetime,{label:e.buttonOptions.showLabel?u.ActionBarButtons.create:"",icon:e.buttonOptions.showIcon?e.buttonOptions.showCustomIcon?i.icon:MsPortalFx.Base.Images.Add():null,tooltip:u.Search.createCommandTitle,onClick:()=>{if(I.trace({source:e.source,name:e.assetTypeInfo.id,action:"CreateCommandClicked",...e.supplyAdditionalTelemetryData&&{data:{...e.supplyAdditionalTelemetryData()}}}),i.marketplaceItemId)this._router.route(`#create/${i.marketplaceItemId}`,{openedBy:e.openedBy});else{const a=(0,f.getCreateBlade)({marketplaceItemId:i.marketplaceItemId,marketplaceMenuItemId:i.marketplaceMenuItemId,noPdlCreateBlade:i.noPdlCreateBlade,noPdlCreateExtension:i.noPdlCreateExtension,noPdlCreateParameters:i.noPdlCreateParameters,assetExtensionName:s,assetType:r,assetKind:t,resourceType:i.resourceType?.resourceTypeName||e.assetTypeInfo.resourceType});this._diContainer.get(g.BladeOpener).openBlade(a,{flags:2,telemetryName:e.telemetryName})}return!1},disabled:e.assetTypeInfo.isDisabled})}dispose(){this._ltm.dispose()}_addBrowseMenuItem(e,t,i){const s=D(e.extension,e.assetTypeManifest.name,t),r=o.getFavoriteType({assetType:e,kind:t,diContainer:this._diContainer,assetTypeIdWithKind:s});if(!this.possibleFavoritesLookup[s.toLowerCase()]){this.allFavoriteTypes().push(r);const e=MsPortalFx.find(this._favoritesManager.favorites.value,(e=>e.id===r.id));e&&(r.isFavorite=e.isFavorite),this.possibleFavoritesLookup[r.id.toLowerCase()]=r}}_addBrowseMenuItemToCategory(e){const t=D(e.assetType.extension,e.assetType.assetTypeManifest.name,e.kind),i=o.getFavoriteType({assetType:e.assetType,kind:e.kind,diContainer:this._diContainer,assetTypeIdWithKind:t,boost:e.boost,subCategory:e.subCategory}),s=MsPortalFx.find(this._favoritesManager.favorites.value,(e=>e.id===i.id));if(s&&e.boost&&(s.boost=e.boost),!e.tempPossibleFavorites.some((e=>e.id===t))){const t=this.possibleFavoritesLookup[i.id.toLowerCase()];if(t){i.isFavorite=t.isFavorite,i.isFilteredOut=t.isFilteredOut,i.matches=t.matches,i.relevanceScore=t.relevanceScore;const s=i.isHidden=t.isHidden;s(s()||e.isHidden),e.boost&&(t.boost=e.boost)}e.tempPossibleFavorites.splice(e.index,0,i)}if(e.isHidden){const t=this.allFavoriteTypes().find((e=>e.id===i.id));t&&t.isHidden(e.isHidden)}}_loadFlyoutMenu(e){const t=this.possibleFavoritesLookup;this._assetTypes().forEach((t=>{this._addBrowseMenuItem(t,void 0,e)}));const i=this.categories();this.showCategories(!!i.length);const r=Object.keys(t).slice(0);i.forEach((e=>{const t=[],i=e.possibleFavorites;i();const a=e.sourceCategory,o=a?.items||[],n=a?.serviceHubs||[];for(const e of n){const i=this._allServiceHubs[`${e.extensionName}::${e.serviceMenuId}`];if(i){const e=this._serviceHubUIManager.getFavoriteType(i),s=i.portalServices.map((e=>this._portalServiceUIManager.getFavoriteType(e)));if(t.push(e),t.push(...s),!this.possibleFavoritesLookup[e.id]){this.possibleFavoritesLookup[e.id]=e,this.allFavoriteTypes.push(e);for(const e of s)this.possibleFavoritesLookup[e.id]||(this.possibleFavoritesLookup[e.id]=e,this.allFavoriteTypes.push(e))}}}o.length&&(o.forEach(((e,i)=>{let a,o,n=-1;if(this._assetTypes().some((t=>{if(function(e,t){return e.extensionName===t.extension&&e.assetType===t.assetTypeManifest.name}(e,t)){const s=(e.kind||"").toLowerCase();o=s&&t.kindMap&&t.kindMap[s]&&e.kind,n=i,a=t}return n>-1})),n>-1){o&&this._addBrowseMenuItem(a,o),MsPortalFx.remove(r,a.id.toLowerCase());const i=e.subCategoryId;let l=this._subCategoriesLocalizedNameMap[i];i&&!l&&(l=(0,s.provideSubCategoryName)(i),this._subCategoriesLocalizedNameMap[i]=l);const c={assetType:a,index:n,kind:o,isHidden:!!e.isHidden,tempPossibleFavorites:t,boost:e.boost,subCategory:l};this._addBrowseMenuItemToCategory(c)}})),i(t),e.count(t.filter((e=>!e.isHidden())).length))}));const o=this._uncuratedCategory,n=[];if(o){P(r.map((e=>t[e])),((e,t)=>(0,a.compareAssetTypeForSort)(e.label,t.label))).forEach((e=>{const t=e.assetType;if(t){const i=this._extensionToDefaultCategoryMap[t.extension],s=i||o,r=!i&&1===this._discoveryPolicy||(0,d.supportsOption)(t.assetTypeManifest.options,1),a=this.allFavoriteTypes().find((t=>t.id===e.id));a&&a.isHidden(r);const l=s.possibleFavorites;let c=[];c=i?l():n;const u={assetType:t,index:c.length,kind:"",isHidden:r,tempPossibleFavorites:c};this._addBrowseMenuItemToCategory(u),l(c);const p=c.filter((e=>!e.isHidden())).length;s.count(p)}}))}return this.allFavoriteTypes(P(this.allFavoriteTypes(),((e,t)=>(0,a.compareAssetTypeForSort)(e.label,t.label)))),Promise.resolve(this.categories())}};function $(e){if(!e?.assetType)return null;const t=e.id;let{assetTypeManifest:i}=e.assetType;return e.kind&&e.assetType.kindMap&&(i=e.assetType.kindMap[e.kind.toLowerCase()]||i),"HubsExtension_BrowseAllResources"===t&&(i.marketplaceItemId="hub"),i}t.FavoritesManagerDeferred=E=__decorate([__metadata("fx:diagnostics",[e,"FavoritesManagerDeferred"]),i.Class(),__metadata("design:paramtypes",[s.AssetTypeService,a.BrowseManager,o.FavoritesManager,i.Container,c.RecentServicesManager,y.Router,b.ServiceHubsManager,v.ServiceHubUIManager,x.PortalServiceUIManager,w.Experimentation])],E)})),
define("MsPortalImpl/Widgets/Widgets.SharedOptionsInit",["require","exports","Fx/ResourceManagement","FxHubs/RpcEndPoints","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.ArmIdHelpers","MsPortalImpl/Base/Base.DeepLink","MsPortalImpl/Base/Base.Router","MsPortalImpl/Services/Services.AssetTypes","MsPortalImpl/Services/Services.Recents","MsPortalImpl/UI/Compositions/UI.Composition.Services","MsPortalImpl/Services/Services.Subscriptions","Fx"],(function(e,t,i,s,r,a,o,n,l,c,d,u,p){"use strict";t.initSearchWidgetOptions=function(e,t,M){const T=M.get(l.AssetTypeService),_=M.get(c.RecentServicesManager);function A(e,t,i,s){P({source:"TopBar",action:t,data:e}),C.action=i,B.route(s,{openedBy:3})}const P=h.trace,L=parseInt((0,p.getFeatureValue)("search"));M.get(u.SubscriptionsUserContext).getInSessionSelectedSubscriptions().then((i=>{i.subscribeAndRun(e,(e=>{t.showResults(!1),function(e,t,i){I(t).then((t=>{i=i||[];const s=(t=t||{}).type,a=t.value,o=i.length;let n="",l=!1;if(a){let t=!0;1===s||2===s?a===o?n=r.Search.searchingAllSubs:(n=r.Search.searchingSelectedSubsOfTotal.format(o,a),a<=20&&(l=!0,t=!1)):o&&(n=r.Search.searchingSelectedSubsOnly.format(o)),e.subscriptionSummary(n),e.showChangeSubscriptions(t),e.showAllSubscriptionsSearch(l)}}))}(t,M,e)}))})),t.showMenu.subscribe(e,(e=>{S(),e?(x&&h.cancelTrace(x),C={version:v,correlationId:++w,action:""},x=h.start({source:"Search",action:"SearchSession"}),t.showResults()||t.filter.valueHasMutated()):(C.action||(C.action=t.showResults()?"AbandonedResult":"AbandonedRecent"),h.completeTrace(x,C),x=null,m=setTimeout((()=>{t.filter(""),t.results([]),S()}),b))})),t.results.subscribe(e,(e=>{t.showExternalColumn(e.some((e=>e.results.some((e=>e.isExternal)))))})),t.openFeedbackPane=()=>{M.getAsync(d.FeedbackPaneInfo).then((e=>{const t=e.widget;t.isVisible()||(C.action="Feedback",t.toggle({title:r.Search.feedbackTitle,action:"SearchFeedback"},{correlationId:C.correlationId}))}))};const B=M.get(n.Router);t.openAllResourcesBlade=e=>{A(e,"SearchAllResourcesExecuted","AllResources",`${(0,l.getBrowseAllDeeplink)()}/filter/${e}`)},t.openAllResourceGroupsBlade=e=>{A(e,"SearchResourceGroupsExecuted","AllResourceGroups","#blade/HubsExtension/Resources/resourceType/Microsoft.Resources%2Fsubscriptions%2FresourceGroups/filter/"+e)},t.openMarketplaceBlade=e=>{A(e,"SearchMarketplaceExecuted","Marketplace","#blade/Microsoft_Azure_Marketplace/GalleryFeaturedMenuItemBlade/selectedMenuItemId/home/searchQuery/"+e)},t.openRecentsBlade=()=>{A("","SearchAllRecentsExecuted","AllRecents","#blade/HubsExtension/Resources/resourceType/Microsoft.Resources%2Frecent")},t.openResultItemBlade=(e,s,r)=>{P({source:"TopBar",action:"SearchResultOpened",data:{id:r.id,resultType:r.resultType,type:r.origAssetType,deepLink:r.deepLink}}),t.showResults()?C.action="Result":(C.query="",C.action="Recent");let o="BrowseItem";const n=r.id,l=r.armId||i.ArmId.parse(r.id,!0);(0,a.isResourceAtAnyLevel)(l)?o="Resource":4===l.kind?o="ResourceGroup":1===l.kind&&(o="Subscription"),C.item={id:n,displayName:r.origDisplayName||r.displayName,subName:r.origSubName||r.subName,resultType:o,assetType:r.origAssetType||r.typeName,position:s},"BrowseItem"===r.resultType&&1===r.detailsType&&_.addService({type:"assetType",assetId:r.id}),r.isExternal?window.open(r.deepLink):B.route(r.deepLink,{openedBy:3})},t.performSearch=e=>{e=(e||"").trim(),C.query=e,C.queryCount=(C.queryCount||0)+1;const t=h.start({source:"TopBar",action:"SearchExecuted"}),i={criteria:e,resultCount:L};return F(M).then((s=>MsPortalFx.require("MsPortalImpl/Services/Services.Search").then((a=>a.search(i,M).then((i=>{h.completeTrace(t,{filter:e,result:i.map((e=>(e.results||[]).length)).reduce(((e,t)=>e+t),0)});const a=[],n=i.map((e=>{const t=(e.results||[]).map((e=>{let t,i;if(e.details)if(0===e.detailsType){const s=e.details;i=s.extensionName+y+s.assetType,t=(0,o.getAssetDeepLink)(M,s)}else if(1===e.detailsType){const s=e.details,r=T.getAssetType(s.extensionName,s.assetType);i=s.extensionName+y+s.assetType,r&&(t=T.getAssetTypeDeepLink(r))}else t=e.details;const a=e.isPreview?r.Search.previewLabelFmt.format(e.displayName):e.displayName,n=e.subName;return{id:e.id,armId:e.armId,displayName:a,subName:n,subNameFmt:e.subNameFmt,resultType:e.resultType,typeName:e.typeName,icon:e.icon,toolTip:k(T,s,e.id,e.armId),isExternal:3===e.detailsType,filteredSubName:e.filteredSubName,deepLink:t,detailsType:e.detailsType,origDisplayName:a,origSubName:n,origAssetType:i}})),i=e.totalResultsCount;let n;n=i<=0?r.Search.zeroResults:r.Search.seeAllResults.format(i),a.push({displayName:e.displayName,results:t,totalResultsCount:e.totalResultsCount||0,moreResultsLinkText:n,moreLinkType:e.moreLinkType,moreLinkDetails:e.moreLinkDetails})}));return Promise.all(n).then((()=>a))})))).catch((e=>{throw h.cancelTrace(t,{error:e}),e}))))},t.isDropdownInitialized().then((()=>{ko.computed(e,(()=>{if(!t.filter()){s.AssetTypes.getRecentResourcesEndPoint.invoke(g.client,"HubsExtension",{limit:10}).then((e=>e.map((e=>F(M).then((t=>{const i=e.assetTypeInformation,s=(e.resourceKind||i.defaultKind||"").toLowerCase(),a=i.kindMap&&i.kindMap[s],n=a&&a.icon||i.icon||f.Images.Polychromatic.ResourceDefault(),l=a&&a.singularDisplayName||i.compositeDisplayName&&i.compositeDisplayName.singular||i.resourceType,c=e.assetTypeInformation.isPreview?r.Search.previewLabelFmt.format(e.name):e.name;return{id:e.resourceId,armId:e.armId,displayName:c,resultType:"Resource",typeName:l,icon:n,toolTip:k(T,t,e.resourceId,e.armId),deepLink:(0,o.getAssetDeepLink)(M,{extensionName:i.extensionName,assetType:i.assetType,assetId:e.resourceId}),detailsType:0,origDisplayName:c,origAssetType:i.extensionName+y+i.assetType}})))))).then((e=>Promise.allSettled(e).then((e=>{t.mruItems(e.filter((e=>"fulfilled"===e.status&&e.value)).slice(0,5).map((e=>"fulfilled"===e.status&&e.value)))}))))}}))}))},t.searchClearTimeInMillies=void 0;var f=MsPortalFx.Base,h=f.Diagnostics.Telemetry,g=FxImpl.Rpc;s.Subscriptions.CountTypeEnum;const y=".";let m,b=t.searchClearTimeInMillies=3e5;const v=1;let x,w=0,C={version:v,correlationId:w,action:""};function S(){m&&(clearTimeout(m),m=null)}function k(e,t,s,a){if(0===(a=a||i.ArmId.parse(s,!0)).kind)return"";const o=[];if(a.subscription){const e=t.get(a.subscription);o.push({name:e&&e.uniqueDisplayName||a.subscription,type:r.Search.subscriptionsType})}a.resourceGroup&&o.push({name:a.resourceGroup,type:r.Search.resourceGroupType});const n=i.ArmId.getResourceNames(a),l=i.ArmId.getResourceTypes(a);if(n.length){let t=a.provider;n.forEach(((i,s)=>{t+="/"+l[s];const r=e.getAssetTypeByResourceType(t);o.push({name:i,type:r?r.compositeDisplayName.singular:l[s]})}))}const c=o.pop();return"{0}\n{1}\n\n{2}".format(c.name,c.type,o.map((e=>e.type+": "+e.name)).reverse().join("\n"))}const F=(0,p.memoizePromise)((e=>e.get(u.SubscriptionsUserContext).getInSessionSelectedSubscriptions().then((e=>{const t=FxImpl.lowerCaseStringMap();return e().forEach((e=>t.set(e.subscriptionId,e))),t})))),I=e=>e.get(u.SubscriptionsUserContext).getAllSubscriptionsCount()})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.AllServicesMenu.css",["module"],(function(e){"use strict";return{css:'.fxs-sidebar-flyout{min-width:320px;list-style:none}.fxs-sidebar-flyout-collapsed-layout .fxs-sidebar-category-label-wrapper{width:calc(100vw - 20px)}.fxs-sidebar-hint-text{text-align:right;font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:5px}.fxs-sidebar-hint-text-hide{visibility:hidden}.fxs-sidebar-hide{display:none!important}.fxs-sidebar-browse-flyout{height:100%}.fxs-sidebar-flyout-header{height:20px;margin:0 0 10px;text-align:right}.fxs-sidebar-flyout-icon{flex:0 0 18px;display:flex;align-items:center;height:18px}.fxs-sidebar-flyout-icon svg,.fxs-sidebar-flyout-icon img{height:18px;width:18px}.fxs-sidebar-flyout-hub-icon{flex:0 0 24px;display:flex;align-items:center;height:24px}.fxs-sidebar-flyout-hub-icon svg,.fxs-sidebar-flyout-hub-icon img{height:24px;width:24px}.fxs-sidebar-possible-favorites{height:calc(100% - 80px);overflow-y:auto;overflow-x:hidden}.fxs-sidebar-flyout .fxs-sidebar-flyout-allcategories-list{width:100%;padding-left:20px;list-style:none;margin:0}.fxs-sidebar-is-collapsed .fxs-sidebar-flyout .fxs-sidebar-flyout-allcategories-list{width:calc(100vw - 300px)}.fxs-sidebar-flyout.fxs-sidebar-flyout-filtered .fxs-sidebar-category{display:block}.fxs-sidebar-flyout.fxs-sidebar-flyout-filtered .fxs-sidebar-flyout-allservices-list{flex-flow:column wrap}.fxs-sidebar-flyout-top{display:flex;margin-bottom:20px}.fxs-sidebar-flyout .fxs-sidebar-label{margin-left:12px;width:auto;padding-right:8px}.fxs-allservices-label{flex:initial}.fxs-sidebar-label-name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.fxs-sidebar-flyout-item-link{display:flex;flex:1 1 auto;align-items:center;height:40px;padding-left:10px;padding-right:2px;width:160px;max-height:70px}.fxs-allservices-menu-commands{display:flex;align-self:center;padding-right:3px}.fxs-allservices-menu-commands svg{height:14px;width:14px;margin-top:2px;margin-left:5px}.fxs-allservices-menu-commands .azc-toolbar-item>.azc-toolbarButton-icon-chevron{height:none;width:none}.fxs-allservices-menu-commands-detail-view .azc-toolbar-item{height:30px}.fxs-allservices-menu-commands-detail-view .azc-toolbar-item>.azc-toolbarButton-container{border-radius:4px;border:1px solid #d1d1d1;height:30px}a.fxs-sidebar-flyout-item-link:hover{text-decoration:none}.fxs-sidebar-flyout .fxs-sidebar-item,.fxs-allservices-menu-subcategory-item{align-items:flex-start;display:flex;min-height:35px;max-width:400px;margin-right:40px}.fxs-sidebar-flyout .fxs-sidebar-item .fxs-sidebar-matches-prefix,.fxs-allservices-menu-subcategory-item .fxs-sidebar-matches-prefix{font-weight:600}.fxs-sidebar-flyout .fxs-sidebar-item .fxs-sidebar-matches,.fxs-allservices-menu-subcategory-item .fxs-sidebar-matches{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:10px;text-align:left;display:block}.fxs-sidebar-flyout .fxs-sidebar-item:hover .fxs-sidebar-star svg,.fxs-allservices-menu-subcategory-item:hover .fxs-sidebar-star svg,.fxs-sidebar-flyout .fxs-sidebar-item.fxs-portal-selected .fxs-sidebar-star svg,.fxs-allservices-menu-subcategory-item.fxs-portal-selected .fxs-sidebar-star svg{opacity:1}.fxs-allservices-menu-subcategory-item{margin-right:20px;margin-left:20px}.fxs-sidebar-flyout-item-content{display:flex;align-items:center;flex:1 1 auto;width:400px;max-height:40px}.fxs-sidebar-star{flex:0 0 auto;display:flex;align-items:center;justify-content:center;align-self:center;height:40px;width:30px;cursor:pointer;pointer-events:all}.fxs-sidebar-star svg{height:14px;width:14px;opacity:.6;fill:#0078d4}.fxs-sidebar-star.fxs-is-favorite svg{opacity:1}.fxs-mode-light .fxs-sidebar-star:hover{background-color:#faf9f8}.fxs-mode-light .fxs-allservices-menu-commands .azc-toolbar-item>.azc-toolbarButton-container:hover{background-color:#faf9f8}.fxs-mode-dark .fxs-sidebar-star:hover{background-color:#484644}.fxs-mode-dark .fxs-sidebar-star svg{fill:#f2f2f2}.fxs-mode-dark .fxs-allservices-menu-commands .azc-toolbar-item>.azc-toolbarButton-container:hover{background-color:#484644}.fxs-sidebar-category-label-wrapper,.fxs-sidebar-category-label-wrapper-noclick{display:flex;align-items:center;margin-top:10px;margin-bottom:16px;height:25px;width:calc(100vw - 300px)}.fxs-sidebar-category-label-wrapper:hover,.fxs-sidebar-category-label-wrapper-noclick:hover{cursor:pointer}.fxs-sidebar-category-label-divider{flex:1 1 auto;border-bottom-width:1px;border-bottom-style:solid;height:0;margin:0 5px}.fxs-sidebar-category-label{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:600;font-size:16px;text-align:left;padding-right:5px;flex:0 0 auto!important}.fxs-sidebar-category-button{flex:0 0 auto;height:25px!important;width:25px!important;border:0}.fxs-sidebar-category-button>svg{height:10;width:10}.fxs-sidebar-category-button-transform{transform:scale(-1,-1);background-color:rgba(255,255,255,.3)}.fxs-sidebar-filter-input{max-width:140px;margin:0;flex:0 0 auto;border-style:none;height:21px}.fxs-sidebar-filter-input-infoballoon{margin-left:4px;align-self:center}.fxs-sidebar-flyout .fxs-sidebar-content{min-height:40px;padding-left:20px;display:flex;flex:1 1 auto;flex-wrap:wrap}.fxs-sidebar-flyout-title-text{font-size:24px;flex:0 0 auto;font-weight:600}.fxs-sidebar-flyout-subtitle-text{font-size:24px;flex:0 0 auto;display:none}.fxs-sidebar-flyout-subtitle-text::before{content:"|";margin:0 10px}.fxs-sidebar-flyout-link{font-size:13px;line-height:1.385;padding-right:10px;padding-left:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.fxs-sidebar-flyout-link:hover{text-decoration:underline}.fxs-sidebar-flyout-state{padding-right:10px;padding-left:5px;margin-left:auto;display:flex;flex:0 1 auto;flex-wrap:wrap;align-self:center;margin-bottom:25px}.fxs-sidebar-flyout-noresults{margin:auto;display:flex;justify-content:center;flex-direction:column}.fxs-sidebar-flyout-noresultsicon{height:120px;width:120px;padding-top:100px;opacity:.4;align-self:center}.fxs-sidebar-flyout-noresultstext{text-align:center;font-size:15px;margin-top:12px;margin-right:10px}.fxs-sidebar-flyout-norecommendations{margin:auto;display:flex;justify-content:center;flex-direction:column;overflow-y:hidden}.fxs-sidebar-flyout-info{display:flex;margin-right:10px;flex-wrap:wrap;align-items:center}.fxs-sidebar-flyout-feedback{display:flex;padding-top:5px;padding-left:10px}.fxs-sidebar-flyout-feedback-section{padding-top:20px}.fxs-sidebar-flyout-no-recents-title,.fxs-sidebar-flyout-feedback-title{font-weight:600;margin-right:12px;margin-left:10px;font-size:14px;align-self:center}.fxs-sidebar-flyout-feedback-border{border:solid 1px;border-color:#f3f2f1;width:calc(100vw - 100px)}.fxs-sidebar-fluout-feedback-center{justify-content:center;display:flex;flex-direction:column;align-items:center;padding-top:15px}.fxs-sidebar-flyout-feedback-icon{align-items:center;justify-content:center;align-self:center;padding-right:5px;height:16px;width:16px}.fxs-sidebar-flyout-feedback-icon svg{height:16px;width:16px;fill:#0078d4}.fxs-sidebar-flyout-actions{display:flex;flex:0 0 auto}.fxs-sidebar-content-wrapper{display:flex}.fxs-sidebar-count-label{font-size:16px}.fxs-sidebar-flyout-searchview{margin-left:20px!important}.fxs-sidebar-flyout .fxs-sidebar-flyout-searchview{margin-top:10px}.fxs-sidebarflyout-category-button{display:flex;align-items:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;height:32px;font-size:13px;padding-left:10px;font-weight:400}.fxs-sidebarflyout-category-button-overview{font-weight:600}.fxs-sidebar-category-name{margin-left:20px}.fxs-sidebarflyout-filter-wrapper{display:flex;align-items:center;height:22px;border-style:solid;border-width:1px;border-color:#808080;margin-left:10px;margin-top:5px;max-width:178px}.fxs-sidebar-flyout-filter-pillcollection{flex-grow:1;padding-left:20px}.fxs-sidebarflyout-filters{display:flex;flex:1}.fxs-sidebarflyout-category-nodata{cursor:pointer}.fxs-sidebarflyout-list-container{height:100%}.fxs-sidebar-flyout-content-wrapper{height:100%;position:relative;display:flex;flex-direction:row;flex:1 1 auto;margin:0;list-style:none;top:20px}.fxs-sidebar-flyout-category-list{display:flex;flex-direction:column;width:240px;flex:0 0 auto;max-height:calc(100% - 85px);overflow-y:auto}.fxs-sidebar-flyout-allservices-list{display:flex;flex:1 1 auto;flex-flow:row wrap;position:relative;padding-left:0;padding-top:10px;overflow:auto;align-content:flex-start;margin:0}.fxs-sidebar-flyout-recommended-services-list{display:flex;flex-flow:row wrap;align-items:flex-start;padding:0}.fxs-sidebar-flyout-services-list-with-subcategories{display:flex;flex:1 1 auto;flex-flow:row wrap;position:relative;margin-top:0;padding-left:5px;overflow:auto;align-content:flex-start}.fxs-sidebar-flyout-subcategories-list{display:flex;flex:1 1 auto;flex-flow:row wrap;position:relative;padding-left:15px;padding-top:10px;overflow:auto;align-content:flex-start}.fxs-sidebar-flyout-freetrainings-container{display:flex;list-style:none;margin-left:-40px;flex-wrap:wrap}.fxs-sidebar-flyout-freetrainings-item{border:1px solid rgba(204,204,204,.5);box-shadow:rgba(0,0,0,.1) 0 2px 4px 0;transition:box-shadow .02s ease 0s;width:280px;margin-right:16px;margin-top:10px;cursor:pointer}.fxs-sidebar-flyout-freetrainings-item:hover{box-shadow:rgba(0,0,0,.14) 0 4px 8px 0;transition:box-shadow .02s ease 0s}.fxs-sidebar-flyout-usefullinks-item-container,.fxs-sidebar-flyout-freetrainings-item-container{display:flex;flex-direction:column;padding:18px}.fxs-sidebar-flyout-usefullinks-item-container:hover,.fxs-sidebar-flyout-freetrainings-item-container:hover{text-decoration:none!important}.fxs-sidebar-flyout-freetrainings-item-container{height:85%;position:relative}.fxs-sidebar-flyout-item-hub-name{margin-left:auto;white-space:nowrap}.fxs-sidebar-flyout-usefulink-description{padding-bottom:10px;height:80px}.fxs-sidebar-flyout-freetrainings-item-icon{border:2px solid #0078d4;max-height:30px;max-width:30px;margin-bottom:5px;border-radius:50%}.fxs-sidebar-flyout-freetrainings-item-subtitle{display:flex;font-size:13px;line-height:15px;color:#595959;margin-bottom:8px}.fxs-sidebar-flyout-freetrainings-item-description{font-family:az_ea_font,"Segoe UI",az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;font-weight:400;font-size:13px;line-height:15px;overflow:hidden;text-overflow:ellipsis;color:#292827;height:86px}.fxs-sidebar-flyout-overflow-fade{position:relative;margin-bottom:30px}.fxs-sidebar-flyout-overflow-fade::after{position:absolute;width:100%;left:0;height:26px;content:"";bottom:0;background:rgba(0,0,0,0) linear-gradient(0deg,#fff,rgba(255,255,255,0)) repeat scroll 0% 0%}.fxs-mode-dark .fxs-sidebar-flyout-overflow-fade::after{background:rgba(0,0,0,0) linear-gradient(0deg,#111,rgba(255,255,255,0)) repeat scroll 0% 0%}.fxs-sidebar-flyout-start{color:#0078d4;position:absolute;bottom:16px}.fxs-sidebar-flyout-section-loading{top:120px;left:-50px}.fxs-sidebar-flyout-recommendation-loading{height:60vh}.fxs-sidebar-flyout-featured-item,.fxs-sidebar-flyout-overview-title-wrapper{display:flex;align-items:center;margin-bottom:10px}.fxs-sidebar-flyout-overview-title{font-weight:600;margin-right:12px;font-size:17px}.fxs-sidebar-flyout-categories-title{font-weight:600;padding-top:15px;padding-bottom:5px;margin-left:28px;border-bottom:1px solid;font-size:15px}.fxs-sidebar-flyout-allcategories-list{max-height:calc(100% - 105px);overflow-y:auto;overflow-x:hidden}.fxs-sidebar-flyout-overview-seeAllServices,.fxs-sidebar-flyout-overview-seeAll{font-size:13px;cursor:pointer}.fxs-sidebar-flyout-overview-category{padding-top:20px;max-width:900px}.fxs-sidebar-flyout-usefullinks-item{background-color:#faf9f8;margin-right:16px;margin-top:10px;width:280px;border:1px solid transparent}.fxs-sidebar-flyout-usefullinks-item-title{font-size:14px;font-weight:600;line-height:16px;padding-bottom:10px}.fxs-sidebar-flyout-usefullinks-title{font-weight:600;font-size:18px;margin-top:35px;margin-bottom:10px}.fxs-sidebar-flyout-usefullinks-container{list-style:none;margin-left:-40px;display:flex;flex-wrap:wrap}.fxs-sidebar-flyout-featured-container{list-style:none;display:flex;margin-left:-40px;margin-top:0;flex-wrap:wrap}.fxs-sidebar-flyout-featured-in-all-container{margin-bottom:-11px}.fxs-sidebar-flyout-featured-item{height:100px;width:100px;padding:10px;flex:0 0 auto;box-sizing:border-box;border:1px solid transparent;margin-right:8px}.fxs-sidebar-flyout-featured-item:hover{background-color:#fff;border-color:rgba(204,204,204,.8)}.fxs-sidebar-flyout-featured-item-details{height:100%;width:100%;display:flex;align-items:center;flex-direction:column}.fxs-sidebar-flyout-featured-item-details:hover{text-decoration:none!important}.fxs-sidebar-flyout-featured-item-icon{height:32px;width:32px;flex:0 0 auto;margin-bottom:9px}.fxs-sidebar-flyout-featured-item-icon-allservices{height:24px;margin-left:12px;margin-bottom:18px;transform:rotate(90deg);width:24px}.fxs-sidebar-flyout-featured-item-title{text-align:center;overflow:hidden;width:100%;text-overflow:ellipsis}.fxs-sidebar-flyout-category-trainings{display:flex;flex-direction:column;margin-top:120px;flex-basis:100%;padding-bottom:10px}.fxs-sidebar-flyout-category-dropdown{width:188px;padding-left:10px;padding-top:10px}.fxs-sidebar-flyout-close-hidden{visibility:hidden}.fxs-sidebar-flyout-usefullinks-link:hover{text-decoration:underline}.fxs-menu-recommendation-deploy-text{flex:none;order:0;flex-grow:0}.fxs-menu-recommendation-deployed-services-container{display:flex;align-items:center;flex-flow:row wrap;gap:8px;margin-bottom:10px}.fxs-sidebar-flyout-recommendation-deployed-service-tag{display:flex;border-radius:2px;padding:4px 8px;flex:none;order:0;flex-grow:0}.fxs-sidebar-flyout-recommendation-deployed-service-name{margin-left:3px}.fxs-menu-recommendations-list-container{display:flex;flex-direction:column;align-items:flex-start;padding:0;gap:20px}.fxs-allservices-menu-category-header-disabled{pointer-events:none;cursor:default}.fxs-sidebar-service-hub-header{margin-top:10px;margin-bottom:10px;width:calc(100vw - 300px);pointer-events:none;cursor:default;margin-left:10px;list-style-type:none}.fxs-sidebar-service-hub-header:hover{cursor:pointer}.fxs-sidebar-service-hub-header-label{display:flex;align-items:center}.fxs-sidebar-service-hub-header-link{color:#0078d4;pointer-events:all}.fxs-portal-service-item{margin-right:20px;margin-left:20px;max-width:400px;cursor:pointer}.fxs-sidebar-flyout-detail-view-toggle{margin-left:auto;margin-right:40px}.fxs-sidebar-flyout-card{display:flex;width:400px;flex-direction:column;justify-content:center;align-items:center;margin-bottom:16px;margin-left:10px;border-radius:4px;border:1px solid #fff;box-shadow:0 2px 4px 0 rgba(0,0,0,.14),0 0 2px 0 rgba(0,0,0,.12)}.fxs-sidebar-flyout-card.fxs-portal-selected{background-color:unset}.fxs-sidebar-flyout-card-header{display:flex;align-items:center;align-self:stretch;border-radius:4px;gap:12px;padding:12px}.fxs-sidebar-flyout-card-icon svg,.fxs-sidebar-flyout-card-icon img{height:32px;width:32px}.fxs-sidebar-flyout-card-label{font-weight:600}.fxs-sidebar-flyout-card-favorite{margin-left:auto}.fxs-sidebar-flyout-card-body{padding:0 12px 12px;align-items:flex-start;align-self:stretch;display:-webkit-box;-webkit-line-clamp:2;height:2em;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis}.fxs-sidebar-flyout-card-footer{display:flex;padding:12px;justify-content:space-between;align-items:center;align-self:stretch;border-radius:0 0 4px 4px}.fxs-sidebar-flyout-card-footer-buttons{display:flex;align-items:flex-start;gap:12px}.fxs-allservices-view-resources-link{align-self:center;cursor:pointer}.fxs-sidebar-flyout-card-footer-badges{display:flex;justify-content:space-between;align-items:center}@media all and (min-width:640px){.fxs-sidebarflyout-filter-wrapper{margin-left:15px}.fxs-sidebarflyout-filter-wrapper-in-all{margin-left:5px!important}.fxs-sidebar-flyout-content-wrapper{top:0}.fxs-sidebar-flyout-allcategories-list{max-height:calc(100% - 105px)}.fxs-sidebar-filter-input{max-width:180px}.fxs-sidebar-flyout-feedback-border{width:calc(100vw - 350px)}.fxs-sidebar-flyout-subtitle-text{display:block}}',moduleId:e.id}})),
define("_generated/MsPortalImpl/Svg/Startup/ArrowWideUp.svg",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.data=t.type=void 0,t.type=282,t.data="<svg viewBox='0 0 9.7 14.2' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M9 5.6 5.4 1.9v12.3h-1V1.9L.7 5.6 0 4.9 4.9 0l4.8 4.9z'/></g></svg>"})),
define("MsPortalImpl/Widgets/Widgets.AllServicesMenu",["require","exports","MsPortalImpl/Widgets/Widgets.SharedOptionsInit","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/UI/Hubs/UI.FavoritesManager","MsPortalImpl/UI/Hubs/UI.FavoritesManagerDeferred","MsPortalImpl/Widgets/Widgets.WidgetBase","_generated/MsPortalImpl/Svg/Startup/Search.svg","MsPortalImpl/Base/JQueryHelper","Fx/Controls/Toolbar","MsPortalImpl/Base/Base.Router","MsPortalImpl/Services/Services.Recents","MsPortalImpl/Interactions/Interactions.PortalReader","_generated/MsPortalImpl/Svg/Startup/ArrowWideUp.svg","Fx/Controls/DropDown","MsPortalImpl/Services/Services.Settings","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Interactions/Interactions.KeyboardNavigation","Weave","Weave/Core/Computation","WeaveDOM/DirectRender/DataAttribute","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.AllServicesMenu.css","MsPortalImpl/UI/UI.BladeOpener","Fx/Controls/Pill","Fx/Controls/DataGrid","Fx/Controls/PillCollection","Fx/Controls/Toggle","Fx/Assets/AssetTypes","Fx/Controls/InfoBalloon","Fx/Composition/Selectable","Fx/Experimentation","FxInternal/Weave","FxInternal/Lifetime","FxHubs/ResourceCommands/BrowseCommanding","Fx","FxInternal/Weave/Util","MsPortalImpl/UI/Hubs/UI.ServiceHubs"],(function(e,t,i,s,r,a,o,n,l,c,d,u,p,f,h,g,y,m,b,v,x,w,C,S,k,F,I,M,T,_,A,P,L,B,D,R,N,H,E){"use strict";t.Widget=t.ViewModel=void 0,t.getServiceDisplayName=function(e){return e.assetType?.compositeDisplayName?.service||e.assetType?.compositeDisplayName?.plural},t.reservedCategoriesLC=void 0,t.toggleFavorite=ve,(0,C.injectCss)(S);var V=MsPortalFx.Base,W=V.Diagnostics.Telemetry,O=V.Images,z=V.Promises.cancelOnDispose;const U=window.fx.environment,j="AllServicesMenu",K=".fxs-sidebar-browse",G="fxs-portal-selected",q="fxs-sidebar-item",Q="fxs-sidebar-filter-input",J="fxs-sidebar-hide",X="."+J,Y="fxs-sidebar-flyout-allservices-list",Z="fxs-sidebar-category-button-transform",ee="fxs-sidebar-flyout-collapsed-layout",te="click",ie="keydown",se="aria-activedescendant",re="."+Q+",."+Y,ae=/order: (\d+)/,oe=w.SideBarFlyout.Filter,ne=w.SideBarFlyout.ReleaseStatusFilter,le=w.SideBarFlyout.ServiceProviderFilter,ce=w.SideBarFlyout.recentsCategory.toLocaleLowerCase(),de=w.SideBarFlyout.favoritesCategory.toLocaleLowerCase(),ue=w.SideBarFlyout.everythingCategory.toLocaleLowerCase(),pe=window.matchMedia("(max-width: 640px)"),fe=t.reservedCategoriesLC=["All","uncurated","Favorites","Recents"].map((e=>e.toLowerCase())),he={All:ne.all,GA:ne.ga,Preview:ne.preview},ge={All:le.all,Microsoft:le.microsoft,Partner:le.partner};class ye extends o.ViewModel{constructor(){super(),this.text=w.SideBarFlyout,this.isFiltered=(0,b.makeWritableComputation)(!1),this.visibleCategories=ko.observableArray(),this.visibleCategoryNames=ko.observableArray(),this.subCategories={},this.bladeTitle=(0,b.makeWritableComputation)(MsPortalFx.isFeatureEnabled("brandingsidebar")?U.branding?.browseLabel:w.SideBar.allServices),this.noResultsPerCategoryText=(0,b.makeWritableComputation)(),this.noResultsPerCategoryLink=(0,b.makeWritableComputation)(),this.favoritesCategory=(0,b.makeWritableComputation)(),this.noResultsInFavoritesCategory=(0,b.makeWritableComputation)(),this.onCategory=(0,b.makeWritableComputation)(),this.icons={hyperlink:O.Hyperlink(),favorite:O.Star({palette:99}),notFavorite:O.Favorite({palette:99}),caretUp:O.CaretUp(),caretDown:O.CaretDown(),allServices:O.Polychromatic.AllServices(),search:n,arrowRight:O.CustomImageWithOptions(f,{palette:99,customClass:"msportalfx-svg-c35"}),close:O.Close(),feedback:O.Feedback()},this.searchTextPlaceholder=w.SideBar.searchTextPlaceholder,this.filterInputValue=(0,b.makeWritableComputation)(""),this.searchBoxInfoBalloon=(0,b.makeWritableComputation)(),this.matchesPrefix=w.SideBarFlyout.keywords,this.noResults=(0,b.makeWritableComputation)(),this.hideFavoriteStars=MsPortalFx.isFeatureEnabled("hideFavoriteStars"),this.disableFavoriteStars=MsPortalFx.isFeatureEnabled("disablefavoritestars"),this.isLoading=(0,b.makeWritableComputation)(!0),this.showCategoriesDropdown=(0,b.makeWritableComputation)(!1),this.categoriesDropdown=(0,b.makeWritableComputation)(),this.startRendering=(0,b.makeWritableComputation)(),this.showFeaturedInAll=(0,b.makeWritableComputation)(),this.releaseStatusFilterValue=(0,b.makeWritableComputation)("All"),this.serviceProviderFilterValue=(0,b.makeWritableComputation)("All"),this.pillFilterCollection=(0,b.makeWritableComputation)(),this.detailViewToggle=(0,b.makeWritableComputation)(),this.showDetailView=(0,b.makeWritableComputation)(!1),this.recentCategory=(0,b.makeWritableComputation)({id:"Recents",label:this.text.recentsCategory,possibleFavorites:ko.observableArray([])}),this.noResultsInRecentCategory=(0,b.makeWritableComputation)(),this.showCategoryHeaders=(0,b.makeWritableComputation)(!0),this.currentCategoryName=(0,b.makeWritableComputation)(w.SideBarFlyout.everythingCategory),this.currentCategoryWithSubcategories=(0,b.makeWritableComputation)({id:ko.observable(),subCategoriesArray:ko.observableArray()})}}function me(e,t,i){W.trace({source:i?.source||"AllServicesMenu",name:t,action:e,data:i})}function be(e,t,i,s,r){if(e.removeClass(G),0!==e.length&&0!==t.length||(t=i),s&&r){const e=t.attr("id");s.attr(se,e)}t.addClass(G),t.get(0)?.scrollIntoView(!1)}function ve(e){const{clickedFavorite:t,favoritesManager:i,favoritesManagerDeferred:s,telemetrySource:r}=e,a=t.id,o=i.favorites,n=MsPortalFx.findIndex(o.value,(e=>e.id===a));let l,c;if(t.isFavorite()){if(-1!==n){t.isFavorite(!1);const e=MsPortalFx.find(s.allFavoriteTypes(),(e=>e.id===a));e&&e.isFavorite(!1),o.splice(n,1),l="UnFavoriteService",c=i.remove;const r=e?.portalService?.assetId;if(r){const e=MsPortalFx.find(s.allFavoriteTypes(),(e=>e.id===r));e?.isHidden?.()&&(e.isFavorite(!1),c(r))}}}else if(-1===n){t.isFavorite(!0);const e=MsPortalFx.find(s.allFavoriteTypes(),(e=>e.id===a));e&&e.isFavorite(!0),o.push(e),l="FavoriteService",c=i.add}l&&me(l,a,{totalFavorites:o.value.length,source:r}),a&&c&&c(a)}function xe(e,t,i,s,r,a,o,n){const l=!!e?.length||o&&"All"!==o||n&&"All"!==n;let c;t.isFiltered(l);const d=!r||"All"===r;if(d){const e=t.visibleCategories().filter((e=>e.id===r))[0];c=e&&e.possibleFavorites}s.read(w.SideBarFlyout.listFiltered),c=c&&c();const u=!d||!!e;return i.filterAllServices({source:"AllServices",filter:e,possibleFavorites:c,dontApplyVisibility:a,releaseStatus:o,serviceProvider:n,showKeywordAndTypeMatches:!0,includePortalServices:u,includeServiceHubs:!0}).then((e=>e))}function we(e){e.find(`.${q}.${G}`).removeClass(G);e.find(".fxs-sidebar-category-label-wrapper.fxs-portal-selected").removeClass(G)}function Ce(e,t,i){let s=e.find(`.${q}:not(${X})`)[0];s=e.find(`.${q}[style='order: 1;']`)[0]||e.find(`.${q}:not(${X})`)[0],i.parent().addClass(G),$(s).addClass(G);const r=$(s).attr("id");t.attr(se,r),t.focus()}function Se(e,t){const i=ke(t[0]),s=i.id,r=t.find(".fxs-sidebar-category-button"),a=e.find(`.${q}[data-category="${s}"]`).toArray();let o;r.hasClass(Z)?(r.attr("aria-label",w.SideBarFlyout.collapseCategory),r.removeClass(Z),a.forEach((e=>{$(e).removeClass(J)})),o="CategoryExpanded"):(r.addClass(Z),r.attr("aria-label",w.SideBarFlyout.expandCategory),a.forEach((e=>{$(e).addClass(J)})),o="CategoryCollapsed"),me(o,i.id)}function ke(e){return(0,x.getElementData)(e)}function Fe(e,t,i,s,r,a,o,n){return o.attach(e,t,i,(e=>{const t=$(e.currentTarget).attr("data-category"),i=ke(e.currentTarget),l=new n.ViewModel(i,$(e.currentTarget),r,a);l.positionHint=$(e.currentTarget).find(".fxs-dropmenu-is-open").length?1:2,W.trace({source:"HoverCard",action:"InitialReveal",name:i.id,data:{hoverCardLocation:a}});const c="AllServicesCategory"===a?i.id:"";return new o.Widget(o.getBalloonElement(i.id+(s?t:""),a,c),l,r)}),r)}t.ViewModel=ye;const Ie=(e,t)=>{const i=e.label,s=t.label,r=i.indexOf("Azure"),a=s.indexOf("Azure"),o=0===r?i.slice(r+6):i,n=0===a?s.slice(a+6):s;return o.localeCompare(n)};class Me extends o.Widget{constructor(e,t,i){super(e,t),this._sidebarBrowse=MsPortalFx.memoize((()=>$.querySelectorAll(K))),this._noResultsInCategory=ko.observable(!1),this._announce=new p.PortalReader(this.ltm,{idPrefix:"allservices"}),this._initialLoadWithCategory=!1;const s=this.ltm;this._favoritesManager=i.get(r.FavoritesManager),this._favoritesManagerDeferred=i.get(a.FavoritesManagerDeferred),this._diContainer=i,this._settingsManager=i.get(g.SettingsManager),this._serviceHubUIManager=i.get(E.ServiceHubUIManager);const o=t.visibleCategories;this.options.searchBoxInfoBalloon((0,A.create)(this.ltm,{content:w.SideBarFlyout.searchBoxInfoBalloonContent})),t.onFeedbackButtonClickHandler=()=>{const e=new P.PdlBladeReference("InProductFeedbackBlade","HubsExtension",{parameters:{bladeName:"AllServicesFlyout",cesQuestion:w.SideBarFlyout.Feedback.cesQuestion,cvaQuestion:w.SideBarFlyout.Feedback.cvaQuestion,extensionName:"Shell",featureName:"AllServicesFeedback",surveyId:"AllServices09022021"}});this._diContainer.get(k.BladeOpener).openBlade(e,{flags:1,telemetryName:"AllServicesFeedback",context:{openedBy:5}})},this._bladeManagement={openBlade:e=>i.get(k.BladeOpener).openBlade(e,{flags:8,telemetryName:"AllServicesMenu",context:{openedBy:5}}),openContextPane:e=>i.get(k.BladeOpener).openBlade(e,{flags:9,telemetryName:"AllServicesMenu",context:{openedBy:5}}),openBladeAsync:()=>Promise.resolve(!1),openContextPaneAsync:()=>Promise.resolve(!1)},this._router=i.get(d.Router),this._recentsManager=i.get(u.RecentServicesManager),this._diContainer.get(L.Experimentation).shellAssignments.whenAvailable().then((e=>{e.getBooleanValue("azHome")&&this.options.bladeTitle(w.SideBar.services);const i=(0,_.getAllAssetTypes)({includeBrowseManifest:!0});return Promise.all([this._favoritesManagerDeferred.initializeCategories(),i,this._serviceHubUIManager.initialize()]).then((e=>{let[i]=e;const[,r]=e;this._allAssetTypesDetailsMap=r&&MsPortalFx.extendArrayIntoMap(Object.create(null),r,(e=>e.resourceType&&e.resourceType.toLowerCase()),(e=>e.resourceType&&e));const a=[],n=this._serviceProviderValueGrid=I.create(s,{header:{visible:!1},columns:[I.createTemplateColumn({id:"name",header:oe.value,width:"100fr",cell:{template:"<div><span data-bind='text: value'></span><span data-bind='pcControl: infoBalloon'></span></span></div>",viewModel:e=>({value:ge[e],infoBalloon:"Partner"===e?(0,A.create)(s,{content:{htmlTemplate:`<div style="margin-bottom:10px">${w.SideBarFlyout.partnertagpilldescription.format(`<b>${w.SideBarFlyout.partnertagisv}</b>`)}</div><a href="https://aka.ms/ANIS/Overview/AzurePortal" class='msportalfx-ext-link' target="_blank">${w.SideBarFlyout.learnMore}</a>`}}):null})}})],ariaLabel:oe.valueList,dataSource:()=>Object.keys(ge).map((e=>({id:e.toString(),item:e}))),selection:{selectionMode:0}});n.refresh(),a.push(F.create(s,{showRemoveButton:!1,ariaLabel:le.serviceProvider,getKeyText:e=>le.serviceProvider,getOperatorText:e=>":",getValueText:e=>ge[e],value:(0,B.toObservable)(this.ltm,this.options.serviceProviderFilterValue),createEditor:e=>({onEditModeExited:e=>{let t;return 4===e?(t=n.selection.selectedItems()[0],this.options.serviceProviderFilterValue(t),me("ServiceProviderFilterUpdated",ge[t])):(t=this.options.serviceProviderFilterValue.value,n.selection.selectItemById(t.toString())),t},title:le.serviceProvider,buttons:[{button:4,displayText:oe.apply},{button:1,displayText:oe.cancel}],content:{htmlTemplate:'<div style="width: 250px;"><div data-bind="pcControl: valueGrid"></div></div>',viewModel:{valueGrid:n}}})}));const l=this._releaseStatusValueGrid=I.create(s,{header:{visible:!1},columns:[I.createTextColumn({id:"name",header:oe.value,width:"100fr",cell:{text:e=>he[e]}})],ariaLabel:oe.valueList,dataSource:()=>Object.keys(he).map((e=>({id:e.toString(),item:e}))),selection:{selectionMode:0}});if(l.refresh(),a.push(F.create(s,{showRemoveButton:!1,ariaLabel:ne.releaseStatus,getKeyText:e=>ne.releaseStatus,getOperatorText:e=>":",getValueText:e=>he[e],value:(0,B.toObservable)(this.ltm,this.options.releaseStatusFilterValue),createEditor:e=>({onEditModeExited:e=>{let t;return 4===e?(t=l.selection.selectedItems()[0],this.options.releaseStatusFilterValue(t),me("ReleaseStatusFilterUpdated",he[t])):(t=this.options.releaseStatusFilterValue.value,l.selection.selectItemById(t.toString())),t},title:ne.releaseStatus,buttons:[{button:4,displayText:oe.apply},{button:1,displayText:oe.cancel}],content:{htmlTemplate:'<div style="width: 250px;"><div data-bind="pcControl: valueGrid"></div></div>',viewModel:{valueGrid:l}}})})),a.length&&this.options.pillFilterCollection(M.create(s,{ariaLabel:oe.filter,items:a,multipleRows:!1})),this._settingsManager.querySetting(7,"DetailView").then((e=>{const t=e?.enabled;W.trace({source:j,action:"DetailViewEnabled",data:{detailViewEnabled:t}});const i=(0,T.create)(s,{ariaLabel:this.options.text.DetailView.toggleLabel,value:t,valueText:{onText:this.options.text.DetailView.toggleLabel,offText:this.options.text.DetailView.toggleLabel},visible:(0,B.toObservable)(this.ltm,this.options.isFiltered.compose(H.negation))});i.value.subscribe(s,(e=>{W.trace({source:j,action:"DetailViewToggled",data:{enabled:e}}),this._settingsManager.setSetting(7,"DetailView",{enabled:e})})),this.options.detailViewToggle(i),this._displayDetailViewToggleBubble(),(0,b.subscribeAndRun)(s,[(0,B.toComputation)(i.value),this.options.isFiltered],((e,t)=>this.options.showDetailView(e&&!t)))})),i=i.filter((e=>e.id.toLowerCase()!=="uncurated".toLowerCase())),this._favoritesManagerDeferred.updateForRecents(null,20).then((e=>{this.options.recentCategory.value.possibleFavorites.subscribeAndRun(this.ltm,(e=>{e?.forEach((e=>this._applyCommand(e,(()=>({categoryId:this.options.currentCategoryName.value,subCategoryId:e.subCategoryId,detailViewEnabled:this.options.showDetailView.value})))))})),this.options.noResultsInRecentCategory(!e?.length)})),"overview"===i[0].id.toLowerCase()){const e=i.shift(),s=e.possibleFavorites().filter((e=>!e.isDisabled)).slice(0,9);e.possibleFavorites(s),t.overviewCategory=e,t.showFeaturedInAll(!0)}const c={id:"Favorites",label:this.options.text.favoritesCategory,possibleFavorites:ko.observableArray()};(0,b.subscribeAndRun)(this.ltm,[this._favoritesManager.favorites],(e=>{const t=e.slice().sort(((e,t)=>Ie(e,t)));c.possibleFavorites(t),!e?.length&&this.options.noResultsInFavoritesCategory(!0)})),this.options.favoritesCategory(c),this.options.favoritesCategory.value.possibleFavorites.subscribeAndRun(this.ltm,(e=>{e.forEach((e=>this._applyCommand(e,(()=>({categoryId:this.options.currentCategoryName.value,subCategoryId:e.subCategoryId,detailViewEnabled:this.options.showDetailView.value})))))}));const d=["All","uncurated","Favorites","Recents","General"].map((e=>e.toLowerCase()));i.sort(((e,t)=>d.includes(e.id.toLowerCase())||d.includes(t.id.toLowerCase())?0:e.label.toLowerCase()<=t.label.toLowerCase()?-1:1));const u=i.map((e=>{const t=MsPortalFx.clone(e),i=t.possibleFavorites().reduce(((e,t)=>({...e,[t.subCategoryId]:[...e[t.subCategoryId]||[],t]})),{});let r=[];return MsPortalFx.forEachKey(i,(e=>{i[e].sort(((e,t)=>Ie(e,t))),r=r.concat(i[e])})),t.possibleFavorites(r),t.possibleFavorites=e.possibleFavorites.filter(s,(t=>!e.isHidden()&&!t.isHidden()&&"Microsoft_Azure_GeneratedExtension"!==t.assetType?.extension)),t})).filter((e=>!e.isHidden())),p=u.map((e=>({label:e.label,id:e.id})));u.forEach((e=>{const i=e.possibleFavorites().reduce(((e,t)=>{if(t.subCategoryId){const i=e.find((e=>e.subCategoryId?.toLowerCase()===t.subCategoryId.toLowerCase()));if(i)i.servicesinSubCategory.push(t);else{const i={subCategoryId:t.subCategoryId,servicesinSubCategory:(0,b.makeArrayComputation)(),currentVisibileCount:(0,b.makeWritableComputation)(0)};i.servicesinSubCategory.push(t),e.push(i)}}else if(t.serviceHub){const i=e.find((e=>e.serviceHub?.id?.toLowerCase()===t.id.toLowerCase()));if(!i){const i={serviceHub:t,servicesinSubCategory:(0,b.makeArrayComputation)(),currentVisibileCount:(0,b.makeWritableComputation)(0)};e.push(i)}}else if(t.portalService){const i=this._serviceHubUIManager.getParentFavoriteType(t);if(i){const s=e.find((e=>e.serviceHub?.id.toLowerCase()===i.id.toLowerCase()));if(s)s.servicesinSubCategory.push(t);else{const s={serviceHub:i,servicesinSubCategory:(0,b.makeArrayComputation)(),currentVisibileCount:(0,b.makeWritableComputation)(0)};s.servicesinSubCategory.push(t),e.push(s)}}}else if(!t.serviceHub&&!t.portalService&&!t.subCategoryId)if(e[0]?.servicesinSubCategory?.value.length)e[0].servicesinSubCategory.push(t);else{const i={servicesinSubCategory:(0,b.makeArrayComputation)(),currentVisibileCount:(0,b.makeWritableComputation)(0)};i.servicesinSubCategory.push(t),e.push(i)}return e}),[]);Object.keys(i).length&&(i.forEach((e=>e.currentVisibileCount(e.servicesinSubCategory.value.length))),t.subCategories[e.id]=i,i.sort(((e,t)=>e.serviceHub&&!t.serviceHub?-1:!e.serviceHub&&t.serviceHub?1:0)))})),o(u),t.visibleCategoryNames(p);const f=this._currentCategoryName?.text()||w.SideBarFlyout.everythingCategory;this.options.currentCategoryName(f),t.visibleCategories().forEach((e=>{e.possibleFavorites().forEach((e=>{this._applyCommand(e,(()=>({categoryId:this.options.currentCategoryName.value,subCategoryId:e.subCategoryId,detailViewEnabled:this.options.showDetailView.value})))}))})),this.options.startRendering(!0)}))})).finally((()=>{this.options.isLoading(!1);const t=()=>{this._filterInput=e.find(`.${Q}`),this._browseLink=$.querySelectorAll(K);const t=MsPortalFx.getUniqueId();e.find(".fxs-sidebar-flyout-allcategories-list").attr({id:t,"aria-label":this._browseLink.attr("aria-label")}),this._filterInput.attr("aria-owns",t),this._currentCategoryName||this.options.showCategoriesDropdown.value||(this._currentCategoryName=this.element.find(".fxs-sidebarflyout-category-button").first());const i=ke(this._currentCategoryName[0]);i&&this.options.onCategory(i.id),this._renderSidebarFlyout(pe),new m.KeyboardNavigation(this.ltm,{element:e.find(".fxs-sidebar-flyout-category-list"),tabTriggers:12,itemSelector:".fxs-sidebar-category-name"}),new m.KeyboardNavigation(this.ltm,{element:e.find(".fxs-sidebar-flyout-featured-container"),tabTriggers:12,itemSelector:".fxs-sidebar-flyout-featured-item-details"}),new m.KeyboardNavigation(this.ltm,{element:e.find(".fxs-sidebar-flyout-freetrainings-container"),tabTriggers:12,itemSelector:".fxs-sidebar-flyout-freetrainings-item-container"}),new m.KeyboardNavigation(this.ltm,{element:e.find(".fxs-sidebar-flyout-usefullinks-container"),tabTriggers:12,itemSelector:".fxs-sidebar-flyout-usefullinks-link"}),this._attachEventHandlers(),this._initiateSelection()};(0,v.invokeAfterChangePropagation)((()=>{t();const e=this.options.categoryInputValue;e?.length&&this.options.onCategory.value?.toLowerCase()!==e.toLowerCase()&&(this._initialLoadWithCategory=!0,this._switchCategories(null,e,null,!0))}))})),this._noResultsInCategory.subscribe(s,(e=>{e||this.element.find(`.fxs-sidebar-flyout-noresults:not(${X},.fxs-display-none)`).toArray().forEach((e=>{$(e).addClass(J)}))}))}_applyCommand(e,t){if(!e)return;const i=new D.TriggerableLifetimeManager,s=e.assetType?.lowerCaseResourceType,r=s&&this._allAssetTypesDetailsMap[s],a=r&&(0,R.createServiceHoverCardCommand)({showIcon:!0,showLabel:!1,showCustomIcon:!1},"AllServicesMenu",t,r?.browseManifest,i,(()=>e.assetType?.extension),e?.resourceType,this._bladeManagement,e.isDisabled,r?.hiddenCommands,e.kind),o=[];if(a)o.push(a);else{const s=this._favoritesManagerDeferred.getCreateCommandForService({buttonOptions:{showIcon:!0,showLabel:!1,showCustomIcon:!1},lifetime:i,assetTypeInfo:e,source:"AllServicesMenu",supplyAdditionalTelemetryData:t,openedBy:5,telemetryName:"AllServicesMenu"});s&&o.push(s)}e.commandsToolbarListView=ko.observable(c.create(i,{items:o,showLabels:!0}));const n=r&&(0,R.createServiceHoverCardCommand)({showIcon:!1,showLabel:!0,showCustomIcon:!1},"AllServicesMenu-DetailView",t,r?.browseManifest,i,(()=>e.assetType?.extension),e?.resourceType,this._bladeManagement,e.isDisabled,r?.hiddenCommands,e.kind),l=[];if(n)l.push(n);else{const s=this._favoritesManagerDeferred.getCreateCommandForService({buttonOptions:{showIcon:!1,showLabel:!0,showCustomIcon:!1},lifetime:i,assetTypeInfo:e,source:"AllServicesMenu-DetailView",supplyAdditionalTelemetryData:t,openedBy:5,telemetryName:"AllServicesMenu-DetailView"});s&&l.push(s)}l.length&&(e.commandsToolbarDetailView=ko.observable(c.create(i,{items:l,showLabels:!0})))}dispose(){super.dispose(),this._cleanElement(),this._sidebarBrowse.clear()}onDisplay(e,t){const i=this.element,s=this._filterInput;if(s&&s.focus(),t&&me("SideBarBrowseMenuOpened"),e){const t=decodeURIComponent(e);this.options.filterInputValue(t),xe(t,this.options,this._favoritesManagerDeferred,this._announce,"All")}we(i),this._currentCategoryName&&Ce(i,s,this._currentCategoryName)}_renderSidebarFlyout(e){if(e.matches){const e=this._currentCategoryName.text();let t;switch(e){case w.SideBarFlyout.everythingCategory:t={label:w.SideBarFlyout.everythingCategory,id:"All"};break;case w.SideBarFlyout.favoritesCategory:t={label:w.SideBarFlyout.favoritesCategory,id:"Favorites"};break;case w.SideBarFlyout.recentsCategory:t={label:w.SideBarFlyout.recentsCategory,id:"Recents"};break;default:t=this.options.visibleCategories().filter((t=>t.label===e))[0]}if(this.options.categoriesDropdown.value)this.options.categoriesDropdown.value.value({label:t.label,id:t.id});else{const e=function(e,t){const i=[];return i.push({text:w.SideBarFlyout.everythingCategory,value:{label:w.SideBarFlyout.everythingCategory,id:"All"}}),i.push({text:w.SideBarFlyout.favoritesCategory,value:{label:w.SideBarFlyout.favoritesCategory,id:"Favorites"}}),i.push({text:w.SideBarFlyout.recentsCategory,value:{label:w.SideBarFlyout.recentsCategory,id:"Recents"}}),t().forEach((e=>{const t={text:e.label,value:{label:e.label,id:e.id}};i.push(t)})),h.create(e,{ariaLabel:w.SideBarFlyout.categoriesDropdownLabel,multiselect:!1,items:i,suppressDirtyBehavior:!0,value:{label:"",id:""}})}(this.ltm,this.options.visibleCategories);e.value({label:t.label,id:t.id}),e.value.subscribe(this.ltm,(e=>{this._switchCategories(null,e.label,e.id)})),this.options.categoriesDropdown(e)}this.options.showCategoriesDropdown(!0),this.element.addClass(ee)}else this.options.showCategoriesDropdown(!1),this.element.removeClass(ee)}_initiateSelection(e){const t=this.element,i=this._filterInput;e?this._bindingPromise.then((()=>{Ce(t,i,this._currentCategoryName)})):Ce(t,i,this._currentCategoryName)}_switchCategories(e,t,i,s){this.options.releaseStatusFilterValue("All"),this._releaseStatusValueGrid.selection.selectItemById("All"),this.options.serviceProviderFilterValue("All"),this._serviceProviderValueGrid.selection.selectItemById("All");let r=Promise.resolve();const a=t?.toLocaleLowerCase(),o=e?.find(".fxs-sidebarflyout-category-button")?.[0]?.getAttribute("data-category")?.toLowerCase();this.options.noResultsInRecentCategory(!1),a===ce||o===ce?(this.options.onCategory("Recents"),r=this._favoritesManagerDeferred.updateForRecents(null,20).then((e=>{this.options.recentCategory.value.possibleFavorites(e),this.options.noResultsInRecentCategory(!e?.length)})),this.options.noResultsInFavoritesCategory(!1)):a===de||o===de?(this.options.onCategory("Favorites"),this.options.noResultsInFavoritesCategory(!this.options.favoritesCategory.value.possibleFavorites().length)):this.options.noResultsInFavoritesCategory(!1),this._currentCategoryName.parent().removeClass(G);const n=this._currentCategoryName,c=()=>{we(this.element),this._initiateSelection(),this._filterInput.focus()};let d;if(t){const e=this.element.find(".fxs-sidebarflyout-category-button").toArray();let s;s=i?e.filter((e=>e.getAttribute("data-category").toLowerCase()===i.toLowerCase())):e.filter((e=>e.getAttribute("title").toLowerCase()===t.toLowerCase())),s.length?(this._currentCategoryName=$(s),d=t):(this._currentCategoryName=this.element.find(".fxs-sidebarflyout-category-button[data-category='{0}']".format(w.SideBarFlyout.everythingCategory)),d=w.SideBarFlyout.everythingCategory)}else this._currentCategoryName=e&&e.find(".fxs-sidebarflyout-category-button"),d=this._currentCategoryName[0]?.getAttribute("data-category");const u=ke(this._currentCategoryName[0]),p=u.id||"All";if(this.options.onCategory(p),this.options.currentCategoryName(d),fe.includes(p.toLowerCase()))this.options.currentCategoryWithSubcategories.value.subCategoriesArray([]),xe("",this.options,this._favoritesManagerDeferred,this._announce,"All").then((()=>{(this.options.noResults.value||this._noResultsInCategory())&&(this.options.noResults(!1),this._noResultsInCategory(!1));const e="All".toLowerCase(),t=d.toLocaleLowerCase()===e||o===e;this.options.showCategoryHeaders(t),fe.includes(p.toLowerCase())&&("All"===p?(this.element.find(`.${q}`).toArray().forEach((e=>{$(e).removeClass(J)})),l.unhide(this.element.find(".fxs-sidebar-item-category")),this.options.showFeaturedInAll(!!this.options.overviewCategory)):(this.options.showFeaturedInAll(!1),r.then((()=>{this.element.find(`.${q}`).toArray().forEach((e=>{$(e)[0]?.getAttribute("data-category")?.toLowerCase()!==p.toLowerCase()?$(e).addClass(J):$(e).removeClass(J)}))})),l.hide(this.element.find(".fxs-sidebar-item-category")),l.unhide(this.element.find("li[data-category='{0}']".format(d))))),c()}));else{const e=this.options.subCategories[p];this.options.currentCategoryWithSubcategories.value&&(this.options.currentCategoryWithSubcategories.value.id(p),xe("",this.options,this._favoritesManagerDeferred,this._announce,p).then((()=>{e.forEach((e=>{e.currentVisibileCount(e.servicesinSubCategory.value.filter((e=>!e.isHidden()&&!e.isFilteredOut())).length)})),this.options.currentCategoryWithSubcategories.value.subCategoriesArray(e)}))),e?.length&&xe("",this.options,this._favoritesManagerDeferred,this._announce,p).then((()=>{c()})),(0,v.invokeAfterChangePropagation)((()=>{this._subCategoryViewElement?.length||(this._subCategoryViewElement=this.element.find(".fxs-sidebar-flyout-services-list-with-subcategories"))}))}e&&e.addClass(G);const f=ke(n[0]);this.options.showCategoriesDropdown.value?me("CategorySwitch",i):me("CategorySwitch",u?.id,{previousCategory:f?.id});const h=encodeURIComponent(this.options.onCategory.value);if(s){const e=this.options.filterInputValue.value;window.location.hash=e?`#allservices/category/${h}/filter/${e}`:`#allservices/category/${h}`,this.options.filterInputValue(e)}else{const e=window.location.hash;e!==`#allservices/category/${h}`&&"#allservices"!==e||this.options.filterInputValue(""),window.location.hash=`#allservices/category/${h}`}}_attachEventHandlers(){const t=this._filterInput,i=this.element,r=s.getModifierKeys;let a={};const o=e=>{if(e){const t=(e instanceof jQuery?e:$(e.currentTarget)).find(".fxs-allservices-menu-commands");t?.removeClass("fxs-display-none"),!(e instanceof jQuery)&&e.stopImmediatePropagation()}},n=e=>{if(e){const t=(e instanceof jQuery?e:$(e.currentTarget)).find(".fxs-allservices-menu-commands");t?.addClass("fxs-display-none"),!(e instanceof jQuery)&&e.stopImmediatePropagation()}},c=()=>{this._renderSidebarFlyout(pe)};y.isSafari?(pe.addListener(c),this.ltm.registerForDispose((()=>pe.removeListener(c)))):(pe.addEventListener("change",c),this.ltm.registerForDispose((()=>pe.removeEventListener("change",c))));this.element.on({mouseenter:e=>{$(e.currentTarget).find(".fxs-sidebar-star").removeClass("fxs-sidebar-hide"),o(e),e.stopImmediatePropagation()},mouseleave:e=>{const t=e.currentTarget,i=$(t).find(".fxs-sidebar-star");ke(t).isFavorite?.()||i.addClass("fxs-sidebar-hide"),n(e),e.stopImmediatePropagation()}},".fxs-sidebar-flyout-item-content"),this.element.on({mouseenter:o,mouseleave:n},".fxs-sidebar-flyout-item-content");const d=(e,t)=>{e.opensExternal?window.open(e.uri,"_blank"):(this._router.route(e.uri,{openedBy:5}),this._recentsManager.addService({type:"favoriteType",favoriteType:e})),t.preventDefault(),t.stopPropagation()};this.ltm.registerForDispose(this.element.setEvents([te,".fxs-sidebar-flyout-freetrainings-item",e=>{const t=ke(e.currentTarget);me("FreeTrainingLinkClicked","FreeTrainings",{linkDestination:t.link,displayTitle:t.title,category:this._currentCategoryName.text()})}],[te,".fxs-sidebarflyout-category-nodata",e=>{this._noResultsInCategory(!1),a={},t.focus(),this._currentCategoryName.parent().removeClass(G);const s=this.options.filterInputValue.value;l.unhide(this.element.find(".fxs-sidebar-item-category")),xe("",this.options,this._favoritesManagerDeferred,this._announce,"All").then((()=>{we(i),this._currentCategoryName=this.element.find(".fxs-sidebarflyout-category-button[data-category='All']").first(),this.options.filterInputValue(s),xe(s,this.options,this._favoritesManagerDeferred,this._announce,"All").then((()=>{this._currentCategoryName.parent().addClass(G),s?.length&&(this.element.find(`.${q}`).toArray().forEach((e=>{ke(e).isFilteredOut()||$(e).removeClass(J)})),this.element.find(`.${q}:not(${X})`).toArray().forEach((e=>{const t=ke(e);a[t.label]?$(e).addClass("fxs-sidebar-hide"):a[t.label]=!0}))),we(i),Ce(i,t,this._currentCategoryName)}))})),e.preventDefault()}],[ie,".fxs-sidebar-flyout-category-list,.fxs-sidebar-category-name",e=>{if(13===e.keyCode||32===e.keyCode){const e=i.find(".fxs-sidebar-flyout-category-list").find(`.fxs-sidebar-category-name.${G}`);this._switchCategories(e)}}],[te,".fxs-sidebar-category-name",e=>{if(e.type===te){const t=$(e.currentTarget);this._switchCategories(t)}}],[te+" "+ie,".fxs-sidebar-category-label-wrapper",e=>{const t=$(e.currentTarget);if(e.type===te||e.type===ie&&13===e.keyCode||32===e.keyCode)return Se(this.element,t),e.stopPropagation(),e.preventDefault(),!1}],[te,".fxs-search-clear",e=>{this.options.filterInputValue(""),this._noResultsInCategory(!1),we(i),Ce(i,t,this._currentCategoryName)}],[te+" "+ie,".fxs-sidebar-star",e=>{const t=e.type===ie&&13===e.keyCode&&this.options.showDetailView.value;if(e.type===te||t){ve({clickedFavorite:ke(e.currentTarget),favoritesManager:this._favoritesManager,favoritesManagerDeferred:this._favoritesManagerDeferred,telemetrySource:"AllServicesMenu"})}e.type===te&&we(i)}],[te,".fxs-sidebar-service-hub-header a",e=>{const t=ke(e.currentTarget);me("AllServicesServiceHubOpened",t.id,{detailViewEnabled:this.options.showDetailView.value,categoryId:this.options.currentCategoryName.value}),this._router.route(t.uri,{openedBy:5}),this._recentsManager.addService({type:"favoriteType",favoriteType:t})}],[te+" "+ie,".fxs-sidebar-item a,.fxs-sidebar-flyout-featured-item-asset a,.fxs-allservices-menu-subcategory-item a",e=>{const t=e.type===ie&&13===e.keyCode&&this.options.showDetailView.value;if(e.type===te||t){const t=ke(e.currentTarget),i=$(e.target).closest(".fxs-sidebar-flyout-featured-item-asset").length?"OverviewFeaturedItemOpened":"AllServicesAssetTypeOpened",s={detailViewEnabled:this.options.showDetailView.value,categoryId:this.options.currentCategoryName.value,subCategoryId:t.subCategoryId};me(i,t.id,{...s,isFavorite:t.isFavorite(),isPreview:t.isPreview}),d(t,e)}}],[ie,".fxs-sidebar-flyout-category-list",e=>{const t=i.find(".fxs-sidebar-flyout-category-list"),s=t.find(`.fxs-sidebar-category-name.${G}`),r=t.find(".fxs-sidebar-category-name").first(),a=t.find(".fxs-sidebar-category-name").last();let o;switch(e.keyCode){case 40:o=s.nextUntil("",".fxs-sidebar-category-name").first(),be(s,o,r);break;case 38:o=s.prevUntil("",".fxs-sidebar-category-name").first(),be(s,o,a)}}],[te+" "+ie,".fxs-sidebar-flyout-overview-seeAllServices",e=>{(e.type===te||e.type===ie&&13===e.keyCode||32===e.keyCode)&&this._switchCategories(null,"All")}],[ie,re,e=>{let s=i.find(`.${q}.${G}`);s.length||(s=i.find(".fxs-sidebar-category-label-wrapper.fxs-portal-selected"));const r=i.find(`.${Y}`),a=s.attr("style");let o,n=0;const l=i.find(`.${q}`).not(X).first(),c=i.find(`.${q}`).not(X).last();switch(a&&ae.test(a)&&(n=parseInt(ae.exec(a)[1])),e.keyCode){case 40:o=n?$(i.find(`.${q}[style='order: ${n+1};']`)):s.nextAll(`:not(${X},.fxs-display-none)`).first(),be(s,o,l,t,r),t.focus(),e.stopPropagation();break;case 38:o=n>1?$(i.find(`.${q}[style='order: ${n-1};']`)):s.prevAll(`:not(${X},.fxs-display-none)`).first(),be(s,o,c,t,r),t.focus(),e.stopPropagation()}}])),z(this.ltm,Promise.all([MsPortalFx.require(e.normalize("MsPortalImpl/Widgets/Widgets.HoverCard")),MsPortalFx.require(e.normalize("MsPortalImpl/Widgets/ServiceHoverCard"))])).then((([e,t])=>{Fe(this.ltm,this.element,".fxs-sidebar-flyout-featured-item-asset",!1,this._diContainer,"AllServicesFeatured",e,t);const s=Fe(this.ltm,this.element,".fxs-sidebar-flyout-item-content",!0,this._diContainer,"AllServicesCategory",e,t);this.ltm.registerForDispose(this.element.setEvents([ie,re,e=>{const t=r(e);let a,o=i.find(`.${q}.${G}`);if(o.length||(o=i.find(".fxs-sidebar-category-label-wrapper.fxs-portal-selected")),o.length>0&&(a=ke(o[0])),38!==e.keyCode&&40!==e.keyCode||e.preventDefault(),MsPortalFx.isFeatureEnabled("showHoverCard")){if(112===e.keyCode)return s(o[0]),e.stopPropagation(),e.preventDefault(),!1}else if(32===e.keyCode&&4===t)return ve({clickedFavorite:a,favoritesManager:this._favoritesManager,favoritesManagerDeferred:this._favoritesManagerDeferred,telemetrySource:"AllServicesMenu"}),e.stopPropagation(),!1;if(13===e.keyCode&&0===t){if(($(e.target).is("input")||$(e.target).hasClass("fxs-sidebar-flyout-allservices-list"))&&$(o[0]).hasClass("fxs-sidebar-category-label-wrapper"))return Se(this.element,o),e.stopPropagation(),e.preventDefault(),!1;a&&!this.options.showDetailView.value&&d(a,e),e.stopPropagation()}}]))}));const u=(e,t,i)=>{const s={};t!==e&&this.element.find(`.${q}:not(${X})`).toArray().forEach((e=>{const t=ke(e);if(s[t.label])if(i){const e=t.labelId;this.element.find(`li[id="${e}"]`).toArray().forEach((e=>{$(e).attr("data-category")!==i&&$(e).addClass("fxs-sidebar-hide")}))}else $(e).addClass("fxs-sidebar-hide");else s[t.label]=!0}))};(0,b.subscribeAndRun)(this.ltm,[this.options.filterInputValue,this.options.releaseStatusFilterValue,this.options.serviceProviderFilterValue],((e,s,r)=>{const a=()=>{const a=this._currentCategoryName?.text()||w.SideBarFlyout.everythingCategory,o=ke(this._currentCategoryName[0])?.id||"All";if(a.toLocaleLowerCase()===this.options.text.favoritesCategory.toLocaleLowerCase()){this.options.isFiltered(!!e?.length||s&&"All"!==s||r&&"All"!==r);const t=this.options.favoritesCategory.value.possibleFavorites();t?.length&&this._favoritesManagerDeferred.filterAllServices({source:"AllServices",filter:e,possibleFavorites:t,dontApplyVisibility:!1,releaseStatus:s,serviceProvider:r,showKeywordAndTypeMatches:!0,includeServiceHubs:!0,includePortalServices:!0}).then((e=>{u(e.matchCount,this.element.find(`.${q}:not(${X})`).length,a),e.matchCount?this.options.noResults(!1):this.options.noResults(!0)}))}else{if(a.toLocaleLowerCase()!==this.options.text.recentsCategory.toLocaleLowerCase()){this.element.find(".fxs-sidebar-category-button").toArray().some((e=>$(e).hasClass(Z)))&&function(e,t){if(t===w.SideBarFlyout.everythingCategory)e.find(".fxs-sidebar-category-button").toArray().forEach((t=>{if($(t).hasClass(Z)){const i=$(t).parent().attr("data-category");$(t).removeClass(Z),e.find(`.${q}[data-category="${i}"]`).toArray().forEach((e=>{$(e).removeClass(J)}))}}));else{const i=e.find(`.fxs-sidebar-category-button[data-category="${t}"]`).first(),s=e.find(`.${q}[data-category="${t}"]`).toArray();i.hasClass(Z)&&(i.removeClass(Z),s.forEach((e=>{$(e).removeClass(J)})))}}(this.element,a);let n,l=!1;return this._noResultsInCategory(!1),this.options.noResultsPerCategoryLink(""),n=e?.length>1?N.delay(100).then((()=>{if(this.options.filterInputValue.value===e)return xe(e||"",this.options,this._favoritesManagerDeferred,this._announce,o,void 0,s,r)})):xe(e||"",this.options,this._favoritesManagerDeferred,this._announce,o,void 0,s,r),n.then((o=>{const n=ke(this._currentCategoryName[0]);if(""===e&&a.toLocaleLowerCase()===ue&&this.options.showCategoryHeaders(!0),this.options.filterInputValue.value?.length&&me("SearchInAllServicesMenu",MsPortalFx.sanitizeMessage(this.options.filterInputValue.value),{currentCategory:n&&n.id}),o){we(i),Ce(i,t,this._currentCategoryName);const n=this.element.findByClassName(Y),c=!n.length||n.hasClass("weave-display-none2")?this._subCategoryViewElement:n,d=c?.find(`.fxs-sidebar-flyout-item-content:not(${X}, .weave-display-none2), .fxs-sidebar-flyout-card:not(${X}, .weave-display-none2)`).length;this.options.currentCategoryWithSubcategories?.value?.subCategoriesArray().forEach((e=>{e.currentVisibileCount(e.servicesinSubCategory.value.filter((e=>!e.isHidden()&&!e.isFilteredOut())).length)})),l=0===d,this.options.onCategory.value&&"All"!==this.options.onCategory.value?(l&&(s&&"All"!==s||r&&"All"!==r?this.options.noResultsPerCategoryText(w.SideBarFlyout.noResultsText):xe(e||"",this.options,this._favoritesManagerDeferred,this._announce,"All",!0).then((t=>{const i=t&&t.matchCount;this.options.noResultsPerCategoryText(w.SideBarFlyout.noResultsInCategory.format(e,a)),i&&this.options.noResultsPerCategoryLink(w.SideBarFlyout.noResultsInCategoryLink.format(i))})),this.element.find(`.fxs-sidebar-flyout-noresults[data-category="${a}"]`).toArray().forEach((e=>{$(e).removeClass(J)}))),this.options.currentCategoryWithSubcategories?.value?.id()?.toLowerCase()===ue&&u(o.matchCount,d,a),this._noResultsInCategory(l)):(n.hasClass("weave-display-none2")?this.options.currentCategoryWithSubcategories.value.subCategoriesArray().forEach((e=>{e.currentVisibileCount(e.servicesinSubCategory.value.filter((e=>!e.isHidden()&&!e.isFilteredOut())).length)})):this.options.visibleCategories().forEach((e=>{e.count(e.possibleFavorites().filter((e=>!e.portalService&&!e.isHidden()&&!e.isFilteredOut())).length)})),this.options.noResults(l),this.options.isFiltered.value?u(o.matchCount,d):this.element.find(`.${q}${X}`).toArray().forEach((e=>{const t=ke(e);t.isFilteredOut()||t.isHidden()||$(e).removeClass("fxs-sidebar-hide")})));const p=i.find(`.${q}.${G}`);p.length&&p?.is(":visible")||(we(this.element),this._initiateSelection())}}))}{this.options.isFiltered(!!e?.length||s&&"All"!==s||r&&"All"!==r);const t=this.options.recentCategory.value.possibleFavorites();t?.length&&this._favoritesManagerDeferred.filterAllServices({source:"AllServices",filter:e,possibleFavorites:t,dontApplyVisibility:!1,releaseStatus:s,serviceProvider:r,showKeywordAndTypeMatches:!0,includeServiceHubs:!0,includePortalServices:!0}).then((e=>{e.matchCount?this.options.noResults(!1):this.options.noResults(!0)}))}}};this.options.isLoading.value||(0,v.invokeAfterChangePropagation)((()=>{this._initialLoadWithCategory?(this._initialLoadWithCategory=!1,this.options.filterInputValue.value&&a()):a()}))}))}async _displayDetailViewToggleBubble(){const e=await MsPortalFx.require("MsPortalImpl/Widgets/Widgets.TeachingBubble"),t=this._settingsManager;if((await t.querySettings({store:7,keys:["DetailViewToggleTeachingBubble"]})).DetailViewToggleTeachingBubble)return;const i=$.querySelectorAll(".fxs-sidebar-flyout-detail-view-toggle")?.get(0);i&&(W.trace({source:j,action:"DetailViewToggleTeachingBubble",actionModifier:"shown",data:{currentCategory:this._currentCategoryName?.text()}}),e.createTeachingBubble({teachingBubbleOptions:[{targetElement:i,directionalHint:"up",title:w.SideBarFlyout.DetailView.TeachingBubble.title,description:w.SideBarFlyout.DetailView.TeachingBubble.description,actionButtonText:w.SideBarFlyout.DetailView.TeachingBubble.tryDetailView}],onCompletion:()=>{t.setSetting(7,"DetailViewToggleTeachingBubble",{viewed:+Date.now(),action:"complete"}),W.trace({source:j,action:"DetailViewToggleTeachingBubble",actionModifier:"activated",data:{currentCategory:this._currentCategoryName?.text()}}),this.options.detailViewToggle.value.value(!0)},onDismiss:()=>{t.setSetting(7,"DetailViewToggleTeachingBubble",{viewed:+Date.now(),action:"dismiss"}),W.trace({source:j,action:"DetailViewToggleTeachingBubble",actionModifier:"dismissed",data:{currentCategory:this._currentCategoryName?.text()}})},isCoachmark:!0,onCoachmarkExpanded:()=>{W.trace({source:j,action:"DetailViewToggleTeachingBubble",actionModifier:"coachmarkExpanded",data:{currentCategory:this._currentCategoryName?.text()}})},diContainer:this._diContainer,featureName:"AllServicesDetailViewToggleBubble"}))}}t.Widget=Me}));