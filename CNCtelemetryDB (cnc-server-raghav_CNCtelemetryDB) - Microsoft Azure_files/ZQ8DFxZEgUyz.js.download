define("MsPortalImpl/Widgets/ServiceHoverCard",["require","exports","MsPortalImpl/TsxStringMode/Tsx","Fx/Controls/Toolbar","MsPortalImpl/Resources/ImplScriptResources","FxHubs/RpcEndPoints","MsPortalImpl/Services/Services.BrowseCuration","FxHubs/ResourceCommands/BrowseCommanding","MsPortalImpl/UI/UI.BladeOpener","Fx/Experimentation","MsPortalImpl/UI/Hubs/UI.FavoritesManagerDeferred","MsPortalImpl/UI/Hubs/UI.FavoritesManager","MsPortalImpl/Widgets/Widgets.HoverCard","MsPortalImpl/Services/Services.Recents","MsPortalImpl/Base/Base.SvgHelper","_generated/MsPortalImpl/Svg/Internal/AzureCopilot.svg","MsPortalImpl/Services/Services.AssetTypes"],(function(e,t,s,i,a,r,o,n,l,d,c,v,p,x,h,f,u){"use strict";t.ViewModel=void 0;var b=s,g=i.ToolbarItems.createBasicButton,m=MsPortalFx.Base.Images,k=FxImpl.TriggerableLifetimeManager;function I(e){MsPortalFx.require("MsPortalImpl/Widgets/Widgets.AllServicesMenu").then((t=>{const s=e.diContainer.get(v.FavoritesManager);t.toggleFavorite({clickedFavorite:e.favorite,favoritesManager:e.diContainer.get(v.FavoritesManager),favoritesManagerDeferred:e.diContainer.get(c.FavoritesManagerDeferred),telemetrySource:"ServiceHoverCard"}),s.loadFavorites()}))}class C extends p.ViewModel{constructor(e,t,s,h){super(),this.onClickToggleExpandedState=()=>{this.isDescriptionExpanded(!this.isDescriptionExpanded())},this.subtitle=ko.observable(),this.additionalInfo=ko.observable(),this.possibleFavorite=ko.observable(),this.favoriteInitial=null,this.addIcon=m.Add({palette:3}),this.viewIcon=m.View({palette:3}),this.favoriteIcon=m.Star({palette:99}),this.notFavoriteIcon=m.Favorite({palette:99}),this.isDescriptionExpanded=ko.observable(!1),this.seeMoreString=ko.pureComputed((()=>this.isDescriptionExpanded()?a.ServicesInfo.HoverCard.seeLess:a.ServicesInfo.HoverCard.seeMore)),this.expandIcon=m.CaretDown(),this.toolbar=ko.observable(),this.tweakHoverCard=ko.observable(!1),this.showCopilotButton=ko.observable(!1),this.copilotButtonText=ko.observable(a.SideBarFlyout.copilotButtonText),this.showPartnerTag=ko.pureComputed((()=>this.possibleFavorite().isPartner));const f=e.portalService?.serviceHubDisplayName||e.serviceHub?.serviceMenuManifest?.display;this.subtitle(f),this.showFavoriteStar=ko.pureComputed((()=>!MsPortalFx.isFeatureEnabled("disablefavoritestars")&&!!this.additionalInfo())),this.lifetime=new k,this.template=F,this.dockingElement=t,this.focusContent=this.toolbar,this._hoverCardSource=h,this._recentsManager=s.get(x.RecentServicesManager),this.possibleFavorite(e),this.onFavoritesChange=e=>{const t=MsPortalFx.find(e,(e=>e&&e.id===this.possibleFavorite().id));t&&this.possibleFavorite(t)},this.setFavorite=()=>{if(this.favoriteOnDismiss){this.updateFavorite=()=>{const e=this.possibleFavorite(),t=e.isFavorite();t!==!!s.get(v.FavoritesManager).favorites.value.find((t=>t.id===e.id))&&(e.isFavorite=ko.observable(!t),I({favorite:e,diContainer:s}))};const e=this.possibleFavorite();e.isFavorite(!e.isFavorite())}else I({favorite:this.possibleFavorite(),diContainer:s})},this.shouldShowExpandButton=e=>$(e.parentNode).find(".fxs-hover-card-description")[0].scrollHeight>90,this._bladeManagement={openBlade:e=>s.get(l.BladeOpener).openBlade(e,{flags:8,telemetryName:"ServiceHoverCard"}),openContextPane:e=>s.get(l.BladeOpener).openBlade(e,{flags:9,telemetryName:"ServiceHoverCard"}),openBladeAsync:()=>Promise.resolve(!1),openContextPaneAsync:()=>Promise.resolve(!1)};const b=s.get(d.Experimentation).shellAssignments;this.tweakHoverCard(b.getBooleanValue("tweakservicehovercard"));const C=e?.serviceHub?.serviceMenuManifest?.display||e?.portalService?.portalServiceManifest?.display||e?.assetType?.compositeDisplayName?.plural;C&&MsPortalFx.require("MsPortalImpl/Services/Services.Copilot").then((e=>{const t=s.get(e.CopilotService);this.showCopilotButton(t.getConfig().enabled),this.onClickCopilotButton=()=>{t.nudge({prompt:a.SideBarFlyout.copilotButtonPrompt.format(C),promptId:`serviceHoverCard_${C}`,source:"hovercard"}),this.widget.dispose()}})),(0,o.getAllServicesAdditionalData)().then((e=>{this.possibleFavorite()&&this.additionalInfo(function(e,t,s,i){const a=e?.id,o=t&&t[a]||{},{createLink:n,createBladeReference:l}=(0,c.getServiceCreateLink)(e),d=ko.observable();(async function(e,t){if(!e)return null;if(e.serviceHub||e.portalService)return e.uri;const s=e.id,i=await(0,u.getBrowseBladeUri)(t,s.toLowerCase());return i||e.uri})(e,s).then((e=>d(e)));const v=ko.observableArray();return Promise.all([MsPortalFx.require("MsPortalImpl/UI/UI.DeepLink"),r.AssetTypes.getRecentResourcesEndPoint.invoke(s.get(FxImpl.Rpc.Client),MsPortalFx.Base.Constants.ExtensionNames.Hubs,{limit:3,assetTypeId:"HubsExtension_BrowseAllResources"===a?void 0:a})]).then((([e,t])=>{v(t.map((t=>{const{resourceId:i,timeStamp:a,name:r}=t,{icon:o}=t.assetTypeInformation,n=new Date(a).toRelativeString("difference");return{resourceId:e.getResourceDeepLink(s,i),timeStamp:n,icon:o,name:r}})))})),{recentClick:t=>((0,p.logTelemetry)("BrowseRecentResourceLinkClicked",e.id,{resourceName:t.name,resourceId:t.resourceId,source:i}),!0),usefulClick:t=>((0,p.logTelemetry)("UsefulResourceLinkClicked",e.id,{linkDestination:t.link,displayTitle:t.linkTitle,source:i}),!0),trainingClick:t=>((0,p.logTelemetry)("TrainingLinkClicked",e.id,{linkDestination:t.link,displayTitle:t.title,source:i}),!0),freeClick:t=>((0,p.logTelemetry)("FreeOfferingLinkClicked",e.id,{linkDestination:t.createUri,displayTitle:t.title,source:i}),!0),createLink:n,createBladeReference:l,deepLink:d,description:(0,c.getFavoriteTypeDescription)(e),freeOfferings:o.freeOfferings,recents:v,trainings:o.trainings,usefulLinks:o.usefulLinks}}(this.possibleFavorite(),e.assetTypesDataMap,s,this._hoverCardSource)),r.ArtBrowse.getBrowsePrereqsEndpoint.invoke(FxImpl.Rpc.client,"fxw",{resourceType:this.possibleFavorite()?.assetType?.lowerCaseResourceType,includeColumnsVersion:2}).then((async e=>{const t=e&&(0,n.createServiceHoverCardCommand)({showLabel:!0,showIcon:!0,showCustomIcon:!0},`ServiceHoverCard-${this._hoverCardSource}`,null,e?.browseQueryManifest,this.lifetime,(()=>this.possibleFavorite()?.assetType?.extension),this.possibleFavorite()?.resourceType,this._bladeManagement,this.possibleFavorite()?.isDisabled,e?.assetTypes[this.possibleFavorite()?.resourceType?.toLowerCase()]?.hiddenCommands,this.possibleFavorite()?.kind),r=[];if(t?r.push(t):(this.additionalInfo()?.createLink||this.additionalInfo()?.createBladeReference)&&r.push(g(this.lifetime,{label:a.ActionBarButtons.create,icon:this.addIcon,tooltip:this.possibleFavorite()?.isDisabled&&a.SideBarFlyout.disabledMessage,onClick:()=>{(0,p.logTelemetry)("CreateResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),this.additionalInfo().createLink?window.location.hash=this.additionalInfo().createLink:s.get(l.BladeOpener).openBlade(this.additionalInfo().createBladeReference,{flags:2,telemetryName:"ServiceHoverCard"}),this.widget.dispose()},disabled:this.possibleFavorite()?.isDisabled})),this.additionalInfo()?.deepLink){const e=this.possibleFavorite();r.push(g(this.lifetime,{label:a.ActionBarButtons.view,icon:this.viewIcon,onClick:()=>{(0,p.logTelemetry)("ViewResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),window.location.hash=this.additionalInfo().deepLink(),this._recentsManager.addService({type:"favoriteType",favoriteType:e})}}))}this.toolbar(i.create(this.lifetime,{items:r,showLabels:!0}))}))}))}}t.ViewModel=C;const F=b.tsx(s.Root,null,b.tsx("div",{class:"fxs-hover-card-container fxs-portal-background fxs-portal-text"},b.tsx("div",{class:"fxs-hide-accessible-label",id:"hoverCardDescriptionId",title:a.ServicesInfo.showServiceCard,"aria-hidden":"true"},a.ServicesInfo.showServiceCard),b.tsx("div",{class:"fxs-hover-card-initial","data-bind":{css:{"fxs-hover-card-padbottom":"!additionalInfo()"}}},b.tsx("div",{class:"fxs-hover-card-header"},b.tsx("div",{class:"fxs-hover-card-icon","data-bind":{image:"possibleFavorite().icon || possibleFavorite().image"}}),b.tsx("div",null,b.tsx("header",{class:"fxs-hover-card-title","data-bind":{text:"possibleFavorite().label",attr:{title:"possibleFavorite().label"}}}),b.tsx(s.KoIf,{condition:"subtitle()"},b.tsx("div",{class:"fxs-hover-card-subtitle fxs-portal-subtext","data-bind":{text:"subtitle",attr:{title:"subtitle"}}})),b.tsx("div",{class:"fxs-hover-card-tags"},b.tsx(s.KoIf,{condition:"possibleFavorite().isDisabled"},b.tsx("div",{class:"msportalfx-preview-text fxs-service-disabled-tag",title:a.SideBarFlyout.disabledMessage},a.SideBarFlyout.disabled)),b.tsx(s.KoIf,{condition:"showPartnerTag()"},b.tsx("div",{class:"msportalfx-preview-text fxs-service-partner-tag",title:a.SideBarFlyout.Partnertag.title},a.SideBarFlyout.Partnertag.name)),b.tsx(s.KoIf,{condition:"tweakHoverCard() && possibleFavorite().isPreview"},b.tsx("div",{class:"msportalfx-preview-text fxs-service-preview-tag",title:a.SideBarFlyout.preview},a.SideBarFlyout.preview)))),b.tsx(s.KoIf,{condition:"showFavoriteStar()"},b.tsx("div",{class:"fxs-hover-card-favoriteicon",role:"button","aria-pressed":"false","aria-label":a.KeyboardShortcuts.Toggle.toggleFavoriteService,"data-bind":{fxclick:"setFavorite",image:"possibleFavorite().isFavorite() ? favoriteIcon : notFavoriteIcon"}}))),b.tsx("div",{class:"fxs-hover-card-commands"},b.tsx("div",{"data-bind":{pcControl:"toolbar"}}))),b.tsx("div",{class:"fxs-hover-card-border"}),b.tsx("div",{class:"fxs-hover-card"},b.tsx(s.KoIf,{condition:"additionalInfo()"},b.tsx("div",{class:"fxs-hover-card-additional","data-bind":{with:"additionalInfo"}},b.tsx(s.KoIf,{condition:"recents"},b.tsx(s.KoIf,{condition:"recents().length"},b.tsx("div",{class:"fxs-hover-card-padless-header"},b.tsx("header",{class:"fxs-hover-card-heading"},a.ServicesInfo.HoverCard.Header.recents)),b.tsx("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"recents"}},b.tsx("li",{class:"fxs-hover-card-list-item"},b.tsx("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},b.tsx("div",{class:"fxs-hover-card-training-icon","data-bind":{image:"$data.icon"}}),b.tsx("div",{class:"fxs-hover-card-training-link"},b.tsx("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.recentClick",text:"$data.name",attr:{title:"$data.name",href:"$data.resourceId"}}}),b.tsx("div",{class:"fxs-hover-card-training-sub"},b.tsx("span",{"data-bind":{text:"$data.timeStamp"}}))))))),b.tsx(s.KoIfNot,{condition:"recents().length"},b.tsx(s.KoIf,{condition:"description"},b.tsx("div",{class:"fxs-hover-card-section"},b.tsx("header",{class:"fxs-hover-card-heading"},a.ServicesInfo.HoverCard.Header.description),b.tsx("div",{"data-bind":{text:"description",css:{"fxs-hover-card-description":"true","fxs-hover-card-expanded-description":"$parent.isDescriptionExpanded()"}}}),b.tsx(s.KoIf,{condition:"$parent.shouldShowExpandButton($element)"},b.tsx("a",{href:"#",class:"fxs-hover-card-seemore-link",tabindex:"0","data-bind":{click:"$parent.onClickToggleExpandedState",clickBubble:"false"}},b.tsx("div",{class:"fxs-hover-card-see-more-less","data-bind":{text:"$parent.seeMoreString",attr:{title:"$parent.seeMoreString",ariaLabel:"$parent.seeMoreString"}}}),b.tsx("div",{"data-bind":{image:"$parent.expandIcon",css:{"fxs-hover-card-expand-icon":"true","fxs-hover-card-icon-vertical-transform":"$parent.isDescriptionExpanded()"}}}))))))),b.tsx(s.KoIf,{condition:"$parent.showCopilotButton()"},b.tsx("div",{class:"fxs-hover-card-section fxs-hover-card-azure-copilot-link-section","data-bind":{click:"$parent.onClickCopilotButton",attr:{"aria-label":"$parent.copilotButtonText",title:"$parent.copilotButtonText"}}},b.tsx("div",{class:"fxs-portal-svg fxs-hover-card-azure-copilot-icon"},h.getSvgReferenceOrFallBackToData(f).outerHTML),b.tsx("div",{class:"fxs-portal-text fxs-hover-card-azure-copilot-link","data-bind":{text:"$parent.copilotButtonText"}}))),b.tsx(s.KoIf,{condition:"trainings && trainings.length"},b.tsx("div",{class:"fxs-hover-card-padless-header"},b.tsx("header",{class:"fxs-hover-card-heading"},a.ServicesInfo.HoverCard.Header.training)),b.tsx("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"trainings"}},b.tsx("li",{class:"fxs-hover-card-list-item"},b.tsx("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},b.tsx("div",{class:"fxs-hover-card-training-link"},b.tsx("a",{class:"msportalfx-ext-link",href:"",target:"_blank","data-bind":{click:"$parent.trainingClick",text:"$data.title",attr:{title:"$data.title",href:"$data.link"}}}),b.tsx("div",{class:"fxs-hover-card-training-sub"},b.tsx("span",{"data-bind":{text:"$data.units"}}),b.tsx(s.KoIf,{condition:"$data.units && $data.duration"},b.tsx("span",null," · ")),b.tsx("span",{"data-bind":{text:"$data.duration"}}))))))),b.tsx(s.KoIf,{condition:"usefulLinks && usefulLinks.length"},b.tsx("div",{class:"fxs-hover-card-section fxs-hover-card-padleftright"},b.tsx("header",{class:"fxs-hover-card-heading"},a.ServicesInfo.HoverCard.Header.usefulLinks),b.tsx("ul",{class:"fxs-hover-card-list","data-bind":{foreach:"usefulLinks"}},b.tsx("li",{class:"fxs-hover-card-list-item"},b.tsx("a",{target:"_blank","data-bind":{click:"$parent.usefulClick",text:"$data.title",attr:{href:"$data.link"},css:{"msportalfx-ext-link":"$data.isExternalLink"}}}))))),b.tsx(s.KoIf,{condition:"!$parent.tweakHoverCard() && freeOfferings && freeOfferings.length"},b.tsx("div",{class:"fxs-hover-card-padless-header"},b.tsx("header",{class:"fxs-hover-card-heading"},a.ServicesInfo.HoverCard.Header.freeOfferings)),b.tsx("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"freeOfferings"}},b.tsx("li",{class:"fxs-hover-card-list-item"},b.tsx("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},b.tsx("div",{class:"fxs-hover-card-training-link"},b.tsx("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.freeClick",text:"$data.title",attr:{href:"$data.createUri"}}}),b.tsx("div",{class:"fxs-hover-card-training-sub"},b.tsx("span",{"data-bind":{text:"$data.subTitle"}}))))))))))))}));