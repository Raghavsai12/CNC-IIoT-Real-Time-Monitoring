define("MsPortalImpl/Base/BladeWidthHelper",["require","exports"],(function(e,t){"use strict";t.contextPaneDefaultSizeClass=t.allWidthClasses=void 0,t.getBladeWidthInfo=function(e){return s[e]};const s={51:{css:"fxs-bladesize-menu",width:265},0:{css:"fxs-bladesize-small",width:315},1:{css:"fxs-bladesize-medium",width:585},2:{css:"fxs-bladesize-large",width:855},3:{css:"fxs-bladesize-xlarge",width:1125}};t.contextPaneDefaultSizeClass="fxs-bladesize-contextpane-default";t.allWidthClasses=MsPortalFx.map(s,(e=>e.css)).join(" ")})),
define("MsPortalImpl/Interactions/Interactions.FocusHandler",["require","exports","MsPortalImpl/Base/Base.Timers","Weave","MsPortalImpl/Widgets/Widgets.Common"],(function(e,t,s,i,a){"use strict";let o;t.setFocusOnContainer=t.FocusHandler=void 0;t.setFocusOnContainer=s.throttleByAnimationFrame(((e,t)=>function(e,t){const s=$(e);if(!$.contains(s[0],document.activeElement)){let e=s.findFirstTabbable((e=>e.isInScrollView(t)));if(!e.length&&s.hasClass("fxs-blade-content")){const t=s.closest(".fxs-blade"),i=t.hasClass("fxs-menublade")?[]:[t.find(".fxs-blade-close")];i.push(s.closest("[tabindex]"));const a=MsPortalFx.find(i,(e=>!!e.attr("tabindex")||e.is("button,a")));a&&(e=a)}if(e.length){if(e.hasClass("fxs-part")){const t=e.findFirstTabbable();1===t.length&&(e=t)}return e[0].focus(),e}}}(e,t)));class n{constructor(){if(this._containerTargets=[],this._mapTofocusableTargets=MsPortalFx.memoize((e=>[])),this._mapSkipAutoFocus=new Map,this._debounceMenuBladeCleanup=s.debounce((()=>{0!==this._containerTargets.length||this._masterMenuBladeToSetFocus?.isMenuBladeLoadingDetailBlade()||(this._menuBladeToSetFocus=void 0,this._masterMenuBladeToSetFocus=void 0)}),1e3),o)throw new Error("FocusHandler operates as a singleton.");this._ltm=new FxImpl.TriggerableLifetimeManager,o=this,this._ltm.registerForDispose([this._debounceMenuBladeCleanup,$.querySelectorAll("body").setEvents(["focusin",this._cancelAutofocus=e=>{this._mapTofocusableTargets.map().forEach(((t,s)=>{const i=!!e||s!==this._menuBladeToSetFocus;this._mapSkipAutoFocus.set(s,i)}))}])])}dispose(){this._ltm.dispose(),o=null}static get Instance(){return o||(o=new n)}registerContainerForFocus(e,t){if(e){if(!this._menuBladeToSetFocus){t.isMenuBladeLoadingDetailBlade()&&(this._menuBladeToSetFocus=e,this._masterMenuBladeToSetFocus=t)}this._cancelAutofocus(),MsPortalFx.pushUnique(this._containerTargets,[e])}}notifyContainerReadyForFocus(e){try{if(MsPortalFx.remove(this._containerTargets,e).length){if(!this._mapSkipAutoFocus.get(e)){let o=e;if(this._menuBladeToSetFocus&&this._menuBladeToSetFocus!==e){const t=this._menuBladeToSetFocus.element.closest(".fxs-blade-content-container");t[0]&&$.contains(t[0],e.element[0])&&(o=this._menuBladeToSetFocus)}o&&(t=o,s.requestAnimationFrame((()=>{Promise.allSettled([(0,a.waitForBindings)(t.element[0]),(0,i.waitForChangePropagation)()]).then((()=>{setTimeout((()=>{t.setFocus()}),50)}))})))}this._mapSkipAutoFocus.delete(e),this._mapTofocusableTargets.delete(e),this._menuBladeToSetFocus&&0===this._containerTargets.length&&this._debounceMenuBladeCleanup()}}catch(e){}var t}}t.FocusHandler=n})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeEditAssetButton",["require","exports","Fx/DependencyInjection","FxInternal/AsyncLoader","Fx","MsPortalImpl/Resources/ImplScriptResources","Weave"],(function(e,t,s,i,a,o,n){"use strict";t.BladeEditAssetButton=void 0;var l=MsPortalFx.Base;let r=t.BladeEditAssetButton=class{constructor(e){this._diContainer=e,this.icon=(0,n.makeWritableComputation)(null),this.title=(0,n.makeWritableComputation)("")}configure(e,t){(0,a.isFeatureEnabled)("selfservice_editasset")?this._diContainer.getAsync(i.get("MsPortalImpl/Services/Services.AssetCustomization","AssetCustomization")).then((s=>{const i=s.isAvailable(e,t);i&&(this.icon(l.Images.Edit({palette:99})),this.onClick=()=>s.customizeAsset(),this.title(o.Blade.editAsset)),t.showEditAssetButton(i)})):t.showEditAssetButton(!1)}};t.BladeEditAssetButton=r=__decorate([__metadata("fx:diagnostics",[e,"BladeEditAssetButton"]),s.Class(),__metadata("design:paramtypes",[s.Container])],r)})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeFavoriteResourceButton",["require","exports","Fx/DependencyInjection","FxHubs/RpcEndPoints","MsPortalImpl/Resources/ImplScriptResources","Weave"],(function(e,t,s,i,a,o){"use strict";t.BladeFavoriteResourceButton=void 0;var n=MsPortalFx.Base;let l=t.BladeFavoriteResourceButton=class{constructor(){this.icon=(0,o.makeWritableComputation)(null),this.title=(0,o.makeWritableComputation)(""),this._setFavoriteProperties=()=>{this.icon(n.Images.Star({palette:99})),this.onClick=()=>this._removeResourceFromFavorites(),this.title(a.Blade.removeFromFavorites)},this._setNotFavoriteProperties=()=>{this.icon(n.Images.Favorite({palette:99})),this.onClick=()=>this._addResourceToFavorites(),this.title(a.Blade.addToFavorites)},this._addResourceToFavorites=()=>{i.AssetTypes.addFavoriteResourceEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:this._resourceId,name:this._resourceName.value,telemetrySource:"ResourceBlade"}).then((e=>{e&&this._setFavoriteProperties()}))},this._removeResourceFromFavorites=()=>{i.AssetTypes.removeFavoriteResourceEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:this._resourceId,telemetrySource:"ResourceBlade"}).then((()=>{this._setNotFavoriteProperties()}))}}configure(e,t){if("resourcemenublade"===e?.bladeDefinition?.name?.toLowerCase()){const s=e?.getViewModel();s?.id&&s.id()&&"string"==typeof s.id()&&(this._resourceId=s.id(),this._resourceName=t.titleMain,i.AssetTypes.isResourceFavoriteEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:this._resourceId}).then((e=>{e?this._setFavoriteProperties():this._setNotFavoriteProperties(),t.showFavoriteResourceButton(!0)})))}}};t.BladeFavoriteResourceButton=l=__decorate([__metadata("fx:diagnostics",[e,"BladeFavoriteResourceButton"]),s.Class()],l)})),
define("MsPortalImpl/Widgets/Widgets.BladeContent.Component",["require","exports","Weave/DirectMode","Weave","FxInternal/Weave/Util","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Weave/Components/LoadingIndicator","MsPortalImpl/Widgets/Widgets.PartError","FxInternal/Weave","MsPortalImpl/Weave/LazyControls","MsPortalImpl/Widgets/Widgets.CommandBar"],(function(e,t,s,i,a,o,n,l,r,d,c){"use strict";t.BladeContentInner=function(e){const{vm:t}=e,f=(0,r.toComputation)(t.title),g=f.compose((e=>o.Blade.collapseMenuAria.format(e))),x=f.compose((e=>o.Blade.expandMenuAria.format(e))),b=(0,r.toComputation)(t.shieldType).compose(h),C=t.noticeTmplVm,v=(0,r.toComputation)(t.statusBar.activatable),y=(0,i.composeComputation)([(0,r.toComputation)(t.contentState),(0,r.toComputation)(t.loaded),v],((e,t,s)=>0===e||1===e||s&&!t)),I=(0,r.toComputation)(t.renderCmdBarWhenNoCmd),B=(0,i.composeComputation)([(0,r.toComputation)(t.commandBar.items),I],((e,t)=>e.length>0||t)),_=["fxs-commandBar-target fxs-portal-border fxs-portal-background fxs-portal-svg",{"fxs-alwaysshowcommandbar":I}];return s(i.Fragment,null,s("div",{className:["fxs-blade-commandBarContainer fxs-portal-background az-noprint",{"fxs-display-none":(0,i.composeComputation)([C,t.errorTmplVm],((e,t)=>e||t))}]},s(i.If,{condition:B,concealmentBehavior:"remove",trueFn:()=>s(c.CommandBar,{className:_,vm:t.commandBar}),falseFn:()=>s("div",{className:_})})),s("div",{className:"fxs-blade-dialoghost az-noprint"},s("div",{className:"fxs-blade-dialog"})),s(i.If,{condition:(0,r.toComputation)(t.description).compose(a.isNonEmptyString),concealmentBehavior:"remove",trueFn:()=>s(i.LifetimeManagerScoped,{fn:e=>s(d.LazyInfoBox,{className:"fxs-blade-description-container",vm:s=>s.createVm(e,{style:1,text:{htmlTemplate:'<span data-bind="text: description"></span><a class="msportalfx-ext-link" data-bind="text: helpText, attr: { href: helpUri }, visible: helpUri().length > 0" target="_blank"></a>',viewModel:{description:t.description,helpUri:t.helpUri,helpText:o.Blade.helpText}}})})})}),s("div",{className:"fxs-blade-status-container"},s(i.If,{condition:y,falseFn:()=>s(i.LifetimeManagerScoped,{fn:e=>s(d.LazyInfoBox,{className:"fxs-blade-status-text-container",tagName:"div",vm:s=>s.createVm(e,{style:ko.computed(e,t.contentState,(e=>p[e]||1)),text:{htmlTemplate:'<span data-bind="text: text" style="overflow: hidden; text-overflow: ellipsis;"></span>&nbsp;<a class="msportalfx-ext-arrow ext-fxc-stretched-link" data-bind="image: arrowRight, visible: showArrow, attr: { \'aria-label\': text }" href="#"></a>',viewModel:{showArrow:t.statusBar.activatable,text:t.contentStateDisplayText,arrowRight:MsPortalFx.Base.Images.ArrowRight()}},ariaLabel:t.contentStateDisplayText})})})})),s("div",{className:"fxs-blade-content-wrapper",tabindex:"-1",role:"presentation","data-contenttitle":f},s("div",{className:"fxs-blade-summary-container fxs-portal-border fxs-display-none"}),s("div",{className:"fxs-blade-content"},(0,i.composeComputation)([C,t.errorTmplVm],u).compose((e=>2===e?s("div",{className:"fxs-blade-stacklayout"}):0===e?s("div",{className:"msportalfx-padding msportalfx-fill"},s(i.GetContext,{fn:({diContainer:e})=>t.errorTmplVm.compose((t=>s("div",{className:"fxs-blade-errorcontent msportalfx-fill",afterMount:(s,i)=>{i.registerForDispose(new l.Widget($(s),t,e))}})))})):C.compose((e=>e?s(d.LazyNotice,{vm:e}):null)))),s("button",{className:"fxs-bladecontent-collapser fxs-portal-hover fxs-portal-svg","aria-expanded":"true",image:m,title:g,"aria-label":g}))),s("div",{className:"fxs-blade-actionBar fxs-display-none"}),s("button",{className:"fxs-blade-collapse-veil fxs-portal-hover fxs-portal-svg","aria-expanded":"false",image:m,title:x,"aria-label":x}),s(n.LoadingIndicator,{className:["fxs-bladecontent-progress",{"fxs-blade-shield-translucent fxs-tile-overlay":b,"fxs-portal-background":b.compose(a.negation),"fxs-display-none":(0,r.toComputation)(t.showLoadingIndicator).compose(a.negation)}]}))};const m=MsPortalFx.Base.Images.DoubleChevron();function h(e){return 1===e}function u(e,t){return t?0:e?1:2}const p={0:1,2:4,3:5,5:1,4:1,6:2,7:3,1:3}})),
define("MsPortalImpl/Widgets/Widgets.Blade.Component",["require","exports","Weave/DirectMode","Weave","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Weave/Components/LoadingIndicator","MsPortalImpl/Widgets/Widgets.BladeContent.Component","MsPortalImpl/Widgets/Widgets.DropMenu","FxInternal/Weave","Fx/Experimentation","MsPortalImpl/Services/Services.Copilot"],(function(e,t,s,i,a,o,n,l,r,d,c){"use strict";t.BladeInner=function(e){const{vm:t,widgetBladeRef:m}=e,p=a.Blade,f=(0,r.toComputation)(t.loaded),g=t.title,x=t.titleMain,b=g.compose((e=>p.expandAria.format(e))),C=h.DoubleChevron({palette:99}),v=x.compose((e=>a.Blade.expandMenuAria.format(e))),y=new l.ViewModel(void 0,void 0,".fxs-blade-dropmenubutton");y.setItemFocusWhenOpen=!0,y.buttonLabel(p.moreContentActionAria),y.buttonTooltip(p.moreContentActionAria),y.alignMenu=0,y.containInViewport=!0;const I=t.diContainer.get(d.Experimentation).shellAssignments.getBooleanValue("headerLessCopilotDockedPane");return s(i.Fragment,null,s("div",{className:["fxs-blade-header-react-mount-point",{"fxs-display-none":I&&t.isInContextPane&&t.bladeName.name?.toLowerCase().includes(t.diContainer.get(c.CopilotService).getConfig().chatView?.toLowerCase())}],afterMount:(e,s)=>{e&&m&&MsPortalFx.require("MsPortalImpl/Widgets/ShellHeader/ShellHeaderWrapper").then((i=>{i.ShellHeaderWrapper({element:e,lifeTimeManager:s,vm:t,widgetBladeRef:m}),u.trace({source:"Shell",action:"ReactShellHeaderRendered"})}))}}),s("div",{className:["fxs-blade-content-container","fxs-blade-content-container-default-overlay",{"fxs-blade-disabled":(0,r.toComputation)(t.disabled)}]},s("div",{className:"fxs-blade-content-container-default"},s(n.BladeContentInner,{vm:t.defaultContent})),s("div",{className:"fxs-blade-content-container-default-details"},s("button",{role:"button",type:"button",className:"fxs-overlay-menu-expander fxs-portal-hover",title:v,"aria-label":v},s("div",{className:"fxs-portal-svg",image:C}),s("div",null,a.SideBar.menuExpand)),s("div",{className:"fxs-blade-content-container-header fxs-blade-content-container-header-primary fxs-display-none"}),s("div",{className:"fxs-blade-content-container-details fxs-blade-content-container-details-primary"})),s("button",{className:"fxs-blade-collapse-veil fxs-portal-hover fxs-portal-svg",tabindex:"-1","aria-hidden":"true",title:b})),s(o.LoadingIndicator,{className:["fxs-blade-progress fxs-portal-background",{"fxs-display-none":f}]}))};var m=MsPortalFx.Base,h=MsPortalFx.Base.Images,u=m.Diagnostics.Telemetry})),
define("MsPortalImpl/Widgets/Widgets.Lens.Component",["require","exports","Weave/DirectMode","Weave","FxInternal/Weave"],(function(e,t,s,i,a){"use strict";t.LensInner=function(e){const{vm:t}=e,o=(0,a.toComputation)(t.title),n=(0,a.toComputation)(t.title);return s(i.Fragment,null,s("div",{className:"fxs-lens-title-container"},s("div",{className:"fxs-lens-title",visible:n},o)),s("div",{className:"fxs-lens-layout"}))}})),
define("_generated/Less/MsPortalImpl/Widgets/Widgets.Lens.css",["module"],(function(e){"use strict";return{css:".fxs-lens{position:relative;padding-bottom:10px}.fxs-lens-title-container{display:flex;align-items:center;height:30px}.fxs-lens-title{flex:1 1 auto;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:14px;line-height:30px;height:30px}.fxs-lens-fit{padding-bottom:0;height:100%}.fxs-lens-fit>.fxs-lens-title{display:none}.fxs-lens-fit>.fxs-lens-layout{height:100%}.fxs-bladestyle-create .fxs-lens.fxs-lens-fit{width:calc(100% + 2*20px);margin-left:-20px}.fxs-blade-locked .fxs-stacklayout-child:last-child.fxs-lens{padding-bottom:0}.fxs-bladecontent-unlocked .fxs-lens.fxs-lens-fit{padding-top:15px}.fxs-blade-locked .fxs-blade-stacklayout.fxs-stacklayout-vertical .fxs-lens>.fxs-lens-title-container{height:auto}.fxs-blade-stacklayout.fxs-stacklayout-horizontal .fxs-lens>.fxs-lens-layout{height:calc(100% - 30px)}.fxs-blade-content-container .fxs-bladestyle-hub .fxs-blade-summary-container,.fxs-blade-content-container .fxs-bladestyle-hubsubmenu .fxs-blade-summary-container{border:0}.fxs-blade-summary-container{position:relative;overflow:hidden;border-bottom-width:1px;border-bottom-style:solid}.fxs-blade-summary-container .fxs-lens{padding-bottom:0}.fxs-blade-summary-container .fxs-lens .fxs-lens-title-container{display:none}.fxs-blade-summary-container .fxs-lens .fxs-tile{min-height:35px;width:100%!important;height:auto}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-tile-progress{top:35px;height:calc(100% - 35px);overflow:hidden}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-part{padding:0;box-shadow:none!important}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-part.fxs-part-part-title-visible .fxs-part-content{top:0}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-part .fxs-part-title{display:none}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-part .fxs-part-blockui-shield{top:35px}.fxs-blade-summary-container .fxs-lens .fxs-tile .fxs-tile-actionbar-actionlist{visibility:hidden}.fxs-lens-layout-flow .fxs-lens-layout{display:flex;flex-flow:row wrap;align-items:flex-start;margin:0 -5px -5px 0}.fxs-lens-layout-flow .fxs-tile{flex:0 0 auto;margin:0 5px 5px 0}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.Lens",["require","exports","MsPortalImpl/UI/Compositions/UI.Composition.PartSize","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Widgets/Widgets.Tile","MsPortalImpl/Widgets/Widgets.Lens.Component","MsPortalImpl/Weave/DirectRender","MsPortalImpl/Widgets/Widgets.UIElementBase","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Lens.css"],(function(e,t,s,i,a,o,n,l,r,d){"use strict";t.Widget=t.ViewModel=void 0,(0,r.injectCss)(d);var c=a.Widget,m=l.Widget;const h=i.Widget.getWidget;class u extends l.ViewModel{constructor(e,t){super(e),this.diContainer=t,this.title=ko.observable()}getViewSettings(){return{}}applyViewSettings(e){}}t.ViewModel=u;t.Widget=class extends m{constructor(e,t){super(e,t),e.addClass("fxs-lens"),(0,n.applyToElement)({element:e[0],ltm:this.ltm,weaveNode:(0,o.LensInner)({vm:t}),weaveContext:{diContainer:t.diContainer},opName:"blade"}),ko.computed(this.ltm,[t.locked,t.title],((t,s)=>{const i=e.find(".fxs-lens-layout"),a=e.find(".fxs-lens-title");if(t||MsPortalFx.isNullOrWhiteSpace(s))i.removeAttr("aria-describedby"),a.removeAttr("id");else{const e=MsPortalFx.getUniqueId();i.attr("aria-describedby",e),a.attr("id",e)}}))}dispose(){this._cleanElement("fxs-lens","fxs-lens-fit","fxs-lens-layout-flow"),super.dispose()}addChild(e){if(!e)throw new Error("Can't add null child.");const t=e.element||e,i=h(t,c),a=i.options,o=s.isVariableSize(a.size()),n=a.size()===MsPortalFx.Parts.PartSize.FitToContainer;o||this.element.addClass("fxs-lens-layout-flow");const l=this.element;l.find(".fxs-lens-layout").append(i.element),l.toggleClass("fxs-lens-fit",n)}removeChild(e,t){let s=!1;const i=function(e,t){const s=t.find(".fxs-lens-layout").children().toArray().map((e=>h($(e),c)));return MsPortalFx.find(s,(t=>t&&t.options&&t.options.id===e))}(e,this.element);if(i){const e=i.element;t?e.detach():e.remove(),s=!0}return s}setSize(e,t){this.element.find(".fxs-lens-layout").children().each(((e,t)=>{const s=h($(t),c);s&&s.element.trigger("fxsizechanged")}))}saveViewSettings(){return this.options.getViewSettings()}getTelemetrySource(){return"Lens"}}})),
define("MsPortalImpl/Widgets/Widgets.StackLayout",["require","exports","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Widgets/Widgets.LayoutBase","MsPortalImpl/Widgets/Widgets.UIElementBase","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.StackLayout.css"],(function(e,t,s,i,a,o,n){"use strict";t.Widget=t.ViewModel=t.StackLayoutPositioningEngine=void 0,(0,o.injectCss)(n);const l="fxs-stacklayout-horizontal",r="fxs-stacklayout-vertical",d="fxs-stacklayout-child";class c extends a.ViewModel{constructor(e,t,s){super(e),this._positions=[],this.orientation=ko.observable(i.Orientation.Vertical),this.childElements=ko.observableArray(),this.applyViewSettings(t),this.insertBeforeChildSelector=s}getViewSettings(){return{positions:this.positions}}applyViewSettings(e){e&&e.positions&&(this.positions=e.positions)}get positions(){return this._positions}set positions(e){this._positions=e||[]}}t.ViewModel=c;class m extends a.Widget{constructor(e,t){super(e,t),this._engine=new h,this._engine.positions=t.positions,e.addClass("fxs-stacklayout"),ko.computed(this.ltm,(()=>{const e=this.options.orientation();this.element.toggleClass(r,void 0===e||e===i.Orientation.Vertical).toggleClass(l,e===i.Orientation.Horizontal)})),this._bindDescendants()}dispose(){this.options.childElements().slice().forEach((function(e){ko.cleanNode(e[0]),e.remove()})),this._cleanElement(r,l,"fxs-stacklayout"),super.dispose()}addChild(e){this._addInsertChild(e)}insertChild(e,t){this._addInsertChild(e,t)}removeChild(e){const t=MsPortalFx.find(this.options.childElements(),(function(t){return a.Widget.getId(t)===e}));return!!t&&(s.hide(t).removeClass(d),setTimeout((()=>{t.remove()}),100),this.options.childElements().splice(this.options.childElements().indexOf(t),1),this._engine.remove(e),this._applyPositioning(),!0)}saveViewSettings(){return this.options.positions=this._engine.positions,this.options.getViewSettings()}discardStateOfUnusedChildren(){const e={stateDiscarded:!1};if(this._engine){const t=this._engine.discardUnusedPositions();t&&t.length&&(e.stateDiscarded=!0,e.message="Removed Positions: "+JSON.stringify(t))}return e}_addInsertChild(e,t){const s=this.options,i=this.element,o=s.childElements();if(!e)throw new Error("Cannot add a null child.");const n=e.element?e.element:e;n.addClass(d),o.push(n),this._engine.insert(a.Widget.getId(n),t);const l=i.children(`.${d}`).toArray().filter((e=>{const t=e&&e.style;return"none"!==(t&&t.display)})),r=s.insertBeforeChildSelector&&i.children(s.insertBeforeChildSelector);t>=0||(t=l.length),l.length>t?$(l[t]).before(n):r?.length?$(r[0]).before(n):l.length?$(l[l.length-1]).after(n):i.append(n),this._applyPositioning()}_applyPositioning(){const e=this.options.childElements,t=[];this._engine.positions.forEach(((s,i,o)=>{const n=MsPortalFx.find(e(),(function(e){return a.Widget.getId(e)===s.id}));n&&(e().splice(e().indexOf(n),1),t.push(n))})),Array.prototype.unshift.apply(e(),t),e.valueHasMutated()}}t.Widget=m;class h{constructor(){this._items=[],this._filledPositions={}}append(e){const t=this._getExistingItem(e);return this._filledPositions[e]=!0,t||this._insert(e),this._items}insert(e,t){const s=this._getExistingItem(e);return this._filledPositions[e]=!0,s&&this._items.splice(this._items.indexOf(s),1),this._insert(e,t),this._items}move(e,t){const s=this._getExistingItem(e),i=this._items.indexOf(s);return i>=0&&(this._items.splice(i,1),this._items.splice(t,0,s)),this._items}remove(e){const t=this._getExistingItem(e),s=this._items.indexOf(t);return s>=0&&(this._items.splice(s,1),this._filledPositions[e]=!1),this._items}get positions(){return this._items}set positions(e){this._items.length=0,this._items=e}discardUnusedPositions(){const e=[];return this._items.slice(0).forEach((t=>{this._filledPositions[t.id]||(e.push(t),this.remove(t.id))})),e}_insert(e,t){const s={id:e};t>=0&&t<this._items.length?this._items.splice(t,0,s):this._items.push(s)}_getExistingItem(e){return MsPortalFx.find(this._items,(function(t){return t.id===e}))}}t.StackLayoutPositioningEngine=h})),
define("MsPortalImpl/Widgets/Widgets.BladeContent",["require","exports","MsPortalImpl/Interactions/Interactions.RightClick","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Interactions/Interactions.PortalReader","MsPortalImpl/Interactions/Interactions.FocusHandler","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Widgets/Widgets.WidgetBase","MsPortalImpl/Widgets/Widgets.CommandBar","MsPortalImpl/Widgets/Widgets.ContextMenu","MsPortalImpl/Widgets/Widgets.LayoutBase","MsPortalImpl/Widgets/Widgets.Lens","MsPortalImpl/Widgets/Widgets.StackLayout","MsPortalImpl/Widgets/Widgets.UIElementBase","MsPortalImpl/Base/BladeWidthHelper","MsPortalImpl/Base/Base.BrowserDetection","Viva.Controls/Util/Viva.Resize","Weave","Fx","MsPortalImpl/Interactions/Interactions.DismissHandler","MsPortalImpl/Services/Services.HomeViewSettings"],(function(e,t,s,i,a,o,n,l,r,d,c,m,h,u,p,f,g,x,b,C,v){"use strict";t.Widget=t.ViewModel=t.BladeStatusBarViewModel=void 0,t.combineAllCssClasses=function(e){return e.map((function(e){return e.css})).join(" ")},t.defaultSvg=void 0;var y=MsPortalFx.Base,I=y.Diagnostics,B=MsPortalFx.Blades,_=B.Internal.BladeStyle,w=B.Internal.BladeWidth,M=B.Internal.DisplayState,W=y.Images,k=c.Orientation,F=l.Widget,S=m.Widget,P=u.Widget;const T=i.Blade.StatusBar,E=I.createLog(e),L=MsPortalFx.isNullOrUndefined,R=P.viewSettingsChanged,D="fxs-mode-locked",N="fxs-blade-unauthorized",V="fxs-blade-locked",A="fxs-blade-content",z="fxs-blade-summary-container",H=".fxs-blade-status-text-container .ext-fxc-stretched-link",U="fxs-blade-dialoghost",O="fxs-blade-dialogmodal",j="fxs-bladestyle-default",q="fxs-bladecontent",J="fxs-bladecontent-unlocked",Q="fxs-blade-collapsed",G="fxs-bladecontent-collapser",K="fxs-blade-collapse-veil",X={};X[2]=T.warning,X[3]=T.error,X[4]=T.dirty,X[5]=T.info,X[6]=T.upsell,X[7]=T.complete;const Y=t.defaultSvg=W.Polychromatic.DefaultBlade(),Z={rateLimit:{timeout:100,method:"notifyWhenChangesStop"}};class ee{constructor(){this.activatable=ko.observable(!1),this.activated=ko.observable(!1)}}t.BladeStatusBarViewModel=ee;class te extends u.ViewModel{getTelemetryName(){return["Extension",this.bladeName.extensionName,"Blade",this.bladeName.name].join("/")}constructor(e,t,s){super(e),this.statusBar=new ee,this.bladeStyle=(0,x.makeWritableComputation)(),this.title=ko.observable(),this.subtitle=ko.observable(),this.titleSuffix=ko.observable(),this.subtitleSuffix=ko.observable(),this.description=ko.observable(""),this.helpUri=ko.observable(""),this.contextMenu=new d.ViewModel,this.commandBar=new r.ViewModel,this.renderCmdBarWhenNoCmd=ko.observable(!1),this.icon=ko.observable(Y),this.contentState=ko.observable(0),this.contentStateDisplayText=ko.observable(),this.noticeTmplVm=(0,x.makeWritableComputation)(),this.errorTmplVm=(0,x.makeWritableComputation)(),this.statusIcon=ko.observable(),this.forcedMaximize=ko.observable(!1),this.bladeWidth=ko.observable(1),this.hasIcon=ko.observable(),this.isV2Blade=ko.observable(!1),this.reflowReady=ko.observable(!1),this.showLoadingIndicator=ko.observable(!1),t=t||{},this.loaded=t.loaded||ko.observable(!1),this.shieldType=t.shieldType||ko.observable(),this.displayState=t.displayState||ko.observable(1),this.isUiBlocked=t.isUiBlocked||ko.observable(!1),this.diContainer=t.diContainer,t.disabled&&(this.disabled=t.disabled);const i=new h.ViewModel("fxs-blade-stacklayout-instanceid");i.orientation(k.Vertical),this.stackLayoutOptions=i,this.bladeName=s||{name:e,extensionName:null}}getViewSettings(){this._viewSettings||(this._viewSettings=$.extend(this._viewSettings,{}));const e=this._viewSettings;return e.DisplayState=this.displayState(),e.BladeWidth=this.bladeWidth(),e.BladeStyle=this.bladeStyle.value,e}applyViewSettings(e){if(!e)return;const t=this._viewSettings=MsPortalFx.extend2(this._viewSettings,ko.toJS(e)),s=t.BladeWidth;w[s]&&this.bladeWidth(s);const i=t.BladeStyle;_[i]&&this.bladeStyle(i);const a=t.DisplayState;M[a]&&this.displayState(a)}}t.ViewModel=te;t.Widget=class extends P{constructor(e,t){super(e,t),this._initialRenderingComplete=ko.observable(!1),this._shouldMenuOverlay=ko.observable(!1),this.titleResolved=ko.observable(),this.timer=MsPortalFx.startTimer(),e.addClass(q);const i=this.ltm;let o;this._$bladeContent=this.element.find(`.${A}`),t.contextMenu.registerForCleanup(i),t.contentState.subscribe(i,(t=>{const s=!L(t)&&0!==t&&1!==t;e.toggleClass("fxs-blade-status-visible",s)})),ko.computed(i,[t.contentState,ko.computed(i,[t.contentStateDisplayText],(e=>e||"")),t.statusBar.activatable],((e,s,o)=>{if(1!==e&&s){this._statusBarMessageLifetime&&this._statusBarMessageLifetime.dispose(),this._statusBarMessageLifetime=i.createChildLifetime();const n=new a.PortalReader(this._statusBarMessageLifetime,{idPrefix:"statusbar"});ko.computed(this._statusBarMessageLifetime,[t.title],(t=>{let i=`${t}-${X[e]?X[e]:""}-${s}`;o&&(i+=`-${T.linkDesc}`),n.read(i)})).extend(Z)}})).extend(Z),ko.reactor(i,(()=>{const s=!!t.locked();t.stackLayoutOptions.locked(s),e.toggleClass(D,s).toggleClass(V,s).toggleClass(J,!s)})),(0,x.subscribeAndRun)(i,[t.noticeTmplVm],(s=>{e.toggleClass(N,!!s),s&&(t.locked(!0),t.loaded(!0),t.isUiBlocked(!1),t.bladeStyle(4),this.trigger("fxbladerepos"))})),ko.reactor(i,[t.forcedMaximize,t.bladeWidth,t.reflowReady],(()=>{this.applyBladeWidth(),e.trigger(R,this.saveViewSettings()),this.trigger("fxbladerepos")})),g.track(i,this.element.find(".fxs-blade-content").first(),(e=>{this.element.toggleClass("fxs-blade-layout-sm",e>=0).toggleClass("fxs-blade-layout-md",e>=480).toggleClass("fxs-blade-layout-lg",e>=640).toggleClass("fxs-blade-layout-xl",e>=1024).toggleClass("fxs-blade-layout-xxl",e>=1366).toggleClass("fxs-blade-layout-xxxl",e>=1920)}),{notifyInitialSize:!0}),i.registerForDispose([e.find(".fxs-blade-status-container").setEvents(["click",H,t=>{t.preventDefault(),e.trigger("fxbladestatusbarclicked")}],["keydown",H,t=>{13===t.which&&(t.preventDefault(),e.trigger("fxbladestatusbarclicked"))}]),e.setEvents(["keydown",t=>{if(e.find(H).length&&113===t.which)return e.trigger("fxbladestatusbarclicked"),!1}])]),(0,x.subscribeAndRun)(i,[t.errorTmplVm],(s=>{e.toggleClass(N,!!s),s&&(t.locked(!0),t.loaded(!0),t.isUiBlocked(!1),t.bladeStyle(4),this.trigger("fxbladerepos"))})),i.registerForDispose([s.setup(e,t.contextMenu.menuItems)]),t.contextMenu.menuItems.subscribeAndRun(i,(a=>{const n=!!o,l=a.length>0;n&&!l?o.dispose():!n&&l&&(o=i.createChildLifetime()).registerForDispose(s.setup(e,t.contextMenu.menuItems))})),this.applyBladeWidth();const n=this.element.find(`.${K}, .${G}`);i.registerForDispose(n.setEvents(["click",e=>{const t=this.element.hasClass(Q);this.toggleCollapse({expand:t,startedBy:"user"}),e.stopPropagation(),MsPortalFx.Base.Diagnostics.Telemetry.trace({source:this.options.getTelemetryName(),action:"MenuCollapse",actionModifier:t?"Expand":"Collapse",name:"fxs-blade-menu-expandcollapse"}),this.element.find(`.${t?G:K}`).focus()}])),ko.computed(this.ltm,[t.isUiBlocked,t.loaded],((e,t)=>{this.options.showLoadingIndicator(!t||e)}));const l=this._initialRenderingComplete=ko.observable(!1);ko.reactor(this.ltm,[this.options.showLoadingIndicator],(e=>{e||l(!0),this.options.commandBar.disabled(e)})),ko.reactor(this.ltm,[t.title,l],((e,t)=>{(e||t)&&this.titleResolved(!0)})),ko.reactor(this.ltm,[this._initialRenderingComplete,t.diContainer?.get(v.HomeViewSettings).showAzHome,t.diContainer?.get(v.HomeViewSettings).homeview],((e,t,s)=>{e&&this._shouldMenuOverlay(this.element[0].closest(".fxs-blade").classList.contains("fxs-menublade")&&this.element.hasClass("fxs-blade-content-container-default"))})),this._shouldMenuOverlay.fxAwaitAndRun(this.ltm,(e=>e)).then((()=>{const e=e=>{if(e?.target instanceof Element&&e?.target.classList.contains("fxs-part-reactframe")&&!1===e?.isTrusted)return;if(!1===this._shouldMenuOverlay())return;const t=this.element.hasClass(Q),s=window.innerWidth;s<=720&&!t?this.collapse():s>720&&t&&this.expand()};window.addEventListener("resize",e),e(),this.ltm.registerForDispose((()=>{window.removeEventListener("resize",e)}))}))}toggleCollapse(e){if(!this.element.hasClass(Q)===e?.expand)return;const t=e?.expand??this.element.hasClass(Q);"user"===e?.startedBy&&MsPortalFx.Base.Diagnostics.Telemetry.trace({source:"OverlayServiceMenu",action:"MenuCollapseToggle",actionModifier:t?"Expand":"Collapse",data:{startedBy:e.startedBy,source:this.options.getTelemetryName()}}),t?this.expand():this.collapse()}collapse(){this.element.toggleClass(Q,!0),this.trigger("fxbladerepos"),(0,C.unregister)(this._dismissHandlerObject),this._dismissHandlerObject=null}expand(){this.element.toggleClass(Q,!1),this.trigger("fxbladerepos"),this._shouldMenuOverlay()&&window.innerWidth<=720&&!this._dismissHandlerObject&&(this._dismissHandlerObject={logName:"bladeContent-overlayMenu",dismissFn:()=>{this.collapse()},restoreFocus:()=>{document.getElementsByClassName("fxs-overlay-menu-expander")[0].focus()},shouldDismissOnMouseDownFn:e=>this.element[0].contains(e)?0:2},(0,C.register)(this._dismissHandlerObject),this.ltm.registerForDispose((()=>{(0,C.unregister)(this._dismissHandlerObject),this._dismissHandlerObject=null})),this.setFocus())}dispose(){this._cleanElementClasses([p.allWidthClasses,D,q,this.bladeStyleClass,J,V,Q]),super.dispose()}saveViewSettings(){return this.options.getViewSettings()}setSummary(e){const t=this.element.find(`.${z}`);n.hide(t),t.empty().append(e),n.unhide(t)}setActionBar(e){if(this._actionBar)return void E.error("The blade '{0}' already contains an action bar.".format(this.options.id));if(!this.ltm||this.ltm.isDisposed())return;const t=this.element.find(".fxs-blade-actionBar").removeClass("fxs-display-none"),s=$(FxImpl.createElement("div"));t.append(s),this.ltm.registerForDispose(this._actionBar=e(s))}getForm(){return{element:this.element.find(".fxs-blade-dialog")[0],ltm:this.ltm}}showForm(e,t){this.element.find(`.${U}`).toggleClass(O,t?.modal||!1)}hideForm(){this.element.find(`.${U}`).removeClass(O)}initializeLayout(){const e=this.element.find(".fxs-blade-stacklayout");if(this._layout)throw new Error("Blade widget's layout can only be initialized once.");const t=this.options.stackLayoutOptions;this._layout=new h.Widget(e,t),this.ltm.registerForDispose(this._layout),this.applyBladeWidth()}childRelayout(){this._layout&&this._layout.options.childElements().forEach((e=>{const t=F.getWidget(e,S);t&&t.setSize(-1,-1)}))}addChild(e){let t;if(!e)throw new Error("Can't add null child.");this._layout&&this._layout.addChild(e),t=e instanceof P?e:F.getWidget(e,P),t&&t.setSize(-1,-1)}removeChild(e){return!!this._layout&&this._layout.removeChild(e)}setFocus(){if(!f.isAndroidOrMobile&&this._layout){let e="fxs-lens";const t=this.element.find(`.${z}`).find(`.${e}`);let s;if(n.isVisible(t)?s=t:(e=A,s=this._$bladeContent),s.length){const t=document.activeElement;t&&$.contains(s[0],t)||this._initialRenderingComplete.fxAwaitAndRun(this.ltm).then((()=>{const t=()=>{const e=this._actionBar,t=e?.contentElement;if(t&&n.isVisible(t))return o.setFocusOnContainer(t[0],null);this.setFocusOnCommandBar()},i=()=>o.setFocusOnContainer(s[0],e);i().then((e=>{if(!e&&!$.contains(this.element[0],document.activeElement))return b.delay(150).then(i)})).then((e=>{e||$.contains(this.element[0],document.activeElement)||t()})).catch(t)}))}}else{const e=this._$bladeContent.closest(".fxs-blade").find(".fxs-blade-close");e.length&&e[0].focus()}}setFocusOnCommandBar(){const e=F.getWidget(this.element.find(".fxs-commandBar-target"),r.Widget);e&&e.setFocus()}initializeStyleReactor(){const e=this.element,t=this.options;(0,x.subscribeAndRun)(this.ltm,[t.bladeStyle],(t=>{let s=this.bladeStyleClass;e.removeClass(Object.keys(MsPortalFx.Blades.Internal.BladeStyle).filter((e=>!parseInt(e))).map((e=>"fxs-bladestyle-"+e.toLowerCase())).concat([j]).join(" "));const i=_[t];s=this.bladeStyleClass=i?"fxs-bladestyle-"+i.toLowerCase():j,e.addClass(s)}))}applyBladeWidth(){const e=this.options.bladeWidth.peek();let t;const s=(0,p.getBladeWidthInfo)(e);t=51!==e&&this.options.reflowReady.peek()?"fxs-blade-size-reflow":s.css,this.element.removeClass(p.allWidthClasses).addClass(t);const i=this.element.find(`.${A}`).removeClass(p.allWidthClasses).addClass(t);this.options.forcedMaximize.peek()&&i.css("width",s.width+"px")}}})),
define("MsPortalImpl/Widgets/Widgets.Blade",["require","exports","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/BladeWidthHelper","MsPortalImpl/Base/JQueryHelper","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Widgets/Widgets.BladeContent","MsPortalImpl/Interactions/Interactions.FocusHandler","MsPortalImpl/Interactions/Interactions.PortalReader","MsPortalImpl/Interactions/Interactions.FullScreenMode","MsPortalImpl/Interactions/Interactions.PrintHandler","MsPortalImpl/Widgets/Widgets.UIElementBase","Viva.Controls/Util/Viva.Resize","MsPortalImpl/Base/Base.Timers","FxInternal/Weave/Components/LoadingIndicator","MsPortalImpl/Weave/DirectRender","MsPortalImpl/Widgets/Widgets.BladeContent.Component","MsPortalImpl/Widgets/Widgets.Blade.Component","MsPortalImpl/Weave/Util","FxInternal/Css","_generated/Less/MsPortalImpl/Widgets/Widgets.Blade.css","MsPortalImpl/UI/Compositions/UI.Composition.BladeFavoriteResourceButton","MsPortalImpl/UI/Compositions/UI.Composition.BladeEditAssetButton","Weave","MsPortalImpl/Services/Services.Copilot"],(function(e,t,s,i,a,o,n,l,r,d,c,m,h,u,p,f,g,x,b,C,v,y,I,B,_,w){"use strict";t.Widget=t.ViewModel=t.DisplayStateHelper=void 0,t.createBladeWidget=function(e,t,i){const a=new FxImpl.TriggerableLifetimeManager,o=ko.observable();(0,g.applyToElement)({element:e[0],ltm:a,weaveNode:s(b.BladeInner,{vm:t,widgetBladeRef:o}),weaveContext:{diContainer:t.diContainer},opName:"blade"});const n=new H(e,t);return n.ltm.registerForDispose(a),o(n),i.registerForDispose(n),n},t.getDefaultTitle=function(e){return N.untitled.format(e)},t.widgetProperties=void 0;var M=MsPortalFx.Base.Diagnostics.Telemetry,W=MsPortalFx.Blades.Internal.DisplayState;(0,v.injectCss)(y);const k=window,F=document,S=h.Widget.viewSettingsChanged,P=(0,a.getBladeWidthInfo)(0).width,T=(0,a.getBladeWidthInfo)(1).width,E=P,L=(0,a.getBladeWidthInfo)(51).width,R=E+L,D=i.Controls.Container.preview.toUpperCase(),N=i.Blade,V=t.DisplayStateHelper=[];V[1]={css:""},V[2]={css:"fxs-blade-maximized"};t.widgetProperties={title:"title",subtitle:"subtitle",titleSuffix:"menuContent.title",subtitleSuffix:"menuContent.subtitle",description:"description",helpUri:"helpUri",icon:"icon",showBladeIcon:"showBladeIcon",titleImageUri:"titleImageUri",contentState:"contentState",contentStateDisplayText:"contentStateDisplayText"};class A extends h.ViewModel{getTelemetryName(){return["Extension",this.bladeName.extensionName,"Blade",this.bladeName.name].join("/")}constructor(e,t,s,i){super(e),this.diContainer=t,this.close=$.noop,this.closed=$.noop,this.pinblade=$.noop,this.shareItBlade=$.noop,this.editblade=$.noop,this.title=(0,_.makeWritableComputation)(),this.titleMain=(0,_.makeWritableComputation)(),this.titleExtras=(0,_.makeWritableComputation)(),this.crumb=ko.observable(),this.titleSuffix=ko.observable(),this.subtitle=(0,_.makeWritableComputation)(""),this.icon=(0,_.makeWritableComputation)(),this.titleImageUri=(0,_.makeWritableComputation)(),this.displayState=ko.observable(2),this.pinEnabled=(0,_.makeWritableComputation)(!1),this.shareItEnabled=(0,_.makeWritableComputation)(!1),this.editEnabled=(0,_.makeWritableComputation)(!1),this.editState=(0,_.makeWritableComputation)(!1),this.printEnabled=(0,_.makeWritableComputation)(!1),this.pinVisible=(0,_.makeWritableComputation)(!1),this.shareItVisible=(0,_.makeWritableComputation)(!1),this.editVisible=(0,_.makeWritableComputation)(!1),this.customHome=!1,this.collapseVisible=(0,_.makeWritableComputation)(!1),this.collapsed=(0,_.makeWritableComputation)(!1),this.loaded=ko.observable(!1),this.shieldType=ko.observable(),this.isUiBlocked=ko.observable(!1),this.showBladeIcon=(0,_.makeWritableComputation)(!1),this.associatedWithAsset=ko.observable(!1),this.showPreviewTag=ko.observable(!1),this.isMenuBlade=ko.observable(!1),this.isTabMenuBlade=ko.observable(!1),this.isInContextPane=ko.observable(!1),this.isDefaultItemSelected=ko.observable(!0),this.useActivationStyle=!1,this.showTranslucentSpinner=(0,_.makeWritableComputation)(!1),this.asSubJourney=!1,this.directoryInfo=(0,_.makeWritableComputation)(),this.deepLink=ko.observable("#"),this.showTitleImage=(0,_.makeIndirectComputation)(!1),this.hideCloseButton=(0,_.makeWritableComputation)(!1),this.showMinimize=!1,this.showMaximize=!0,this.showRestore=!0,this.showFavoriteResourceButton=(0,_.makeWritableComputation)(!1),this.showEditAssetButton=(0,_.makeWritableComputation)(!1),this.showCopilotContextMenu=(0,_.makeWritableComputation)(),this.ariaIds={title:MsPortalFx.getUniqueId(),subtitle:MsPortalFx.getUniqueId()},this.bladeName=i||{name:e,extensionName:null};const a=this.defaultContent=new l.ViewModel(e,{diContainer:t,loaded:this.loaded,disabled:this.disabled,displayState:this.displayState,shieldType:this.shieldType,isUiBlocked:this.isUiBlocked},this.bladeName);if(s){const e=s.DisplayState;W[e]&&this.displayState(e)}a.applyViewSettings(s),this.favoriteResourceButton=t.get(I.BladeFavoriteResourceButton),this.editAssetButton=t.get(B.BladeEditAssetButton);const o=t.get(w.CopilotService).getConfig();this.bladeName?.name.toLowerCase()===o.chatView&&this.bladeName?.extensionName===o.extension&&this.showCopilotContextMenu(o)}}function z(e){let t="";return e.forEach((e=>{e&&(t=t?N.titleFormat.format(t,e):e)})),t}t.ViewModel=A;class H extends h.Widget{constructor(e,t){super(e,t),this._headerContent=[],this._detailContent=[],e.addClass("fxs-blade-initializing").addClass("fxs-blade").addClass("msportalfx-shadow-level3").addClass("fxs-portal-bg-txt-br");const s=e.find(".fxs-blade-content-container-default"),i=this._defaultContent=new l.Widget(s,t.defaultContent);let a;i.initializeStyleReactor(),u.track(this.ltm,this.element.first(),(()=>this._relayoutChildren()),{ignoreInitialState:!0}),t.displayState.subscribeAndRun(this.ltm,(e=>{this.refreshDisplayState()})),t.defaultContent.locked.subscribeAndRun(this.ltm,(e=>{t.locked(e)})),this.ltm.registerForDispose(i),this._accessibility(),this._attachEventHandlers(),this._setupDefaultReactors(t),s.trigger(S,i.saveViewSettings()),this.options.displayState.subscribeAndRun(this.ltm,(()=>{this.trigger("fxbladerepos")})),this._setupLoadingReactor=()=>{const e=this.getContentWidget();a&&a.dispose(),a=this.ltm.createChildLifetime(),ko.computed(a,[this.options.loaded,e.options.showLoadingIndicator,e.options.shieldType],((e,t,s)=>{this.element.toggleClass("fxs-blade-hide-translucent",(!e||t)&&1!==s)}))},this._setupLoadingReactor()}dispose(){const e=this._defaultContent;this._cleanElementClasses(["fxs-blade","fxs-portal-bg-txt-br","fxs-menublade","fxs-blade-initializing",a.allWidthClasses,(0,l.combineAllCssClasses)(V),e.bladeStyleClass,"fxs-display-none","fxs-blade-collapsed","fxs-blade-firstblade","msportalfx-shadow-level3","fxs-blade-lastblade","fxs-blade-hide-translucent"]),this.trigger("fxloadingontopbar",{id:this.options.id,cancel:!0}),super.dispose()}refreshDisplayState(){this.element.trigger(S,this._defaultContent.saveViewSettings())}initializeLayout(e){const t=this.element;if(t.removeClass("fxs-blade-initializing"),e){const i=this.hasMenuBladeClass();e.callback&&e.callback(t);if(!i&&this.hasMenuBladeClass()&&u.track(this.ltm,this._defaultContent.element.first(),(()=>this._relayoutChildren()),{ignoreInitialState:!0}),e.hideDefaultContent&&(this._defaultContent.element.addClass("fxs-display-none"),this._defaultContent.options.loaded(!0)),e.setPlaceholderDetailContent){const e=t.find(".fxs-blade-content-container-details-primary").addClass("fxs-bladecontent fxs-blade-color-locked"),i=this._childLifetime.createChildLifetime();i.registerForDispose((()=>e.removeClass("fxs-bladecontent fxs-blade-color-locked"))),(0,g.applyToElement)({element:e[0],ltm:i,weaveNode:s(f.LoadingIndicator,{className:"fxs-bladecontent-progress fxs-portal-background"}),weaveContext:{diContainer:this.options.diContainer}}),this._detailContent.push({container:e,widget:null,lifetime:i,bindingLifetime:null})}}}resetInternalState(){this._$lastFocused=null,this._$lastFocusedChain=null}_openBladeContent(e,t){return(0,g.applyToElement)({element:e.container[0],ltm:e.lifetime,weaveNode:s(x.BladeContentInner,{vm:t}),weaveContext:{diContainer:t.diContainer},opName:"openBladeContent"}),e.widget=new l.Widget(e.container,t),e.widget.initializeStyleReactor(),e.lifetime.registerForDispose(e.widget),e.lifetime.registerForDispose((()=>{e.widget=null})),e.bindingLifetime=e.lifetime.createChildLifetime(),this._setupDetailReactors(e.bindingLifetime,this.options,t,this._detailContent.length>1),e.widget}_openBladeHeaderContent(e,t,i){return(0,g.applyToElement)({element:e.container[0],ltm:e.lifetime,weaveNode:s(x.BladeContentInner,{vm:t}),weaveContext:{diContainer:t.diContainer},opName:"openBladeContent"}),e.widget=new l.Widget(e.container,t),e.widget.initializeStyleReactor(),e.lifetime.registerForDispose(e.widget),e.lifetime.registerForDispose((()=>{e.widget=null})),e.bindingLifetime=e.lifetime.createChildLifetime(),i&&this._setupHeaderReactors(e.bindingLifetime,this.options,t),e.widget}focusSearchBox(){this.element.find(".fxc-search input").first().focus()}getContentWidget(){const e=MsPortalFx.last(this._detailContent);return e&&e.widget||this._defaultContent}setDetailContent(e){let t;this._detailContent.length?(t=this._detailContent[0],t.lifetime.dispose()):(t={lifetime:void 0,bindingLifetime:void 0,container:this.element.find(".fxs-blade-content-container-details-primary"),widget:void 0},this._detailContent.push(t)),t.lifetime=this._childLifetime.createChildLifetime();const s=this._openBladeContent(t,e);return this.trigger("fxbladerepos"),this._setupLoadingReactor(),s}setHeaderContent(e,t){let s;this._headerContent.length?(s=this._headerContent[0],s.lifetime.dispose()):(s={lifetime:void 0,bindingLifetime:void 0,container:this.element.find(".fxs-blade-content-container-header-primary"),widget:void 0},this._headerContent.push(s));const i=s.container.addClass("fxs-bladecontent fxs-blade-color-locked").removeClass("fxs-display-none"),a=this._childLifetime.createChildLifetime();return a.registerForDispose((()=>i.removeClass("fxs-bladecontent fxs-blade-color-locked").addClass("fxs-display-none"))),s.lifetime=a,s.widget=this._openBladeHeaderContent(s,e,t),s.widget}openBladeInPlace(e,t){const s=MsPortalFx.last(this._detailContent);s&&(s.container.addClass("fxs-display-none"),s.bindingLifetime&&s.bindingLifetime.dispose());const i=e.createChildLifetime(),a=this.element.find(".fxs-blade-content-container-default-details"),o=$(FxImpl.createElement("div",{class:"fxs-blade-content-container-details fxs-blade-border fxs-portal-border"}));a.append(o);const n={container:o,lifetime:i,bindingLifetime:null,widget:null};this._detailContent.push(n),i.registerForDispose((()=>{n.container.remove(),MsPortalFx.remove(this._detailContent,n);const e=MsPortalFx.last(this._detailContent);e&&e.widget&&(e.container.removeClass("fxs-display-none"),e.bindingLifetime=e.lifetime.createChildLifetime(),this._setupDetailReactors(e.bindingLifetime,this.options,e.widget.options))}));return this._openBladeContent(n,t)}clearDetailContent(e){this._setupDefaultReactors(this.options);const t=this._detailContent[0];t?.lifetime?.dispose(),this._detailContent=[],this.initializeLayout(e)}clearHeaderContent(){const e=this._headerContent[0];e?.lifetime?.dispose(),this._headerContent=[]}close(e){const t={id:h.Widget.getId(this.element),completed:e};this.trigger("close",t)&&this.trigger("closed",t)}minimize(){const e=h.Widget.getId(this.element);this.trigger("minimized",{id:e})}maximize(){const e=h.Widget.getId(this.element);this.trigger("maximized",{id:e})}restore(){const e=h.Widget.getId(this.element);this.trigger("restore",{id:e})}setFocus(){if(n.isAndroidOrMobile)this.element.find(".fxs-blade-close").focus();else{const e=F.activeElement;if(!e||!$.contains(this.element[0],e)){let e;this._$lastFocused&&$.contains(this.element[0],this._$lastFocused[0])&&(0,o.isVisible)(this._$lastFocused)&&(this._$lastFocused.focus(),e=!0),!e&&this._$lastFocusedChain&&(e=this._$lastFocusedChain.some((e=>!!(e.length&&$.contains(this.element[0],e[0])&&(0,o.isVisible)(e))&&(r.setFocusOnContainer(e[0],null),$.contains(this.element[0],F.activeElement))))),e||this.getContentWidget().setFocus()}}}idealWidth(e){const t=this.hasMenuBladeClass(),s=this._defaultContent,i=s.element.hasClass("fxs-blade-collapsed");if(e)return this.options.collapsed.value?32:t?i?32+P:R:E;{const e=this.getContentWidget();let o=(0,a.getBladeWidthInfo)(e.options.bladeWidth()).width;return t?s.options.noticeTmplVm.value||s.options.errorTmplVm.value||this.options.disabled()?(0,a.getBladeWidthInfo)(2).width:(o=e===s?e.element.siblings().hasClass("fxs-bladecontent")||this.element.hasClass("fxs-blade-initializing")?T:0:T,o+(i?32:L)):o}}setContextPaneWidth(e){this.element.removeClass(`${a.contextPaneDefaultSizeClass} ${a.allWidthClasses}`),MsPortalFx.isNullOrUndefined(e)?this.element.addClass(a.contextPaneDefaultSizeClass):(this.getContentWidget().options.bladeWidth(e),this.element.addClass((0,a.getBladeWidthInfo)(e).css))}isMenuBladeLoadingDetailBlade(){return(this.hasMenuBladeClass()||this.element.hasClass("fxs-tabmenublade"))&&this.getContentWidget()===this._defaultContent&&!this._defaultContent.options.noticeTmplVm.value&&!this._defaultContent.options.errorTmplVm.value&&!this.options.disabled()&&this._defaultContent.element.siblings().children().hasClass("fxs-bladecontent")}_setupDefaultReactors(e){const t=this._resetChildLifetime();if(!t)return;const s=e.defaultContent;ko.reactor(t,(()=>{const t=s.title();e.title(t),e.crumb(t),e.titleMain(t)})),ko.reactor(t,(()=>{const t=[s.subtitle()];e.showPreviewTag()&&t.push(D),e.subtitle(z(t))})),ko.reactor(t,(()=>{e.icon(s.icon()),e.showBladeIcon(s.isV2Blade()?s.hasIcon():e.associatedWithAsset())})),e.showTitleImage.reseat((0,_.composeComputation)([s.bladeStyle,e.titleImageUri],((e,t)=>2===e&&!!$.trim(t))))}_setupHeaderReactors(e,t,s){if(!e)return;const i=t.defaultContent;ko.reactor(e,(()=>{i.title(s.title())})),ko.reactor(e,(()=>{i.subtitle(s.subtitle())})),ko.reactor(e,(()=>{i.icon(s.icon())}))}_setupDetailReactors(e,t,s,i){if(!e)return;const a=t.defaultContent;ko.reactor(e,[a.title,s.title,s.titleSuffix,t.titleSuffix],(()=>{const e=z(i?[a.title(),s.title(),s.titleSuffix()]:[a.title(),t.titleSuffix(),s.titleSuffix()]);t.title(e),!i&&t.crumb(a.title()),t.titleMain(a.title()),t.titleExtras(e.replace(a.title(),""))})),ko.reactor(e,(()=>{const e=[a.subtitle(),s.subtitleSuffix()];t.showPreviewTag()&&e.push(D),t.subtitle(z(e))})),ko.reactor(e,(()=>{const e=s.hasIcon()?s:a;t.icon(e.icon()),t.showBladeIcon(e.isV2Blade()?e.hasIcon():t.associatedWithAsset())})),t.showTitleImage.reseat((0,_.composeComputation)([s.bladeStyle,t.titleImageUri],((e,t)=>2===e&&!!$.trim(t))))}_resetChildLifetime(){if(this.ltm)return MsPortalFx.disposeDisposable(this._childLifetime),this._childLifetime=this.ltm.createChildLifetime()}_accessibility(){const e=this.element.find(".fxs-blade-title-titleText");e.attr("aria-describedby",this.options.ariaIds.subtitle),this.element.find(".fxs-blade-title-subtitleText").attr("id",this.options.ariaIds.subtitle),e.attr("id",this.options.ariaIds.title),this.element.attr("aria-labelledby",this.options.ariaIds.title+" "+this.options.ariaIds.subtitle),this.element.find(".fxs-blade-header").attr("aria-labelledby",this.options.ariaIds.title+" "+this.options.ariaIds.subtitle)}_attachEventHandlers(){const e=this.element,t=()=>this.options.getTelemetryName();e.find(".fxs-blade-close").on("click",(e=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-close"}),e.preventDefault(),this.close(!1)})),e.find(".fxs-blade-fullscreen").on("click",(()=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-fullscreen"}),this.options.diContainer.get(c.FullScreenMode).toggle()})),e.find(".fxs-blade-minimize").on("click",(e=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-minimize"}),e.preventDefault(),this.minimize()})),e.find(".fxs-blade-maximized").on("click",(e=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-maximized"}),e.preventDefault(),this.maximize()})),e.find(".fxs-blade-pin").on("click",(()=>(M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-pin"}),this.options.pinblade(null),!1))),e.find(".fxs-blade-shareit").on("click",(()=>(M.trace({source:t(),action:"BladeOpened",name:"fxs-blade-shareit"}),this.options.shareItBlade(null),!1))),e.find(".fxs-blade-restore").on("click",(e=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-restore"}),e.preventDefault(),this.restore()})),e.find(".fxs-blade-edit").on("click",(()=>(M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-edit"}),this.options.editblade(null),!1))),e.find(".fxs-blade-copyname").on("click",(()=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-copyname"});const s=F.createRange();s.selectNodeContents(e.find(".fxs-blade-title-titleText")[0]);const i=k.getSelection();i.removeAllRanges(),i.addRange(s),F.execCommand("copy"),i.removeAllRanges();const a=this.ltm.createChildLifetime();new d.PortalReader(a).read(N.copyAriaResult),a.dispose()})),e.find(".fxs-blade-print").on("click",(()=>{M.trace({source:t(),action:"CommandExecuted",name:"fxs-blade-print"});const s=e.find("[data-react-id]")[0];if(s){const e=s.getAttribute("data-react-id");parent.window.frames[e].contentWindow.postMessage({signature:"Az",kind:3036,data:this.options.isMenuBlade()?{titleMain:this.options.titleMain.value,titleExtras:this.options.titleExtras.value,subtitle:this.options.subtitle.value}:null},"*")}else this.options.diContainer.get(m.PrintHandler).printBlade(e[0],{name:this.getContentWidget().options.getTelemetryName(),source:"BladeCommand",menuBladeCtx:this.options.isMenuBlade.peek()?t():null})}));const s=(0,p.throttle)(this.ltm,(e=>{let t=this._$lastFocused=$(e.target);const s=this._$lastFocusedChain=[];for(;t.length&&(t=t.parent().closest(".azc-control, .fxs-tile, .fxs-commandBar, .fxs-commandBar-item-expandList, .fxs-commandBar-item",this.element[0]),t.length);)s.push(t)}));this.ltm.registerForDispose(e.setEvents(["focusout",s],["click",".fxs-blade-collapser, .fxs-blade-expander, .fxs-blade-collapse-veil",e=>{const s=this.options.collapsed.value;this.options.collapsed(!s),this.trigger("fxbladerepos"),(0,C.tryFocusAfterChangePropagation)(this.element.find("."+(s?"fxs-blade-collapser":"fxs-blade-expander"))[0]),e.stopPropagation(),M.trace({source:t(),action:"BladeCollapse",actionModifier:s?"Expand":"Collapse",name:"fxs-blade-expandcollapse"})}],["click",".fxs-overlay-menu-expander",e=>{this._defaultContent.toggleCollapse({expand:!0,startedBy:"user"})}],["click",".fxs-blade-content-container-default-overlay .fxc-menu-item",e=>{window.innerWidth<=720&&this._defaultContent.toggleCollapse({expand:!1,startedBy:"user"})}],["fxupdatelastfocus",e=>{this._$lastFocused=e.$lastFocused}])),(0,_.subscribeAndRun)(this.ltm,[this.options.collapsed],(e=>{this.element.toggleClass("fxs-blade-collapsed",e)}))}goToDefaultItem(){this.options.isMenuBlade()?this.trigger("fxgotodefaultitem"):this.goToFirstDetailContent()}goToFirstDetailContent(){const e=this._detailContent[0];e?.widget&&this.goToDetailContent(e.widget.options.id)}goToDetailContent(e){const t=this._detailContent.length;let s=t;for(let i=0;i<t;++i){const t=this._detailContent[i];if(t.widget&&t.widget.options.id===e){s=i;break}}for(let e=t-1;e>s;--e)this._detailContent[e].lifetime.dispose();return s!==t}getBreadCrumbs(e){const t=this.options,s=t.titleExtras.value,i=t.title.value,a=s&&!i.includes(s)?ko.observable(i+s):ko.observable(i);return[{bladeId:t.id,bladeTelemetryName:t.getTelemetryName(),bladeTitle:e||!s?t.crumb:a,bladeTitleResolved:this._defaultContent.titleResolved,isCustomHome:t.customHome,deepLink:t.deepLink,isDefaultItemSelected:t.isDefaultItemSelected}].concat(this._detailContent.filter(((e,t)=>t&&e.widget)).map((e=>{const t=e.widget,s=t.options;return{bladeId:s.id,bladeTelemetryName:s.getTelemetryName(),bladeTitle:s.title,bladeTitleResolved:t.titleResolved,isCustomHome:!1,deepLink:ko.observable("#"),isDefaultItemSelected:ko.observable(!0)}})))}setupAsKnownMenuBlade(){if(this.element.hasClass("fxs-blade-initializing")){this.element.addClass("fxs-blade-known-menu fxs-menublade");const e=this.element.find(".fxs-blade-content-container-details").empty();e.append(FxImpl.createElement("fxs-progress")),ko.applyBindingsToDescendants({},e[0])}}hasMenuBladeClass(){return this.element.hasClass("fxs-menublade")}_relayoutChildren(){this._defaultContent.childRelayout(),this._headerContent.forEach((e=>{e.widget&&e.widget.childRelayout()})),this._detailContent.forEach((e=>{e.widget&&e.widget.childRelayout()}))}}t.Widget=H}));