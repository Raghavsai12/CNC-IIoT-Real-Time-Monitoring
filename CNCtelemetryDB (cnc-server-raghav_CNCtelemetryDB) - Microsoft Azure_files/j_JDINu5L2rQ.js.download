define("MsPortalImpl/Widgets/AzHome/AzHomeAlerts/AzHomeAlerts.DataSource",["require","exports","FxHubs/ArtHelpers/ArtApis","Fx/Errors","MsPortalImpl/Services/Services.Subscriptions","MsPortalImpl/Widgets/AzHome/AzHomeConstants","MsPortalImpl/Widgets/AzHome/FreeTrial/FreeTrialConstants"],(function(e,t,r,s,n,o,a){"use strict";t.freGetAlertsCardData=async function(){const e={query:u,options:{$top:5}},t={query:c,options:{$top:5}},r=A(a.AlertsConstants.FREGetResourceAlertsData,e),s=A(a.AlertsConstants.FREGetServiceHealthAlerts,t),[n,i]=await Promise.all([r,s]),l=y(n),p=new Map(n?.rows?.map((e=>[e[l[o.AlertsDataSourceConstants.Severity]],e[l[o.AlertsDataSourceConstants.Count]]]))),d=0===p.size&&0===await S(),m=y(i);return{serviceIssueAlertsCount:new Map(i?.rows?.map((e=>[e[m[o.AlertsDataSourceConstants.EventType]],e[m[o.AlertsDataSourceConstants.DCountTrackingId]]]))).get(a.AlertsConstants.ServiceIssue)??0,resourceAlertsCount:p.get(a.AlertsConstants.Severity)??0,isDay7:d}},t.getAlertsByResourceIds=async function(e,t){const r=function(e,t){if(!e?.length)return null;let r=d+JSON.stringify(e)+"))";const s="frehome"===t?g:m;r+=s;const n=o.AlertsDataSourceConstants.MaxResourcesToShow;return{query:r,options:{$top:n}}}(e,t),s=await A(o.AlertsDataSourceConstants.GetAlertsByResourceIds,r),n=y(s);return new Map(s?.rows?.map((e=>[e[n[o.AlertsDataSourceConstants.TargetResourceId]].toLowerCase(),e[n[o.AlertsDataSourceConstants.AlertsCount]]])))},t.getResourceAlerts=async function(e){const t=w(p,e);if(!t)return{alertsMap:new Map,isDay7:!1};const r=await A(o.AlertsDataSourceConstants.GetResourceAlerts,t),s=y(r),n=new Map(r?.rows?.map((e=>[e[s[o.AlertsDataSourceConstants.Severity]],e[s[o.AlertsDataSourceConstants.Count]]]))),a=0===n.size&&0===await S();return{alertsMap:n,isDay7:a}},t.getServiceHealthAlerts=async function(e){const t=w(l,e),r=await A(o.AlertsDataSourceConstants.GetServiceHealthAlerts,t),s=y(r);return new Map(r?.rows?.map((e=>[e[s[o.AlertsDataSourceConstants.EventType]],e[s[o.AlertsDataSourceConstants.DCountTrackingId]]])))},t.getSubscriptionIds=async function(e){const t=e.get(n.SubscriptionsUserContext);if(t){const e=await t.getInSessionSelectedSubscriptions();return e()?.map((e=>e.subscriptionId))}return[]},t.log=void 0;const i=t.log=MsPortalFx.Base.Diagnostics.createLog(e),l='ServiceHealthResources\n| where type =~ "Microsoft.ResourceHealth/events"\n| extend eventType = tostring(properties.EventType), status = tostring(properties.Status), impactStartTime = properties.ImpactStartTime, impactMitigationTime = properties.ImpactMitigationTime, lastUpdateTime = properties.LastUpdateTime, trackingId = tostring(properties.TrackingId)\n| where((eventType == "HealthAdvisory" and impactMitigationTime > now() and impactStartTime < now(28d) and lastUpdateTime >= ago(28d) and status == \'Active\')\nor (eventType == "PlannedMaintenance" and impactMitigationTime > now() and impactStartTime < now(50d) and lastUpdateTime >= ago(50d) and status == \'Active\')\n  or(eventType == "ServiceIssue" and lastUpdateTime > ago(3d) and status == \'Active\')\n   or(eventType == "SecurityAdvisory" and impactMitigationTime > now() and impactStartTime < now(28d) and lastUpdateTime >= ago(28d) and status == \'Active\'))\n   or (eventType == "Billing" and impactStartTime > ago(60d) and status == \'Active\')\n| project eventType, trackingId\n| summarize dcount(trackingId) by eventType',c='ServiceHealthResources\n| where type =~ "Microsoft.ResourceHealth/events"\n| extend eventType = tostring(properties.EventType), status = tostring(properties.Status), impactStartTime = properties.ImpactStartTime, impactMitigationTime = properties.ImpactMitigationTime, lastUpdateTime = properties.LastUpdateTime, trackingId = tostring(properties.TrackingId)\n| where (eventType == "ServiceIssue" and lastUpdateTime > ago(3d) and status == \'Active\')\n| project eventType, trackingId\n| summarize dcount(trackingId) by eventType',p='alertsmanagementresources\n| where type == "microsoft.alertsmanagement/alerts"\n| where properties["essentials"]["monitorCondition"] =~ "Fired"\n| where properties["essentials"]["startDateTime"] >= ago(24h)\n| extend severity = tostring(properties["essentials"]["severity"])\n| summarize count() by severity',u='alertsmanagementresources\n| where type == "microsoft.alertsmanagement/alerts"\n| where properties["essentials"]["monitorCondition"] =~ "Fired"\n| where properties["essentials"]["startDateTime"] >= ago(24h)\n| extend severity = tostring(properties["essentials"]["severity"])\n| where severity == "Sev0" or severity == "Sev1" or severity == "Sev2"\n| project severity = "severity"\n| summarize count() by severity',d="resources\n| extend low_id = tolower(id)\n| join kind=inner (alertsmanagementresources\n| where tolower(tostring(properties.essentials.targetResource)) in~ (dynamic(",m='\n| where properties.essentials.startDateTime >= ago(24h)\n| where properties.essentials.monitorCondition == "Fired"\n| extend sev = tostring(properties.essentials.severity)\n| summarize alertsCount = countif(sev in ("Sev0", "Sev1", "Sev2", "Sev3")) by targetResourceId = tolower(tostring(properties.essentials.targetResource))) on $left.low_id == $right.targetResourceId\n| project targetResourceId, alertsCount',g='\n| where properties.essentials.startDateTime >= ago(24h)\n| where properties.essentials.monitorCondition == "Fired"\n| extend sev = tostring(properties.essentials.severity)\n| summarize alertsCount = countif(sev in ("Sev0", "Sev1", "Sev2")) by targetResourceId = tolower(tostring(properties.essentials.targetResource))) on $left.low_id == $right.targetResourceId\n| project targetResourceId, alertsCount',v="resources\n| where type in~ ('microsoft.insights/metricalerts','microsoft.insights/scheduledqueryrules') and kind !in~ ('LogToMetric','LogToApplicationInsights')\n| extend enabled = tobool(properties[\"enabled\"])\n| where enabled == true\n| project properties,enabled,kind\n| union (resources | where type =~ 'microsoft.alertsmanagement/smartdetectoralertrules' | extend severity = tostring(properties[\"severity\"])\n| extend enabled = properties[\"state\"] =~ 'Enabled' | where enabled == true | project properties,enabled,severity), (resources | where type =~ 'microsoft.insights/activitylogalerts' | extend severity = \"Sev4\"\n| extend enabled = tobool(properties[\"enabled\"]) | mvexpand innerCondition = properties[\"condition\"][\"allOf\"] | where innerCondition[\"field\"] =~ 'category'\n| where enabled == true | project enabled)\n| summarize count() by enabled";function y(e){return MsPortalFx.convertArrayToMap(e.columns,(e=>e.name),((e,t)=>t))}async function A(e,t){const n={};if(!t)return n;try{const s=await(0,r.getDataFromArt)(t,`${o.AlertsDataSourceConstants.AzHomeAlertsDataSource}.${e}`,1);return s?.data?.rows&&s.data.rows.length>=0?s.data:(i.warning(`${o.AlertsDataSourceConstants.AzHomeAlertsDataSource}: data or data.rows from ARG was null/undefined in ${e}.`),n)}catch(t){const r=`${o.AlertsDataSourceConstants.AzHomeAlertsDataSource}: Error fetching data from ARG in ${e}.`;throw i.error(r,null,t),new s.FxError(r)}}function w(e,t){if(!t?.length)return null;return{query:e,subscriptions:t,options:{$top:10}}}async function S(){const e={query:v,options:{$top:o.AlertsDataSourceConstants.MaxAlertRulesCountRows}},t=await A(o.AlertsDataSourceConstants.GetAlertRulesCount,e),r=y(t)[o.AlertsDataSourceConstants.Count];return t?.rows?.[r]??0}})),
define("MsPortalImpl/Widgets/AzureHomeShared/FavoriteResources.Shared",["require","exports","Fx/Composition/Selectable","FxHubs/RpcEndPoints","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/Widgets/AzureHome/AzureHome.DataSource","MsPortalImpl/Widgets/AzureHome/AzureHome.Store"],(function(e,t,r,s,n,o,a){"use strict";t.onAddFavoritesClick=function(e,t){i({source:"AzureHomeFavorites",action:"ResourcePickerOpened"}),e.get(n.BladeOpener).openBlade(new r.PdlBladeReference("ResourcePicker","HubsExtension",{parameters:{maxSelectedItems:t},onClosed:(t,r)=>{2===t&&s.AssetTypes.addFavoriteResourcesEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceIds:r.selectedResourceIds,telemetrySource:"AzureHomeResourcePicker"}).then((t=>{t&&(a.useAzureHomeStore.setState({favoriteResourcesLoading:!0,azHomeFavoriteResourcesLoading:!0}),(0,o.reloadFavorites)(e))}))}}),{flags:9,telemetryName:"AzureHomeAddFavorites"})};var i=MsPortalFx.Base.Diagnostics.Telemetry.trace})),
define("_generated/MsPortalImpl/Svg/Internal/ResourceTableAlertsError.svg",["require","exports"],(function(e,t){"use strict";t.type=t.data=void 0;t.type=1,t.data="<svg viewBox='0 0 16 16' class='msportalfx-svg-placeholder' role='presentation' focusable='false' xmlns:svg='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g><title></title><path d='M8 2a6 6 0 1 1 0 12A6 6 0 0 1 8 2ZM6.534 5.839a.5.5 0 0 0-.638.057l-.057.07a.5.5 0 0 0 .057.638L7.293 8 5.896 9.396l-.057.07a.5.5 0 0 0 .057.638l.07.057a.5.5 0 0 0 .638-.057L8 8.707l1.396 1.397.07.057a.5.5 0 0 0 .638-.057l.057-.07a.5.5 0 0 0-.057-.638L8.707 8l1.397-1.396.057-.07a.5.5 0 0 0-.057-.638l-.07-.057a.5.5 0 0 0-.638.057L8 7.293 6.604 5.896l-.07-.057Z'/></g></svg>"}));