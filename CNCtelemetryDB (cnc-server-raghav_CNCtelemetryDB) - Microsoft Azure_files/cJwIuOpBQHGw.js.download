define("@microsoft/azureportal-reactview/ControlPlaneValidators",["require","exports","@microsoft/azureportal-reactview/internal/ReactView","@fluentui/react/lib/Styling","@fluentui/merge-styles/lib/mergeStyleSets","@microsoft/azureportal-reactview/FrameworkIcon","@microsoft/azureportal-reactview/Az","@fluentui/react/lib/Text","react","@microsoft/azureportal-reactview/ResourceManagement","FxInternal/Resources/ControlPlaneValidatorsResources","@microsoft/azureportal-reactview/FormLabel","@microsoft/azureportal-reactview/internal/BaseFunctionProxy","@fluentui/react/lib/Stack","@fluentui/react/lib/Link","@microsoft/azureportal-reactview/internal/FormLabel","@microsoft/azureportal-reactview/internal/DefaultResourceValidation","lodash"],(function(e,t,o,a,l,n,r,s,i,c,u,d,m,p,y,f,g,P){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withControlPlanePolicySelector=t.withControlPlanePolicyValidator=t.ControlPlanePolicyScopeContext=void 0,t.ControlPlanePolicyEvaluator=async function(e,t){const a=e,l=k();let n=t.additionalTelemetry;(n||(n={})).__mode=V.ControlPlaneModes.PolicyEvaluator,t={...t,additionalTelemetry:n};const r=o.ReactView.getInstance().getViewName(),s=b({...t,scope:a,bladeName:r}),i=await s,c=w(i,r,t.additionalTelemetry);return{...i,allErrorResults:c,customHtml:T(c,l,!1)}},t.ControlPlanePolicyScopeContext=i.createContext(null);t.withControlPlanePolicyValidator=function(e){return o=>{const a=i.useContext(t.ControlPlanePolicyScopeContext),[l,n]=i.useState(void 0),[r,s]=i.useContext(g.DefaultResourceValidationContext);(0,d.useValidationEffect)((()=>[E(a,l,{...o.componentOptions})]),[l,a]);const c=i.useCallback(((e,t)=>{o.onChange?.(e,t),n(t)}),[o.onChange,n]),u=i.useMemo((()=>[{skipDefault:!0,resourceTypes:[]},s]),[s]),{componentOptions:m,...p}=o;return i.createElement(g.DefaultResourceValidationContext.Provider,{value:u},i.createElement(e,{...p,onChange:c}))}};t.withControlPlanePolicySelector=function(e){return a=>{const{options:l,componentOptions:n}=a,r=i.useContext(t.ControlPlanePolicyScopeContext),s=(0,f.useFormLabelUIContext)(),c=k(),u=i.useMemo((()=>void 0===l?[{key:"false",text:"false"},{key:"true",text:"true"}]:l?.slice()),[l]);let d=n.additionalTelemetry;(d||(d={})).__mode=V.ControlPlaneModes.Selector,a={...a,componentOptions:n};const[m,p]=i.useState(null),[y,g]=i.useState(null);i.useEffect((()=>{y!==m?.key&&g(m?.key)}),[m]),i.useEffect((()=>{y!==a.selectedKey&&g(a.selectedKey)}),[a.selectedKey]);const P=new D({...n,convertValue:n.convertValue??(e=>e&&e.key&&e.key.toString())},u,[y,g],c,T);i.useEffect((()=>{let e=!0;const t=r;if(t){s?.setLoading(!0);const a=P.getAllowedValues();if(e){const l=o.ReactView.getInstance().getViewName();b({scope:t,resolvedValuesToField:a,bladeName:l,resourceTypeMetadata:n.resourceTypeMetadata,allowEmptyValues:n.allowEmptyValues,additionalTelemetry:n.additionalTelemetry}).then((t=>{if(e){const e=w(t,l,n.additionalTelemetry);P.setDeniedValues(l,t.deniedValues,e),s?.setLoading(!1)}}))}}return()=>{e=!1}}),[l,r]),i.useEffect((()=>{s?.setSublabel(P.getProps().sublabel)}),[P.getProps().sublabel]);const h=i.useCallback(((e,t,...o)=>{p("boolean"==typeof t?u.find((e=>JSON.stringify(t).toLowerCase()===e.key.toString().toLowerCase())):t),a.onChange(e,t,...o)}),[a.onChange,p,u]),{componentOptions:C,...v}=a;return i.createElement("div",null,i.createElement(e,{...v,options:u,selectedKey:y,checked:"true"===y||"false"===y?JSON.parse(y):y,disabled:P.getProps().disabled,onChange:h}))}};const h=(0,a.mergeStyles)({marginLeft:"5px"}),C=(0,m.getBaseFunctionProxy)(),v=(0,a.mergeStyles)({marginLeft:"30px"}),S=(0,l.mergeStyleSets)({icon:{float:"left",marginRight:"8px"},iconSmall:{width:16,height:16}}),V={ControlPlanePolicy:"ControlPlanePolicy",PolicyBladeLinkClicked:"PolicyBladeLinkClicked",PolicySelectorChangedSelection:"PolicySelectorChangedSelection",ControlPlaneModes:{PolicyEvaluator:"PolicyEvaluator.React",Validator:"Validator.React",Selector:"Selector.React"},PolicySelector:{AutoSelected:"AutoSelected",Cleared:"Cleared"}};async function E(e,t,a){const l=e,n=k();let r=a.additionalTelemetry;(r||(r={})).__mode=V.ControlPlaneModes.Validator;let s=a.allowEmptyValues;x(s)&&(s=!1),a={...a,allowEmptyValues:s,additionalTelemetry:r};const i=o.ReactView.getInstance().getViewName(),c=(e=>{const t=e,o=a.convertValue?a.convertValue(t):t,l=[];return x(o)||"string"==typeof o&&I(o)||function(e){let t=!1;x(e)||"string"!=typeof e||(t=e.startsWith("[")&&e.endsWith("]"));return t}(o)||l.push(o),l})(t);if(l?.scopeId){const e=await b({scope:l,resolvedValuesToField:c,bladeName:i,resourceTypeMetadata:a.resourceTypeMetadata,allowEmptyValues:a.allowEmptyValues,additionalTelemetry:a.additionalTelemetry}),t=w(e,i,a.additionalTelemetry),o=0===e.allErrorResults.length;let r=null;return e.allErrorResults.length&&(r=T(t,n,!1)),{message:r,state:o?2:3}}return{state:2}}function w(e,t,o){return e.allErrorResults.map((({reason:e,policyAssignmentId:a})=>{const[l]=c.ArmId.getResourceNames(c.ArmId.parse(a,!0)).slice(-1);return{policyAssignmentName:l,resourceLink:()=>{_(V.PolicyBladeLinkClicked,t,{},o),r.openBlade({bladeName:"PolicyAssignmentDetailBlade",extensionName:"Microsoft_Azure_Policy",parameters:{id:a}})},linkDisplayName:u.Azure.Validators.Policy.clickDetails,noLinkDisplayName:u.Azure.Validators.Policy.policyDetailsFormat.replace("{0}",l),reason:e,sysViolation:l.startsWith("sys")}}))}function T(e,t,o){const a=[],l=e.find((e=>e.sysViolation));return l?i.createElement("div",{role:"alert"},function(e){const t=/https:\/\/\S+/g,o=e.split(t),a=(0,P.defaultTo)(e.match(t),[]),l=[];return o.forEach(((e,t)=>{l.push(i.createElement("span",{key:`text-${t}`},e)),t<a.length&&l.push(i.createElement(y.Link,{href:a[t],target:"_blank",key:`link-${t}`},a[t]))})),l}(l.reason)):(o?e.forEach((e=>{const o=i.createElement(i.Fragment,null,i.createElement("span",null,i.createElement(s.Text,null,e.reason),t?i.createElement(s.Text,null,e.noLinkDisplayName):i.createElement(y.Link,{className:h,onClick:t=>{e.resourceLink()},underline:!0},`(${e.linkDisplayName})`)),i.createElement("br",null));a.push(o)})):e.forEach((e=>{const o=i.createElement("span",{role:"alert"},i.createElement(s.Text,null,e.reason),t?i.createElement(s.Text,null,e.noLinkDisplayName):i.createElement(y.Link,{className:h,onClick:t=>{e.resourceLink()},underline:!0},`(${e.linkDisplayName})`));a.push(o)})),0===a.length?null:i.createElement(p.Stack,null,a.map(((e,t)=>i.createElement(p.Stack.Item,{key:t},e)))))}function b(e){return C.invoke("___policyDataCore___validatePolicy",e)}function k(){return o.ReactView.getInstance().inContextPane()||!1}function _(e,t,o,a){r.trace([{timestamp:Date.now(),source:V.ControlPlanePolicy,action:e,data:{...o,additionalTelemetry:a,bladeName:t}}])}function x(e){return null==e}function I(e){return x(e)||""===e.trim()}function R(e){const t=e||"";return t.toLowerCase?.()}class D{constructor(e,t,o,a,l){this._options=e,this._copyOfItems=t,this._inContextPane=a,this._getCustomHtml=l,this._states={disabledState:i.useState(),selectedKeyState:o,section:i.useState(null)}}getProps(){return{disabled:this._states.disabledState[0],sublabel:this._states.section[0]}}getItemsObservable(){return this._copyOfItems}getAllowedValues(){const e=[];return this.getItemsObservable()?.forEach((t=>{const o=this._options.convertValue(t);x(o)||e.push(o)})),e}setDeniedValues(e,t,o){let a=0;const l=t.map((e=>R(e)));if(this.getItemsObservable()?.forEach((t=>{const o=R(this._options.convertValue(t));!I(o)&&l.includes(o)?(t.disabled=!0,a++,this._states.selectedKeyState[0]===t.key&&(this._states.selectedKeyState[1](null),_(V.PolicySelectorChangedSelection,e,{event:V.PolicySelector.Cleared},this._options.additionalTelemetry))):t.disabled=!1})),a){const t=this.getItemsObservable().filter((e=>!e.disabled)),a=1===t.length?u.Policy.AutoSelect.info:u.Policy.ItemsAvailability.info,l=this._getCustomHtml(o,this._inContextPane,!0);this._states.section[1](i.createElement("div",{role:"status","aria-live":"polite"},i.createElement("div",null,i.createElement(n.FrameworkIcon,{className:`${S.icon} ${S.iconSmall}`,image:{type:171}}),i.createElement("div",null,a),i.createElement("div",{className:v},l)))),1===t.length&&(this._states.selectedKeyState[1](t[0].key),_(V.PolicySelectorChangedSelection,e,{event:V.PolicySelector.AutoSelected},this._options.additionalTelemetry),this._states.disabledState[1](!0))}else this._states.section[1](i.createElement(i.Fragment,null)),this._states.disabledState[1](!1)}}})),
define("@microsoft/azureportal-reactview/Locations",["require","exports","react","@microsoft/azureportal-reactview/internal/ReactView","@microsoft/azureportal-reactview/internal/DefaultResourceValidation","@microsoft/azureportal-reactview/ResourceManagement","@microsoft/azureportal-reactview/ControlPlaneValidators","@microsoft/azureportal-reactview/FormLabel","@microsoft/azureportal-reactview/internal/BaseFunctionProxy"],(function(e,t,o,a,l,n,r,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegionSegment=void 0,t.getLocations=function(e,t){return d(e,t).then((({locations:e})=>e))},t.getLocationsAndResourceTypes=d,t.getLocationDisplayNames=function(){return c.getLocationDisplayNames()},t.useLocationValidationEffect=function(e){const[t]=o.useContext(l.DefaultResourceValidationContext),a=o.useMemo((()=>t.resourceTypes?.map((([e])=>e)).sort().join(",")),[t.resourceTypes]);(0,s.useValidationEffect)((()=>{if(t.skipDefault)return[];const o=e.map((e=>n.ArmId.parse(e).resourceName));return(t.resourceTypes||[]).map((async([e,a])=>{const{scopeId:l,resourceScopeId:n}=t,s=await(0,r.ControlPlanePolicyEvaluator)({...n&&{resourceScopeId:n},...l&&{scopeId:l}},{resourceTypeMetadata:{apiVersion:a,resourceType:e,resourceTypeProperty:"location",resourceTypePropertyAlias:""},resolvedValuesToField:o,additionalTelemetry:{DefaultResourceContext:"LocationDropDown"}}),{customHtml:i,allErrorResults:c}=s;return{message:i,state:c.length>0?3:2}}))}),[t.skipDefault,a,e.sort().join(",")])},t.useDeniedLocations=function(e){const[t]=o.useContext(l.DefaultResourceValidationContext),{locationNames:r,locationsMemo:s}=o.useMemo((()=>({locationNames:e.map((e=>n.ArmId.parse(e).resourceName)),locationsMemo:e.sort().join(",")||""})),[e]),i=o.useMemo((()=>t.resourceTypes?.map((e=>e.join(","))).sort().join(",")||""),[t.resourceTypes]),{scopeId:c,resourceScopeId:u}=t;return function(e,t,l,n,r){const[s,i]=o.useState();return o.useEffect((()=>{let o=!0;const r=t;var s;return n&&i([]),!n&&r&&o&&(s={scope:r,resolvedValuesToField:e,bladeName:a.ReactView.getInstance().getViewName(),resourceTypeMetadata:l.resourceTypeMetadata,allowEmptyValues:l.allowEmptyValues,additionalTelemetry:l.additionalTelemetry},m.invoke("___policyDataCore___validatePolicy",s)).then((e=>{o&&i(e.deniedValues)})),()=>{o=!1}}),r),s}(e,{...u&&{resourceScopeId:u},...c&&{scopeId:c}},{resourceTypeMetadata:t?.resourceTypes?.map((([e,t])=>({apiVersion:t,resourceType:e,resourceTypeProperty:"location",resourceTypePropertyAlias:""}))),resolvedValuesToField:r,additionalTelemetry:{DefaultResourceContext:"DisabledLocationsDropDown"}},t.skipDefault,[c,u,i,s])};const c=__InternalAzurePortal.AzInternalApi.internalApi;var u;function d(e,t){return a.ReactView.getInstance().getLocationsForCreate({subscriptionId:e,resourceTypes:t})}!function(e){e.ServiceProvided="ServiceProvided",e.Recommended="Recommended",e.Other="Other"}(u||(t.RegionSegment=u={}));const m=(0,i.getBaseFunctionProxy)()}));