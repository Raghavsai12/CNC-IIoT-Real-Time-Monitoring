define("MsPortalImpl/Widgets/Widgets.NotificationsPane.Component",["require","exports","Weave/DirectMode","Weave","MsPortalImpl/Resources/ImplScriptResources","FxInternal/Weave","FxInternal/Weave/Util","MsPortalImpl/Resources/PortalNotificationsTelemetry","MsPortalImpl/Widgets/Widgets.DropMenu","MsPortalImpl/Widgets/Widgets.DropMenu.Component","_generated/MsPortalImpl/Svg/Library/ThumbsUp.svg","_generated/MsPortalImpl/Svg/Library/ThumbsDown.svg","MsPortalImpl/UI/Hubs/UI.NotificationManager","MsPortalImpl/UI/UI.AuthStateManager","MsPortalImpl/UI/Hubs/UI.NotificationHelper"],(function(t,i,e,n,o,a,s,c,r,l,f,d,m,u,p){"use strict";i.NotificationsPaneInner=function(t){const{vm:i}=t,x=(0,a.toComputation)(i.notifications),g=x.compose(s.isNonEmptyArray),I=x.compose(s.isEmptyArray),P=N?.notifications||Object.create(null),C=P?.activityLogLinkOverride||'#blade/Microsoft_Azure_ActivityLog/ActivityLogBlade/queryInputs/%7B"user"%3A"%40me"%7D',k=P?.activityLogLinkLabelKey?P.activityLogLinkLabelKey:"activityLogLinkText",y=o.NotificationMenu[k]||o.NotificationMenu.activityLogLinkText,T=()=>{MsPortalFx.Base.Diagnostics.Telemetry.trace({source:c.Source.NotificationHub,action:c.Action.NotificationMoreEventsLinkClicked})},_=new r.ViewModel(void 0,void 0,"a",!1,c.Source.NotificationHub);return _.setItemFocusWhenOpen=!0,_.alignMenu=1,e(n.GetContext,{fn:t=>{const i=t.diContainer,a=i.get(u.AuthStateManager).getCurrentUser().emailAddress,s=i.get(FxImpl.Features),c=s.isEnabled("hideactivityloglink"),r=s.isEnabled("usefeedbackinnotifications");return e(n.Fragment,null,e("div",{className:"fxs-notificationspane-header"},e("div",{className:"fxs-notification-header-content"},c?null:e(n.Fragment,null,e("a",{tabindex:"0",className:["fxs-notificationpane-activitylog-link",{"fxs-display-none":I}],href:C,onClick:T},y),e("div",{className:["fxs-notificationmenu-arrow",{"fxs-display-none":I}],image:MsPortalFx.Base.Images.ArrowRight({palette:3})})),e("div",{className:["fxs-notificationspane-dismisscontainer",{"fxs-display-none":I}]},e("div",null,e("a",{href:"#",className:"fxs-notificationspane-dismissitem fxs-portal-text-primary"},o.NotificationMenu.all)),e(l.DropMenu,{className:"fxs-notification-action-menu",vm:_,button:e("div",{className:"fxs-notification-dropdown-button fxs-portal-svg"},e("div",{className:"fxs-notification-dropdown-button-container"},e("div",{className:"fxs-notification-dropdown-button-icon",image:MsPortalFx.Base.Images.CaretDown()}))),buttonLabel:o.NotificationMenu.dismissOptions,content:e("div",{className:"fx-dropmenu-dropdown"},e("ul",{className:"fx-dropmenu-list-system",role:"menu"},h.map(((t,i)=>e("li",{className:"fxs-portal-hover",role:"presentation"},e("a",{href:"",className:"fxs-portal-text fxs-notificationspane-dismissitem",role:"menuitem",title:t.name,tabindex:i?-1:0,data:t},e("div",{className:"fxs-portal-text"},t.name)))))))})))),e("div",{className:"fxs-notificationspane-top"},e(n.If,{condition:g,concealmentBehavior:"remove",trueFn:()=>e("ul",{tabindex:"0","aria-label":o.NotificationMenu.title,className:"fxs-notificationspane-list"},e(n.ForEach,{collection:x,fn:({item:t})=>{const i=`__fxs_notification_${S++}__`,n=t.clickable,s=t.timeSinceNotified?t.timeSinceNotified:b(t.timestamp),c=(0,m.getNotificationData)(t).userVote;return e("li",{tabindex:"-1",className:"fxs-notificationmenu-notification-li fxs-portal-border"},e("div",{className:"fxs-notificationmenu-notification-wrapper"},e("div",{tabindex:"0",className:"fxs-notificationmenu-notification",data:t},e("div",{className:"fxs-notificationmenu-notification-title"},e("div",{className:"fxs-notificationmenu-notification-title-icon",image:(l=t,D[l.status])}),n?e("a",{data:t,href:"#",tabindex:"-1",className:"fxs-notificationmenu-notification-title-text fxs-notificationmenu-notificationclick msportalfx-tooltip-overflow",role:"button",title:t.title,"aria-label":v(t),"aria-describedby":i},t.title):e("div",{data:t,tabindex:"-1",className:"fxs-notificationmenu-notification-title-text msportalfx-tooltip-overflow",title:t.title,"aria-label":v(t),"aria-describedby":i},t.title),t.status===MsPortalFx.Hubs.Notifications.NotificationStatus.InProgress?e("div",{className:"fxs-notificationmenu-notification-title-subtitle fxs-portal-title"},M(t.percentComplete)):null),e("div",{className:["fxs-notificationmenu-notification-description","fxs-portal-title","msportalfx-tooltip-overflow",t.formSection?"fxs-notificationmenu-notification-expandedDescription":""],id:i},(0,p.constructDescription)(t.description,t.descriptionAsHtml)),t.formSection?t.formSection.section("msportalfx-form fxs-notification-inlineform"):null,function(t){return t?.additionalProperties?.subscriptionId&&(t.correlationIds||[]).some((t=>!t.toLowerCase().startsWith("clientnotification")&&!t.toLowerCase().startsWith("fxclientnotification")))}(t)?e("a",{className:"fxs-notificationmenu-notification-details",data:t},o.NotificationMenu.details):null,t.inlineForm||t.formSection?null:e("a",{data:t,href:"#",tabindex:"0",className:"fxs-notification-seemore-link",title:o.NotificationMenu.seeMore,"aria-label":o.NotificationMenu.seeMore,afterMount:t=>{t.parentElement.querySelector(".fxs-notificationmenu-notification-description").scrollHeight>149||t.classList.add("fxs-display-none")}},e("div",{className:"fxs-notification-see-more-less"},o.NotificationMenu.seeMore),e("div",{className:"fxs-notificationmenu-notification-expandIcon",image:MsPortalFx.Base.Images.CaretDown()})),e("div",{className:"fxs-portal-title fxs-notification-user-time-info"},e("div",{className:"fxs-notification-user-time-info-part"},function(t,i){const e=t.caller,n=e&&e.indexOf("@")>0&&e!==i?e:"";return n?o.NotificationMenu.byCallerText.format(n):""}(t,a)),e("time",{className:"fxs-notificationmenu-notification-title-subtitle fxs-notification-user-time-info-part",datetime:s},s)),r?e("div",{className:{"fxs-notification-feedback-wrapper":!0,"fxs-notification-hide":!t?.irisNotificationDetails}},e("div",{className:{"fxs-notification-is-this-helpful":!0,"fxs-notification-hide":c},data:t},o.NotificationMenu.isThisHelpful),e("div",{className:{"fxs-notification-thank-you":!0,"fxs-notification-hide":c.compose((t=>"like"!==t&&"dislike"!==t))},data:t},o.NotificationMenu.thanksForFeedback),e("span",{"aria-label":o.NotificationMenu.thisWasHelpful,className:{"fxs-notification-like-button":!0,"fxs-notification-feedback-selected":c.compose((t=>"like"===t)),"fxs-notification-hide":c},data:t,image:f,role:"button",tabindex:"0"}),e("span",{"aria-label":o.NotificationMenu.thisWasNotHelpful,className:{"fxs-notification-dislike-button":!0,"fxs-notification-feedback-selected":c.compose((t=>"dislike"===t)),"fxs-notification-hide":c},data:t,image:d,role:"button",tabindex:"0"})):e("span",null)),e("div",{role:"button","aria-label":o.NotificationMenu.dismissNotification,className:"fxs-notificationmenu-notification-dismissIcon",data:t,image:MsPortalFx.Base.Images.Close(),tabindex:"0",title:o.NotificationMenu.dismissNotification})));var l}})),falseFn:()=>e("div",{className:"fxs-notifications-empty"},e("div",{className:"fxs-notifications-emptyicon msportalfx-svg-disabled",image:MsPortalFx.Base.Images.Polychromatic.NotificationBell()}),e("div",{className:"nodata-content"},o.NotificationMenu.noNewNotifications),c?null:e("a",{tabindex:"0",className:"fxs-notificationpane-activitylog-link",href:C,onClick:T},y))})))}})},i.iconMap=void 0;var x=MsPortalFx.Base.Images.StatusBadge,g=MsPortalFx.Hubs.Notifications.NotificationStatus;const N=window?.fx?.environment,h=[{name:o.NotificationMenu.informational,dismissableStates:[0],action:"NotificationDismissInformational"},{name:o.NotificationMenu.completed,dismissableStates:[0,1,2,4],action:"NotificationDismissCompleted"}];function v(t){let i=o.NotificationMenu.notificationLabel.format(T[t.status],t.title,b(t.timestamp));return t.percentComplete&&(i+=M(t.percentComplete)),i}function b(t){return t.toRelativeString()}function M(t){return t?o.NotificationMenu.percentComplete.format(t):o.NotificationMenu.inProgress}const I=g.Information,P=g.Warning,C=g.Error,k=g.Success,y=g.InProgress,D=i.iconMap={[I]:x.Info(),[P]:x.Warning(),[C]:x.Error(),[y]:MsPortalFx.Base.Images.Loading.EllipsisSquare(),[k]:x.Success()},T={[I]:o.NotificationMenu.info,[P]:o.NotificationMenu.warning,[C]:o.NotificationMenu.error,[y]:o.NotificationMenu.progress,[k]:o.NotificationMenu.success};let S=0})),
define("MsPortalImpl/Widgets/Widgets.NotificationsPane",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/UI/Hubs/UI.NotificationManager","MsPortalImpl/Resources/PortalNotificationsTelemetry","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/Interactions/Interactions.PortalReader","MsPortalImpl/Weave/DirectRender","MsPortalImpl/Widgets/Widgets.NotificationsPane.Component","WeaveDOM/DirectRender/DataAttribute","MsPortalImpl/Notifications/IrisNotificationsTelemetry"],(function(t,i,e,n,o,a,s,c,r,l,f){"use strict";i.Widget=void 0;var d=MsPortalFx.Base.Diagnostics.Telemetry,m=MsPortalFx.Hubs.Notifications.NotificationStatus;const u=o.Source.NotificationHub,p=o.Action.NotificationDismissAllClicked,x=o.Action.NotificationDismissedFromPane,g=o.ActionModifier.NotificationDismissed,N=o.Action.NotificationMenuOpen,h=o.Action.NotificationMenuClosed,v=o.Action.RecommendationSurfaced,b="TopBar",M=d.trace,I="click",P=e.NotificationMenu,C=P.collapse,k=P.seeMore;function y(t){t.preventDefault(),t.stopPropagation()}function D(t,i,e){t.removeClass("fxs-portal-selected"),t.find(".fxs-notificationmenu-notification-title-text").attr("tabindex","-1"),0!==t.length&&0!==i.length||(i=e),i.addClass("fxs-portal-selected"),i.find(".fxs-notificationmenu-notification-title-text").attr("tabindex","0").focus(),i.get(0).scrollIntoView(!1)}function T(t){if(t){const i=t.dismissableStates;M({source:u,action:t.action}),this.options.notifications.remove((t=>i.includes(t.status)))}else M({source:u,action:p}),this.options.notifications.removeAll(),this.toggleNotificationsContextPane()}function S(t){this.options.notifications.remove(t),M({source:u,action:x,actionModifier:g,data:{notificationId:t.notificationId}});const i=t?.irisNotificationDetails;i&&(0,f.irisTelemetryHandler)({diContainer:this.options.diContainer,messageArg:{irisNotificationDetails:i,action:g},messageContext:null})}function _(t,i,e){const a=(0,n.getNotificationData)(i).userVote;if(a.value)return;a(e);const s=i?.irisNotificationDetails;s&&(0,f.irisTelemetryHandler)({diContainer:t,messageArg:{irisNotificationDetails:s,action:"like"===e?o.ActionModifier.FeedbackLike:o.ActionModifier.FeedbackDislike},messageContext:null}),M({source:u,action:o.Action.FeedbackClicked,data:{extensionName:(0,n.getNotificationData)(i).extensionName,status:i.status,title:i.title,trackingId:i.notificationId,vote:e}})}i.Widget=class{constructor(t,i){this.options=i,this._timerId=null,this._notificationManager=i.diContainer.get(n.NotificationManager),this.options.notifications=this._notificationManager.notifications,this._announce=new s.PortalReader(t,{idPrefix:"notif"}),t.registerForDispose((()=>{this._stopRealTimeUpdating(),this._removeEventHandlers()}))}toggleNotificationsContextPane(){const t=this.options;this._contextPane=t.diContainer.get(a.DockedContextPane);const i=this._contextPane;if(this._stopRealTimeUpdating(),t.isPaneOpen())return t.isPaneOpen(!1),Promise.resolve(i.close(!0));{t.isPaneOpen(!0);const e=this.options.notifications();M({source:b,action:N,data:{notificationCount:e.length}}),this._updateTimeSinceNotified();return e.filter((i=>i.isRecommendation&&i.timestamp.getTime()>t.lastPaneOpenedTime())).forEach((t=>{const i=t.additionalProperties||{};MsPortalFx.extend(i,{status:m[t.status],correlationId:(t.correlationIds||[]).join(",")}),M({source:u,action:v,data:i})})),i.tryOpen(this,!1)}}onAddingContent(t){const i=FxImpl.createElement("div",{class:"fxs-notificationspane"});return t.getWidget().getBladeHost($(i),{title:P.title,bladeWidth:0}).then((e=>{t.getWidget().addChild(e),(0,c.applyToElement)({element:i,ltm:e.ltm,weaveNode:(0,r.NotificationsPaneInner)({vm:this.options}),weaveContext:{diContainer:this.options.diContainer},opName:"NotificationPane"}),$.querySelectorAll(".fxs-topbar-notifications").addClass("fxs-topbar-active"),t.openedFromTopBar(!0),t.getRootElement().addClass("fxs-portal-contextpane-from-topbar"),this._attachEventHandlers($(i)),function(t){const i=t.find(":focusable");i.length&&i.focus()}(t.getRootElement()),function(t){const i=t.find(".fxs-notificationspane-top");i.length&&i.scrollTop(0)}(t.getRootElement())}))}onRemovingContent(t){this._stopRealTimeUpdating(),this.options.isPaneOpen(!1),t.getWidget().clear(),$.querySelectorAll(".fxs-topbar-notifications").removeClass("fxs-topbar-active"),t.openedFromTopBar(!1),t.getRootElement().removeClass("fxs-portal-contextpane-from-topbar"),M({source:b,action:h}),this._removeEventHandlers()}timestampToString(t){return t.toRelativeString()}_attachEventHandlers(t){this._events=t.setEvents([I,".fxs-notificationspane-dismissitem",t=>{y(t);const i=(0,l.getElementData)(t.currentTarget);T.call(this,i)}],[I,".fxs-notificationmenu-notificationclick",t=>{y(t);const i=(0,l.getElementData)(t.currentTarget);this._notificationManager.handleNotificationClick(i,!0)}],[I,".fxs-notificationmenu-notification-details",t=>{y(t);const i=(0,l.getElementData)(t.currentTarget);this._notificationManager.showNotificationDetails(i)}],[I,".fxs-notificationmenu-notification-dismissIcon",t=>{y(t),this._announce.read(P.notificationDismissed);const i=(0,l.getElementData)(t.currentTarget);S.call(this,i)}],[I,".fxs-notification-dislike-button",t=>{y(t);const i=(0,l.getElementData)(t.currentTarget);_(this.options.diContainer,i,"dislike"),this._announce.read(P.thisWasNotHelpfulSelected)}],["keydown",".fxs-notification-dislike-button",t=>{if(13===t.keyCode){y(t);const i=(0,l.getElementData)(t.currentTarget);_(this.options.diContainer,i,"dislike"),this._announce.read(P.thisWasNotHelpfulSelected),$.querySelectorAll("#"+t.currentTarget.id)?.blur()}}],[I,".fxs-notification-like-button",t=>{y(t);const i=(0,l.getElementData)(t.currentTarget);_(this.options.diContainer,i,"like"),this._announce.read(P.thisWasHelpfulSelected)}],["keydown",".fxs-notification-like-button",t=>{if(13===t.keyCode){y(t);const i=(0,l.getElementData)(t.currentTarget);_(this.options.diContainer,i,"like"),this._announce.read(P.thisWasHelpfulSelected),$.querySelectorAll("#"+t.currentTarget.id)?.blur()}}],[I,".fxs-notification-seemore-link",t=>{y(t);!function(t,i){const e=t?.parent()?.find(".fxs-notificationmenu-notification-description");i.inlineForm||(e.hasClass("fxs-notificationmenu-notification-expandedDescription")?(t.attr("aria-label",k),t.attr("title",k),t.find(".fxs-notification-see-more-less").text(k),t.find(".fxs-notificationmenu-notification-expandIcon").removeClass("fxs-notificationmenu-notification-iconVerticalTransform"),e.removeClass("fxs-notificationmenu-notification-expandedDescription")):(t.attr("aria-label",C),t.attr("title",C),t.find(".fxs-notification-see-more-less").text(C),t.find(".fxs-notificationmenu-notification-expandIcon").addClass("fxs-notificationmenu-notification-iconVerticalTransform"),e.addClass("fxs-notificationmenu-notification-expandedDescription")))}($(t.currentTarget),(0,l.getElementData)(t.currentTarget))}],["keydown",".fxs-notificationspane-list",t=>{const i=$(t.currentTarget),e=i.find(".fxs-portal-selected"),n=i.find(".fxs-notificationmenu-notification-li").first(),o=e.nextAll("li");let a;switch(t.keyCode){case 40:a=o.first(),D(e,a,n),t.stopPropagation();break;case 38:a=e[0]===n[0]?o.last():e.prevAll("li").first(),D(e,a,n),t.stopPropagation();break;case 13:case 32:{const i=$(t.target);if(i.hasClass("fxs-notificationmenu-notification-title-text")){const t=(0,l.getElementData)(i[0]);t&&this._notificationManager.handleNotificationClick(t,!0)}t.stopPropagation();break}}}])}_removeEventHandlers(){MsPortalFx.disposeDisposable(this._events),this._events=null}_stopRealTimeUpdating(){clearTimeout(this._timerId),this._timerId=null}_updateTimeSinceNotified(){this.options.notifications().forEach((t=>{t.timeSinceNotified&&t.timeSinceNotified(this.timestampToString(t.timestamp))})),this._timerId=setTimeout(this._updateTimeSinceNotified.bind(this),6e4)}}}));